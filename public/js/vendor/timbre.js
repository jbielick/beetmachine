!function(undefined){"use strict";function setupTypedArray(){function ArrayBuffer(_){for(var shift,a=new Array(_.byteLength),bytes=_.BYTES_PER_ELEMENT,i=0,imax=a.length;imax>i;++i)shift=i%bytes*8,a[i]=(_[i/bytes|0]&255<<shift)>>>shift;return a.__view=_,a}function TypedArray(klass,arg,offset,length){var a,b,bytes,i,imax;if(Array.isArray(arg))if(arg.__view)if("undefined"==typeof offset&&(offset=0),"undefined"==typeof length&&(length=arg.length-offset),bytes=klass.bytes,klass.type===floating)a=arg.__view.slice(offset/bytes|0,(offset+length)/bytes|0);else{for(b=arg.slice(offset,offset+length),a=new Array(b.length/bytes|0),i=0,imax=a.length;imax>i;++i)a[i]=0;for(i=0,imax=b.length;imax>i;++i)a[i/bytes|0]+=(255&b[i])<<i%bytes*8}else a=arg.slice();else a="number"==typeof arg&&arg>0?new Array(0|arg):[];if(klass.type!==floating)for(i=0,imax=a.length;imax>i;++i)a[i]=65535&(+a[i]||0);else for(i=0,imax=a.length;imax>i;++i)a[i]=a[i]||0;if(klass.type===signed)for(i=0,imax=a.length;imax>i;++i)a[i]&1<<8*bytes-1&&(a[i]-=1<<8*bytes);return a.__klass=klass,a.constructor=window[klass.name],a.set=set,a.subarray=subarray,a.BYTES_PER_ELEMENT=klass.bytes,a.byteLength=klass.bytes*a.length,a.byteOffset=offset||0,Object.defineProperty(a,"buffer",{get:function(){return new ArrayBuffer(this)}}),a}var unsigned=0,signed=1,floating=2,set=function(array,offset){"undefined"==typeof offset&&(offset=0);var i,imax=Math.min(this.length-offset,array.length);for(i=0;imax>i;++i)this[offset+i]=array[i]},subarray=function(begin,end){return"undefined"==typeof end&&(end=this.length),new this.constructor(this.slice(begin,end))};[["Int8Array",1,signed],["Uint8Array",1,unsigned],["Int16Array",2,signed],["Uint16Array",2,unsigned],["Int32Array",4,signed],["Uint32Array",4,unsigned],["Float32Array",4,floating],["Float64Array",8,floating]].forEach(function(_params){var name=_params[0],params={bytes:_params[1],type:_params[2],name:name};window[name]=function(arg,offset,length){return TypedArray.call(this,params,arg,offset,length)}})}"undefined"==typeof Float32Array&&setupTypedArray();var timbre=function(){return T.apply(null,arguments)},slice=Array.prototype.slice,FINISHED_STATE=0,PLAYING_STATE=1,UNSCHEDULED_STATE=2,SCHEDULED_STATE=3,ACCEPT_SAMPLERATES=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3],ACCEPT_CELLSIZES=[32,64,128,256],_ver="13.08.03",_sys=null,_constructors={},_factories={},_envtype="undefined"!=typeof module&&module.exports?"node":"undefined"!=typeof window?"browser":"unknown",_envmobile="browser"===_envtype&&/(iPhone|iPad|iPod|Android)/i.test(navigator.userAgent),_f64mode=!1,_bpm=120,T=function(){var t,m,args=slice.call(arguments),key=args[0];switch(typeof key){case"string":_constructors[key]?t=new _constructors[key](args.slice(1)):_factories[key]?t=_factories[key](args.slice(1)):(m=/^(.+?)(?:\.(ar|kr))?$/.exec(key),m&&(key=m[1],_constructors[key]?t=new _constructors[key](args.slice(1)):_factories[key]&&(t=_factories[key](args.slice(1))),t&&m[2]&&t[m[2]]()));break;case"number":t=new NumberWrapper(args);break;case"boolean":t=new BooleanWrapper(args);break;case"function":t=new FunctionWrapper(args);break;case"object":if(null!==key){if(key instanceof TimbreObject)return key;if(key.context instanceof TimbreObject)return key.context;isDictionary(key)?t=new ObjectWrapper(args):isArray(key)&&(t=new ArrayWrapper(args))}}t===undefined&&(t=new AddNode(args.slice(1)),console.warn('T("'+key+'") is not defined.'));var _=t._;return _.originkey=key,_.meta=__buildMetaData(t),_.emit("init"),t},__buildMetaData=function(instance){for(var names,desc,meta=instance._.meta,p=instance;null!==p&&p.constructor!==Object;){names=Object.getOwnPropertyNames(p);for(var i=0,imax=names.length;imax>i;++i)meta[names[i]]||(/^(constructor$|process$|_)/.test(names[i])?meta[names[i]]="ignore":(desc=Object.getOwnPropertyDescriptor(p,names[i]),"function"==typeof desc.value?meta[names[i]]="function":(desc.get||desc.set)&&(meta[names[i]]="property")));p=Object.getPrototypeOf(p)}return meta};Object.defineProperties(timbre,{version:{value:_ver},envtype:{value:_envtype},envmobile:{value:_envmobile},env:{get:function(){return _sys.impl.env}},samplerate:{get:function(){return _sys.samplerate}},channels:{get:function(){return _sys.channels}},cellsize:{get:function(){return _sys.cellsize}},currentTime:{get:function(){return _sys.currentTime}},isPlaying:{get:function(){return _sys.status===PLAYING_STATE}},isRecording:{get:function(){return _sys.status===SCHEDULED_STATE}},amp:{set:function(value){"number"==typeof value&&(_sys.amp=value)},get:function(){return _sys.amp}},bpm:{set:function(value){"number"==typeof value&&value>=5&&300>=value&&(_bpm=value)},get:function(){return _bpm}}}),timbre.bind=function(Klass,opts){return _sys.bind(Klass,opts),timbre},timbre.setup=function(opts){return _sys.setup(opts),timbre},timbre.play=function(){return _sys.play(),timbre},timbre.pause=function(){return _sys.pause(),timbre},timbre.reset=function(){return _sys.reset(),_sys.events.emit("reset"),timbre},timbre.on=timbre.addListener=function(type,listener){return _sys.on(type,listener),timbre},timbre.once=function(type,listener){return _sys.once(type,listener),timbre},timbre.off=timbre.removeListener=function(type,listener){return _sys.off(type,listener),timbre},timbre.removeAllListeners=function(type){return _sys.removeAllListeners(type),timbre},timbre.listeners=function(type){return _sys.listeners(type)},timbre.rec=function(){return _sys.rec.apply(_sys,arguments)},timbre.timevalue=function(){var getbpm=function(str){var m,bpm=_bpm;return(m=/^bpm(\d+(?:\.\d+)?)/i.exec(str))&&(bpm=Math.max(5,Math.min(300,+(m[1]||0)))),bpm};return function(str){var m,ms,x;if(m=/^(\d+(?:\.\d+)?)Hz$/i.exec(str))return 0===+m[1]?0:1e3/+m[1];if(m=/L(\d+)?(\.*)$/i.exec(str))return ms=60/getbpm(str)*(4/(m[1]||4))*1e3,ms*=[1,1.5,1.75,1.875][(m[2]||"").length]||1;if(m=/^(\d+(?:\.\d+)?|\.(?:\d+))(min|sec|m)s?$/i.exec(str))switch(m[2]){case"min":return 60*+(m[1]||0)*1e3;case"sec":return 1e3*+(m[1]||0);case"m":return+(m[1]||0)}return(m=/^(?:([0-5]?[0-9]):)?(?:([0-5]?[0-9]):)(?:([0-5]?[0-9]))(?:\.([0-9]{1,3}))?$/.exec(str))?(x=3600*(m[1]||0)+60*(m[2]||0)+(m[3]||0),x=1e3*x+(0|((m[4]||"")+"00").substr(0,3))):(m=/(\d+)\.(\d+)\.(\d+)$/i.exec(str))?(x=480*(4*m[1]+ +m[2])+ +m[3],60/getbpm(str)*(x/480)*1e3):(m=/(\d+)ticks$/i.exec(str))?60/getbpm(str)*(m[1]/480)*1e3:(m=/^(\d+)samples(?:\/(\d+)Hz)?$/i.exec(str))?1e3*m[1]/(m[2]||timbre.samplerate):0}}();var fn=timbre.fn={SignalArray:Float32Array,currentTimeIncr:0,emptycell:null,FINISHED_STATE:FINISHED_STATE,PLAYING_STATE:PLAYING_STATE,UNSCHEDULED_STATE:UNSCHEDULED_STATE,SCHEDULED_STATE:SCHEDULED_STATE},isArray=fn.isArray=Array.isArray,isDictionary=fn.isDictionary=function(object){return"object"==typeof object&&object.constructor===Object};fn.nop=function(){return this},fn.isSignalArray=function(obj){return obj instanceof fn.SignalArray?!0:Array.isArray(obj)&&obj.__klass&&2===obj.__klass.type?!0:!1},fn.extend=function(child,parent){function ctor(){this.constructor=child}parent=parent||TimbreObject;for(var key in parent)parent.hasOwnProperty(key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},fn.constructorof=function(ctor,Klass){for(var f=ctor&&ctor.prototype;f;){if(f===Klass.prototype)return!0;f=Object.getPrototypeOf(f)}return!1},fn.register=function(key,ctor){fn.constructorof(ctor,TimbreObject)?_constructors[key]=ctor:_factories[key]=ctor},fn.alias=function(key,alias){_constructors[alias]?_constructors[key]=_constructors[alias]:_factories[alias]&&(_factories[key]=_factories[alias])},fn.getClass=function(key){return _constructors[key]},fn.pointer=function(src,offset,length){return offset=src.byteOffset+offset*src.constructor.BYTES_PER_ELEMENT,"number"==typeof length?new src.constructor(src.buffer,offset,length):new src.constructor(src.buffer,offset)},fn.nextTick=function(func){return _sys.nextTick(func),timbre},fn.fixAR=function(self){self._.ar=!0,self._.aronly=!0},fn.fixKR=function(self){self._.ar=!1,self._.kronly=!0},fn.changeWithValue=function(){var _=this._,x=_.value*_.mul+_.add;isNaN(x)&&(x=0);for(var cell=this.cells[0],i=0,imax=cell.length;imax>i;++i)cell[i]=x},fn.changeWithValue.unremovable=!0,fn.clone=function(src){var new_instance=new src.constructor([]);return new_instance._.ar=src._.ar,new_instance._.mul=src._.mul,new_instance._.add=src._.add,new_instance._.bypassed=src._.bypassed,new_instance},fn.timer=function(){var make_onstart=function(self){return function(){-1===_sys.timers.indexOf(self)&&(_sys.timers.push(self),_sys.events.emit("addObject"),self._.emit("start"),fn.buddies_start(self))}},make_onstop=function(self){return function(){var i=_sys.timers.indexOf(self);-1!==i&&(_sys.timers.splice(i,1),self._.emit("stop"),_sys.events.emit("removeObject"),fn.buddies_stop(self))}};return function(self){var onstart=make_onstart(self),onstop=make_onstop(self);return self.nodeType=TimbreObject.TIMER,self.start=function(){return _sys.nextTick(onstart),self},self.stop=function(){return _sys.nextTick(onstop),self},self}}(),fn.listener=function(){var make_onlisten=function(self){return function(){-1===_sys.listeners.indexOf(self)&&(_sys.listeners.push(self),_sys.events.emit("addObject"),self._.emit("listen"),fn.buddies_start(self))}},make_onunlisten=function(self){return function(){var i=_sys.listeners.indexOf(self);-1!==i&&(_sys.listeners.splice(i,1),self._.emit("unlisten"),_sys.events.emit("removeObject"),fn.buddies_stop(self))}};return function(self){var onlisten=make_onlisten(self),onunlisten=make_onunlisten(self);return self.nodeType=TimbreObject.LISTENER,self.listen=function(){return arguments.length&&self.append.apply(self,arguments),self.nodes.length&&_sys.nextTick(onlisten),self},self.unlisten=function(){return arguments.length&&self.remove.apply(self,arguments),self.nodes.length||_sys.nextTick(onunlisten),self},self}}(),fn.make_onended=function(self,lastValue){return function(){if(self.playbackState=FINISHED_STATE,"number"==typeof lastValue)for(var cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=lastValue;self._.emit("ended")}},fn.inputSignalAR=function(self){var i,j,not_clear,tmp,tmpL,tmpR,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],nodes=self.nodes,imax=nodes.length,jmax=cell.length,tickID=self.tickID;if(2===self.numChannels){if(not_clear=!0,0!==imax){for(i=0;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE){nodes[i].process(tickID),cellL.set(nodes[i].cells[1]),cellR.set(nodes[i].cells[2]),not_clear=!1,++i;break}for(;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=jmax;j;)j-=8,cellL[j]+=tmpL[j],cellR[j]+=tmpR[j],cellL[j+1]+=tmpL[j+1],cellR[j+1]+=tmpR[j+1],cellL[j+2]+=tmpL[j+2],cellR[j+2]+=tmpR[j+2],cellL[j+3]+=tmpL[j+3],cellR[j+3]+=tmpR[j+3],cellL[j+4]+=tmpL[j+4],cellR[j+4]+=tmpR[j+4],cellL[j+5]+=tmpL[j+5],cellR[j+5]+=tmpR[j+5],cellL[j+6]+=tmpL[j+6],cellR[j+6]+=tmpR[j+6],cellL[j+7]+=tmpL[j+7],cellR[j+7]+=tmpR[j+7]}not_clear&&(cellL.set(fn.emptycell),cellR.set(fn.emptycell))}else{if(not_clear=!0,0!==imax){for(i=0;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE){nodes[i].process(tickID),cell.set(nodes[i].cells[0]),not_clear=!1,++i;break}for(;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE)for(tmp=nodes[i].process(tickID).cells[0],j=jmax;j;)j-=8,cell[j]+=tmp[j],cell[j+1]+=tmp[j+1],cell[j+2]+=tmp[j+2],cell[j+3]+=tmp[j+3],cell[j+4]+=tmp[j+4],cell[j+5]+=tmp[j+5],cell[j+6]+=tmp[j+6],cell[j+7]+=tmp[j+7]}not_clear&&cell.set(fn.emptycell)}},fn.inputSignalKR=function(self){var i,nodes=self.nodes,imax=nodes.length,tickID=self.tickID,tmp=0;for(i=0;imax>i;++i)nodes[i].playbackState===PLAYING_STATE&&(tmp+=nodes[i].process(tickID).cells[0][0]);return tmp},fn.outputSignalAR=function(self){var i,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],mul=self._.mul,add=self._.add;if(2===self.numChannels)for(i=cell.length;i;)i-=8,cellL[i]=cellL[i]*mul+add,cellR[i]=cellR[i]*mul+add,cellL[i+1]=cellL[i+1]*mul+add,cellR[i+1]=cellR[i+1]*mul+add,cellL[i+2]=cellL[i+2]*mul+add,cellR[i+2]=cellR[i+2]*mul+add,cellL[i+3]=cellL[i+3]*mul+add,cellR[i+3]=cellR[i+3]*mul+add,cellL[i+4]=cellL[i+4]*mul+add,cellR[i+4]=cellR[i+4]*mul+add,cellL[i+5]=cellL[i+5]*mul+add,cellR[i+5]=cellR[i+5]*mul+add,cellL[i+6]=cellL[i+6]*mul+add,cellR[i+6]=cellR[i+6]*mul+add,cellL[i+7]=cellL[i+7]*mul+add,cellR[i+7]=cellR[i+7]*mul+add,cell[i]=.5*(cellL[i]+cellR[i]),cell[i+1]=.5*(cellL[i+1]+cellR[i+1]),cell[i+2]=.5*(cellL[i+2]+cellR[i+2]),cell[i+3]=.5*(cellL[i+3]+cellR[i+3]),cell[i+4]=.5*(cellL[i+4]+cellR[i+4]),cell[i+5]=.5*(cellL[i+5]+cellR[i+5]),cell[i+6]=.5*(cellL[i+6]+cellR[i+6]),cell[i+7]=.5*(cellL[i+7]+cellR[i+7]);else if(1!==mul||0!==add)for(i=cell.length;i;)i-=8,cell[i]=cell[i]*mul+add,cell[i+1]=cell[i+1]*mul+add,cell[i+2]=cell[i+2]*mul+add,cell[i+3]=cell[i+3]*mul+add,cell[i+4]=cell[i+4]*mul+add,cell[i+5]=cell[i+5]*mul+add,cell[i+6]=cell[i+6]*mul+add,cell[i+7]=cell[i+7]*mul+add},fn.outputSignalKR=function(self){var i,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],mul=self._.mul,add=self._.add,value=cell[0]*mul+add;if(2===self.numChannels)for(i=cell.length;i;)i-=8,cell[i]=cell[i+1]=cell[i+2]=cell[i+3]=cell[i+4]=cell[i+5]=cell[i+6]=cell[i+7]=cellL[i]=cellL[i+1]=cellL[i+2]=cellL[i+3]=cellL[i+4]=cellL[i+5]=cellL[i+6]=cellL[i+7]=cellR[i]=cellR[i+1]=cellR[i+2]=cellR[i+3]=cellR[i+4]=cellR[i+5]=cellR[i+6]=cellR[i+7]=value;else for(i=cell.length;i;)i-=8,cell[i]=cell[i+1]=cell[i+2]=cell[i+3]=cell[i+4]=cell[i+5]=cell[i+6]=cell[i+7]=value},fn.buddies_start=function(self){var node,i,imax,buddies=self._.buddies;for(i=0,imax=buddies.length;imax>i;++i)switch(node=buddies[i],node.nodeType){case TimbreObject.DSP:node.play();break;case TimbreObject.TIMER:node.start();break;case TimbreObject.LISTENER:node.listen()}},fn.buddies_stop=function(self){var node,i,imax,buddies=self._.buddies;for(i=0,imax=buddies.length;imax>i;++i)switch(node=buddies[i],node.nodeType){case TimbreObject.DSP:node.pause();break;case TimbreObject.TIMER:node.stop();break;case TimbreObject.LISTENER:node.unlisten()}},fn.fix_iOS6_1_problem=function(flag){_sys.fix_iOS6_1_problem(flag)};var modules=timbre.modules={},EventEmitter=modules.EventEmitter=function(){function EventEmitter(context){this.context=context,this.events={}}var $=EventEmitter.prototype;return $.emit=function(type){var handler=this.events[type];if(!handler)return!1;var args;if("function"==typeof handler){switch(arguments.length){case 1:handler.call(this.context);break;case 2:handler.call(this.context,arguments[1]);break;case 3:handler.call(this.context,arguments[1],arguments[2]);break;default:args=slice.call(arguments,1),handler.apply(this.context,args)}return!0}if(isArray(handler)){args=slice.call(arguments,1);for(var listeners=handler.slice(),i=0,imax=listeners.length;imax>i;++i)listeners[i]instanceof TimbreObject?listeners[i].bang.apply(listeners[i],args):listeners[i].apply(this.context,args);return!0}return handler instanceof TimbreObject?(args=slice.call(arguments,1),void handler.bang.apply(handler,args)):!1},$.on=function(type,listener){if("function"!=typeof listener&&!(listener instanceof TimbreObject))throw new Error("addListener takes instances of Function or timbre.Object");var e=this.events;return e[type]?isArray(e[type])?e[type].push(listener):e[type]=[e[type],listener]:e[type]=listener,this},$.once=function(type,listener){var g,self=this;if("function"==typeof listener)g=function(){self.off(type,g),listener.apply(self.context,arguments)};else{if(!(listener instanceof TimbreObject))throw new Error("once takes instances of Function or timbre.Object");g=function(){self.off(type,g),listener.bang.apply(listener,arguments)}}return g.listener=listener,self.on(type,g),this},$.off=function(type,listener){if("function"!=typeof listener&&!(listener instanceof TimbreObject))throw new Error("removeListener takes instances of Function or timbre.Object");var e=this.events;if(!e[type])return this;var list=e[type];if(isArray(list)){for(var position=-1,i=0,imax=list.length;imax>i;++i)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;list.splice(position,1),0===list.length&&(e[type]=null)}else(list===listener||list.listener&&list.listener===listener)&&(e[type]=null);return this},$.removeAllListeners=function(type){var e=this.events,remain=!1,listeners=e[type];if(isArray(listeners))for(var i=listeners.length;i--;){var listener=listeners[i];listener.unremovable?remain=!0:this.off(type,listener)}else listeners&&(listeners.unremovable?remain=!0:this.off(type,listeners));return remain||(e[type]=null),this},$.listeners=function(type){var a,e=this.events;if(!e[type])return[];if(e=e[type],!isArray(e))return e.unremovable?[]:[e];e=e.slice(),a=[];for(var i=0,imax=e.length;imax>i;++i)e[i].unremovable||a.push(e[i]);return a},EventEmitter}(),Deferred=modules.Deferred=function(){function Deferred(context){this.context=context||this,this._state="pending",this._doneList=[],this._failList=[],this._promise=new Promise(this)}function Promise(object){this.context=object.context,this.then=object.then,this.done=function(){return object.done.apply(object,arguments),this},this.fail=function(){return object.fail.apply(object,arguments),this},this.pipe=function(){return object.pipe.apply(object,arguments)},this.always=function(){return object.always.apply(object,arguments),this},this.promise=function(){return this},this.isResolved=function(){return object.isResolved()},this.isRejected=function(){return object.isRejected()}}var $=Deferred.prototype,exec=function(statue,list,context,args){if("pending"===this._state){this._state=statue;for(var i=0,imax=list.length;imax>i;++i)list[i].apply(context,args);this._doneList=this._failList=null}},isDeferred=function(x){return x&&"function"==typeof x.promise};return $.resolve=function(){var args=slice.call(arguments,0);return exec.call(this,"resolved",this._doneList,this.context||this,args),this},$.resolveWith=function(context){var args=slice.call(arguments,1);return exec.call(this,"resolved",this._doneList,context,args),this},$.reject=function(){var args=slice.call(arguments,0);return exec.call(this,"rejected",this._failList,this.context||this,args),this},$.rejectWith=function(context){var args=slice.call(arguments,1);return exec.call(this,"rejected",this._failList,context,args),this},$.promise=function(){return this._promise},$.done=function(){for(var args=slice.call(arguments),isResolved="resolved"===this._state,isPending="pending"===this._state,list=this._doneList,i=0,imax=args.length;imax>i;++i)"function"==typeof args[i]&&(isResolved?args[i]():isPending&&list.push(args[i]));return this},$.fail=function(){for(var args=slice.call(arguments),isRejected="rejected"===this._state,isPending="pending"===this._state,list=this._failList,i=0,imax=args.length;imax>i;++i)"function"==typeof args[i]&&(isRejected?args[i]():isPending&&list.push(args[i]));return this},$.always=function(){return this.done.apply(this,arguments),this.fail.apply(this,arguments),this},$.then=function(done,fail){return this.done(done).fail(fail)},$.pipe=function(done,fail){var self=this,dfd=new Deferred(this.context);return this.done(function(){var res=done.apply(self.context,arguments);isDeferred(res)?res.then(function(){var args=slice.call(arguments);dfd.resolveWith.apply(dfd,[res].concat(args))}):dfd.resolveWith(self,res)}),this.fail(function(){if("function"==typeof fail){var res=fail.apply(self.context,arguments);isDeferred(res)&&res.fail(function(){var args=slice.call(arguments);dfd.rejectWith.apply(dfd,[res].concat(args))})}else dfd.reject.apply(dfd,arguments)}),dfd.promise()},$.isResolved=function(){return"resolved"===this._state},$.isRejected=function(){return"rejected"===this._state},$.state=function(){return this._state},Deferred.when=function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length;1!==length||isDeferred(subordinate)||(remaining=0);var deferred=1===remaining?subordinate:new Deferred,updateFunc=function(i,results){return function(value){results[i]=arguments.length>1?slice.call(arguments):value,--remaining||deferred.resolve.apply(deferred,results)}};if(length>1)for(var resolveResults=new Array(length),onfailed=function(){deferred.reject()};length>i;++i)resolveValues[i]&&isDeferred(resolveValues[i])?resolveValues[i].promise().done(updateFunc(i,resolveResults)).fail(onfailed):(resolveResults[i]=resolveValues[i],--remaining);return remaining||deferred.resolve.apply(deferred,resolveValues),deferred.promise()},Deferred}(),TimbreObject=timbre.Object=function(){function TimbreObject(numChannels,_args){this._={};var e=this._.events=new EventEmitter(this);if(this._.emit=function(){return e.emit.apply(e,arguments)},isDictionary(_args[0])){var params=_args.shift(),_in=params["in"];this.once("init",function(){this.set(params),_in&&(isArray(_in)?this.append.apply(this,_in):_in instanceof TimbreObject&&this.append(_in))})}switch(this.tickID=-1,this.nodes=_args.map(timbre),this.cells=[],this.numChannels=numChannels,numChannels){case 0:this.L=this.R=new ChannelObject(null),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 1:this.L=this.R=new ChannelObject(this),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 2:this.L=new ChannelObject(this),this.R=new ChannelObject(this),this.cells[0]=new fn.SignalArray(_sys.cellsize),this.cells[1]=this.L.cell,this.cells[2]=this.R.cell}this.playbackState=PLAYING_STATE,this.nodeType=TimbreObject.DSP,this._.ar=!0,this._.mul=1,this._.add=0,this._.dac=null,this._.bypassed=!1,this._.meta={},this._.samplerate=_sys.samplerate,this._.cellsize=_sys.cellsize,this._.buddies=[]}TimbreObject.DSP=1,TimbreObject.TIMER=2,TimbreObject.LISTENER=3;var $=TimbreObject.prototype;return Object.defineProperties($,{isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},isBypassed:{get:function(){return this._.bypassed}},isEnded:{get:function(){return!(1&this.playbackState)}},mul:{set:function(value){"number"==typeof value&&(this._.mul=value,this._.emit("setMul",value))},get:function(){return this._.mul}},add:{set:function(value){"number"==typeof value&&(this._.add=value,this._.emit("setAdd",value))},get:function(){return this._.add}},buddies:{set:function(value){isArray(value)||(value=[value]),this._.buddies=value.filter(function(node){return node instanceof TimbreObject})},get:function(){return this._.buddies}}}),$.toString=function(){return this.constructor.name},$.valueOf=function(){return _sys.tickID!==this.tickID&&this.process(_sys.tickID),this.cells[0][0]},$.append=function(){if(arguments.length>0){var list=slice.call(arguments).map(timbre);this.nodes=this.nodes.concat(list),this._.emit("append",list)}return this},$.appendTo=function(object){return object.append(this),this},$.remove=function(){if(arguments.length>0){for(var j,nodes=this.nodes,list=[],i=0,imax=arguments.length;imax>i;++i)-1!==(j=nodes.indexOf(arguments[i]))&&(list.push(nodes[j]),nodes.splice(j,1));list.length>0&&this._.emit("remove",list)}return this},$.removeFrom=function(object){return object.remove(this),this},$.removeAll=function(){var list=this.nodes.slice();return this.nodes=[],list.length>0&&this._.emit("remove",list),this},$.removeAtIndex=function(index){var item=this.nodes[index];return item&&(this.nodes.splice(index,1),this._.emit("remove",[item])),this},$.postMessage=function(message){return this._.emit("message",message),this},$.to=function(object){if(object instanceof TimbreObject)object.append(this);else{var args=slice.call(arguments);isDictionary(args[1])?args.splice(2,0,this):args.splice(1,0,this),object=T.apply(null,args)}return object},$.splice=function(ins,obj,rem){var i;return obj?obj instanceof TimbreObject&&(i=obj.nodes.indexOf(rem),-1!==i&&obj.nodes.splice(i,1),ins instanceof TimbreObject?(ins.nodes.push(this),obj.nodes.push(ins)):obj.nodes.push(this)):this._.dac&&(ins instanceof TimbreObject?rem instanceof TimbreObject?rem._.dac&&(rem._.dac._.node=ins,ins._.dac=rem._.dac,rem._.dac=null,ins.nodes.push(this)):this._.dac&&(this._.dac._.node=ins,ins._.dac=this._.dac,this._.dac=null,ins.nodes.push(this)):rem instanceof TimbreObject&&rem._.dac&&(rem._.dac._.node=this,this._.dac=rem._.dac,rem._.dac=null)),this},$.on=$.addListener=function(type,listener){return this._.events.on(type,listener),this},$.once=function(type,listener){return this._.events.once(type,listener),this},$.off=$.removeListener=function(type,listener){return this._.events.off(type,listener),this},$.removeAllListeners=function(type){return this._.events.removeAllListeners(type),this},$.listeners=function(type){return this._.events.listeners(type)},$.set=function(key,value){var x,desc,meta=this._.meta;switch(typeof key){case"string":switch(meta[key]){case"property":this[key]=value;break;case"function":this[key](value);break;default:for(x=this;null!==x;)desc=Object.getOwnPropertyDescriptor(x,key),desc&&("function"==typeof desc.value?(meta[key]="function",this[key](value)):(desc.get||desc.set)&&(meta[key]="property",this[key]=value)),x=Object.getPrototypeOf(x)}break;case"object":for(x in key)this.set(x,key[x])}return this},$.get=function(key){return"property"===this._.meta[key]?this[key]:void 0},$.bang=function(){return this._.emit.apply(this,["bang"].concat(slice.call(arguments))),this},$.process=fn.nop,$.bypass=function(){return this._.bypassed=0===arguments.length?!0:!!arguments[0],this},$.play=function(){var dac=this._.dac;return null===dac&&(dac=this._.dac=new SystemInlet(this)),dac.play()&&this._.emit.apply(this,["play"].concat(slice.call(arguments))),fn.buddies_start(this),this},$.pause=function(){var dac=this._.dac;return dac&&dac.playbackState===PLAYING_STATE&&(dac.pause(),this._.dac=null,this._.emit("pause")),fn.buddies_stop(this),this},$.start=$.stop=$.listen=$.unlisten=function(){return this},$.ar=function(){return(0===arguments.length?0:!arguments[0])?this.kr(!0):this._.kronly||(this._.ar=!0,this._.emit("ar",!0)),this},$.kr=function(){return(0===arguments.length?0:!arguments[0])?this.ar(!0):this._.aronly||(this._.ar=!1,this._.emit("ar",!1)),this},$.plot="browser"===_envtype?function(opts){var _=this._,canvas=opts.target;if(!canvas)return this;var foreground,width=opts.width||canvas.width||320,height=opts.height||canvas.height||240,offset_x=(opts.x||0)+.5,offset_y=opts.y||0,context=canvas.getContext("2d");foreground=opts.foreground!==undefined?opts.foreground:_.plotForeground||"rgb(  0, 128, 255)";var background;background=opts.background!==undefined?opts.background:_.plotBackground||"rgb(255, 255, 255)";var x,y,dy,y0,i,lineWidth=opts.lineWidth||_.plotLineWidth||1,cyclic=!!_.plotCyclic,data=_.plotData||this.cells[0],range=opts.range||_.plotRange||[-1.2,1.2],rangeMin=range[0],rangeDelta=height/(range[1]-rangeMin),dx=width/data.length,imax=data.length;if(context.save(),context.rect(offset_x,offset_y,width,height),null!==background&&(context.fillStyle=background,context.fillRect(offset_x,offset_y,width,height)),_.plotBefore&&_.plotBefore.call(this,context,offset_x,offset_y,width,height),_.plotBarStyle)for(context.fillStyle=foreground,x=0,i=0;imax>i;++i)dy=(data[i]-rangeMin)*rangeDelta,y=height-dy,context.fillRect(x+offset_x,y+offset_y,dx,dy),x+=dx;else{for(context.strokeStyle=foreground,context.lineWidth=lineWidth,context.beginPath(),x=0,y0=height-(data[0]-rangeMin)*rangeDelta,context.moveTo(x+offset_x,y0+offset_y),i=1;imax>i;++i)x+=dx,y=height-(data[i]-rangeMin)*rangeDelta,context.lineTo(x+offset_x,y+offset_y);cyclic?context.lineTo(x+dx+offset_x,y0+offset_y):context.lineTo(x+dx+offset_x,y+offset_y),context.stroke()}_.plotAfter&&_.plotAfter.call(this,context,offset_x,offset_y,width,height);var border=opts.border||_.plotBorder;return border&&(context.strokeStyle="string"==typeof border?border:"#000",context.lineWidth=1,context.strokeRect(offset_x,offset_y,width,height)),context.restore(),this}:fn.nop,TimbreObject}(),ChannelObject=timbre.ChannelObject=function(){function ChannelObject(parent){timbre.Object.call(this,-1,[]),fn.fixAR(this),this._.parent=parent,this.cell=new fn.SignalArray(_sys.cellsize),this.L=this.R=this,this.cells[0]=this.cells[1]=this.cells[2]=this.cell,this.numChannels=1}return fn.extend(ChannelObject),ChannelObject.prototype.process=function(tickID){return this.tickID!==tickID&&(this.tickID=tickID,this._.parent&&this._.parent.process(tickID)),this},ChannelObject}(),AddNode=function(){function AddNode(_args){TimbreObject.call(this,2,_args)}return fn.extend(AddNode),AddNode.prototype.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},fn.register("+",AddNode),AddNode}(),NumberWrapper=function(){function NumberWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.value=_args[0],isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(NumberWrapper);var $=NumberWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.value=isNaN(value)?0:value,fn.changeWithValue.call(this))},get:function(){return this._.value}}}),NumberWrapper}(),BooleanWrapper=function(){function BooleanWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.value=_args[0],isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(BooleanWrapper);var $=BooleanWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){this._.value=value?1:0,fn.changeWithValue.call(this)},get:function(){return!!this._.value}}}),BooleanWrapper}(),FunctionWrapper=function(){function FunctionWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.func=_args[0],this._.value=0,isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(FunctionWrapper);var $=FunctionWrapper.prototype;return Object.defineProperties($,{func:{set:function(value){"function"==typeof value&&(this._.func=value)},get:function(){return this._.func}},args:{set:function(value){this._.args=isArray(value)?value:[value]},get:function(){return this._.args}}}),$.bang=function(){var _=this._,args=slice.call(arguments).concat(_.args),x=_.func.apply(this,args);return"number"==typeof x&&(_.value=x,fn.changeWithValue.call(this)),this._.emit("bang"),this},FunctionWrapper}(),ArrayWrapper=function(){function ArrayWrapper(_args){TimbreObject.call(this,1,[]);var i,imax;for(i=0,imax=_args[0].length;imax>i;++i)this.append(_args[0][i]);if(isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}}fn.extend(ArrayWrapper);var $=ArrayWrapper.prototype;return Object.defineProperties($,{}),$.bang=function(){var i,imax,args=["bang"].concat(slice.call(arguments)),nodes=this.nodes;for(i=0,imax=nodes.length;imax>i;++i)nodes[i].bang.apply(nodes[i],args);return this},$.postMessage=function(message){var i,imax,nodes=this.nodes;for(i=0,imax=nodes.length;imax>i;++i)nodes[i].postMessage(message);return this},$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},ArrayWrapper}(),ObjectWrapper=function(){function ObjectWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}}fn.extend(ObjectWrapper);var $=ObjectWrapper.prototype;return Object.defineProperties($,{}),ObjectWrapper}(),SystemInlet=function(){function SystemInlet(object){TimbreObject.call(this,2,[]),this.playbackState=FINISHED_STATE;
var _=this._;_.node=object,_.onplay=make_onplay(this),_.onpause=make_onpause(this)}fn.extend(SystemInlet);var make_onplay=function(self){return function(){-1===_sys.inlets.indexOf(self)&&(_sys.inlets.push(self),_sys.events.emit("addObject"),self.playbackState=PLAYING_STATE,self._.emit("play"))}},make_onpause=function(self){return function(){var i=_sys.inlets.indexOf(self);-1!==i&&(_sys.inlets.splice(i,1),self.playbackState=FINISHED_STATE,self._.emit("pause"),_sys.events.emit("removeObject"))}},$=SystemInlet.prototype;return $.play=function(){return _sys.nextTick(this._.onplay),-1===_sys.inlets.indexOf(this)},$.pause=function(){_sys.nextTick(this._.onpause)},$.process=function(tickID){var node=this._.node;1&node.playbackState?(node.process(tickID),this.cells[1].set(node.cells[1]),this.cells[2].set(node.cells[2])):(this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell))},SystemInlet}(),SoundSystem=function(){function SoundSystem(){this.context=this,this.tickID=0,this.impl=null,this.amp=.8,this.status=FINISHED_STATE,this.samplerate=44100,this.channels=2,this.cellsize=64,this.streammsec=20,this.streamsize=0,this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this.deferred=null,this.recStart=0,this.recBuffers=null,this.delayProcess=make_delayProcess(this),this.events=null,fn.currentTimeIncr=1e3*this.cellsize/this.samplerate,fn.emptycell=new fn.SignalArray(this.cellsize),this.reset(!0)}var make_delayProcess=function(self){return function(){self.recStart=Date.now(),self.process()}},$=SoundSystem.prototype;$.bind=function(Klass,opts){if("function"==typeof Klass){var player=new Klass(this,opts);this.impl=player,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate)}return this},$.setup=function(params){return"object"==typeof params&&(-1!==ACCEPT_SAMPLERATES.indexOf(params.samplerate)&&(this.samplerate=params.samplerate<=this.impl.maxSamplerate?params.samplerate:this.impl.maxSamplerate),-1!==ACCEPT_CELLSIZES.indexOf(params.cellsize)&&(this.cellsize=params.cellsize),"undefined"!=typeof Float64Array&&"undefined"!=typeof params.f64&&(_f64mode=!!params.f64,fn.SignalArray=_f64mode?Float64Array:Float32Array)),fn.currentTimeIncr=1e3*this.cellsize/this.samplerate,fn.emptycell=new fn.SignalArray(this.cellsize),this},$.getAdjustSamples=function(samplerate){var samples,bits;return samplerate=samplerate||this.samplerate,samples=this.streammsec/1e3*samplerate,bits=Math.ceil(Math.log(samples)*Math.LOG2E),bits=8>bits?8:bits>14?14:bits,1<<bits},$.play=function(){return this.status===FINISHED_STATE&&(this.status=PLAYING_STATE,this.streamsize=this.getAdjustSamples(),this.strmL=new fn.SignalArray(this.streamsize),this.strmR=new fn.SignalArray(this.streamsize),this.impl.play(),this.events.emit("play")),this},$.pause=function(){return this.status===PLAYING_STATE&&(this.status=FINISHED_STATE,this.impl.pause(),this.events.emit("pause")),this},$.reset=function(deep){return deep&&(this.events=new EventEmitter(this).on("addObject",function(){this.status===FINISHED_STATE&&this.play()}).on("removeObject",function(){this.status===PLAYING_STATE&&this.inlets.length+this.timers.length+this.listeners.length===0&&this.pause()})),this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this},$.process=function(){var x,tmpL,tmpR,i,j,jmax,k,nextTicks,tickID=this.tickID,strmL=this.strmL,strmR=this.strmR,amp=this.amp,imax=this.streamsize,saved_i=0,kmax=this.cellsize,n=this.streamsize/this.cellsize,timers=this.timers,inlets=this.inlets,listeners=this.listeners,currentTimeIncr=fn.currentTimeIncr;for(i=0;imax>i;++i)strmL[i]=strmR[i]=0;for(;n--;){for(++tickID,j=0,jmax=timers.length;jmax>j;++j)1&timers[j].playbackState&&timers[j].process(tickID);for(j=0,jmax=inlets.length;jmax>j;++j)if(x=inlets[j],x.process(tickID),1&x.playbackState)for(tmpL=x.cells[1],tmpR=x.cells[2],k=0,i=saved_i;kmax>k;++k,++i)strmL[i]+=tmpL[k],strmR[i]+=tmpR[k];for(saved_i+=kmax,j=0,jmax=listeners.length;jmax>j;++j)1&listeners[j].playbackState&&listeners[j].process(tickID);for(this.currentTime+=currentTimeIncr,nextTicks=this.nextTicks.splice(0),j=0,jmax=nextTicks.length;jmax>j;++j)nextTicks[j]()}for(i=0;imax>i;++i)x=strmL[i]*amp,-1>x?x=-1:x>1&&(x=1),strmL[i]=x,x=strmR[i]*amp,-1>x?x=-1:x>1&&(x=1),strmR[i]=x;this.tickID=tickID;var currentTime=this.currentTime;if(this.status===SCHEDULED_STATE){if(2===this.recCh)this.recBuffers.push(new fn.SignalArray(strmL)),this.recBuffers.push(new fn.SignalArray(strmR));else{var strm=new fn.SignalArray(strmL.length);for(i=0,imax=strm.length;imax>i;++i)strm[i]=.5*(strmL[i]+strmR[i]);this.recBuffers.push(strm)}if(currentTime>=this.maxDuration)this.deferred.sub.reject();else if(currentTime>=this.recDuration)this.deferred.sub.resolve();else{var now=Date.now();now-this.recStart>20?setTimeout(this.delayProcess,10):this.process()}}},$.nextTick=function(func){this.status===FINISHED_STATE?func():this.nextTicks.push(func)},$.rec=function(){fn.fix_iOS6_1_problem(!0);var dfd=new Deferred(this);if(this.deferred)return console.warn("rec deferred is exists??"),dfd.reject().promise();if(this.status!==FINISHED_STATE)return console.log("status is not none",this.status),dfd.reject().promise();var i=0,args=arguments,opts=isDictionary(args[i])?args[i++]:{},func=args[i];if("function"!=typeof func)return console.warn("no function"),dfd.reject().promise();this.deferred=dfd,this.status=SCHEDULED_STATE,this.reset();var rec_inlet=new T("+"),inlet_dfd=new Deferred(this),outlet={done:function(){inlet_dfd.resolve.apply(inlet_dfd,slice.call(arguments))},send:function(){rec_inlet.append.apply(rec_inlet,arguments)}},self=this;return inlet_dfd.then(recdone,function(){fn.fix_iOS6_1_problem(!1),recdone.call(self,!0)}),this.deferred.sub=inlet_dfd,this.savedSamplerate=this.samplerate,this.samplerate=opts.samplerate||this.samplerate,this.recDuration=opts.recDuration||1/0,this.maxDuration=opts.maxDuration||6e5,this.recCh=opts.ch||1,2!==this.recCh&&(this.recCh=1),this.recBuffers=[],this.streamsize=this.getAdjustSamples(),this.strmL=new fn.SignalArray(this.streamsize),this.strmR=new fn.SignalArray(this.streamsize),this.inlets.push(rec_inlet),func(outlet),setTimeout(this.delayProcess,10),dfd.promise()};var recdone=function(){this.status=FINISHED_STATE,this.reset();var bufferLength,recBuffers=this.recBuffers,samplerate=this.samplerate,streamsize=this.streamsize;this.samplerate=this.savedSamplerate,bufferLength=1/0!==this.recDuration?this.recDuration*samplerate*.001|0:(recBuffers.length>>this.recCh-1)*streamsize;var result,i,imax=bufferLength/streamsize|0,j=0,k=0,remaining=bufferLength;if(2===this.recCh){var L=new fn.SignalArray(bufferLength),R=new fn.SignalArray(bufferLength),mixed=new fn.SignalArray(bufferLength);for(i=0;imax>i;++i)if(L.set(recBuffers[j++],k),R.set(recBuffers[j++],k),k+=streamsize,remaining-=streamsize,remaining>0&&streamsize>remaining){L.set(recBuffers[j++].subarray(0,remaining),k),R.set(recBuffers[j++].subarray(0,remaining),k);break}for(i=0,imax=bufferLength;imax>i;++i)mixed[i]=.5*(L[i]+R[i]);result={samplerate:samplerate,channels:2,buffer:[mixed,L,R]}}else{var buffer=new fn.SignalArray(bufferLength);for(i=0;imax>i;++i)if(buffer.set(recBuffers[j++],k),k+=streamsize,remaining-=streamsize,remaining>0&&streamsize>remaining){buffer.set(recBuffers[j++].subarray(0,remaining),k);break}result={samplerate:samplerate,channels:1,buffer:[buffer]}}var args=[].concat.apply([result],arguments);this.deferred.resolve.apply(this.deferred,args),this.deferred=null};return $.on=function(type,listeners){this.events.on(type,listeners)},$.once=function(type,listeners){this.events.once(type,listeners)},$.off=function(type,listener){this.events.off(type,listener)},$.removeAllListeners=function(type){this.events.removeListeners(type)},$.listeners=function(type){return this.events.listeners(type)},$.fix_iOS6_1_problem=function(flag){this.impl.fix_iOS6_1_problem&&this.impl.fix_iOS6_1_problem(flag)},SoundSystem}(),ImplClass=null;ImplClass="undefined"!=typeof webkitAudioContext?function(sys){var bufSrc,jsNode,context=new webkitAudioContext;fn._audioContext=context,this.maxSamplerate=context.sampleRate,this.defaultSamplerate=context.sampleRate,this.env="webkit";var ua=navigator.userAgent;if(ua.match(/linux/i)?sys.streammsec*=8:ua.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(sys.streammsec*=4),this.play=function(){var onaudioprocess,x,dx,jsn_streamsize=sys.getAdjustSamples(context.sampleRate),sys_streamsize=sys.streamsize;sys.samplerate===context.sampleRate?onaudioprocess=function(e){var outs=e.outputBuffer;sys.process(),outs.getChannelData(0).set(sys.strmL),outs.getChannelData(1).set(sys.strmR)}:2*sys.samplerate===context.sampleRate?onaudioprocess=function(e){var i,j,inL=sys.strmL,inR=sys.strmR,outs=e.outputBuffer,outL=outs.getChannelData(0),outR=outs.getChannelData(1),imax=outs.length;for(sys.process(),i=j=0;imax>i;i+=2,++j)outL[i]=outL[i+1]=inL[j],outR[i]=outR[i+1]=inR[j]}:(x=sys_streamsize,dx=sys.samplerate/context.sampleRate,onaudioprocess=function(e){var i,inL=sys.strmL,inR=sys.strmR,outs=e.outputBuffer,outL=outs.getChannelData(0),outR=outs.getChannelData(1),imax=outs.length;for(i=0;imax>i;++i)x>=sys_streamsize&&(sys.process(),x-=sys_streamsize),outL[i]=inL[0|x],outR[i]=inR[0|x],x+=dx}),bufSrc=context.createBufferSource(),jsNode=context.createJavaScriptNode(jsn_streamsize,2,sys.channels),jsNode.onaudioprocess=onaudioprocess,bufSrc.noteOn(0),bufSrc.connect(jsNode),jsNode.connect(context.destination)},this.pause=function(){bufSrc.disconnect(),jsNode.disconnect()},_envmobile){var n=0,buf=context.createBufferSource();this.fix_iOS6_1_problem=function(flag){n+=flag?1:-1,1===n?(buf.noteOn(0),buf.connect(context.destination)):0===n&&buf.disconnect()}}}:"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(sys){var timer=function(){var source="var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};",blob=new Blob([source],{type:"text/javascript"}),path=URL.createObjectURL(blob);return new Worker(path)}();this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="moz",this.play=function(){var audio=new Audio,interleaved=new Float32Array(sys.streamsize*sys.channels),streammsec=sys.streammsec,written=0,writtenIncr=sys.streamsize/sys.samplerate*1e3,start=Date.now(),onaudioprocess=function(){if(!(written>Date.now()-start)){var inL=sys.strmL,inR=sys.strmR,i=interleaved.length,j=inL.length;for(sys.process();j--;)interleaved[--i]=inR[j],interleaved[--i]=inL[j];audio.mozWriteAudio(interleaved),written+=writtenIncr}};audio.mozSetup(sys.channels,sys.samplerate),timer.onmessage=onaudioprocess,timer.postMessage(streammsec)},this.pause=function(){timer.postMessage(0)}}:function(){this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="nop",this.play=function(){},this.pause=function(){}},_sys=(new SoundSystem).bind(ImplClass);var exports=timbre;"node"===_envtype?module.exports=global.timbre=exports:"browser"===_envtype&&(exports.noConflict=function(){var _t=window.timbre,_T=window.T;return function(deep){return window.T===exports&&(window.T=_T),deep&&window.timbre===exports&&(window.timbre=_t),exports}}(),window.timbre=window.T=exports),function(){function getFlashPlayerVersion(subs){try{return nav.plugins&&nav.mimeTypes&&nav.mimeTypes.length?nav.plugins["Shockwave Flash"].description.match(/([0-9]+)/)[subs]:new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").match(/([0-9]+)/)[subs]}catch(e){return-1}}if("nop"===_sys.impl.env&&"browser"===_envtype&&!_envmobile){var nav=navigator;if(!(getFlashPlayerVersion(0)<10)){var swf,PlayerDivID="TimbreFlashPlayerDiv",src=function(){var scripts=document.getElementsByTagName("script");if(scripts&&scripts.length)for(var m,i=0,imax=scripts.length;imax>i;++i)if(m=/^(.*\/)timbre(?:\.dev)?\.js$/i.exec(scripts[i].src))return m[1]+"timbre.swf"}();window.timbrejs_flashfallback_init=function(){function TimbreFlashPlayer(sys){var timerId=0;this.maxSamplerate=44100,this.defaultSamplerate=44100,this.env="flash",this.play=function(){var onaudioprocess,interleaved=new Array(sys.streamsize*sys.channels),streammsec=sys.streammsec,written=0,writtenIncr=sys.streamsize/sys.samplerate*1e3,start=Date.now();onaudioprocess=function(){if(!(written>Date.now()-start)){var inL=sys.strmL,inR=sys.strmR,i=interleaved.length,j=inL.length;for(sys.process();j--;)interleaved[--i]=32768*inR[j]|0,interleaved[--i]=32768*inL[j]|0;swf.writeAudio(interleaved.join(" ")),written+=writtenIncr}},swf.setup?(swf.setup(sys.channels,sys.samplerate),timerId=setInterval(onaudioprocess,streammsec)):console.warn("Cannot find "+src)},this.pause=function(){0!==timerId&&(swf.cancel(),clearInterval(timerId),timerId=0)}}_sys.bind(TimbreFlashPlayer),delete window.timbrejs_flashfallback_init};var o,p,swfSrc=src,swfName=swfSrc+"?"+ +new Date,swfId="TimbreFlashPlayer",div=document.createElement("div");div.id=PlayerDivID,div.style.display="inline",div.width=div.height=1,nav.plugins&&nav.mimeTypes&&nav.mimeTypes.length?(o=document.createElement("object"),o.id=swfId,o.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",o.width=o.height=1,o.setAttribute("data",swfName),o.setAttribute("type","application/x-shockwave-flash"),p=document.createElement("param"),p.setAttribute("name","allowScriptAccess"),p.setAttribute("value","always"),o.appendChild(p),div.appendChild(o)):div.innerHTML='<object id="'+swfId+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1"><param name="movie" value="'+swfName+'" /><param name="bgcolor" value="#FFFFFF" /><param name="quality" value="high" /><param name="allowScriptAccess" value="always" /></object>',window.addEventListener("load",function(){document.body.appendChild(div),swf=document[swfId]})}}}()}(),function(T){"use strict";function Biquad(samplerate){this.samplerate=samplerate,this.frequency=340,this.Q=1,this.gain=0,this.x1L=this.x2L=this.y1L=this.y2L=0,this.x1R=this.x2R=this.y1R=this.y2R=0,this.b0=this.b1=this.b2=this.a1=this.a2=0,this.setType("lpf")}var $=Biquad.prototype;$.process=function(cellL,cellR){var xL,xR,yL,yR,i,imax,x1L=this.x1L,x2L=this.x2L,y1L=this.y1L,y2L=this.y2L,x1R=this.x1R,x2R=this.x2R,y1R=this.y1R,y2R=this.y2R,b0=this.b0,b1=this.b1,b2=this.b2,a1=this.a1,a2=this.a2;for(i=0,imax=cellL.length;imax>i;++i)xL=cellL[i],yL=b0*xL+b1*x1L+b2*x2L-a1*y1L-a2*y2L,x2L=x1L,x1L=xL,y2L=y1L,y1L=yL,xR=cellR[i],yR=b0*xR+b1*x1R+b2*x2R-a1*y1R-a2*y2R,x2R=x1R,x1R=xR,y2R=y1R,y1R=yR,cellL[i]=yL,cellR[i]=yR;this.x1L=x1L,this.x2L=x2L,this.y1L=y1L,this.y2L=y2L,this.x1R=x1R,this.x2R=x2R,this.y1R=y1R,this.y2R=y2R},$.setType=function(type){var f;(f=setParams[type])&&(this.type=type,f.call(this,this.frequency,this.Q,this.gain))},$.setParams=function(frequency,Q,dbGain){this.frequency=frequency,this.Q=Q,this.gain=dbGain;var f=setParams[this.type];return f&&f.call(this,frequency,Q,dbGain),this};var setParams={lowpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt(.5*(4-Math.sqrt(16-16/(g*g)))),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta-gamma);this.b0=2*alpha,this.b1=4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},highpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt((4-Math.sqrt(16-16/(g*g)))/2),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta+gamma);this.b0=2*alpha,this.b1=-4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},bandpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=alpha*ia0,this.b1=0,this.b2=-alpha*ia0,this.a1=-2*k*ia0,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=this.b1=this.b2=this.a1=this.a2=0},lowshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne+aMinusOne*k+k2);this.b0=A*(aPlusOne-aMinusOne*k+k2)*ia0,this.b1=2*A*(aMinusOne-aPlusOne*k)*ia0,this.b2=A*(aPlusOne-aMinusOne*k-k2)*ia0,this.a1=-2*(aMinusOne+aPlusOne*k)*ia0,this.a2=(aPlusOne+aMinusOne*k-k2)*ia0}},highshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne-aMinusOne*k+k2);this.b0=A*(aPlusOne+aMinusOne*k+k2)*ia0,this.b1=-2*A*(aMinusOne+aPlusOne*k)*ia0,this.b2=A*(aPlusOne+aMinusOne*k-k2)*ia0,this.a1=2*(aMinusOne-aPlusOne*k)*ia0,this.a2=(aPlusOne-aMinusOne*k-k2)*ia0}},peaking:function(frequency,Q,dbGain){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency){var A=Math.pow(10,dbGain/40);if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha/A);this.b0=(1+alpha*A)*ia0,this.b1=-2*k*ia0,this.b2=(1-alpha*A)*ia0,this.a1=this.b1,this.a2=(1-alpha/A)*ia0}else this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0}else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},notch:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=ia0,this.b1=-2*k*ia0,this.b2=ia0,this.a1=this.b1,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},allpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=(1-alpha)*ia0,this.b1=-2*k*ia0,this.b2=(1+alpha)*ia0,this.a1=this.b1,this.a2=this.b0}else this.b0=-1,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0}};setParams.lpf=setParams.lowpass,setParams.hpf=setParams.highpass,setParams.bpf=setParams.bandpass,setParams.bef=setParams.notch,setParams.brf=setParams.notch,setParams.apf=setParams.allpass,T.modules.Biquad=Biquad}(timbre),function(T){"use strict";function Chorus(samplerate){this.samplerate=samplerate;var bits=Math.round(Math.log(.1*samplerate)*Math.LOG2E);this.buffersize=1<<bits,this.bufferL=new T.fn.SignalArray(this.buffersize+1),this.bufferR=new T.fn.SignalArray(this.buffersize+1),this.wave=null,this._wave=null,this.writeIndex=this.buffersize>>1,this.readIndex=0,this.delayTime=20,this.rate=4,this.depth=20,this.feedback=.2,this.wet=.5,this.phase=0,this.phaseIncr=0,this.phaseStep=4,this.setWaveType("sin"),this.setDelayTime(this.delayTime),this.setRate(this.rate)}var $=Chorus.prototype,waves=[];waves[0]=function(){for(var wave=new Float32Array(512),i=0;512>i;++i)wave[i]=Math.sin(2*Math.PI*(i/512));return wave}(),waves[1]=function(){for(var x,wave=new Float32Array(512),i=0;512>i;++i)x=i/512-.25,wave[i]=1-4*Math.abs(Math.round(x)-x);return wave}(),$.setWaveType=function(waveType){"sin"===waveType?(this.wave=waveType,this._wave=waves[0]):"tri"===waveType&&(this.wave=waveType,this._wave=waves[1])},$.setDelayTime=function(delayTime){this.delayTime=delayTime;for(var readIndex=this.writeIndex-(delayTime*this.samplerate*.001|0);0>readIndex;)readIndex+=this.buffersize;this.readIndex=readIndex},$.setRate=function(rate){this.rate=rate,this.phaseIncr=512*this.rate/this.samplerate*this.phaseStep},$.process=function(cellL,cellR){var x,index,mod,i,j,bufferL=this.bufferL,bufferR=this.bufferR,size=this.buffersize,mask=size-1,wave=this._wave,phase=this.phase,phaseIncr=this.phaseIncr,writeIndex=this.writeIndex,readIndex=this.readIndex,depth=this.depth,feedback=this.feedback,wet=this.wet,dry=1-wet,imax=cellL.length,jmax=this.phaseStep;for(i=0;imax>i;){for(mod=wave[0|phase]*depth,phase+=phaseIncr;phase>512;)phase-=512;for(j=0;jmax>j;++j,++i)index=readIndex+size+mod&mask,x=.5*(bufferL[index]+bufferL[index+1]),bufferL[writeIndex]=cellL[i]-x*feedback,cellL[i]=cellL[i]*dry+x*wet,x=.5*(bufferR[index]+bufferR[index+1]),bufferR[writeIndex]=cellR[i]-x*feedback,cellR[i]=cellR[i]*dry+x*wet,writeIndex=writeIndex+1&mask,readIndex=readIndex+1&mask}this.phase=phase,this.writeIndex=writeIndex,this.readIndex=readIndex},T.modules.Chorus=Chorus}(timbre),function(T){"use strict";function Compressor(samplerate,channels){this.samplerate=samplerate,this.channels=channels,this.lastPreDelayFrames=0,this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.ratio=-1,this.slope=-1,this.linearThreshold=-1,this.dbThreshold=-1,this.dbKnee=-1,this.kneeThreshold=-1,this.kneeThresholdDb=-1,this.ykneeThresholdDb=-1,this.K=-1,this.attackTime=.003,this.releaseTime=.25,this.preDelayTime=.006,this.dbPostGain=0,this.effectBlend=1,this.releaseZone1=.09,this.releaseZone2=.16,this.releaseZone3=.42,this.releaseZone4=.98,this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1,this.delayBufferL=new T.fn.SignalArray(MaxPreDelayFrames),this.delayBufferR=2===channels?new T.fn.SignalArray(MaxPreDelayFrames):this.delayBufferL,this.preDelayTime=6,this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.maxAttackCompressionDiffDb=-1,this.meteringReleaseK=1-Math.exp(-1/(.325*this.samplerate)),this.setAttackTime(this.attackTime),this.setReleaseTime(this.releaseTime),this.setPreDelayTime(this.preDelayTime),this.setParams(-24,30,12)}var MaxPreDelayFrames=1024,MaxPreDelayFramesMask=MaxPreDelayFrames-1,DefaultPreDelayFrames=256,kSpacingDb=5,$=Compressor.prototype;$.clone=function(){var new_instance=new Compressor(this.samplerate,this.channels);return new_instance.setAttackTime(this.attackTime),new_instance.setReleaseTime(this.releaseTime),new_instance.setPreDelayTime(this.preDelayTime),new_instance.setParams(this.dbThreshold,this.dbKnee,this.ratio),new_instance},$.setAttackTime=function(value){this.attackTime=Math.max(.001,value),this._attackFrames=this.attackTime*this.samplerate},$.setReleaseTime=function(value){this.releaseTime=Math.max(.001,value);var releaseFrames=this.releaseTime*this.samplerate,satReleaseTime=.0025;this._satReleaseFrames=satReleaseTime*this.samplerate;var y1=releaseFrames*this.releaseZone1,y2=releaseFrames*this.releaseZone2,y3=releaseFrames*this.releaseZone3,y4=releaseFrames*this.releaseZone4;this._kA=.9999999999999998*y1+1.8432219684323923e-16*y2-1.9373394351676423e-16*y3+8.824516011816245e-18*y4,this._kB=-1.5788320352845888*y1+2.3305837032074286*y2-.9141194204840429*y3+.1623677525612032*y4,this._kC=.5334142869106424*y1-1.272736789213631*y2+.9258856042207512*y3-.18656310191776226*y4,this._kD=.08783463138207234*y1-.1694162967925622*y2+.08588057951595272*y3-.00429891410546283*y4,this._kE=-.042416883008123074*y1+.1115693827987602*y2-.09764676325265872*y3+.028494263462021576*y4},$.setPreDelayTime=function(preDelayTime){this.preDelayTime=preDelayTime;var preDelayFrames=preDelayTime*this.samplerate;if(preDelayFrames>MaxPreDelayFrames-1&&(preDelayFrames=MaxPreDelayFrames-1),this.lastPreDelayFrames!==preDelayFrames){this.lastPreDelayFrames=preDelayFrames;for(var i=0,imax=this.delayBufferL.length;imax>i;++i)this.delayBufferL[i]=this.delayBufferR[i]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=preDelayFrames}},$.setParams=function(dbThreshold,dbKnee,ratio){this._k=this.updateStaticCurveParameters(dbThreshold,dbKnee,ratio);var fullRangeGain=this.saturate(1,this._k),fullRangeMakeupGain=1/fullRangeGain;fullRangeMakeupGain=Math.pow(fullRangeMakeupGain,.6),this._masterLinearGain=Math.pow(10,.05*this.dbPostGain)*fullRangeMakeupGain},$.kneeCurve=function(x,k){return x<this.linearThreshold?x:this.linearThreshold+(1-Math.exp(-k*(x-this.linearThreshold)))/k},$.saturate=function(x,k){var y;if(x<this.kneeThreshold)y=this.kneeCurve(x,k);else{var xDb=x?20*Math.log(x)*Math.LOG10E:-1e3,yDb=this.ykneeThresholdDb+this.slope*(xDb-this.kneeThresholdDb);y=Math.pow(10,.05*yDb)}return y},$.slopeAt=function(x,k){if(x<this.linearThreshold)return 1;var x2=1.001*x,xDb=x?20*Math.log(x)*Math.LOG10E:-1e3,x2Db=x2?20*Math.log(x2)*Math.LOG10E:-1e3,y=this.kneeCurve(x,k),y2=this.kneeCurve(x2,k),yDb=y?20*Math.log(y)*Math.LOG10E:-1e3,y2Db=y2?20*Math.log(y2)*Math.LOG10E:-1e3;return(y2Db-yDb)/(x2Db-xDb)},$.kAtSlope=function(desiredSlope){for(var xDb=this.dbThreshold+this.dbKnee,x=Math.pow(10,.05*xDb),minK=.1,maxK=1e4,k=5,i=0;15>i;++i){var slope=this.slopeAt(x,k);desiredSlope>slope?maxK=k:minK=k,k=Math.sqrt(minK*maxK)}return k},$.updateStaticCurveParameters=function(dbThreshold,dbKnee,ratio){this.dbThreshold=dbThreshold,this.linearThreshold=Math.pow(10,.05*dbThreshold),this.dbKnee=dbKnee,this.ratio=ratio,this.slope=1/this.ratio,this.kneeThresholdDb=dbThreshold+dbKnee,this.kneeThreshold=Math.pow(10,.05*this.kneeThresholdDb);var k=this.kAtSlope(1/this.ratio),y=this.kneeCurve(this.kneeThreshold,k);return this.ykneeThresholdDb=y?20*Math.log(y)*Math.LOG10E:-1e3,this._k=k,this._k},$.process=function(cellL,cellR){for(var dryMix=1-this.effectBlend,wetMix=this.effectBlend,k=this._k,masterLinearGain=this._masterLinearGain,satReleaseFrames=this._satReleaseFrames,kA=this._kA,kB=this._kB,kC=this._kC,kD=this._kD,kE=this._kE,nDivisionFrames=64,nDivisions=cellL.length/nDivisionFrames,frameIndex=0,desiredGain=this.detectorAverage,compressorGain=this.compressorGain,maxAttackCompressionDiffDb=this.maxAttackCompressionDiffDb,i_attackFrames=1/this._attackFrames,preDelayReadIndex=this.preDelayReadIndex,preDelayWriteIndex=this.preDelayWriteIndex,detectorAverage=this.detectorAverage,delayBufferL=this.delayBufferL,delayBufferR=this.delayBufferR,meteringGain=this.meteringGain,meteringReleaseK=this.meteringReleaseK,i=0;nDivisions>i;++i){var envelopeRate,scaledDesiredGain=Math.asin(desiredGain)/(.5*Math.PI),isReleasing=scaledDesiredGain>compressorGain,x=compressorGain/scaledDesiredGain,compressionDiffDb=x?20*Math.log(x)*Math.LOG10E:-1e3;if((1/0===compressionDiffDb||isNaN(compressionDiffDb))&&(compressionDiffDb=-1),isReleasing){maxAttackCompressionDiffDb=-1,x=compressionDiffDb,x=-12>x?0:x>0?3:.25*(x+12);var x2=x*x,x3=x2*x,x4=x2*x2,_releaseFrames=kA+kB*x+kC*x2+kD*x3+kE*x4,_dbPerFrame=kSpacingDb/_releaseFrames;envelopeRate=Math.pow(10,.05*_dbPerFrame)}else{(-1===maxAttackCompressionDiffDb||compressionDiffDb>maxAttackCompressionDiffDb)&&(maxAttackCompressionDiffDb=compressionDiffDb);var effAttenDiffDb=Math.max(.5,maxAttackCompressionDiffDb);x=.25/effAttenDiffDb,envelopeRate=1-Math.pow(x,i_attackFrames)}for(var loopFrames=nDivisionFrames;loopFrames--;){var compressorInput=0,absUndelayedSource=.5*(cellL[frameIndex]+cellR[frameIndex]);delayBufferL[preDelayWriteIndex]=cellL[frameIndex],delayBufferR[preDelayWriteIndex]=cellR[frameIndex],0>absUndelayedSource&&(absUndelayedSource*=-1),absUndelayedSource>compressorInput&&(compressorInput=absUndelayedSource);var absInput=compressorInput;0>absInput&&(absInput*=-1);var shapedInput=this.saturate(absInput,k),attenuation=1e-4>=absInput?1:shapedInput/absInput,attenuationDb=attenuation?-20*Math.log(attenuation)*Math.LOG10E:1e3;2>attenuationDb&&(attenuationDb=2);var dbPerFrame=attenuationDb/satReleaseFrames,satReleaseRate=Math.pow(10,.05*dbPerFrame)-1,isRelease=attenuation>detectorAverage,rate=isRelease?satReleaseRate:1;detectorAverage+=(attenuation-detectorAverage)*rate,detectorAverage>1&&(detectorAverage=1),1>envelopeRate?compressorGain+=(scaledDesiredGain-compressorGain)*envelopeRate:(compressorGain*=envelopeRate,compressorGain>1&&(compressorGain=1));var postWarpCompressorGain=Math.sin(.5*Math.PI*compressorGain),totalGain=dryMix+wetMix*masterLinearGain*postWarpCompressorGain,dbRealGain=20*Math.log(postWarpCompressorGain)*Math.LOG10E;meteringGain>dbRealGain?meteringGain=dbRealGain:meteringGain+=(dbRealGain-meteringGain)*meteringReleaseK,cellL[frameIndex]=delayBufferL[preDelayReadIndex]*totalGain,cellR[frameIndex]=delayBufferR[preDelayReadIndex]*totalGain,frameIndex++,preDelayReadIndex=preDelayReadIndex+1&MaxPreDelayFramesMask,preDelayWriteIndex=preDelayWriteIndex+1&MaxPreDelayFramesMask}1e-6>detectorAverage&&(detectorAverage=1e-6),1e-6>compressorGain&&(compressorGain=1e-6)}this.preDelayReadIndex=preDelayReadIndex,this.preDelayWriteIndex=preDelayWriteIndex,this.detectorAverage=detectorAverage,this.compressorGain=compressorGain,this.maxAttackCompressionDiffDb=maxAttackCompressionDiffDb,this.meteringGain=meteringGain},$.reset=function(){this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1;for(var i=0,imax=this.delayBufferL.length;imax>i;++i)this.delayBufferL[i]=this.delayBufferR[i]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.maxAttackCompressionDiffDb=-1},T.modules.Compressor=Compressor}(timbre),function(T){"use strict";function Decoder(){}Decoder.prototype.decode=function(src,onloadedmetadata,onloadeddata){if("string"==typeof src){if(/\.wav$/.test(src))return Decoder.wav_decode(src,onloadedmetadata,onloadeddata);if(Decoder.ogg_decode&&/\.ogg$/.test(src))return Decoder.ogg_decode(src,onloadedmetadata,onloadeddata);if(Decoder.mp3_decode&&/\.mp3$/.test(src))return Decoder.mp3_decode(src,onloadedmetadata,onloadeddata)}else if("object"==typeof src){if("wav"===src.type)return Decoder.wav_decode(src.data,onloadedmetadata,onloadeddata);if(Decoder.ogg_decode&&"ogg"===src.type)return Decoder.ogg_decode(src.data,onloadedmetadata,onloadeddata);if(Decoder.mp3_decode&&"mp3"===src.type)return Decoder.mp3_decode(src.data,onloadedmetadata,onloadeddata)}return Decoder.webkit_decode?"object"==typeof src?Decoder.webkit_decode(src.data||src,onloadedmetadata,onloadeddata):Decoder.webkit_decode(src,onloadedmetadata,onloadeddata):Decoder.moz_decode?Decoder.moz_decode(src,onloadedmetadata,onloadeddata):void onloadedmetadata(!1)},T.modules.Decoder=Decoder,Decoder.getBinaryWithPath="browser"===T.envtype?function(path,callback){T.fn.fix_iOS6_1_problem(!0);var xhr=new XMLHttpRequest;xhr.open("GET",path),xhr.responseType="arraybuffer",xhr.onreadystatechange=function(){4===xhr.readyState&&(xhr.response?callback(new Uint8Array(xhr.response)):void 0!==xhr.responseBody&&callback(new Uint8Array(VBArray(xhr.responseBody).toArray())),T.fn.fix_iOS6_1_problem(!1))},xhr.send()}:function(path,callback){callback("no support")};var _24bit_to_32bit=function(uint8){for(var b0,b1,b2,bb,x,int32=new Int32Array(uint8.length/3),i=0,imax=uint8.length,j=0;imax>i;)b0=uint8[i++],b1=uint8[i++],b2=uint8[i++],bb=b0+(b1<<8)+(b2<<16),x=8388608&bb?bb-16777216:bb,int32[j++]=x;return int32};Decoder.wav_decode=function(){var _decode=function(data,onloadedmetadata,onloadeddata){if("RIFF"!==String.fromCharCode(data[0],data[1],data[2],data[3]))return onloadedmetadata(!1);var l1=data[4]+(data[5]<<8)+(data[6]<<16)+(data[7]<<24);if(l1+8!==data.length)return onloadedmetadata(!1);if("WAVE"!==String.fromCharCode(data[8],data[9],data[10],data[11]))return onloadedmetadata(!1);if("fmt "!==String.fromCharCode(data[12],data[13],data[14],data[15]))return onloadedmetadata(!1);for(var channels=data[22]+(data[23]<<8),samplerate=data[24]+(data[25]<<8)+(data[26]<<16)+(data[27]<<24),bitSize=data[34]+(data[35]<<8),i=36;i<data.length&&"data"!==String.fromCharCode(data[i],data[i+1],data[i+2],data[i+3]);)i+=1;if(i>=data.length)return onloadedmetadata(!1);i+=4;var l2=data[i]+(data[i+1]<<8)+(data[i+2]<<16)+(data[i+3]<<24),duration=(l2/channels>>1)/samplerate;if(i+=4,l2>data.length-i)return onloadedmetadata(!1);
var mixdown,bufferL,bufferR;mixdown=new Float32Array(duration*samplerate|0),2===channels&&(bufferL=new Float32Array(mixdown.length),bufferR=new Float32Array(mixdown.length)),onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration}),8===bitSize?data=new Int8Array(data.buffer,i):16===bitSize?data=new Int16Array(data.buffer,i):32===bitSize?data=new Int32Array(data.buffer,i):24===bitSize&&(data=_24bit_to_32bit(new Uint8Array(data.buffer,i)));var imax,j,x,k=1/((1<<bitSize-1)-1);if(2===channels)for(i=j=0,imax=mixdown.length;imax>i;++i)x=bufferL[i]=data[j++]*k,x+=bufferR[i]=data[j++]*k,mixdown[i]=.5*x;else for(i=0,imax=mixdown.length;imax>i;++i)mixdown[i]=data[i]*k;onloadeddata()};return function(src,onloadedmetadata,onloadeddata){"string"==typeof src?Decoder.getBinaryWithPath(src,function(data){_decode(data,onloadedmetadata,onloadeddata)}):_decode(src,onloadedmetadata,onloadeddata)}}(),Decoder.webkit_decode=function(){if("undefined"!=typeof webkitAudioContext){var ctx=T.fn._audioContext,_decode=function(data,onloadedmetadata,onloadeddata){var samplerate,channels,bufferL,bufferR,duration;if("string"==typeof data)return onloadeddata(!1);var buffer;try{buffer=ctx.createBuffer(data.buffer,!1)}catch(e){return onloadedmetadata(!1)}samplerate=ctx.sampleRate,channels=buffer.numberOfChannels,2===channels?(bufferL=buffer.getChannelData(0),bufferR=buffer.getChannelData(1)):bufferL=bufferR=buffer.getChannelData(0),duration=bufferL.length/samplerate;for(var mixdown=new Float32Array(bufferL),i=0,imax=mixdown.length;imax>i;++i)mixdown[i]=.5*(mixdown[i]+bufferR[i]);onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration}),onloadeddata()};return function(src,onloadedmetadata,onloadeddata){if(src instanceof File){var reader=new FileReader;reader.onload=function(e){_decode(new Uint8Array(e.target.result),onloadedmetadata,onloadeddata)},reader.readAsArrayBuffer(src)}else"string"==typeof src?Decoder.getBinaryWithPath(src,function(data){_decode(data,onloadedmetadata,onloadeddata)}):_decode(src,onloadedmetadata,onloadeddata)}}}(),Decoder.moz_decode=function(){return"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(src,onloadedmetadata,onloadeddata){var samplerate,channels,mixdown,bufferL,bufferR,duration,writeIndex=0,audio=new Audio(src);audio.volume=0,audio.addEventListener("loadedmetadata",function(){samplerate=audio.mozSampleRate,channels=audio.mozChannels,duration=audio.duration,mixdown=new Float32Array(audio.duration*samplerate|0),2===channels&&(bufferL=new Float32Array(audio.duration*samplerate|0),bufferR=new Float32Array(audio.duration*samplerate|0)),2===channels?audio.addEventListener("MozAudioAvailable",function(e){for(var x,samples=e.frameBuffer,i=0,imax=samples.length;imax>i;i+=2)x=bufferL[writeIndex]=samples[i],x+=bufferR[writeIndex]=samples[i+1],mixdown[writeIndex]=.5*x,writeIndex+=1},!1):audio.addEventListener("MozAudioAvailable",function(e){for(var samples=e.frameBuffer,i=0,imax=samples.length;imax>i;++i)mixdown[i]=samples[i],writeIndex+=1},!1),audio.play(),setTimeout(function(){onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration})},1e3)},!1),audio.addEventListener("ended",function(){onloadeddata()},!1),audio.load()}:void 0}()}(timbre),function(T){"use strict";function Envelope(samplerate){this.samplerate=samplerate||44100,this.value=ZERO,this.status=StatusWait,this.curve="linear",this.step=1,this.releaseNode=null,this.loopNode=null,this.emit=null,this._envValue=new EnvelopeValue(samplerate),this._table=[],this._initValue=ZERO,this._curveValue=0,this._defaultCurveType=CurveTypeLin,this._index=0,this._counter=0}function EnvelopeValue(samplerate){this.samplerate=samplerate,this.value=ZERO,this.step=1,this._curveType=CurveTypeLin,this._curveValue=0,this._grow=0,this._a2=0,this._b1=0,this._y1=0,this._y2=0}var ZERO=Envelope.ZERO=1e-6,CurveTypeSet=Envelope.CurveTypeSet=0,CurveTypeLin=Envelope.CurveTypeLin=1,CurveTypeExp=Envelope.CurveTypeExp=2,CurveTypeSin=Envelope.CurveTypeSin=3,CurveTypeWel=Envelope.CurveTypeWel=4,CurveTypeCurve=Envelope.CurveTypeCurve=5,CurveTypeSqr=Envelope.CurveTypeSqr=6,CurveTypeCub=Envelope.CurveTypeCub=7,StatusWait=Envelope.StatusWait=0,StatusGate=Envelope.StatusGate=1,StatusSustain=Envelope.StatusSustain=2,StatusRelease=Envelope.StatusRelease=3,StatusEnd=Envelope.StatusEnd=4,CurveTypeDict={set:CurveTypeSet,lin:CurveTypeLin,linear:CurveTypeLin,exp:CurveTypeExp,exponential:CurveTypeExp,sin:CurveTypeSin,sine:CurveTypeSin,wel:CurveTypeWel,welch:CurveTypeWel,sqr:CurveTypeSqr,squared:CurveTypeSqr,cub:CurveTypeCub,cubed:CurveTypeCub};Envelope.CurveTypeDict=CurveTypeDict;var $=Envelope.prototype;$.clone=function(){var new_instance=new Envelope(this.samplerate);return new_instance._table=this._table,new_instance._initValue=this._initValue,new_instance.setCurve(this.curve),null!==this.releaseNode&&new_instance.setReleaseNode(this.releaseNode+1),null!==this.loopNode&&new_instance.setLoopNode(this.loopNode+1),new_instance.setStep(this.step),new_instance.reset(),new_instance},$.setTable=function(value){this._initValue=value[0],this._table=value.slice(1),this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=StatusWait},$.setCurve=function(value){"number"==typeof value?(this._defaultCurveType=CurveTypeCurve,this._curveValue=value,this.curve=value):(this._defaultCurveType=CurveTypeDict[value]||null,this.curve=value)},$.setReleaseNode=function(value){"number"==typeof value&&value>0&&(this.releaseNode=value-1)},$.setLoopNode=function(value){"number"==typeof value&&value>0&&(this.loopNode=value-1)},$.setStep=function(step){this.step=this._envValue.step=step},$.reset=function(){this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=StatusWait},$.release=function(){null!==this.releaseNode&&(this._counter=0,this.status=StatusRelease)},$.getInfo=function(sustainTime){var i,imax,table=this._table,totalDuration=0,loopBeginTime=1/0,releaseBeginTime=1/0,isEndlessLoop=!1;for(i=0,imax=table.length;imax>i;++i){this.loopNode===i&&(loopBeginTime=totalDuration),this.releaseNode===i&&(sustainTime>totalDuration?totalDuration+=sustainTime:totalDuration=sustainTime,releaseBeginTime=totalDuration);var items=table[i];Array.isArray(items)&&(totalDuration+=items[1])}return 1/0!==loopBeginTime&&1/0===releaseBeginTime&&(totalDuration+=sustainTime,isEndlessLoop=!0),{totalDuration:totalDuration,loopBeginTime:loopBeginTime,releaseBeginTime:releaseBeginTime,isEndlessLoop:isEndlessLoop}},$.calcStatus=function(){var items,endValue,time,curveType,status=this.status,table=this._table,index=this._index,counter=this._counter,curveValue=this._curveValue,defaultCurveType=this._defaultCurveType,loopNode=this.loopNode,releaseNode=this.releaseNode,envValue=this._envValue,emit=null;switch(status){case StatusWait:case StatusEnd:break;case StatusGate:case StatusRelease:for(;0>=counter;)if(index>=table.length){if(status===StatusGate&&null!==loopNode){index=loopNode;continue}status=StatusEnd,counter=1/0,curveType=CurveTypeSet,emit="ended"}else if(status!==StatusGate||index!==releaseNode)items=table[index++],endValue=items[0],curveType=null===items[2]?defaultCurveType:items[2],curveType===CurveTypeCurve&&(curveValue=items[3],Math.abs(curveValue)<.001&&(curveType=CurveTypeLin)),time=items[1],counter=envValue.setNext(endValue,time,curveType,curveValue);else{if(null!==loopNode&&releaseNode>loopNode){index=loopNode;continue}status=StatusSustain,counter=1/0,curveType=CurveTypeSet,emit="sustained"}}return this.status=status,this.emit=emit,this._index=index,this._counter=counter,status},$.next=function(){return 1&this.calcStatus()&&(this.value=this._envValue.next()||ZERO),this._counter-=1,this.value},$.process=function(cell){var i,envValue=this._envValue,imax=cell.length;if(1&this.calcStatus())for(i=0;imax>i;++i)cell[i]=envValue.next()||ZERO;else{var value=this.value||ZERO;for(i=0;imax>i;++i)cell[i]=value}this.value=cell[imax-1],this._counter-=cell.length},EnvelopeValue.prototype.setNext=function(endValue,time,curveType,curveValue){var grow,w,a1,a2,b1,y1,y2,n=this.step,value=this.value,counter=.001*time*this.samplerate/n|0;switch(1>counter&&(counter=1,curveType=CurveTypeSet),curveType){case CurveTypeSet:this.value=endValue;break;case CurveTypeLin:grow=(endValue-value)/counter;break;case CurveTypeExp:grow=0!==value?Math.pow(endValue/value,1/counter):0;break;case CurveTypeSin:w=Math.PI/counter,a2=.5*(endValue+value),b1=2*Math.cos(w),y1=.5*(endValue-value),y2=y1*Math.sin(.5*Math.PI-w),value=a2-y1;break;case CurveTypeWel:w=.5*Math.PI/counter,b1=2*Math.cos(w),endValue>=value?(a2=value,y1=0,y2=-Math.sin(w)*(endValue-value)):(a2=endValue,y1=value-endValue,y2=Math.cos(w)*(value-endValue)),value=a2+y1;break;case CurveTypeCurve:a1=(endValue-value)/(1-Math.exp(curveValue)),a2=value+a1,b1=a1,grow=Math.exp(curveValue/counter);break;case CurveTypeSqr:y1=Math.sqrt(value),y2=Math.sqrt(endValue),grow=(y2-y1)/counter;break;case CurveTypeCub:y1=Math.pow(value,.33333333),y2=Math.pow(endValue,.33333333),grow=(y2-y1)/counter}return this.next=NextFunctions[curveType],this._grow=grow,this._a2=a2,this._b1=b1,this._y1=y1,this._y2=y2,counter};var NextFunctions=[];NextFunctions[CurveTypeSet]=function(){return this.value},NextFunctions[CurveTypeLin]=function(){return this.value+=this._grow,this.value},NextFunctions[CurveTypeExp]=function(){return this.value*=this._grow,this.value},NextFunctions[CurveTypeSin]=function(){var y0=this._b1*this._y1-this._y2;return this.value=this._a2-y0,this._y2=this._y1,this._y1=y0,this.value},NextFunctions[CurveTypeWel]=function(){var y0=this._b1*this._y1-this._y2;return this.value=this._a2+y0,this._y2=this._y1,this._y1=y0,this.value},NextFunctions[CurveTypeCurve]=function(){return this._b1*=this._grow,this.value=this._a2-this._b1,this.value},NextFunctions[CurveTypeSqr]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1,this.value},NextFunctions[CurveTypeCub]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1*this._y1,this.value},EnvelopeValue.prototype.next=NextFunctions[CurveTypeSet],T.modules.Envelope=Envelope,T.modules.EnvelopeValue=EnvelopeValue}(timbre),function(T){"use strict";function FFT(n){n="number"==typeof n?n:512,n=1<<Math.ceil(Math.log(n)*Math.LOG2E),this.length=n,this.buffer=new T.fn.SignalArray(n),this.real=new T.fn.SignalArray(n),this.imag=new T.fn.SignalArray(n),this._real=new T.fn.SignalArray(n),this._imag=new T.fn.SignalArray(n),this.mag=new T.fn.SignalArray(n>>1),this.minDecibels=-30,this.maxDecibels=-100;var params=FFTParams.get(n);this._bitrev=params.bitrev,this._sintable=params.sintable,this._costable=params.costable}var $=FFT.prototype;$.setWindow=function(key){if("string"==typeof key){var m=/([A-Za-z]+)(?:\(([01]\.?\d*)\))?/.exec(key);if(null!==m){var name=m[1].toLowerCase(),a=void 0!==m[2]?+m[2]:.25,f=WindowFunctions[name];if(f){this._window||(this._window=new T.fn.SignalArray(this.length));var w=this._window,n=0,N=this.length;for(a=0>a?0:a>1?1:a;N>n;++n)w[n]=f(n,N,a);this.windowName=key}}}},$.forward=function(_buffer){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this.real,imag=this.imag,window=this._window,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;if(window)for(i=0;n>i;++i)buffer[i]=_buffer[i]*window[i];else buffer.set(_buffer);for(i=0;n>i;++i)real[i]=buffer[bitrev[i]],imag[i]=0;for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}var rval,ival,mag=this.mag;for(i=0;n>i;++i)rval=real[i],ival=imag[i],mag[i]=Math.sqrt(rval*rval+ival*ival);return{real:real,imag:imag}},$.inverse=function(_real,_imag){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this._real,imag=this._imag,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;for(i=0;n>i;++i)j=bitrev[i],real[i]=+_real[j],imag[i]=-_imag[j];for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}for(i=0;n>i;++i)buffer[i]=real[i]/n;return buffer},$.getFrequencyData=function(array){var i,minDecibels=this.minDecibels,imax=Math.min(this.mag.length,array.length);if(imax){var x,mag=this.mag,peak=0;for(i=0;imax>i;++i)x=mag[i],array[i]=x?20*Math.log(x)*Math.LOG10E:minDecibels,peak<array[i]&&(peak=array[i])}return array};var FFTParams={get:function(n){return FFTParams[n]||function(){var i,imax,bitrev=function(){var x,i,j,k,n2;for(x=new Int16Array(n),n2=n>>1,i=j=0;x[i]=j,!(++i>=n);){for(k=n2;j>=k;)j-=k,k>>=1;j+=k}return x}(),k=Math.floor(Math.log(n)/Math.LN2),sintable=new T.fn.SignalArray((1<<k)-1),costable=new T.fn.SignalArray((1<<k)-1),PI2=2*Math.PI;for(i=0,imax=sintable.length;imax>i;++i)sintable[i]=Math.sin(PI2*(i/n)),costable[i]=Math.cos(PI2*(i/n));return FFTParams[n]={bitrev:bitrev,sintable:sintable,costable:costable},FFTParams[n]}()}},WindowFunctions=function(){var PI=Math.PI,PI2=2*Math.PI,abs=Math.abs,pow=Math.pow,cos=Math.cos,sin=Math.sin,sinc=function(x){return sin(PI*x)/(PI*x)},E=Math.E;return{rectangular:function(){return 1},hann:function(n,N){return.5*(1-cos(PI2*n/(N-1)))},hamming:function(n,N){return.54-.46*cos(PI2*n/(N-1))},tukery:function(n,N,a){return a*(N-1)/2>n?.5*(1+cos(PI*(2*n/(a*(N-1))-1))):n>(N-1)*(1-a/2)?.5*(1+cos(PI*(2*n/(a*(N-1))-2/a+1))):1},cosine:function(n,N){return sin(PI*n/(N-1))},lanczos:function(n,N){return sinc(2*n/(N-1)-1)},triangular:function(n,N){return 2/(N+1)*((N+1)/2-abs(n-(N-1)/2))},bartlett:function(n,N){return 2/(N-1)*((N-1)/2-abs(n-(N-1)/2))},gaussian:function(n,N,a){return pow(E,-.5*pow((n-(N-1)/2)/(a*(N-1)/2),2))},bartlettHann:function(n,N){return.62-.48*abs(n/(N-1)-.5)-.38*cos(PI2*n/(N-1))},blackman:function(n,N,a){var a0=(1-a)/2,a1=.5,a2=a/2;return a0-a1*cos(PI2*n/(N-1))+a2*cos(4*PI*n/(N-1))}}}();T.modules.FFT=FFT}(timbre),function(T){"use strict";function Oscillator(samplerate){this.samplerate=samplerate||44100,this.wave=null,this.step=1,this.frequency=0,this.value=0,this.phase=0,this.feedback=!1,this._x=0,this._lastouts=0,this._coeff=TABLE_SIZE/this.samplerate,this._radtoinc=TABLE_SIZE/(2*Math.PI)}function waveshape(sign,name,shape,width){var _wave,i,imax,j,jmax,wave=Wavetables[name];if(void 0!==wave){switch("function"==typeof wave&&(wave=wave()),shape){case"@1":for(i=512;1024>i;++i)wave[i]=0;break;case"@2":for(i=512;1024>i;++i)wave[i]=Math.abs(wave[i]);break;case"@3":for(i=256;512>i;++i)wave[i]=0;for(i=512;768>i;++i)wave[i]=Math.abs(wave[i]);for(i=768;1024>i;++i)wave[i]=0;break;case"@4":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=wave[i<<1];wave=_wave;break;case"@5":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=Math.abs(wave[i<<1]);wave=_wave}if(void 0!==width&&50!==width){for(width*=.01,width=0>width?0:width>1?1:width,_wave=new Float32Array(1024),imax=1024*width|0,i=0;imax>i;++i)_wave[i]=wave[i/imax*512|0];for(jmax=1024-imax,j=0;1024>i;++i,++j)_wave[i]=wave[j/jmax*512+512|0];wave=_wave}if("+"===sign)for(i=0;1024>i;++i)wave[i]=.5*wave[i]+.5;else if("-"===sign)for(i=0;1024>i;++i)wave[i]*=-1;return wave}}function wavb(src){var wave=new Float32Array(1024),n=src.length>>1;if(-1!==[2,4,8,16,32,64,128,256,512,1024].indexOf(n))for(var i=0,k=0;n>i;++i){var x=parseInt(src.substr(2*i,2),16);x=128&x?(x-256)/128:x/127;for(var j=0,jmax=1024/n;jmax>j;++j)wave[k++]=x}return wave}function wavc(src){var wave=new Float32Array(1024);if(8===src.length){var i,j,color=parseInt(src,16),bar=new Float32Array(8);for(bar[0]=1,i=0;7>i;++i)bar[i+1]=.0625*(15&color),color>>=4;for(i=0;8>i;++i){var x=0,dx=(i+1)/1024;for(j=0;1024>j;++j)wave[j]+=Math.sin(2*Math.PI*x)*bar[i],x+=dx}var absx,maxx=0;for(i=0;1024>i;++i)maxx<(absx=Math.abs(wave[i]))&&(maxx=absx);if(maxx>0)for(i=0;1024>i;++i)wave[i]/=maxx}return wave}var TABLE_SIZE=1024,TABLE_MASK=TABLE_SIZE-1,$=Oscillator.prototype;$.setWave=function(value){var i,dx,wave=this.wave;if(this.wave||(this.wave=new Float32Array(TABLE_SIZE+1)),"function"==typeof value)for(i=0;TABLE_SIZE>i;++i)wave[i]=value(i/TABLE_SIZE);else if(T.fn.isSignalArray(value))if(value.length===wave.length)wave.set(value);else for(dx=value.length/TABLE_SIZE,i=0;TABLE_SIZE>i;++i)wave[i]=value[i*dx|0];else"string"==typeof value&&void 0!==(dx=getWavetable(value))&&this.wave.set(dx);this.wave[TABLE_SIZE]=this.wave[0]},$.clone=function(){var new_instance=new Oscillator(this.samplerate);return new_instance.wave=this.wave,new_instance.step=this.step,new_instance.frequency=this.frequency,new_instance.value=this.value,new_instance.phase=this.phase,new_instance.feedback=this.feedback,new_instance},$.reset=function(){this._x=0},$.next=function(){var x=this._x,index=x+this.phase*this._radtoinc|0;return this.value=this.wave[index&TABLE_MASK],x+=this.frequency*this._coeff*this.step,x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value},$.process=function(cell){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this.frequency*this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=dx;this._lastouts=lastouts}else{var phaseoffset=this.phase*radtoinc;for(i=0;imax>i;++i)phase=x+phaseoffset,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=dx}x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithFreqArray=function(cell,freqs){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=freqs[i]*dx;this._lastouts=lastouts}else{var phaseoffset=this.phase*this._radtoinc;for(i=0;imax>i;++i)phase=x+phaseoffset,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=freqs[i]*dx}x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithPhaseArray=function(cell,phases){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this.frequency*this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=dx;this._lastouts=lastouts}else for(i=0;imax>i;++i)phase=x+phases[i]*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=dx;x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithFreqAndPhaseArray=function(cell,freqs,phases){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=freqs[i]*dx;this._lastouts=lastouts}else for(i=0;imax>i;++i)phase=x+phases[i]*TABLE_SIZE,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=freqs[i]*dx;x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]};var getWavetable=function(key){var wave=Wavetables[key];if(void 0!==wave)return"function"==typeof wave&&(wave=wave()),wave;var m;if(m=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(key),null!==m){var sign=m[1],name=m[2],shape=m[3],width=m[4];if(wave=waveshape(sign,name,shape,width),void 0!==wave)return Wavetables[key]=wave,wave}return m=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(key),null!==m?wavb(m[1]):(m=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(key),null!==m?wavc(m[1]):void 0)};Oscillator.getWavetable=getWavetable;var setWavetable=function(name,value){var dx,i,wave=new Float32Array(1024);if("function"==typeof value)for(i=0;1024>i;++i)wave[i]=value(i/1024);else if(T.fn.isSignalArray(value))if(value.length===wave.length)wave.set(value);else for(dx=value.length/1024,i=0;1024>i;++i)wave[i]=value[i*dx|0];Wavetables[name]=wave};Oscillator.setWavetable=setWavetable;var Wavetables={sin:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=Math.sin(2*Math.PI*(i/1024));return wave},cos:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=Math.cos(2*Math.PI*(i/1024));return wave},pulse:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=512>i?1:-1;return wave},tri:function(){for(var x,wave=new Float32Array(1024),i=0;1024>i;++i)x=i/1024-.25,wave[i]=1-4*Math.abs(Math.round(x)-x);return wave},saw:function(){for(var x,wave=new Float32Array(1024),i=0;1024>i;++i)x=i/1024,wave[i]=2*(x-Math.round(x));return wave},fami:function(){for(var d=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-.125,-.25,-.375,-.5,-.625,-.75,-.875,-1,-1,-.875,-.75,-.625,-.5,-.375,-.25,-.125],wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=d[i/1024*d.length|0];return wave},konami:function(){for(var d=[-.625,-.875,-.125,.75,.5,.125,.5,.75,.25,-.125,.5,.875,.625,0,.25,.375,-.125,-.75,0,.625,.125,-.5,-.375,-.125,-.75,-1,-.625,0,-.375,-.875,-.625,-.25],wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=d[i/1024*d.length|0];return wave}};T.modules.Oscillator=Oscillator}(timbre),function(T){"use strict";function Reverb(samplerate,buffersize){this.samplerate=samplerate;var i,imax,k=samplerate/44100;for(imax=2*CombParams.length,this.comb=new Array(imax),this.combout=new Array(imax),i=0;imax>i;++i)this.comb[i]=new CombFilter(CombParams[i%CombParams.length]*k),this.combout[i]=new T.fn.SignalArray(buffersize);for(imax=2*AllpassParams.length,this.allpass=new Array(imax),i=0;imax>i;++i)this.allpass[i]=new AllpassFilter(AllpassParams[i%AllpassParams.length]*k);this.outputs=[new T.fn.SignalArray(buffersize),new T.fn.SignalArray(buffersize)],this.damp=0,this.wet=.33,this.setRoomSize(.5),this.setDamp(.5)}function CombFilter(buffersize){this.buffer=new T.fn.SignalArray(0|buffersize),this.buffersize=this.buffer.length,this.bufidx=0,this.feedback=0,this.filterstore=0,this.damp=0}function AllpassFilter(buffersize){this.buffer=new T.fn.SignalArray(0|buffersize),this.buffersize=this.buffer.length,this.bufidx=0}var CombParams=[1116,1188,1277,1356,1422,1491,1557,1617],AllpassParams=[225,556,441,341],$=Reverb.prototype;$.setRoomSize=function(roomsize){var comb=this.comb,value=.28*roomsize+.7;this.roomsize=roomsize,comb[0].feedback=comb[1].feedback=comb[2].feedback=comb[3].feedback=comb[4].feedback=comb[5].feedback=comb[6].feedback=comb[7].feedback=comb[8].feedback=comb[9].feedback=comb[10].feedback=comb[11].feedback=comb[12].feedback=comb[13].feedback=comb[14].feedback=comb[15].feedback=value},$.setDamp=function(damp){var comb=this.comb,value=.4*damp;this.damp=damp,comb[0].damp=comb[1].damp=comb[2].damp=comb[3].damp=comb[4].damp=comb[5].damp=comb[6].damp=comb[7].damp=comb[8].damp=comb[9].damp=comb[10].damp=comb[11].damp=comb[12].damp=comb[13].damp=comb[14].damp=comb[15].damp=value},$.process=function(cellL,cellR){var i,comb=this.comb,combout=this.combout,allpass=this.allpass,output0=this.outputs[0],output1=this.outputs[1],wet=this.wet,dry=1-wet,imax=cellL.length;for(comb[0].process(cellL,combout[0]),comb[1].process(cellL,combout[1]),comb[2].process(cellL,combout[2]),comb[3].process(cellL,combout[3]),comb[4].process(cellL,combout[4]),comb[5].process(cellL,combout[5]),comb[6].process(cellL,combout[6]),comb[7].process(cellL,combout[7]),comb[8].process(cellR,combout[8]),comb[9].process(cellR,combout[9]),comb[10].process(cellR,combout[10]),comb[11].process(cellR,combout[11]),comb[12].process(cellR,combout[12]),comb[13].process(cellR,combout[13]),comb[14].process(cellR,combout[14]),comb[15].process(cellR,combout[15]),i=0;imax>i;++i)output0[i]=combout[0][i]+combout[1][i]+combout[2][i]+combout[3][i]+combout[4][i]+combout[5][i]+combout[6][i]+combout[7][i],output1[i]=combout[8][i]+combout[9][i]+combout[10][i]+combout[11][i]+combout[12][i]+combout[13][i]+combout[14][i]+combout[15][i];for(allpass[0].process(output0,output0),allpass[1].process(output0,output0),allpass[2].process(output0,output0),allpass[3].process(output0,output0),allpass[4].process(output1,output1),allpass[5].process(output1,output1),allpass[6].process(output1,output1),allpass[7].process(output1,output1),i=0;imax>i;++i)cellL[i]=output0[i]*wet+cellL[i]*dry,cellR[i]=output1[i]*wet+cellR[i]*dry},CombFilter.prototype.process=function(input,output){var ins,outs,i,buffer=this.buffer,buffersize=this.buffersize,bufidx=this.bufidx,filterstore=this.filterstore,feedback=this.feedback,damp1=this.damp,damp2=1-damp1,imax=input.length;for(i=0;imax>i;++i)ins=.015*input[i],outs=buffer[bufidx],filterstore=outs*damp2+filterstore*damp1,buffer[bufidx]=ins+filterstore*feedback,++bufidx>=buffersize&&(bufidx=0),output[i]=outs;this.bufidx=bufidx,this.filterstore=filterstore},AllpassFilter.prototype.process=function(input,output){var ins,outs,bufout,i,buffer=this.buffer,buffersize=this.buffersize,bufidx=this.bufidx,imax=input.length;for(i=0;imax>i;++i)ins=input[i],bufout=buffer[bufidx],outs=-ins+bufout,buffer[bufidx]=ins+.5*bufout,++bufidx>=buffersize&&(bufidx=0),output[i]=outs;this.bufidx=bufidx},T.modules.Reverb=Reverb}(timbre),function(T){"use strict";function Scissor(soundbuffer){return new Tape(soundbuffer)}function Tape(soundbuffer){if(this.fragments=[],soundbuffer){var samplerate=soundbuffer.samplerate||44100,duration=soundbuffer.buffer[0].length/samplerate;this.fragments.push(new Fragment(soundbuffer,0,duration))}}function Fragment(soundbuffer,start,duration,reverse,pitch,stretch,pan){soundbuffer||(soundbuffer=silencebuffer),this.buffer=soundbuffer.buffer[0],this.samplerate=soundbuffer.samplerate||44100,this.start=start,this._duration=duration,this.reverse=reverse||!1,this.pitch=pitch||100,this.stretch=stretch||!1,this.pan=pan||50}function TapeStream(tape,samplerate){this.tape=tape,this.fragments=tape.fragments,this.samplerate=samplerate||44100,this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5}var DummyBuffer=new Float32Array(60),silencebuffer={buffer:DummyBuffer,samplerate:1};Scissor.silence=function(duration){return new Scissor(silencebuffer).slice(0,1).fill(duration)},Scissor.join=function(tapes){for(var new_instance=new Tape,i=0;i<tapes.length;i++)tapes[i]instanceof Tape&&new_instance.add_fragments(tapes[i].fragments);return new_instance},Scissor.Tape=Tape,Tape.prototype.add_fragment=function(fragment){return this.fragments.push(fragment),this},Tape.prototype.add_fragments=function(fragments){for(var i=0;i<fragments.length;i++)this.fragments.push(fragments[i]);return this},Tape.prototype.duration=function(){for(var result=0,i=0;i<this.fragments.length;i++)result+=this.fragments[i].duration();return result},Tape.prototype.slice=function(start,length){var duration=this.duration();start+length>duration&&(length=duration-start);for(var new_instance=new Tape,remainingstart=start,remaininglength=length,i=0;i<this.fragments.length;i++){var fragment=this.fragments[i],items=fragment.create(remainingstart,remaininglength),new_fragment=items[0];if(remainingstart=items[1],remaininglength=items[2],new_fragment&&new_instance.add_fragment(new_fragment),0===remaininglength)break}return new_instance},Tape.prototype.cut=Tape.prototype.slice,Tape.prototype.concat=function(other){var new_instance=new Tape;return new_instance.add_fragments(this.fragments),new_instance.add_fragments(other.fragments),new_instance},Tape.prototype.loop=function(count){var i,orig_fragments=[];for(i=0;i<this.fragments.length;i++)orig_fragments.push(this.fragments[i].clone());var new_instance=new Tape;for(i=0;count>i;i++)new_instance.add_fragments(orig_fragments);return new_instance},Tape.prototype.times=Tape.prototype.loop,Tape.prototype.split=function(count){for(var splitted_duration=this.duration()/count,results=[],i=0;count>i;i++)results.push(this.slice(i*splitted_duration,splitted_duration));return results},Tape.prototype.fill=function(filled_duration){var duration=this.duration();if(0===duration)throw"EmptyFragment";var loop_count=filled_duration/duration|0,remain=filled_duration%duration;return this.loop(loop_count).plus(this.slice(0,remain))},Tape.prototype.replace=function(start,length,replaced){var new_instance=new Tape,offset=start+length;new_instance=new_instance.plus(this.slice(0,start));var new_instance_duration=new_instance.duration();start>new_instance_duration&&(new_instance=new_instance.plus(Scissor.silence(start-new_instance_duration))),new_instance=new_instance.plus(replaced);var duration=this.duration();return duration>offset&&(new_instance=new_instance.plus(this.slice(offset,duration-offset))),new_instance},Tape.prototype.reverse=function(){for(var new_instance=new Tape,i=this.fragments.length;i--;){var fragment=this.fragments[i].clone();fragment.reverse=!fragment.isReversed(),new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.pitch=function(pitch,stretch){var new_instance=new Tape;stretch=stretch||!1;for(var i=0;i<this.fragments.length;i++){var fragment=this.fragments[i].clone();fragment.pitch*=.01*pitch,fragment.stretch=stretch,new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.stretch=function(factor){var factor_for_pitch=1/(.01*factor)*100;return this.pitch(factor_for_pitch,!0)},Tape.prototype.pan=function(right_percent){var new_instance=new Tape;right_percent>100?right_percent=100:0>right_percent&&(right_percent=0);for(var i=0;i<this.fragments.length;i++){var fragment=this.fragments[i].clone();fragment.pan=right_percent,new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.silence=function(){return Scissor.silence(this.duration())},Tape.prototype.join=function(tapes){for(var new_instance=new Tape,i=0;i<tapes.length;i++)tapes[i]instanceof Tape&&new_instance.add_fragments(tapes[i].fragments);return new_instance},Tape.prototype.getBuffer=function(){var samplerate=44100;this.fragments.length>0&&(samplerate=this.fragments[0].samplerate);var stream=new TapeStream(this,samplerate),total_samples=this.duration()*samplerate|0;return{samplerate:samplerate,buffer:stream.fetch(total_samples)}},Fragment.prototype.duration=function(){return this._duration*(100/this.pitch)},Fragment.prototype.original_duration=function(){return this._duration},Fragment.prototype.isReversed=function(){return this.reverse},Fragment.prototype.isStretched=function(){return this.stretched},Fragment.prototype.create=function(remaining_start,remaining_length){var duration=this.duration();if(remaining_start>=duration)return[null,remaining_start-duration,remaining_length];var new_length,have_remain_to_retuen=remaining_start+remaining_length>=duration;have_remain_to_retuen?(new_length=duration-remaining_start,remaining_length-=new_length):(new_length=remaining_length,remaining_length=0);var new_fragment=this.clone();return new_fragment.start=this.start+remaining_start*this.pitch*.01,new_fragment._duration=new_length*this.pitch*.01,new_fragment.reverse=!1,[new_fragment,0,remaining_length]},Fragment.prototype.clone=function(){var new_instance=new Fragment;return new_instance.buffer=this.buffer,new_instance.samplerate=this.samplerate,new_instance.start=this.start,new_instance._duration=this._duration,new_instance.reverse=this.reverse,new_instance.pitch=this.pitch,new_instance.stretch=this.stretch,new_instance.pan=this.pan,new_instance
},Scissor.Fragment=Fragment,Scissor.TapeStream=TapeStream,TapeStream.prototype.reset=function(){return this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5,this.isLooped=!1,this},TapeStream.prototype.fetch=function(n){var cellL=new T.fn.SignalArray(n),cellR=new T.fn.SignalArray(n),fragments=this.fragments;if(0===fragments.length)return[cellL,cellR];for(var pan,samplerate=100*this.samplerate,buffer=this.buffer,bufferIndex=this.bufferIndex,bufferIndexIncr=this.bufferIndexIncr,bufferBeginIndex=this.bufferBeginIndex,bufferEndIndex=this.bufferEndIndex,fragment=this.fragment,fragmentIndex=this.fragmentIndex,panL=this.panL,panR=this.panR,i=0;n>i;i++){for(;!buffer||bufferBeginIndex>bufferIndex||bufferIndex>=bufferEndIndex;)if(!fragment||fragmentIndex<fragments.length)fragment=fragments[fragmentIndex++],buffer=fragment.buffer,bufferIndexIncr=fragment.samplerate/samplerate*fragment.pitch,bufferBeginIndex=fragment.start*fragment.samplerate,bufferEndIndex=bufferBeginIndex+fragment.original_duration()*fragment.samplerate,pan=.01*fragment.pan,panL=1-pan,panR=pan,fragment.reverse?(bufferIndexIncr*=-1,bufferIndex=bufferEndIndex+bufferIndexIncr):bufferIndex=bufferBeginIndex;else{if(!this.isLooped){this.isEnded=!0,buffer=DummyBuffer,bufferIndexIncr=0,bufferIndex=0;break}buffer=null,bufferIndex=0,bufferIndexIncr=0,bufferBeginIndex=0,bufferEndIndex=0,fragment=null,fragmentIndex=0}cellL[i]=buffer[0|bufferIndex]*panL,cellR[i]=buffer[0|bufferIndex]*panR,bufferIndex+=bufferIndexIncr}return this.buffer=buffer,this.bufferIndex=bufferIndex,this.bufferIndexIncr=bufferIndexIncr,this.bufferBeginIndex=bufferBeginIndex,this.bufferEndIndex=bufferEndIndex,this.fragment=fragment,this.fragmentIndex=fragmentIndex,this.panL=panL,this.panR=panR,[cellL,cellR]},T.modules.Scissor=Scissor}(timbre),function(T){"use strict";function StereoDelay(samplerate){this.samplerate=samplerate;var bits=Math.ceil(Math.log(1.5*samplerate)*Math.LOG2E);this.buffersize=1<<bits,this.buffermask=this.buffersize-1,this.writeBufferL=new T.fn.SignalArray(this.buffersize),this.writeBufferR=new T.fn.SignalArray(this.buffersize),this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR,this.delaytime=null,this.feedback=null,this.cross=null,this.mix=null,this.prevL=0,this.prevR=0,this.readIndex=0,this.writeIndex=0,this.setParams(125,.25,!1,.45)}var $=StereoDelay.prototype;$.setParams=function(delaytime,feedback,cross,mix){if(this.delaytime!==delaytime){this.delaytime=delaytime;var offset=.001*delaytime*this.samplerate|0;offset>this.buffermask&&(offset=this.buffermask),this.writeIndex=this.readIndex+offset&this.buffermask}this.feedback!==feedback&&(this.feedback=feedback),this.cross!==cross&&(this.cross=cross,cross?(this.readBufferL=this.writeBufferR,this.readBufferR=this.writeBufferL):(this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR)),this.mix!==mix&&(this.mix=mix)},$.process=function(cellL,cellR){var x,i,readBufferL=this.readBufferL,readBufferR=this.readBufferR,writeBufferL=this.writeBufferL,writeBufferR=this.writeBufferR,readIndex=this.readIndex,writeIndex=this.writeIndex,mask=this.buffermask,fb=this.feedback,wet=this.mix,dry=1-wet,prevL=this.prevL,prevR=this.prevR,imax=cellL.length;for(i=0;imax>i;++i)x=readBufferL[readIndex],writeBufferL[writeIndex]=cellL[i]-x*fb,cellL[i]=prevL=.5*(cellL[i]*dry+x*wet+prevL),x=readBufferR[readIndex],writeBufferR[writeIndex]=cellR[i]-x*fb,cellR[i]=prevR=.5*(cellR[i]*dry+x*wet+prevR),readIndex+=1,writeIndex=writeIndex+1&mask;this.readIndex=readIndex&this.buffermask,this.writeIndex=writeIndex,this.prevL=prevL,this.prevR=prevR},T.modules.StereoDelay=StereoDelay}(timbre),function(T){"use strict";var fn=T.fn,modules=T.modules;fn.register("audio",function(_args){var BufferNode=fn.getClass("buffer"),instance=new BufferNode(_args);return instance.playbackState=fn.FINISHED_STATE,instance._.isLoaded=!1,Object.defineProperties(instance,{isLoaded:{get:function(){return this._.isLoaded}}}),instance.load=load,instance.loadthis=loadthis,instance});var load=function(src){var self=this,_=this._,dfd=new modules.Deferred(this),args=arguments,i=1;dfd.done(function(){self._.emit("done")}),"function"==typeof args[i]&&(dfd.done(args[i++]),"function"==typeof args[i]&&dfd.fail(args[i++])),_.loadedTime=0;var onloadedmetadata=function(result,msg){var _=self._;result?(self.playbackState=fn.PLAYING_STATE,_.samplerate=result.samplerate,_.channels=result.channels,_.bufferMix=null,_.buffer=result.buffer,_.phase=0,_.phaseIncr=result.samplerate/T.samplerate,_.duration=1e3*result.duration,_.currentTime=0,_.isReversed&&(_.phaseIncr*=-1,_.phase=result.buffer[0].length+_.phaseIncr),self._.emit("loadedmetadata")):dfd.reject(msg)},onloadeddata=function(){self._.isLoaded=!0,self._.plotFlush=!0,self._.emit("loadeddata"),dfd.resolveWith(self)};return(new modules.Decoder).decode(src,onloadedmetadata,onloadeddata),dfd.promise()},loadthis=function(){return load.apply(this,arguments),this}}(timbre),function(T){"use strict";function BiquadNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.biquad=new Biquad(_.samplerate),_.freq=T(340),_.band=T(1),_.gain=T(0),_.plotBefore=plotBefore,_.plotRange=[-18,18],_.plotFlush=!0}var fn=T.fn,FFT=T.modules.FFT,Biquad=T.modules.Biquad,PLOT_LOW_FREQ=20;fn.extend(BiquadNode);var plotBefore=function(context,x,y,width,height){context.lineWidth=1,context.strokeStyle="rgb(192, 192, 192)";for(var nyquist=.5*this._.samplerate,i=1;10>=i;++i)for(var j=1;4>=j;j++){var f=i*Math.pow(10,j);if(!(PLOT_LOW_FREQ>=f||f>=nyquist)){context.beginPath();var _x=Math.log(f/PLOT_LOW_FREQ)/Math.log(nyquist/PLOT_LOW_FREQ);_x=(_x*width+x|0)+.5,context.moveTo(_x,y),context.lineTo(_x,y+height),context.stroke()}}var h=height/6;for(i=1;6>i;i++){context.beginPath();var _y=(y+i*h|0)+.5;context.moveTo(x,_y),context.lineTo(x+width,_y),context.stroke()}},$=BiquadNode.prototype;Object.defineProperties($,{type:{set:function(value){var _=this._;value!==_.biquad.type&&(_.biquad.setType(value),_.plotFlush=!0)},get:function(){return this._.biquad.type}},freq:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}},cutoff:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}},res:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},Q:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},band:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},gain:{set:function(value){this._.gain=T(value)},get:function(){return this._.gain}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var freq=_.freq.process(tickID).cells[0][0],band=_.band.process(tickID).cells[0][0],gain=_.gain.process(tickID).cells[0][0];(_.prevFreq!==freq||_.prevband!==band||_.prevGain!==gain)&&(_.prevFreq=freq,_.prevband=band,_.prevGain=gain,_.biquad.setParams(freq,band,gain),_.plotFlush=!0),_.bypassed||_.biquad.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)}return this};var fft=new FFT(2048),super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var biquad=new Biquad(this._.samplerate);biquad.setType(this.type),biquad.setParams(this.freq.valueOf(),this.band.valueOf(),this.gain.valueOf());var impluse=new Float32Array(fft.length);impluse[0]=1,biquad.process(impluse,impluse),fft.forward(impluse);var i,j,f,index,delta,x0,x1,xx,size=512,data=new Float32Array(size),nyquist=.5*this._.samplerate,spectrum=new Float32Array(size);for(fft.getFrequencyData(spectrum),i=0;size>i;++i)f=Math.pow(nyquist/PLOT_LOW_FREQ,i/size)*PLOT_LOW_FREQ,j=f/(nyquist/spectrum.length),index=0|j,delta=j-index,0===index?x1=x0=xx=spectrum[index]:(x0=spectrum[index-1],x1=spectrum[index],xx=(1-delta)*x0+delta*x1),data[i]=xx;this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("biquad",BiquadNode),fn.register("lowpass",function(_args){return new BiquadNode(_args).set("type","lowpass")}),fn.register("highpass",function(_args){return new BiquadNode(_args).set("type","highpass")}),fn.register("bandpass",function(_args){return new BiquadNode(_args).set("type","bandpass")}),fn.register("lowshelf",function(_args){return new BiquadNode(_args).set("type","lowshelf")}),fn.register("highshelf",function(_args){return new BiquadNode(_args).set("type","highshelf")}),fn.register("peaking",function(_args){return new BiquadNode(_args).set("type","peaking")}),fn.register("notch",function(_args){return new BiquadNode(_args).set("type","notch")}),fn.register("allpass",function(_args){return new BiquadNode(_args).set("type","allpass")}),fn.alias("lpf","lowpass"),fn.alias("hpf","highpass"),fn.alias("bpf","bandpass"),fn.alias("bef","notch"),fn.alias("brf","notch"),fn.alias("apf","allpass")}(timbre),function(T){"use strict";function BufferNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.pitch=T(1),_.samplerate=44100,_.channels=0,_.bufferMix=null,_.buffer=[],_.isLooped=!1,_.isReversed=!1,_.duration=0,_.currentTime=0,_.currentTimeObj=null,_.phase=0,_.phaseIncr=0,_.onended=fn.make_onended(this,0),_.onlooped=make_onlooped(this)}var fn=T.fn,Tape=T.modules.Scissor.Tape,isSignalArray=function(obj){return fn.isSignalArray(obj)||obj instanceof Float32Array};fn.extend(BufferNode);var make_onlooped=function(self){return function(){var _=self._;_.phase>=_.buffer[0].length?_.phase=0:_.phase<0&&(_.phase=_.buffer[0].length+_.phaseIncr),self._.emit("looped")}},$=BufferNode.prototype,setBuffer=function(value){var _=this._;if("object"==typeof value){var samplerate,channels,buffer=[];isSignalArray(value)?(buffer[0]=value,channels=1):"object"==typeof value&&(value instanceof T.Object?value=value.buffer:value instanceof Tape&&(value=value.getBuffer()),Array.isArray(value.buffer)?isSignalArray(value.buffer[0])&&(isSignalArray(value.buffer[1])&&isSignalArray(value.buffer[2])?(channels=2,buffer=value.buffer):(channels=1,buffer=[value.buffer[0]])):isSignalArray(value.buffer)&&(channels=1,buffer=[value.buffer]),"number"==typeof value.samplerate&&(samplerate=value.samplerate)),buffer.length&&(samplerate>0&&(_.samplerate=value.samplerate),_.bufferMix=null,_.buffer=buffer,_.phase=0,_.phaseIncr=_.samplerate/T.samplerate,_.duration=1e3*_.buffer[0].length/_.samplerate,_.currentTime=0,_.plotFlush=!0,this.reverse(_.isReversed))}};Object.defineProperties($,{buffer:{set:setBuffer,get:function(){var _=this._;return{samplerate:_.samplerate,channels:_.channels,buffer:_.buffer}}},pitch:{set:function(value){this._.pitch=T(value)},get:function(){return this._.pitch}},isLooped:{get:function(){return this._.isLooped}},isReversed:{get:function(){return this._.isReversed}},samplerate:{get:function(){return this._.samplerate}},duration:{get:function(){return this._.duration}},currentTime:{set:function(value){if("number"==typeof value){var _=this._;value>=0&&value<=_.duration&&(_.phase=value/1e3*_.samplerate,_.currentTime=value)}else value instanceof T.Object?this._.currentTimeObj=value:null===value&&(this._.currentTimeObj=null)},get:function(){return this._.currentTimeObj?this._.currentTimeObj:this._.currentTime}}}),$.clone=function(){var _=this._,instance=fn.clone(this);return _.buffer.length&&setBuffer.call(instance,{buffer:_.buffer,samplerate:_.samplerate,channels:_.channels}),instance.loop(_.isLooped),instance.reverse(_.isReversed),instance},$.slice=function(begin,end){var _=this._,instance=T(_.originkey),isReversed=_.isReversed;if(_.buffer.length){if(begin="number"==typeof begin?.001*begin*_.samplerate|0:0,end="number"==typeof end?.001*end*_.samplerate|0:_.buffer[0].length,begin>end){var tmp=begin;begin=end,end=tmp,isReversed=!isReversed}2===_.channels?setBuffer.call(instance,{buffer:[fn.pointer(_.buffer[0],begin,end-begin),fn.pointer(_.buffer[1],begin,end-begin),fn.pointer(_.buffer[2],begin,end-begin)],samplerate:_.samplerate}):setBuffer.call(instance,{buffer:fn.pointer(_.buffer[0],begin,end-begin),samplerate:_.samplerate}),instance.playbackState=fn.PLAYING_STATE}return instance.loop(_.isLooped),instance.reverse(_.isReversed),instance},$.reverse=function(value){var _=this._;return _.isReversed=!!value,_.isReversed?(_.phaseIncr>0&&(_.phaseIncr*=-1),0===_.phase&&_.buffer.length&&(_.phase=_.buffer[0].length+_.phaseIncr)):_.phaseIncr<0&&(_.phaseIncr*=-1),this},$.loop=function(value){return this._.isLooped=!!value,this},$.bang=function(value){return this.playbackState=value===!1?fn.FINISHED_STATE:fn.PLAYING_STATE,this._.phase=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(!_.buffer.length)return this;if(this.tickID!==tickID){this.tickID=tickID;var i,bufferL,bufferR,cellL=this.cells[1],cellR=this.cells[2],phase=_.phase,imax=_.cellsize;if(2===_.channels?(bufferL=_.buffer[1],bufferR=_.buffer[2]):bufferL=bufferR=_.buffer[0],_.currentTimeObj){var t,pos=_.currentTimeObj.process(tickID).cells[0],sr=.001*_.samplerate;for(i=0;imax>i;++i)t=pos[i],phase=t*sr,cellL[i]=bufferL[0|phase]||0,cellR[i]=bufferR[0|phase]||0;_.phase=phase,_.currentTime=t}else{var pitch=_.pitch.process(tickID).cells[0][0],phaseIncr=_.phaseIncr*pitch;for(i=0;imax>i;++i)cellL[i]=bufferL[0|phase]||0,cellR[i]=bufferR[0|phase]||0,phase+=phaseIncr;phase>=bufferL.length?fn.nextTick(_.isLooped?_.onlooped:_.onended):0>phase&&fn.nextTick(_.isLooped?_.onlooped:_.onended),_.phase=phase,_.currentTime+=fn.currentTimeIncr}fn.outputSignalAR(this)}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var bufferL,bufferR,_=this._;if(_.plotFlush){2===_.channels?(bufferL=_.buffer[1],bufferR=_.buffer[2]):bufferL=bufferR=_.buffer[0];for(var data=new Float32Array(2048),x=0,xIncr=bufferL.length/2048,i=0;2048>i;i++)data[i]=.5*(bufferL[0|x]+bufferR[0|x]),x+=xIncr;_.plotData=data,_.plotFlush=null}return super_plot.call(this,opts)},fn.register("buffer",BufferNode)}(timbre),function(T){"use strict";function ChorusNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var chorus=new Chorus(this._.samplerate);chorus.setDelayTime(20),chorus.setRate(4),chorus.depth=20,chorus.feedback=.2,chorus.mix=.33,this._.chorus=chorus}var fn=T.fn,Chorus=T.modules.Chorus;fn.extend(ChorusNode);var $=ChorusNode.prototype;Object.defineProperties($,{type:{set:function(value){this._.chorus.setDelayTime(value)},get:function(){return this._.chorus.wave}},delay:{set:function(value){value>=.5&&80>=value&&this._.chorus.setDelayTime(value)},get:function(){return this._.chorus.delayTime}},rate:{set:function(value){"number"==typeof value&&value>0&&this._.chorus.setRate(value)},get:function(){return this._.chorus.rate}},depth:{set:function(value){"number"==typeof value&&value>=0&&100>=value&&(value*=this._.samplerate/44100,this._.chorus.depth=value)},get:function(){return this._.chorus.depth}},fb:{set:function(value){"number"==typeof value&&value>=-1&&1>=value&&(this._.chorus.feedback=.99996*value)},get:function(){return this._.chorus.feedback}},mix:{set:function(value){this._.mix=T(value)},get:function(){return this._.mix}}}),$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,fn.inputSignalAR(this),_.bypassed||_.chorus.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)),this},fn.register("chorus",ChorusNode)}(timbre),function(T){"use strict";function ClipNode(_args){T.Object.call(this,2,_args);var _=this._;_.min=-.8,_.max=.8}var fn=T.fn;fn.extend(ClipNode);var $=ClipNode.prototype;Object.defineProperties($,{minmax:{set:function(value){var _=this._;"number"==typeof value&&(_.min=-Math.abs(value),_.max=-_.min)},get:function(){return this._.max}},min:{set:function(value){var _=this._;"number"==typeof value&&(_.max<value?_.max=value:_.min=value)},get:function(){return this._.min}},max:{set:function(value){var _=this._;"number"==typeof value&&(value<_.min?_.min=value:_.max=value)},get:function(){return this._.max}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,value,cellL=this.cells[1],cellR=this.cells[2],imax=cellL.length,min=_.min,max=_.max;if(_.ar){for(fn.inputSignalAR(this),i=0;imax>i;++i)value=cellL[i],min>value?value=min:value>max&&(value=max),cellL[i]=value,value=cellR[i],min>value?value=min:value>max&&(value=max),cellR[i]=value;fn.outputSignalAR(this)}else value=fn.inputSignalKR(this),min>value?value=min:value>max&&(value=max),this.cells[0][0]=value,fn.outputSignalKR(this)}return this},fn.register("clip",ClipNode)}(timbre),function(T){"use strict";function CompressorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.prevThresh=-24,_.prevKnee=30,_.prevRatio=12,_.thresh=T(_.prevThresh),_.knee=T(_.prevKnee),_.ratio=T(_.prevRatio),_.postGain=6,_.reduction=0,_.attack=3,_.release=25,_.comp=new Compressor(_.samplerate),_.comp.dbPostGain=_.postGain,_.comp.setAttackTime(.001*_.attack),_.comp.setReleaseTime(.001*_.release),_.comp.setPreDelayTime(6),_.comp.setParams(_.prevThresh,_.prevKnee,_.prevRatio)}var fn=T.fn,timevalue=T.timevalue,Compressor=T.modules.Compressor;fn.extend(CompressorNode);var $=CompressorNode.prototype;Object.defineProperties($,{thresh:{set:function(value){this._.thresh=T(value)},get:function(){return this._.thresh}},thre:{set:function(value){this._.thresh=T(value)},get:function(){return this._.thre}},knee:{set:function(value){this._.kne=T(value)},get:function(){return this._.knee}},ratio:{set:function(value){this._.ratio=T(value)},get:function(){return this._.ratio}},gain:{set:function(value){"number"==typeof value&&(this._.comp.dbPostGain=value)},get:function(){return this._.comp.dbPostGain}},attack:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&(value=0>value?0:value>1e3?1e3:value,this._.attack=value,this._.comp.setAttackTime(.001*value))},get:function(){return this._.attack}},release:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&(value=0>value?0:value>1e3?1e3:value,this._.release=value,this._.comp.setReleaseTime(.001*value))},get:function(){return this._.release}},reduction:{get:function(){return this._.reduction}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var thresh=_.thresh.process(tickID).cells[0][0],knee=_.knee.process(tickID).cells[0][0],ratio=_.ratio.process(tickID).cells[0][0];(_.prevThresh!==thresh||_.prevKnee!==knee||_.prevRatio!==ratio)&&(_.prevThresh=thresh,_.prevKnee=knee,_.prevRatio=ratio,_.comp.setParams(thresh,knee,ratio)),_.bypassed||(_.comp.process(this.cells[1],this.cells[2]),_.reduction=_.comp.meteringGain),fn.outputSignalAR(this)}return this},fn.register("comp",CompressorNode)}(timbre),function(T){"use strict";function DelayNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.time=T(100),_.fb=T(.2),_.cross=T(!1),_.mix=.33,_.delay=new StereoDelay(_.samplerate)}var fn=T.fn,timevalue=T.timevalue,StereoDelay=T.modules.StereoDelay;fn.extend(DelayNode);var $=DelayNode.prototype;Object.defineProperties($,{time:{set:function(value){"string"==typeof value&&(value=timevalue(value)),this._.time=T(value)},get:function(){return this._.time}},fb:{set:function(value){this._.fb=T(value)},get:function(){return this._.fb}},cross:{set:function(value){this._.cross=T(value)},get:function(){return this._.cross}},mix:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.mix=value)},get:function(){return this._.mix}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var time=_.time.process(tickID).cells[0][0],fb=_.fb.process(tickID).cells[0][0],cross=0!==_.cross.process(tickID).cells[0][0],mix=_.mix;(_.prevTime!==time||_.prevFb!==fb||_.prevCross!==cross||_.prevMix!==mix)&&(_.prevTime=time,_.prevFb=fb,_.prevCross=cross,_.prevMix=mix,_.delay.setParams(time,fb,cross,mix)),fn.inputSignalAR(this),_.bypassed||_.delay.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)}return this},fn.register("delay",DelayNode)}(timbre),function(T){"use strict";function DistNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.pre=T(60),_.post=T(-18),_.x1L=_.x2L=_.y1L=_.y2L=0,_.x1R=_.x2R=_.y1R=_.y2R=0,_.b0=_.b1=_.b2=_.a1=_.a2=0,_.cutoff=0,_.Q=1,_.preScale=0,_.postScale=0}var fn=T.fn;fn.extend(DistNode);var $=DistNode.prototype;Object.defineProperties($,{cutoff:{set:function(value){"number"==typeof value&&value>0&&(this._.cutoff=value)},get:function(){return this._.cutoff}},pre:{set:function(value){this._.pre=T(value)},get:function(){return this._.pre}},post:{set:function(value){this._.post=T(value)},get:function(){return this._.post}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var preGain=-_.pre.process(tickID).cells[0][0],postGain=-_.post.process(tickID).cells[0][0];if((_.prevPreGain!==preGain||_.prevPostGain!==postGain)&&(_.prevPreGain=preGain,_.prevPostGain=postGain,_.preScale=Math.pow(10,.05*-preGain),_.postScale=Math.pow(10,.05*-postGain)),!_.bypassed){var i,imax,value,x0,y0,cellL=this.cells[1],cellR=this.cells[2],preScale=_.preScale,postScale=_.postScale;if(_.cutoff){_.prevCutoff!==_.cutoff&&(_.prevCutoff=_.cutoff,lowpass_params(_));var x1L=_.x1L,x2L=_.x2L,y1L=_.y1L,y2L=_.y2L,x1R=_.x1R,x2R=_.x2R,y1R=_.y1R,y2R=_.y2R,b0=_.b0,b1=_.b1,b2=_.b2,a1=_.a1,a2=_.a2;for(i=0,imax=cellL.length;imax>i;++i)x0=cellL[i]*preScale,y0=b0*x0+b1*x1L+b2*x2L-a1*y1L-a2*y2L,value=y0*postScale,-1>value?value=-1:value>1&&(value=1),cellL[i]=value,x2L=x1L,x1L=x0,y2L=y1L,y1L=y0,x0=cellR[i]*preScale,y0=b0*x0+b1*x1R+b2*x2R-a1*y1R-a2*y2R,value=y0*postScale,-1>value?value=-1:value>1&&(value=1),cellR[i]=value,x2R=x1R,x1R=x0,y2R=y1R,y1R=y0;_.x1L=x1L,_.x2L=x2L,_.y1L=y1L,_.y2L=y2L,_.x1R=x1R,_.x2R=x2R,_.y1R=y1R,_.y2R=y2R}else for(i=0,imax=cellL.length;imax>i;++i)value=cellL[i]*preScale*postScale,-1>value?value=-1:value>1&&(value=1),cellL[i]=value,value=cellR[i]*preScale*postScale,-1>value?value=-1:value>1&&(value=1),cellR[i]=value}fn.outputSignalAR(this)}return this};var lowpass_params=function(_){var w0=2*Math.PI*_.cutoff/_.samplerate,cos=Math.cos(w0),sin=Math.sin(w0),alpha=sin/(2*_.Q),ia0=1/(1+alpha);_.b0=.5*(1-cos)*ia0,_.b1=1-cos*ia0,_.b2=.5*(1-cos)*ia0,_.a1=-2*cos*ia0,_.a2=1-alpha*ia0};fn.register("dist",DistNode)}(timbre),function(T){"use strict";function DivNode(_args){T.Object.call(this,2,_args),this._.ar=!1}var fn=T.fn;fn.extend(DivNode);var $=DivNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,div,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)div=tmpL[j],cellL[j]=0===div?0:cellL[j]/div,div=tmpR[j],cellR[j]=0===div?0:cellR[j]/div;else for(j=0;jmax>j;++j)cellL[j]=cellR[i]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)div=nodes[i].process(tickID).cells[0][0],tmp=0===div?0:tmp/div;else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("/",DivNode)}(timbre),function(T){"use strict";function EnvNode(_args){T.Object.call(this,2,_args);var _=this._;_.env=new Envelope(_.samplerate),_.env.setStep(_.cellsize),_.tmp=new fn.SignalArray(_.cellsize),_.ar=!1,_.plotFlush=!0,_.onended=make_onended(this),this.on("ar",onar)}function envValue(opts,min,def,name1,name2,func){var x=def;return"number"==typeof opts[name1]?x=opts[name1]:"number"==typeof opts[name2]?x=opts[name2]:func&&("string"==typeof opts[name1]?x=func(opts[name1]):"string"==typeof opts[name2]&&(x=func(opts[name2]))),min>x&&(x=min),x}var fn=T.fn,timevalue=T.timevalue,Envelope=T.modules.Envelope,isDictionary=fn.isDictionary;fn.extend(EnvNode);var onar=function(value){this._.env.setStep(value?1:this._.cellsize)},make_onended=function(self){return function(){self._.emit("ended")}},$=EnvNode.prototype;Object.defineProperties($,{table:{set:function(value){Array.isArray(value)&&(setTable.call(this,value),this._.plotFlush=!0)},get:function(){return this._.env.table}},curve:{set:function(value){this._.env.setCurve(value)},get:function(){return this._.env.curve}},releaseNode:{set:function(value){this._.env.setReleaseNode(value),this._.plotFlush=!0},get:function(){return this._.env.releaseNode+1}},loopNode:{set:function(value){this._.env.setLoopNode(value),this._.plotFlush=!0},get:function(){return this._.env.loopNode+1}}}),$.clone=function(){var instance=fn.clone(this);return instance._.env=this._.env.clone(),instance},$.reset=function(){return this._.env.reset(),this},$.release=function(){var _=this._;return _.env.release(),_.emit("released"),this},$.bang=function(){var _=this._;return _.env.reset(),_.env.status=Envelope.StatusGate,_.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;var value,emit=null;if(_.ar){var tmp=_.tmp;for(_.env.process(tmp),i=0;imax>i;++i)cellL[i]*=tmp[i],cellR[i]*=tmp[i];emit=_.env.emit}else{for(value=_.env.next(),i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value;emit=_.env.emit}fn.outputSignalAR(this),emit&&("ended"===emit?fn.nextTick(_.onended):this._.emit(emit,_.value))}return this};var setTable=function(list){for(var value,time,curveType,curveValue,env=this._.env,table=[list[0]||ZERO],i=1,imax=list.length;imax>i;++i)value=list[i][0]||ZERO,time=list[i][1],curveType=list[i][2],"number"!=typeof time&&(time="string"==typeof time?timevalue(time):10),10>time&&(time=10),"number"==typeof curveType?(curveValue=curveType,curveType=Envelope.CurveTypeCurve):(curveType=Envelope.CurveTypeDict[curveType]||null,curveValue=0),table.push([value,time,curveType,curveValue]);env.setTable(table)},super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var i,imax,env=this._.env.clone(),info=env.getInfo(1e3),totalDuration=info.totalDuration,loopBeginTime=info.loopBeginTime,releaseBeginTime=info.releaseBeginTime,data=new Float32Array(256),duration=0,durationIncr=totalDuration/data.length,isReleased=!1,samples=.001*totalDuration*this._.samplerate|0;for(samples/=data.length,env.setStep(samples),env.status=Envelope.StatusGate,i=0,imax=data.length;imax>i;++i)data[i]=env.next(),duration+=durationIncr,!isReleased&&duration>=releaseBeginTime&&(env.release(),isReleased=!0);this._.plotData=data,this._.plotBefore=function(context,x,y,width,height){var x1,w;1/0!==loopBeginTime&&1/0!==releaseBeginTime&&(x1=x+width*(loopBeginTime/totalDuration),w=x+width*(releaseBeginTime/totalDuration),w-=x1,context.fillStyle="rgba(224, 224, 224, 0.8)",context.fillRect(x1,0,w,height)),1/0!==releaseBeginTime&&(x1=x+width*(releaseBeginTime/totalDuration),w=width-x1,context.fillStyle="rgba(212, 212, 212, 0.8)",context.fillRect(x1,0,w,height))};var minValue=1/0,maxValue=-1/0;for(i=0;imax>i;++i)data[i]<minValue?minValue=data[i]:data[i]>maxValue&&(maxValue=data[i]);1>maxValue&&(maxValue=1),this._.plotRange=[minValue,maxValue],this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("env",EnvNode);var ZERO=Envelope.ZERO;fn.register("perc",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),r=envValue(opts,10,1e3,"r","releaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[ZERO,r]],new EnvNode(_args)}),fn.register("adsr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","decayTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[s,d],[ZERO,r]],opts.releaseNode=3,new EnvNode(_args)}),fn.register("adshr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),h=envValue(opts,10,500,"h","holdTime",timevalue),r=envValue(opts,10,1e3,"r","decayTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[s,d],[s,h],[ZERO,r]],new EnvNode(_args)}),fn.register("asr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","releaseTime",timevalue);return opts.table=[ZERO,[s,a],[ZERO,r]],opts.releaseNode=2,new EnvNode(_args)}),fn.register("dadsr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],dl=envValue(opts,10,100,"dl","delayTime",timevalue),a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[ZERO,dl],[lv,a],[s,d],[ZERO,r]],opts.releaseNode=4,new EnvNode(_args)}),fn.register("ahdsfr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),h=envValue(opts,10,10,"h","holdTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),f=envValue(opts,10,5e3,"f","fadeTime",timevalue),r=envValue(opts,10,1e3,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[lv,h],[s,d],[ZERO,f],[ZERO,r]],opts.releaseNode=5,new EnvNode(_args)}),fn.register("linen",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),s=envValue(opts,10,1e3,"s","sustainTime",timevalue),r=envValue(opts,10,1e3,"r","releaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[lv,s],[ZERO,r]],new EnvNode(_args)}),fn.register("env.tri",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],dur=envValue(opts,20,1e3,"dur","duration",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return dur*=.5,opts.table=[ZERO,[lv,dur],[ZERO,dur]],new EnvNode(_args)}),fn.register("env.cutoff",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],r=envValue(opts,10,100,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[lv,[ZERO,r]],new EnvNode(_args)})}(timbre),function(T){"use strict";function EQNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.biquads=new Array(7),_.plotBefore=plotBefore,_.plotRange=[-18,18],_.plotFlush=!0}var fn=T.fn,FFT=T.modules.FFT,Biquad=T.modules.Biquad,PLOT_LOW_FREQ=20,PARAM_NAMES={hpf:0,lf:1,lmf:2,mf:3,hmf:4,hf:5,lpf:6};fn.extend(EQNode);var plotBefore=function(context,x,y,width,height){context.lineWidth=1,context.strokeStyle="rgb(192, 192, 192)";for(var nyquist=.5*this._.samplerate,i=1;10>=i;++i)for(var j=1;4>=j;j++){var f=i*Math.pow(10,j);if(!(PLOT_LOW_FREQ>=f||f>=nyquist)){context.beginPath();var _x=Math.log(f/PLOT_LOW_FREQ)/Math.log(nyquist/PLOT_LOW_FREQ);_x=(_x*width+x|0)+.5,context.moveTo(_x,y),context.lineTo(_x,y+height),context.stroke()}}var h=height/6;for(i=1;6>i;i++){context.beginPath();var _y=(y+i*h|0)+.5;context.moveTo(x,_y),context.lineTo(x+width,_y),context.stroke()}},$=EQNode.prototype;Object.defineProperties($,{params:{set:function(value){if("object"==typeof value)for(var keys=Object.keys(value),i=0,imax=keys.length;imax>i;++i){var items=value[keys[i]];Array.isArray(items)?this.setParams(keys[i],items[0],items[1],items[2]):this.setParams(keys[i])}}}}),$.setParams=function(index,freq,Q,gain){var _=this._;
if("string"==typeof index&&(index=PARAM_NAMES[index]),index>=0&&index<_.biquads.length){if(index|=0,"number"==typeof freq&&"number"==typeof Q){"number"!=typeof gain&&(gain=0);var biquad=_.biquads[index];if(!biquad)switch(biquad=_.biquads[index]=new Biquad(_.samplerate),index){case 0:biquad.setType("highpass");break;case _.biquads.length-1:biquad.setType("lowpass");break;default:biquad.setType("peaking")}biquad.setParams(freq,Q,gain)}else _.biquads[index]=void 0;_.plotFlush=!0}return this},$.getParams=function(index){var _=this._,biquad=_.biquads[0|index];return biquad?{freq:biquad.frequency,Q:biquad.Q,gain:biquad.gain}:void 0},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),!_.bypassed)for(var cellL=this.cells[1],cellR=this.cells[2],biquads=_.biquads,i=0,imax=biquads.length;imax>i;++i)biquads[i]&&biquads[i].process(cellL,cellR);fn.outputSignalAR(this)}return this};var fft=new FFT(2048),super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var _=this._,impluse=new Float32Array(fft.length);impluse[0]=1;for(var i=0,imax=_.biquads.length;imax>i;++i){var params=this.getParams(i);if(params){var biquad=new Biquad(_.samplerate);biquad.setType(0===i?"highpass":i===imax-1?"lowpass":"peaking"),biquad.setParams(params.freq,params.Q,params.gain),biquad.process(impluse,impluse)}}fft.forward(impluse);var j,f,index,delta,x0,x1,xx,size=512,data=new Float32Array(size),nyquist=.5*_.samplerate,spectrum=new Float32Array(size);for(fft.getFrequencyData(spectrum),i=0;size>i;++i)f=Math.pow(nyquist/PLOT_LOW_FREQ,i/size)*PLOT_LOW_FREQ,j=f/(nyquist/spectrum.length),index=0|j,delta=j-index,0===index?x1=x0=xx=spectrum[index]:(x0=spectrum[index-1],x1=spectrum[index],xx=(1-delta)*x0+delta*x1),data[i]=xx;this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("eq",EQNode)}(timbre),function(T){"use strict";function FFTNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this),this.real=new T.ChannelObject(this),this.imag=new T.ChannelObject(this),this.cells[3]=this.real.cell,this.cells[4]=this.imag.cell;var _=this._;_.fft=new FFT(2*_.cellsize),_.fftCell=new fn.SignalArray(_.fft.length),_.prevCell=new fn.SignalArray(_.cellsize),_.freqs=new fn.SignalArray(_.fft.length>>1),_.plotFlush=!0,_.plotRange=[0,32],_.plotBarStyle=!0}var fn=T.fn,FFT=T.modules.FFT;fn.extend(FFTNode);var $=FFTNode.prototype;Object.defineProperties($,{window:{set:function(value){this._.fft.setWindow(value)},get:function(){return this._.fft.windowName}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var cell=this.cells[0],cellsize=_.cellsize;_.fftCell.set(_.prevCell),_.fftCell.set(cell,cellsize),_.fft.forward(_.fftCell),_.prevCell.set(cell),_.plotFlush=!0,this.cells[3].set(_.fft.real.subarray(0,cellsize)),this.cells[4].set(_.fft.imag.subarray(0,cellsize))}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),super_plot.call(this,opts)},fn.register("fft",FFTNode)}(timbre),function(T){"use strict";function FNoiseNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.freq=T(440),_.reg=32768,_.shortFlag=!1,_.phase=0,_.lastValue=0}var fn=T.fn;fn.extend(FNoiseNode);var $=FNoiseNode.prototype;Object.defineProperties($,{shortFlag:{set:function(value){this._.shortFlag=!!value},get:function(){return this._.shortFlag}},freq:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}}}),$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){this.tickID=tickID;var i,imax,lastValue=_.lastValue,phase=_.phase,phaseStep=_.freq.process(tickID).cells[0][0]/_.samplerate,reg=_.reg,mul=_.mul,add=_.add;if(_.shortFlag)for(i=0,imax=cell.length;imax>i;++i)phase>=1&&(reg>>=1,reg|=(1&(reg^reg>>6))<<15,lastValue=(1&reg)-.5,phase-=1),cell[i]=lastValue*mul+add,phase+=phaseStep;else for(i=0,imax=cell.length;imax>i;++i)phase>=1&&(reg>>=1,reg|=(1&(reg^reg>>1))<<15,lastValue=(1&reg)-.5,phase-=1),cell[i]=lastValue*mul+add,phase+=phaseStep;_.reg=reg,_.phase=phase,_.lastValue=lastValue}return this},fn.register("fnoise",FNoiseNode)}(timbre),function(T){"use strict";function GateNode(_args){T.Object.call(this,2,_args),fn.fixAR(this),this._.selected=0,this._.outputs=[]}var fn=T.fn,GateChannelNode=function(){function GateChannelNode(parent){T.Object.call(this,2,[]),fn.fixAR(this),this._.parent=parent}return fn.extend(GateChannelNode),GateChannelNode.prototype.process=function(tickID){return this.tickID!==tickID&&(this.tickID=tickID,this._.parent.process(tickID)),this},GateChannelNode}();fn.extend(GateNode);var $=GateNode.prototype;Object.defineProperties($,{selected:{set:function(value){var _=this._;if("number"==typeof value){_.selected=value;for(var outputs=_.outputs,i=0,imax=outputs.length;imax>i;++i)outputs[i]&&(outputs[i].cells[0].set(fn.emptycell),outputs[i].cells[1].set(fn.emptycell),outputs[i].cells[2].set(fn.emptycell))}},get:function(){return this._.selected}}}),$.at=function(index){var _=this._,output=_.outputs[index];return output||(_.outputs[index]=output=new GateChannelNode(this)),output},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var output=_.outputs[_.selected];output&&(output.cells[0].set(this.cells[0]),output.cells[1].set(this.cells[1]),output.cells[2].set(this.cells[2]))}return this},fn.register("gate",GateNode)}(timbre),function(T){"use strict";function IFFTNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.fft=new FFT(2*_.cellsize),_.fftCell=new fn.SignalArray(this._.fft.length),_.realBuffer=new fn.SignalArray(this._.fft.length),_.imagBuffer=new fn.SignalArray(this._.fft.length)}var fn=T.fn,FFT=T.modules.FFT;fn.extend(IFFTNode);var $=IFFTNode.prototype;Object.defineProperties($,{real:{set:function(value){this._.real=T(value)},get:function(){return this._.real}},imag:{set:function(value){this._.imag=T(value)},get:function(){return this._.imag}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID&&(this.tickID=tickID,_.real&&_.imag)){var cell=this.cells[0],real=_.realBuffer,imag=_.imagBuffer,_real=_.real.process(tickID).cells[0],_imag=_.imag.process(tickID).cells[0];real.set(_real),imag.set(_imag),cell.set(_.fft.inverse(real,imag).subarray(0,_.cellsize)),fn.outputSignalAR(this)}return this},fn.register("ifft",IFFTNode)}(timbre),function(T){"use strict";function IntervalNode(_args){T.Object.call(this,1,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.interval=T(1e3),_.count=0,_.delay=0,_.timeout=1/0,_.currentTime=0,_.delaySamples=0,_.countSamples=0,_.onended=fn.make_onended(this),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue;fn.extend(IntervalNode);var onstart=function(){var _=this._;this.playbackState=fn.PLAYING_STATE,_.delaySamples=.001*_.samplerate*_.delay|0,_.countSamples=_.count=_.currentTime=0};Object.defineProperty(onstart,"unremovable",{value:!0,writable:!1});var $=IntervalNode.prototype;Object.defineProperties($,{interval:{set:function(value){"string"==typeof value&&(value=timevalue(value),0>=value&&(value=0)),this._.interval=T(value)},get:function(){return this._.interval}},delay:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this._.delay=value,this._.delaySamples=.001*this._.samplerate*value|0)},get:function(){return this._.delay}},count:{set:function(value){"number"==typeof value&&(this._.count=value)},get:function(){return this._.count}},timeout:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this._.timeout=value)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),$.bang=function(){var _=this._;return this.playbackState=fn.PLAYING_STATE,_.delaySamples=.001*_.samplerate*_.delay|0,_.countSamples=_.count=_.currentTime=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID,_.delaySamples>0&&(_.delaySamples-=cell.length);var interval=_.interval.process(tickID).cells[0][0];if(_.delaySamples<=0&&(_.countSamples-=cell.length,_.countSamples<=0)){_.countSamples+=_.samplerate*interval*.001|0;for(var nodes=this.nodes,count=_.count,x=count*_.mul+_.add,j=0,jmax=cell.length;jmax>j;++j)cell[j]=x;for(var i=0,imax=nodes.length;imax>i;++i)nodes[i].bang(count);_.count+=1}_.currentTime+=fn.currentTimeIncr,_.currentTime>=_.timeout&&fn.nextTick(_.onended)}return this},fn.register("interval",IntervalNode)}(timbre),function(T){"use strict";function LagNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._,bits=Math.ceil(Math.log(_.samplerate)*Math.LOG2E);_.buffersize=1<<bits,_.buffermask=_.buffersize-1,_.buffer=new fn.SignalArray(_.buffersize),_.time=0,_.readIndex=0,_.writeIndex=0}var fn=T.fn,timevalue=T.timevalue;fn.extend(LagNode);var $=LagNode.prototype;Object.defineProperties($,{time:{set:function(value){if("string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0){var _=this._;_.time=value;var offset=.001*value*_.samplerate|0;offset>_.buffermask&&(offset=_.buffermask),_.writeIndex=_.readIndex+offset&_.buffermask}},get:function(){return this._.time}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var i,cell=this.cells[0],buffer=_.buffer,mask=_.buffermask,readIndex=_.readIndex,writeIndex=_.writeIndex,imax=cell.length;for(i=0;imax>i;++i)buffer[writeIndex]=cell[i],cell[i]=buffer[readIndex],readIndex+=1,writeIndex=writeIndex+1&mask;_.readIndex=readIndex&mask,_.writeIndex=writeIndex,fn.outputSignalAR(this)}return this},fn.register("lag",LagNode)}(timbre),function(T){"use strict";function MapNode(_args){T.Object.call(this,1,_args);var _=this._;_.input=0,_.value=0,_.prev=null,_.ar=!1,_.map=defaultFunction}var fn=T.fn;fn.extend(MapNode);var defaultFunction=function(x){return x},$=MapNode.prototype;Object.defineProperties($,{input:{set:function(value){"number"==typeof value&&(this._.input=value)},get:function(){return this._.input}},map:{set:function(value){"function"==typeof value&&(this._.map=value)},get:function(){return this._.map}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(input){return this._.map?this._.map(input):0},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var map=_.map;if(map)for(i=0;imax>i;++i)cell[i]=map(cell[i]);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=len?fn.inputSignalKR(this):_.input;_.map&&_.prev!==input&&(_.prev=input,_.value=_.map(input));var value=_.value*_.mul+_.add;for(i=0;imax>i;++i)cell[i]=value}}return this},fn.register("map",MapNode)}(timbre),function(T){"use strict";function MaxNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MaxNode);var $=MaxNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,val,nodes=this.nodes,imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0],cell.set(tmp),i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)val=tmp[j],cell[j]<val&&(cell[j]=val);else for(j=0;jmax>j;++j)cell[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)val=nodes[i].process(tickID).cells[0][0],val>tmp&&(tmp=val);else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("max",MaxNode)}(timbre),function(T){"use strict";function MediaStreamNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.src=_.func=null,_.bufferL=new fn.SignalArray(BUFFER_SIZE),_.bufferR=new fn.SignalArray(BUFFER_SIZE),_.readIndex=0,_.writeIndex=0,_.totalRead=0,_.totalWrite=0}if("browser"===T.envtype){var fn=T.fn,BUFFER_SIZE=4096,BUFFER_MASK=BUFFER_SIZE-1;fn.extend(MediaStreamNode);var $=MediaStreamNode.prototype;$.listen=function(audio){var _impl=impl[T.env];_impl&&(_impl.set.call(this,audio),_impl.listen.call(this))},$.unlisten=function(){var _impl=impl[T.env];_impl&&_impl.unlisten.call(this),this.cells[0].set(fn.emptycell),this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell);for(var _=this._,bufferL=_.bufferL,bufferR=_.bufferR,i=0,imax=bufferL.length;imax>i;++i)bufferL[i]=bufferR[i]=0},$.process=function(tickID){var _=this._;if(null===_.src)return this;if(this.tickID!==tickID){this.tickID=tickID;var cellsize=_.cellsize;if(_.totalWrite>_.totalRead+cellsize){var begin=_.readIndex,end=begin+cellsize;this.cells[1].set(_.bufferL.subarray(begin,end)),this.cells[2].set(_.bufferR.subarray(begin,end)),_.readIndex=end&BUFFER_MASK,_.totalRead+=cellsize}fn.outputSignalAR(this)}return this};var impl={};impl.webkit={set:function(src){var _=this._;if(src instanceof HTMLMediaElement){var context=fn._audioContext;_.src=context.createMediaElementSource(src)}},listen:function(){var _=this._,context=fn._audioContext;_.gain=context.createGainNode(),_.gain.gain.value=0,_.node=context.createJavaScriptNode(1024,2,2),_.node.onaudioprocess=onaudioprocess(this),_.src.connect(_.node),_.node.connect(_.gain),_.gain.connect(context.destination)},unlisten:function(){var _=this._;_.src&&_.src.disconnect(),_.gain&&_.gain.disconnect(),_.node&&_.node.disconnect()}};var onaudioprocess=function(self){return function(e){var _=self._,ins=e.inputBuffer,length=ins.length,writeIndex=_.writeIndex;_.bufferL.set(ins.getChannelData(0),writeIndex),_.bufferR.set(ins.getChannelData(1),writeIndex),_.writeIndex=writeIndex+length&BUFFER_MASK,_.totalWrite+=length}};impl.moz={set:function(src){var _=this._;src instanceof HTMLAudioElement&&(_.src=src,_.istep=_.samplerate/src.mozSampleRate)},listen:function(){var _=this._,o0=_.bufferL,o1=_.bufferR,prev0=0,prev1=0;2===_.src.mozChannels?(_.x=0,_.func=function(e){var x,i,writeIndex=_.writeIndex,totalWrite=_.totalWrite,samples=e.frameBuffer,istep=_.istep,imax=samples.length;for(x=_.x,i=0;imax>i;i+=2){for(x+=istep;x>0;)o0[writeIndex]=.5*(samples[i]+prev0),o1[writeIndex]=.5*(samples[i+1]+prev1),writeIndex=writeIndex+1&BUFFER_MASK,++totalWrite,x-=1;prev0=samples[i],prev1=samples[i+1]}_.x=x,_.writeIndex=writeIndex,_.totalWrite=totalWrite}):(_.x=0,_.func=function(e){var x,i,writeIndex=_.writeIndex,totalWrite=_.totalWrite,samples=e.frameBuffer,istep=_.istep,imax=samples.length;for(x=_.x,i=0;imax>i;++i){for(x+=istep;x>=0;)o0[writeIndex]=o1[writeIndex]=.5*(samples[i]+prev0),writeIndex=writeIndex+1&BUFFER_MASK,++totalWrite,x-=1;prev0=samples[i]}_.x=x,_.writeIndex=writeIndex,_.totalWrite=totalWrite}),_.src.addEventListener("MozAudioAvailable",_.func)},unlisten:function(){var _=this._;_.func&&(_.src.removeEventListener("MozAudioAvailable",_.func),_.func=null)}},fn.register("mediastream",MediaStreamNode)}}(timbre),function(T){"use strict";function MidiCpsNode(_args){T.Object.call(this,1,_args);var _=this._;_.midi=0,_.value=0,_.prev=null,_.a4=440,_.ar=!1}var fn=T.fn;fn.extend(MidiCpsNode);var $=MidiCpsNode.prototype;Object.defineProperties($,{midi:{set:function(value){"number"==typeof value&&(this._.midi=value)},get:function(){return this._.midi}},a4:{set:function(value){"number"==typeof value&&(this._.a4=value,this._.prev=null)},get:function(){return this._.a4}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(midi){var _=this._;return _.a4*Math.pow(2,(midi-69)/12)},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cell=this.cells[0],len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var a4=_.a4;for(i=0;imax>i;++i)cell[i]=a4*Math.pow(2,(cell[i]-69)/12);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=len?fn.inputSignalKR(this):_.midi;_.prev!==input&&(_.prev=input,_.value=_.a4*Math.pow(2,(input-69)/12)),cell[0]=_.value,fn.outputSignalKR(this)}}return this},fn.register("midicps",MidiCpsNode)}(timbre),function(T){"use strict";function MidiRatioNode(_args){T.Object.call(this,1,_args);var _=this._;_.midi=0,_.value=0,_.prev=null,_.range=12,_.ar=!1}var fn=T.fn;fn.extend(MidiRatioNode);var $=MidiRatioNode.prototype;Object.defineProperties($,{midi:{set:function(value){"number"==typeof value&&(this._.midi=value)},get:function(){return this._.midi}},range:{set:function(value){"number"==typeof value&&value>0&&(this._.range=value)},get:function(){return this._.range}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(midi){var _=this._;return Math.pow(2,midi/_.range)},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var range=_.range;for(i=0;imax>i;++i)cell[i]=Math.pow(2,cell[i]/range);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=this.nodes.length?fn.inputSignalKR(this):_.midi;_.prev!==input&&(_.prev=input,_.value=Math.pow(2,input/_.range));var value=_.value*_.mul+_.add;for(i=0;imax>i;++i)cell[i]=value}}return this},fn.register("midiratio",MidiRatioNode)}(timbre),function(T){"use strict";function MinNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MinNode);var $=MinNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,val,nodes=this.nodes,imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0],cell.set(tmp),i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)val=tmp[j],cell[j]>val&&(cell[j]=val);else for(j=0;jmax>j;++j)cell[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)val=nodes[i].process(tickID).cells[0][0],tmp>val&&(tmp=val);else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("min",MinNode)}(timbre),function(T){"use strict";function MML(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.tracks=[],_.onended=fn.make_onended(this),_.currentTime=0,this.on("start",onstart)}var fn=T.fn;fn.extend(MML);var onstart=function(){var self=this,_=this._,mml=_.mml;"string"==typeof mml&&(mml=[mml]),_.tracks=mml.map(function(mml,i){return new MMLTrack(self,i,mml)}),_.currentTime=0,this.playbackState=fn.PLAYING_STATE};Object.defineProperty(onstart,"unremoved",{value:!0,writable:!1});var $=MML.prototype;Object.defineProperties($,{mml:{set:function(value){var _=this._;("string"==typeof value||Array.isArray(value))&&(_.mml=value)},get:function(){return this._.mml}},currentTime:{get:function(){return this._.currentTime}}}),$.on=$.addListener=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.on(type,listener),this},$.once=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.once(type,listener),this},$.off=$.removeListener=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.off(type,listener),this},$.removeAllListeners=function(type){return"mml"===type&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),type="data"),this._.events.removeAllListeners(type),this},$.listeners=function(type){return"mml"===type&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),type="data"),this._.events.listeners(type)},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,tracks=_.tracks;for(i=0,imax=tracks.length;imax>i;++i)tracks[i].process();for(;i--;)tracks[i].ended&&tracks.splice(i,1);0===tracks.length&&fn.nextTick(_.onended),_.currentTime+=fn.currentTimeIncr}return this},fn.register("mml",MML);var MMLTrack=function(){function MMLTrack(sequencer,trackNum,mml){var _=this._={};_.sequencer=sequencer,_.trackNum=trackNum,_.commands=compile(mml),_.status={t:120,l:4,o:4,v:12,q:6,dot:0,tie:!1},_.index=0,_.queue=[],_.currentTime=0,_.queueTime=0,_.segnoIndex=-1,_.loopStack=[],_.prevNote=0,_.remain=1/0,this.ended=!1,sched(this)}var EOF=0,NOTEON=1,NOTEOFF=2,COMMAND=3;MMLTrack.prototype.process=function(){var _=this._,sequencer=_.sequencer,trackNum=_.trackNum,queue=_.queue,eof=!1;if(queue.length)for(;queue[0][0]<=_.currentTime;){var nextItem=_.queue.shift();switch(nextItem[1]){case NOTEON:noteOn(sequencer,trackNum,nextItem[2],nextItem[3]),_.remain=nextItem[4],sched(this);break;case NOTEOFF:noteOff(sequencer,trackNum,nextItem[2],nextItem[3]);break;case COMMAND:command(sequencer,nextItem[2]);break;case EOF:eof=!0}if(0===queue.length)break}_.remain-=fn.currentTimeIncr,eof&&(this.ended=!0),_.currentTime+=fn.currentTimeIncr};var noteOn=function(sequencer,trackNum,noteNum,velocity){var gen,i,imax,nodes=sequencer.nodes;for(i=0,imax=nodes.length;imax>i;++i)gen=nodes[i],gen.noteOn?gen.noteOn(noteNum,velocity):gen.bang();sequencer._.emit("data","noteOn",{trackNum:trackNum,noteNum:noteNum,velocity:velocity})},noteOff=function(sequencer,trackNum,noteNum,velocity){var gen,i,imax,nodes=sequencer.nodes;for(i=0,imax=nodes.length;imax>i;++i)gen=nodes[i],gen.noteOff?gen.noteOff(noteNum,velocity):gen.release&&gen.release();sequencer._.emit("data","noteOff",{trackNum:trackNum,noteNum:noteNum,velocity:velocity})},command=function(sequencer,cmd){sequencer._.emit("data","command",{command:cmd})},sched=function(self){var cmd,tempo,val,len,dot,vel,duration,quantize,pending,_queueTime,peek,i,imax,_=self._,commands=(_.sequencer,_.commands),queue=_.queue,index=_.index,status=_.status,queueTime=_.queueTime,loopStack=_.loopStack;pending=[];outer:for(;;){if(commands.length<=index){if(!(_.segnoIndex>=0))break;index=_.segnoIndex}switch(cmd=commands[index++],cmd.name){case"@":queue.push([queueTime,COMMAND,cmd.val]);break;case"n":if(tempo=status.t||120,null!==cmd.len?(len=cmd.len,dot=cmd.dot||0):(len=status.l,dot=cmd.dot||status.dot),duration=60/tempo*(4/len)*1e3,duration*=[1,1.5,1.75,1.875][dot]||1,vel=status.v<<3,status.tie){for(i=queue.length;i--;)if(queue[i][2]){queue.splice(i,1);break}val=_.prevNote}else val=_.prevNote=cmd.val+12*(status.o+1),queue.push([queueTime,NOTEON,val,vel,duration]);if(len>0){if(quantize=status.q/8,1>quantize)for(_queueTime=queueTime+duration*quantize,queue.push([_queueTime,NOTEOFF,val,vel]),i=0,imax=pending.length;imax>i;++i)queue.push([_queueTime,NOTEOFF,pending[i],vel]);if(pending=[],queueTime+=duration,!status.tie)break outer}else pending.push(val);status.tie=!1;break;case"r":tempo=status.t||120,null!==cmd.len?(len=cmd.len,dot=cmd.dot||0):(len=status.l,dot=cmd.dot||status.dot),len>0&&(duration=60/tempo*(4/len)*1e3,duration*=[1,1.5,1.75,1.875][dot]||1,queueTime+=duration);break;case"l":status.l=cmd.val,status.dot=cmd.dot;break;case"o":status.o=cmd.val;break;case"<":status.o<9&&(status.o+=1);break;case">":status.o>0&&(status.o-=1);break;case"v":status.v=cmd.val;break;case"(":status.v<15&&(status.v+=1);break;case")":status.v>0&&(status.v-=1);break;case"q":status.q=cmd.val;break;case"&":status.tie=!0;break;case"$":_.segnoIndex=index;break;case"[":loopStack.push([index,null,null]);break;case"|":peek=loopStack[loopStack.length-1],peek&&1===peek[1]&&(loopStack.pop(),index=peek[2]);break;case"]":peek=loopStack[loopStack.length-1],peek&&(null===peek[1]&&(peek[1]=cmd.count,peek[2]=index),peek[1]-=1,0===peek[1]?loopStack.pop():index=peek[0]);break;case"t":status.t=null===cmd.val?120:cmd.val;break;case"EOF":queue.push([queueTime,EOF])}}_.index=index,_.queueTime=queueTime},compile=function(mml){var def,re,m,cmd,i,imax,j,jmax,checked=new Array(mml.length),commands=[];for(i=0,imax=MMLCommands.length;imax>i;++i)for(def=MMLCommands[i],re=def.re;m=re.exec(mml);){if(!checked[m.index]){for(j=0,jmax=m[0].length;jmax>j;++j)checked[m.index+j]=!0;cmd=def.func?def.func(m):{name:m[0]},cmd&&(cmd.index=m.index,cmd.origin=m[0],commands.push(cmd))}for(;re.lastIndex<mml.length&&checked[re.lastIndex];)++re.lastIndex}return commands.sort(function(a,b){return a.index-b.index}),commands.push({name:"EOF"}),commands},MMLCommands=[{re:/@(\d*)/g,func:function(m){return{name:"@",val:m[1]||null}}},{re:/([cdefgab])([\-+]?)(\d*)(\.*)/g,func:function(m){return{name:"n",val:{c:0,d:2,e:4,f:5,g:7,a:9,b:11}[m[1]]+({"-":-1,"+":1}[m[2]]||0),len:""===m[3]?null:Math.min(0|m[3],64),dot:m[4].length}}},{re:/r(\d*)(\.*)/g,func:function(m){return{name:"r",len:""===m[1]?null:Math.max(1,Math.min(0|m[1],64)),dot:m[2].length}}},{re:/&/g},{re:/l(\d*)(\.*)/g,func:function(m){return{name:"l",val:""===m[1]?4:Math.min(0|m[1],64),dot:m[2].length}}},{re:/o([0-9])/g,func:function(m){return{name:"o",val:""===m[1]?4:0|m[1]}}},{re:/[<>]/g},{re:/v(\d*)/g,func:function(m){return{name:"v",val:""===m[1]?12:Math.min(0|m[1],15)}}},{re:/[()]/g},{re:/q([0-8])/g,func:function(m){return{name:"q",val:""===m[1]?6:Math.min(0|m[1],8)}}},{re:/\[/g},{re:/\|/g},{re:/\](\d*)/g,func:function(m){return{name:"]",count:0|m[1]||2}}},{re:/t(\d*)/g,func:function(m){return{name:"t",val:""===m[1]?null:Math.max(5,Math.min(0|m[1],300))}}},{re:/\$/g}];return MMLTrack}()}(timbre),function(T){"use strict";function MonoNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MonoNode),MonoNode.prototype.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},fn.register("mono",MonoNode)}(timbre),function(T){"use strict";function MulNode(_args){T.Object.call(this,2,_args)}var fn=T.fn;fn.extend(MulNode);var $=MulNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)cellL[j]*=tmpL[j],cellR[j]*=tmpR[j];else for(j=0;jmax>j;++j)cellL[j]=cellR[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)tmp*=nodes[i].process(tickID).cells[0][0];else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("*",MulNode)}(timbre),function(T){"use strict";function NDictNode(_args){T.Object.call(this,1,_args);var _=this._;_.defaultValue=0,_.index=0,_.dict={},_.ar=!1}var fn=T.fn;fn.extend(NDictNode);var $=NDictNode.prototype;Object.defineProperties($,{dict:{set:function(value){if("object"==typeof value)this._.dict=value;else if("function"==typeof value){for(var dict={},i=0;128>i;++i)dict[i]=value(i);this._.dict=dict}},get:function(){return this._.dict}},defaultValue:{set:function(value){"number"==typeof value&&(this._.defaultValue=value)},get:function(){return this._.defaultValue}},index:{set:function(value){"number"==typeof value&&(this._.index=value)},get:function(){return this._.index}}}),$.at=function(index){var _=this._;return(_.dict[0|index]||_.defaultValue)*_.mul+_.add},$.clear=function(){return this._.dict={},this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var index,value,i,len=this.nodes.length,dict=_.dict,defaultValue=_.defaultValue,mul=_.mul,add=_.add,imax=cell.length;if(_.ar&&len){for(fn.inputSignalAR(this),i=0;imax>i;++i)index=cell[i],index=0>index?index-.5|0:index+.5|0,cell[i]=(dict[index]||defaultValue)*mul+add;fn.outputSignalAR(this)}else for(index=this.nodes.length?fn.inputSignalKR(this):_.index,index=0>index?index-.5|0:index+.5|0,value=(dict[index]||defaultValue)*mul+add,i=0;imax>i;++i)cell[i]=value}return this},fn.register("ndict",NDictNode)}(timbre),function(T){"use strict";function NoiseNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(NoiseNode);var $=NoiseNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,x,mul=_.mul,add=_.add;if(_.ar)for(i=0,imax=cell.length;imax>i;++i)cell[i]=(2*Math.random()-1)*mul+add;else for(x=(2*Math.random()+1)*mul+add,i=0,imax=cell.length;imax>i;++i)cell[i]=x}return this},fn.register("noise",NoiseNode)}(timbre),function(T){"use strict";function OscNode(_args){T.Object.call(this,2,_args);var _=this._;_.freq=T(440),_.phase=T(0),_.osc=new Oscillator(_.samplerate),_.tmp=new fn.SignalArray(_.cellsize),_.osc.step=_.cellsize,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue,Oscillator=T.modules.Oscillator;fn.extend(OscNode);var oninit=function(){var _=this._;this.wave||(this.wave="sin"),_.plotData=_.osc.wave,_.plotLineWidth=2,_.plotCyclic=!0,_.plotBefore=plotBefore},$=OscNode.prototype;Object.defineProperties($,{wave:{set:function(value){this._.osc.setWave(value)},get:function(){return this._.osc.wave}},freq:{set:function(value){"string"==typeof value&&(value=timevalue(value),value=0>=value?0:1e3/value),this._.freq=T(value)},get:function(){return this._.freq}},phase:{set:function(value){this._.phase=T(value),this._.osc.feedback=!1},get:function(){return this._.phase}},fb:{set:function(value){this._.phase=T(value),this._.osc.feedback=!0},get:function(){return this._.phase}}}),$.clone=function(){var instance=fn.clone(this);return instance._.osc=this._.osc.clone(),instance._.freq=this._.freq,instance._.phase=this._.phase,instance},$.bang=function(){return this._.osc.reset(),this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;var osc=_.osc,freq=_.freq.process(tickID).cells[0],phase=_.phase.process(tickID).cells[0];if(osc.frequency=freq[0],osc.phase=phase[0],_.ar){var tmp=_.tmp;for(_.freq.isAr?_.phase.isAr?osc.processWithFreqAndPhaseArray(tmp,freq,phase):osc.processWithFreqArray(tmp,freq):_.phase.isAr?osc.processWithPhaseArray(tmp,phase):osc.process(tmp),i=0;imax>i;++i)cellL[i]*=tmp[i],cellR[i]*=tmp[i]}else{var value=osc.next();for(i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value}fn.outputSignalAR(this)}return this};var plotBefore;"browser"===T.envtype&&(plotBefore=function(context,offset_x,offset_y,width,height){var y=(height>>1)+.5;context.strokeStyle="#ccc",context.lineWidth=1,context.beginPath(),context.moveTo(offset_x,y+offset_y),context.lineTo(offset_x+width,y+offset_y),context.stroke()}),fn.register("osc",OscNode),fn.register("sin",function(_args){return new OscNode(_args).set("wave","sin")}),fn.register("cos",function(_args){return new OscNode(_args).set("wave","cos")}),fn.register("pulse",function(_args){return new OscNode(_args).set("wave","pulse")}),fn.register("tri",function(_args){return new OscNode(_args).set("wave","tri")}),fn.register("saw",function(_args){return new OscNode(_args).set("wave","saw")}),fn.register("fami",function(_args){return new OscNode(_args).set("wave","fami")}),fn.register("konami",function(_args){return new OscNode(_args).set("wave","konami")}),fn.register("+sin",function(_args){return new OscNode(_args).set("wave","+sin").kr()}),fn.register("+pulse",function(_args){return new OscNode(_args).set("wave","+pulse").kr()}),fn.register("+tri",function(_args){return new OscNode(_args).set("wave","+tri").kr()}),fn.register("+saw",function(_args){return new OscNode(_args).set("wave","+saw").kr()}),fn.alias("square","pulse")}(timbre),function(T){"use strict";
function PanNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.pos=T(0),_.panL=.5,_.panR=.5}var fn=T.fn;fn.extend(PanNode);var $=PanNode.prototype;Object.defineProperties($,{pos:{set:function(value){this._.pos=T(value)},get:function(){return this._.pos}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var pos=_.pos.process(tickID).cells[0][0];if(_.prevPos!==pos){_.panL=1-pos,_.panR=_.prevPos=pos}var i,j,tmp,nodes=this.nodes,cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cellL.length;if(imax){for(tmp=nodes[0].process(tickID).cells[0],j=0;jmax>j;++j)cellL[j]=cellR[j]=tmp[j];for(i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)cellL[j]=cellR[j]+=tmp[j];var panL=_.panL,panR=_.panR;for(j=0;jmax>j;++j)cellL[j]=cellL[j]*panL,cellR[j]=cellR[j]*panR}else cellL.set(fn.emptycell),cellR.set(fn.emptycell);fn.outputSignalAR(this)}return this},fn.register("pan",PanNode)}(timbre),function(T){"use strict";function ParamNode(_args){T.Object.call(this,2,_args);var _=this._;_.value=0,_.env=new EnvelopeValue(_.samplerate),_.env.step=_.cellsize,_.curve="lin",_.counter=0,_.ar=!1,_.onended=make_onended(this),this.on("ar",onar)}var fn=T.fn,timevalue=T.timevalue,Envelope=T.modules.Envelope,EnvelopeValue=T.modules.EnvelopeValue;fn.extend(ParamNode);var make_onended=function(self,lastValue){return function(){if("number"==typeof lastValue)for(var cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],value=self._.env.value,i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=value;self._.emit("ended")}},onar=function(value){this._.env.step=value?1:this._.cellsize},$=ParamNode.prototype;Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.env.value=value)},get:function(){return this._.env.value}}}),$.to=function(nextValue,time,curve){var _=this._,env=_.env;if("string"==typeof time?time=timevalue(time):"undefined"==typeof time&&(time=0),"undefined"==typeof curve)_.counter=env.setNext(nextValue,time,Envelope.CurveTypeLin),_.curve="lin";else{var _curve=Envelope.CurveTypeDict[curve];_.counter="undefined"==typeof _curve?env.setNext(nextValue,time,Envelope.CurveTypeCurve,curve):env.setNext(nextValue,time,_curve),_.curve=curve}return _.plotFlush=!0,this},$.setAt=function(nextValue,time){var _=this._;return this.to(_.env.value,time,"set"),_.atValue=nextValue,this},$.linTo=function(nextValue,time){return this.to(nextValue,time,"lin")},$.expTo=function(nextValue,time){return this.to(nextValue,time,"exp")},$.sinTo=function(nextValue,time){return this.to(nextValue,time,"sin")},$.welTo=function(nextValue,time){return this.to(nextValue,time,"wel")},$.sqrTo=function(nextValue,time){return this.to(nextValue,time,"sqr")},$.cubTo=function(nextValue,time){return this.to(nextValue,time,"cub")},$.cancel=function(){var _=this._;return _.counter=_.env.setNext(_.env.value,0,Envelope.CurveTypeSet),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,value,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize,env=_.env,counter=_.counter;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;if(0>=counter&&("set"===_.curve?env.setNext(_.atValue,0,Envelope.CurveTypeSet):env.setNext(env.value,0,Envelope.CurveTypeSet),fn.nextTick(_.onended),_.counter=1/0),_.ar){for(i=0;imax>i;++i)value=env.next(),cellL[i]*=value,cellR[i]*=value;_.counter-=_.cellsize}else{for(value=env.next(),i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value;_.counter-=1}fn.outputSignalAR(this),_.value=value}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var _=this._;if(_.plotFlush){var curve,i,imax,env=new EnvelopeValue(128),data=new Float32Array(128);if("set"===_.curve)for(i=100,imax=data.length;imax>i;++i)data[i]=1;else for(curve=Envelope.CurveTypeDict[_.curve],"undefined"==typeof curve?env.setNext(1,1e3,Envelope.CurveTypeCurve,_.curve):env.setNext(1,1e3,curve),i=0,imax=data.length;imax>i;++i)data[i]=env.next();_.plotData=data,_.plotRange=[0,1],_.plotFlush=null}return super_plot.call(this,opts)},fn.register("param",ParamNode)}(timbre),function(T){"use strict";function PhaserNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.freq=T("sin",{freq:1,add:1e3,mul:250}).kr(),_.Q=T(1),_.allpass=[],this.steps=2}var fn=T.fn,Biquad=T.modules.Biquad;fn.extend(PhaserNode);var $=PhaserNode.prototype;Object.defineProperties($,{freq:{set:function(value){this._.freq=value},get:function(){return this._.freq}},Q:{set:function(value){this._.Q=T(value)},get:function(){return this._.Q}},steps:{set:function(value){if("number"==typeof value){if(value|=0,2===value||4===value||8===value||12===value){var allpass=this._.allpass;if(allpass.length<value)for(var i=allpass.length;value>i;++i)allpass[i]=new Biquad(this._.samplerate),allpass[i].setType("allpass")}this._.steps=value}},get:function(){return this._.steps}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),!_.bypassed){var i,cellL=this.cells[1],cellR=this.cells[2],freq=_.freq.process(tickID).cells[0][0],Q=_.Q.process(tickID).cells[0][0],steps=_.steps;for(i=0;steps>i;i+=2)_.allpass[i].setParams(freq,Q,0),_.allpass[i].process(cellL,cellR),_.allpass[i+1].setParams(freq,Q,0),_.allpass[i+1].process(cellL,cellR)}fn.outputSignalAR(this)}return this},fn.register("phaser",PhaserNode)}(timbre),function(T){"use strict";function PinkNoiseNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);for(var whites=new Uint8Array(5),i=0;5>i;++i)whites[i]=(Math.random()*(1<<30)|0)%25;this._.whites=whites,this._.key=0}var MAX_KEY=31,fn=T.fn;fn.extend(PinkNoiseNode);var $=PinkNoiseNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,j,last_key,sum,diff,key=_.key,whites=_.whites,mul=_.mul,add=_.add;for(i=0,imax=cell.length;imax>i;++i){for(last_key=key++,key>MAX_KEY&&(key=0),diff=last_key^key,j=sum=0;5>j;++j)diff&1<<j&&(whites[j]=(Math.random()*(1<<30)|0)%25),sum+=whites[j];cell[i]=(.01666666*sum-1)*mul+add}_.key=key}return this},fn.register("pink",PinkNoiseNode)}(timbre),function(T){"use strict";function PluckNode(_args){T.Object.call(this,1,_args),this._.freq=440,this._.buffer=null,this._.index=0}var fn=T.fn;fn.extend(PluckNode);var $=PluckNode.prototype;Object.defineProperties($,{freq:{set:function(value){"number"==typeof value&&(0>value&&(value=0),this._.freq=value)},get:function(){return this._.freq}}}),$.bang=function(){for(var _=this._,freq=_.freq,size=_.samplerate/freq+.5|0,buffer=_.buffer=new fn.SignalArray(size),i=0;size>i;++i)buffer[i]=2*Math.random()-1;return _.index=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var buffer=_.buffer;if(buffer){var write,x,i,bufferLength=buffer.length,index=_.index,mul=_.mul,add=_.add,imax=cell.length;for(i=0;imax>i;++i)write=index,x=buffer[index++],index>=bufferLength&&(index=0),x=.5*(x+buffer[index]),buffer[write]=x,cell[i]=x*mul+add;_.index=index}}return this},fn.register("pluck",PluckNode)}(timbre),function(T){"use strict";function RecNode(_args){T.Object.call(this,1,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.timeout=5e3,_.status=STATUS_WAIT,_.writeIndex=0,_.writeIndexIncr=1,_.currentTime=0,_.currentTimeIncr=1e3/_.samplerate,_.onended=make_onended(this)}var fn=T.fn,timevalue=T.timevalue,STATUS_WAIT=0,STATUS_REC=1;fn.extend(RecNode);var make_onended=function(self){return function(){var _=self._,buffer=new fn.SignalArray(_.buffer.subarray(0,0|_.writeIndex));_.status=STATUS_WAIT,_.writeIndex=0,_.currentTime=0,_.emit("ended",{buffer:buffer,samplerate:_.samplerate})}},$=RecNode.prototype;Object.defineProperties($,{timeout:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(this._.timeout=value)},get:function(){return this._.timeout}},samplerate:{set:function(value){"number"==typeof value&&value>0&&value<=this._.samplerate&&(this._.samplerate=value)},get:function(){return this._.samplerate}},currentTime:{get:function(){return this._.currentTime}}}),$.start=function(){var len,_=this._;return _.status===STATUS_WAIT&&(len=.01*_.timeout*_.samplerate|0,(!_.buffer||_.buffer.length<len)&&(_.buffer=new fn.SignalArray(len)),_.writeIndex=0,_.writeIndexIncr=_.samplerate/T.samplerate,_.currentTime=0,_.status=STATUS_REC,_.emit("start"),this.listen()),this},$.stop=function(){var _=this._;return _.status===STATUS_REC&&(_.status=STATUS_WAIT,_.emit("stop"),fn.nextTick(_.onended),this.unlisten()),this},$.bang=function(){return this._.status===STATUS_WAIT?this.srart():this._.status===STATUS_REC&&this.stop(),this._.emit("bang"),this},$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),_.status===STATUS_REC){var i,imax=cell.length,buffer=_.buffer,timeout=_.timeout,writeIndex=_.writeIndex,writeIndexIncr=_.writeIndexIncr,currentTime=_.currentTime,currentTimeIncr=_.currentTimeIncr;for(i=0;imax>i;++i)buffer[0|writeIndex]=cell[i],writeIndex+=writeIndexIncr,currentTime+=currentTimeIncr,currentTime>=timeout&&fn.nextTick(_.onended);_.writeIndex=writeIndex,_.currentTime=currentTime}fn.outputSignalAR(this)}return this},fn.register("record",RecNode),fn.alias("rec","record")}(timbre),function(T){"use strict";function ReverbNode(_args){T.Object.call(this,2,_args),fn.fixAR(this),this._.reverb=new Reverb(this._.samplerate,this._.cellsize)}var fn=T.fn,Reverb=T.modules.Reverb;fn.extend(ReverbNode);var $=ReverbNode.prototype;Object.defineProperties($,{room:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.setRoomSize(value))},get:function(){return this._.reverb.roomsize}},damp:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.setDamp(value))},get:function(){return this._.reverb.damp}},mix:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.wet=value)},get:function(){return this._.reverb.wet}}}),$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,fn.inputSignalAR(this),_.bypassed||_.reverb.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)),this},fn.register("reverb",ReverbNode)}(timbre),function(T){"use strict";function ScheduleNode(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.queue=[],_.currentTime=0,_.maxRemain=1e3}var fn=T.fn,timevalue=T.timevalue;fn.extend(ScheduleNode);var $=ScheduleNode.prototype;Object.defineProperties($,{queue:{get:function(){return this._.queue}},remain:{get:function(){return this._.queue.length}},maxRemain:{set:function(value){"number"==typeof value&&value>0&&(this._.maxRemain=value)},get:function(){return this._.maxRemain}},isEmpty:{get:function(){return 0===this._.queue.length}},currentTime:{get:function(){return this._.currentTime}}}),$.sched=function(delta,item,args){return"string"==typeof delta&&(delta=timevalue(delta)),"number"==typeof delta&&this.schedAbs(this._.currentTime+delta,item,args),this},$.schedAbs=function(time,item,args){if("string"==typeof time&&(time=timevalue(time)),"number"==typeof time){var _=this._,queue=_.queue;if(queue.length>=_.maxRemain)return this;for(var i=queue.length;i--&&!(queue[i][0]<time););queue.splice(i+1,0,[time,T(item),args])}return this},$.advance=function(delta){return"string"==typeof delta&&(delta=timevalue(delta)),"number"==typeof delta&&(this._.currentTime+=delta),this},$.clear=function(){return this._.queue.splice(0),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var emit=null,queue=_.queue;if(queue.length)for(;queue[0][0]<_.currentTime;){var nextItem=_.queue.shift();if(nextItem[1].bang(nextItem[2]),emit="sched",0===queue.length){emit="empty";break}}_.currentTime+=fn.currentTimeIncr,emit&&_.emit(emit)}return this},fn.register("schedule",ScheduleNode),fn.alias("sched","schedule")}(timbre),function(T){"use strict";function ScopeNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.samples=0,_.writeIndex=0,_.plotFlush=!0,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue;fn.extend(ScopeNode);var oninit=function(){this._.buffer||(this.size=1024),this._.interval||(this.interval=1e3)},$=ScopeNode.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.buffer&&"number"==typeof value){var n=64>value?64:value>2048?2048:value;_.buffer=new fn.SignalArray(n),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},interval:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*_.samplerate/_.buffer.length,_.samplesIncr<1&&(_.samplesIncr=1)):_.reservedinterval=value)},get:function(){return this._.interval}}}),$.bang=function(){for(var _=this._,buffer=_.buffer,i=0,imax=buffer.length;imax>i;++i)buffer[i]=0;return _.samples=0,_.writeIndex=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var i,cell=this.cells[0],imax=_.cellsize,samples=_.samples,samplesIncr=_.samplesIncr,buffer=_.buffer,writeIndex=_.writeIndex,emit=!1,bufferlength=buffer.length;for(i=0;imax>i;++i)0>=samples&&(buffer[writeIndex++]=cell[i],writeIndex>=bufferlength&&(writeIndex=0),emit=_.plotFlush=!0,samples+=samplesIncr),--samples;_.samples=samples,_.writeIndex=writeIndex,emit&&this._.emit("data")}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var _=this._;if(_.plotFlush){for(var buffer=_.buffer,mask=buffer.length-1,data=new Float32Array(buffer.length),j=_.writeIndex,i=0,imax=buffer.length;imax>i;i++)data[i]=buffer[++j&mask];_.plotData=data,_.plotFlush=null}return super_plot.call(this,opts)},fn.register("scope",ScopeNode)}(timbre),function(T){"use strict";function ScriptProcessorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.numberOfInputs=0,_.numberOfOutputs=0,_.bufferSize=0,_.bufferMask=0,_.duration=0,_.inputBufferL=null,_.inputBufferR=null,_.outputBufferL=null,_.outputBufferR=null,_.onaudioprocess=null,_.index=0,this.once("init",oninit)}function AudioBuffer(self,buffers){this.samplerate=self._.samplerate,this.length=self._.bufferSize,this.duration=self._.duration,this.numberOfChannels=buffers.length,this.getChannelData=function(n){return buffers[n]}}function AudioProcessingEvent(self){var _=self._;this.node=self,this.playbackTime=T.currentTime,this.inputBuffer=2===_.numberOfInputs?new AudioBuffer(self,[_.inputBufferL,_.inputBufferR]):new AudioBuffer(self,[_.inputBufferL]),this.outputBuffer=2===_.numberOfOutputs?new AudioBuffer(self,[_.outputBufferL,_.outputBufferR]):new AudioBuffer(self,[_.outputBufferL])}var fn=T.fn;fn.extend(ScriptProcessorNode);var oninit=function(){var _=this._;0===_.numberOfInputs&&(this.numberOfInputs=1),0===_.numberOfOutputs&&(this.numberOfOutputs=1),0===_.bufferSize&&(this.bufferSize=1024)},$=ScriptProcessorNode.prototype;Object.defineProperties($,{numberOfInputs:{set:function(value){var _=this._;0===_.numberOfInputs&&(_.numberOfInputs=2===value?2:1)},get:function(){return this._.numberOfInputs}},numberOfOutputs:{set:function(value){var _=this._;0===_.numberOfOutputs&&(_.numberOfOutputs=2===value?2:1)},get:function(){return this._.numberOfOutputs}},bufferSize:{set:function(value){var _=this._;0===_.bufferSize&&-1!==[256,512,1024,2048,4096,8192,16384].indexOf(value)&&(_.bufferSize=value,_.bufferMask=value-1,_.duration=value/_.samplerate,_.inputBufferL=new fn.SignalArray(value),_.inputBufferR=new fn.SignalArray(value),_.outputBufferL=new fn.SignalArray(value),_.outputBufferR=new fn.SignalArray(value))},get:function(){return this._.bufferSize}},onaudioprocess:{set:function(value){"function"==typeof value&&(this._.onaudioprocess=value)},get:function(){return this._.onaudioprocess}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var buffer,cellsize=_.cellsize,bufferMask=_.bufferMask,begin=_.index,end=begin+cellsize,cellL=this.cells[1],cellR=this.cells[2];if(fn.inputSignalAR(this),2===_.numberOfInputs)_.inputBufferL.set(cellL,begin),_.inputBufferR.set(cellR,begin);else{buffer=_.inputBufferL;for(var i=0;cellsize>i;i++)buffer[begin+i]=.5*(cellL[i]+cellR[i])}cellL.set(_.outputBufferL.subarray(begin,end)),cellR.set(_.outputBufferR.subarray(begin,end)),_.index=end&bufferMask,0===_.index&&_.onaudioprocess&&(_.onaudioprocess(new AudioProcessingEvent(this)),1===_.numberOfOutputs&&_.outputBufferR.set(_.outputBufferL)),fn.outputSignalAR(this)}return this},fn.register("script",ScriptProcessorNode)}(timbre),function(T){"use strict";function SelectorNode(_args){T.Object.call(this,2,_args),this._.selected=0,this._.background=!1}var fn=T.fn;fn.extend(SelectorNode);var $=SelectorNode.prototype;Object.defineProperties($,{selected:{set:function(value){"number"==typeof value&&(this._.selected=value,this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell))},get:function(){return this._.selected}},background:{set:function(value){this._.background=!!value},get:function(){return this._.background}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,nodes=this.nodes,imax=nodes.length;if(_.background)for(i=0;imax>i;++i)nodes[i].process(tickID);var tmp=nodes[_.selected];tmp&&(_.background||tmp.process(tickID),this.cells[1].set(tmp.cells[1]),this.cells[2].set(tmp.cells[2])),fn.outputSignalAR(this)}return this},fn.register("selector",SelectorNode)}(timbre),function(T){"use strict";function SpectrumNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.status=WAIT_STATE,_.samples=0,_.samplesIncr=0,_.writeIndex=0,_.plotFlush=!0,_.plotRange=[0,32],_.plotBarStyle=!0,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue,FFT=T.modules.FFT,WAIT_STATE=0,EXEC_STATE=1;fn.extend(SpectrumNode);var oninit=function(){var _=this._;_.fft||(this.size=512),_.interval||(this.interval=500)},$=SpectrumNode.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.fft&&"number"==typeof value){var n=256>value?256:value>2048?2048:value;_.fft=new FFT(n),_.buffer=new fn.SignalArray(_.fft.length),_.freqs=new fn.SignalArray(_.fft.length>>1),_.reservedwindow&&(_.fft.setWindow(_.reservedwindow),_.reservedwindow=null),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},window:{set:function(value){this._.fft.setWindow(value)},get:function(){return this._.fft.windowName}},interval:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*_.samplerate,_.samplesIncr<_.buffer.length&&(_.samplesIncr=_.buffer.length,_.interval=1e3*_.samplesIncr/_.samplerate)):_.reservedinterval=value)},get:function(){return this._.interval}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}},real:{get:function(){return this._.fft.real}},imag:{get:function(){return this._.fft.imag}}}),$.bang=function(){return this._.samples=0,this._.writeIndex=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var i,emit,cell=this.cells[0],imax=cell.length,status=_.status,samples=_.samples,samplesIncr=_.samplesIncr,writeIndex=_.writeIndex,buffer=_.buffer,bufferLength=buffer.length;for(i=0;imax>i;++i)0>=samples&&status===WAIT_STATE&&(status=EXEC_STATE,writeIndex=0,samples+=samplesIncr),status===EXEC_STATE&&(buffer[writeIndex++]=cell[i],writeIndex>=bufferLength&&(_.fft.forward(buffer),emit=_.plotFlush=!0,status=WAIT_STATE)),--samples;_.samples=samples,_.status=status,_.writeIndex=writeIndex,emit&&this._.emit("data")}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),super_plot.call(this,opts)},fn.register("spectrum",SpectrumNode)}(timbre),function(T){"use strict";function SubtractNode(_args){T.Object.call(this,2,_args),this._.ar=!1}var fn=T.fn;fn.extend(SubtractNode);var $=SubtractNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)cellL[j]-=tmpL[j],cellR[j]-=tmpR[j];else for(j=0;jmax>j;++j)cellL[j]=cellR[i]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)tmp-=nodes[i].process(tickID).cells[0][0];else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("-",SubtractNode)}(timbre),function(T){"use strict";function SynthDefNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.poly=4,_.genList=[],_.genDict={},_.synthdef=null,_.remGen=make_remGen(this),_.onended=fn.make_onended(this)}var fn=T.fn;fn.extend(SynthDefNode);var $=SynthDefNode.prototype;Object.defineProperties($,{def:{set:function(value){"function"==typeof value&&(this._.synthdef=value)},get:function(){return this._.synthdef}},poly:{set:function(value){"number"==typeof value&&value>0&&64>=value&&(this._.poly=value)},get:function(){return this._.poly}}});var make_doneAction=function(self,opts){return function(){self._.remGen(opts.gen)}},make_remGen=function(self){return function(gen){var _=self._,i=_.genList.indexOf(gen);-1!==i&&_.genList.splice(i,1),"undefined"!=typeof gen.noteNum&&(_.genDict[gen.noteNum]=null)}},noteOn=function(noteNum,freq,velocity,_opts){velocity|=0,0>=velocity?this.noteOff(this,noteNum):velocity>127&&(velocity=127);var _=this._,list=_.genList,dict=_.genDict,gen=dict[noteNum];gen&&_.remGen(gen);var opts={freq:freq,noteNum:noteNum,velocity:velocity,mul:.0078125*velocity};if(_opts)for(var key in _opts)opts[key]=_opts[key];opts.doneAction=make_doneAction(this,opts),gen=_.synthdef.call(this,opts),gen instanceof T.Object&&(gen.noteNum=noteNum,list.push(gen),dict[noteNum]=opts.gen=gen,this.playbackState=fn.PLAYING_STATE,list.length>_.poly&&_.remGen(list[0]))},midicps=function(){for(var table=new Float32Array(128),i=0;128>i;++i)table[i]=440*Math.pow(2,1*(i-69)/12);return table}(),cpsmidi=function(cps){return cps>0?Math.log(1*cps/440)*Math.LOG2E*12+69:0};$.noteOn=function(noteNum,velocity,_opts){var freq=midicps[noteNum]||440*Math.pow(2,(noteNum-69)/12);return noteOn.call(this,noteNum+.5|0,freq,velocity,_opts),this},$.noteOff=function(noteNum){var gen=this._.genDict[noteNum];return gen&&gen.release&&gen.release(),this},$.noteOnWithFreq=function(freq,velocity,_opts){var noteNum=cpsmidi(freq);return noteOn.call(this,noteNum+.5|0,freq,velocity,_opts),this},$.noteOffWithFreq=function(freq){var noteNum=cpsmidi(freq);return this.noteOff(noteNum+.5|0)},$.allNoteOff=function(){for(var list=this._.genList,i=0,imax=list.length;imax>i;++i)list[i].release&&list[i].release()},$.allSoundOff=function(){for(var _=this._,list=_.genList,dict=_.genDict;list.length;)delete dict[list.shift().noteNum]},$.synth=function(_opts){var gen,_=this._,list=_.genList,opts={};if(_opts)for(var key in _opts)opts[key]=_opts[key];return opts.doneAction=make_doneAction(this,opts),gen=_.synthdef.call(this,opts),gen instanceof T.Object&&(list.push(gen),opts.gen=gen,this.playbackState=fn.PLAYING_STATE,list.length>_.poly&&_.remGen(list[0])),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){if(this.tickID=tickID,this.playbackState===fn.PLAYING_STATE){var gen,i,imax,j,tmpL,tmpR,list=_.genList,cellL=this.cells[1],cellR=this.cells[2],jmax=cell.length;if(list.length)for(gen=list[0],gen.process(tickID),cellL.set(gen.cells[1]),cellR.set(gen.cells[2]),i=1,imax=list.length;imax>i;++i)for(gen=list[i],gen.process(tickID),tmpL=gen.cells[1],tmpR=gen.cells[2],j=0;jmax>j;++j)cellL[j]+=tmpL[j],cellR[j]+=tmpR[j];else fn.nextTick(_.onended)}fn.outputSignalAR(this)}return this},fn.register("SynthDef",SynthDefNode);var env_desc={set:function(value){fn.isDictionary(value)?"string"==typeof value.type&&(this._.env=value):value instanceof T.Object&&(this._.env=value)},get:function(){return this._.env}};fn.register("OscGen",function(){var osc_desc={set:function(value){value instanceof T.Object&&(this._.osc=value)},get:function(){return this._.osc}},wave_desc={set:function(value){"string"==typeof value&&(this._.wave=value)},get:function(){return this._.wave}},synthdef=function(opts){var synth,osc,env,envtype,_=this._;return osc=_.osc||null,env=_.env||{},envtype=env.type||"perc",osc instanceof T.Object&&"function"==typeof osc.clone&&(osc=osc.clone()),osc||(osc=T("osc",{wave:_.wave})),osc.freq=opts.freq,osc.mul=osc.mul*opts.velocity/128,synth=osc,env instanceof T.Object?"function"==typeof env.clone&&(synth=env.clone().append(synth)):synth=T(envtype,env,synth),synth.on("ended",opts.doneAction).bang(),synth};return function(_args){var instance=new SynthDefNode(_args);return instance._.wave="sin",Object.defineProperties(instance,{env:env_desc,osc:osc_desc,wave:wave_desc}),instance.def=synthdef,instance}}()),fn.register("PluckGen",function(){var synthdef=function(opts){var synth,env,envtype,_=this._;return env=_.env||{},envtype=env.type||"perc",synth=T("pluck",{freq:opts.freq,mul:opts.velocity/128}).bang(),env instanceof T.Object?"function"==typeof env.clone&&(synth=env.clone().append(synth)):synth=T(envtype,env,synth),synth.on("ended",opts.doneAction).bang(),synth};return function(_args){var instance=new SynthDefNode(_args);return Object.defineProperties(instance,{env:env_desc}),instance.def=synthdef,instance}}())}(timbre),function(T){"use strict";function ScissorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.isLooped=!1,_.onended=fn.make_onended(this,0)}var fn=T.fn,Scissor=T.modules.Scissor,Tape=Scissor.Tape,TapeStream=Scissor.TapeStream,isSignalArray=fn.isSignalArray;fn.extend(ScissorNode);var $=ScissorNode.prototype;Object.defineProperties($,{tape:{set:function(tape){tape instanceof Tape?(this.playbackState=fn.PLAYING_STATE,this._.tape=tape,this._.tapeStream=new TapeStream(tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped):(tape instanceof T.Object&&tape.buffer&&(tape=tape.buffer),"object"==typeof tape&&Array.isArray(tape.buffer)&&isSignalArray(tape.buffer[0])&&(this.playbackState=fn.PLAYING_STATE,this._.tape=new Scissor(tape),this._.tapeStream=new TapeStream(this._.tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped))},get:function(){return this._.tape}},isLooped:{get:function(){return this._.isLooped}},buffer:{get:function(){return this._.tape?this._.tape.getBuffer():void 0}}}),$.loop=function(value){return this._.isLooped=!!value,this._.tapeStream&&(this._.tapeStream.isLooped=this._.isLooped),this},$.bang=function(){return this.playbackState=fn.PLAYING_STATE,this._.tapeStream&&this._.tapeStream.reset(),this._.emit("bang"),this},$.getBuffer=function(){return this._.tape?this._.tape.getBuffer():void 0},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var tapeStream=_.tapeStream;if(tapeStream){var cellL=this.cells[1],cellR=this.cells[2],tmp=tapeStream.fetch(cellL.length);cellL.set(tmp[0]),cellR.set(tmp[1]),this.playbackState===fn.PLAYING_STATE&&tapeStream.isEnded&&fn.nextTick(_.onended)}fn.outputSignalAR(this)}return this},fn.register("tape",ScissorNode)}(timbre),function(T){"use strict";function TaskNode(_args){T.Object.call(this,1,_args),fn.timer(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.task=[],_.i=0,_.j=0,_.imax=0,_.jmax=0,_.wait=0,_.count=0,_.args={},_.doNum=1,_.initFunc=fn.nop,_.onended=make_onended(this),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue,FunctionWrapper=T(function(){}).constructor;fn.extend(TaskNode);var onstart=function(){var args,_=this._;this.playbackState=fn.PLAYING_STATE,_.task=this.nodes.map(function(x){return x instanceof FunctionWrapper?x.func:!1}).filter(function(x){return!!x}),_.i=_.j=0,_.imax=_.doNum,_.jmax=_.task.length,args=_.initFunc(),fn.isDictionary(args)||(args={param:args}),_.args=args},make_onended=function(self){return function(){self.playbackState=fn.FINISHED_STATE;var _=self._,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],lastValue=_.args;if("number"==typeof lastValue)for(var i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=lastValue;_.emit("ended",_.args)}},$=TaskNode.prototype;Object.defineProperties($,{"do":{set:function(value){"number"==typeof value&&value>0&&(this._.doNum=1/0===value?1/0:0|value)},get:function(){return this._.doNum}},init:{set:function(value){"function"==typeof value&&(this._.initFunc=value)},get:function(){return this._.initFunc}}}),$.bang=function(){var _=this._;return _.count=0,_.emit("bang"),this},$.wait=function(time){return"string"==typeof time&&(time=timevalue(time)),"number"==typeof time&&time>0&&(this._.count+=this._.samplerate*time*.001|0),this},$.process=function(tickID){var func,cell=this.cells[0],_=this._;if(this.tickID!==tickID&&(this.tickID=tickID,_.i<_.imax)){for(;_.count<=0;){if(_.j>=_.jmax){if(++_.i,_.i>=_.imax){fn.nextTick(_.onended);break}_.j=0}func=_.task[_.j++],func&&func.call(this,_.i,_.args)}_.count-=cell.length}return this},fn.register("task",TaskNode)}(timbre),function(T){"use strict";function TimeoutNode(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.currentTime=0,_.samplesMax=0,_.samples=0,_.onended=fn.make_onended(this),this.once("init",oninit),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue;fn.extend(TimeoutNode);var oninit=function(){this._.timeout||(this.timeout=1e3)},onstart=function(){this.playbackState=fn.PLAYING_STATE};Object.defineProperty(onstart,"unremovable",{value:!0,writable:!1});var $=TimeoutNode.prototype;Object.defineProperties($,{timeout:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this.playbackState=fn.PLAYING_STATE,_.timeout=value,_.samplesMax=.001*_.samplerate*value|0,_.samples=_.samplesMax)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),$.bang=function(){var _=this._;return this.playbackState=fn.PLAYING_STATE,_.samples=_.samplesMax,_.currentTime=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){if(this.tickID=tickID,_.samples>0&&(_.samples-=cell.length),_.samples<=0){for(var nodes=this.nodes,i=0,imax=nodes.length;imax>i;++i)nodes[i].bang();fn.nextTick(_.onended)}_.currentTime+=fn.currentTimeIncr}return this},fn.register("timeout",TimeoutNode)}(timbre),function(T){"use strict";function WaveShaperNode(_args){T.Object.call(this,1,_args),fn.fixAR(this),this._.curve=null}var fn=T.fn;fn.extend(WaveShaperNode);var $=WaveShaperNode.prototype;Object.defineProperties($,{curve:{set:function(value){fn.isSignalArray(value)&&(this._.curve=value)},get:function(){return this._.curve}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),_.curve){var x,i,cell=this.cells[0],curve=_.curve,len=curve.length,imax=_.cellsize;for(i=0;imax>i;++i)x=.5*(cell[i]+1)*len+.5|0,0>x?x=0:x>=len-1&&(x=len-1),cell[i]=curve[x]}fn.outputSignalAR(this)}return this},fn.register("waveshaper",WaveShaperNode)}(timbre),function(T){"use strict";function ZMapNode(_args){T.Object.call(this,1,_args);var _=this._;_.inMin=0,_.inMax=1,_.outMin=0,_.outMax=1,_.ar=!1,this.once("init",oninit)
}var fn=T.fn;fn.extend(ZMapNode);var oninit=function(){this._.warp||(this.warp="linlin")},$=ZMapNode.prototype;Object.defineProperties($,{inMin:{set:function(value){"number"==typeof value&&(this._.inMin=value)},get:function(){return this._.inMin}},inMax:{set:function(value){"number"==typeof value&&(this._.inMax=value)},get:function(){return this._.inMax}},outMin:{set:function(value){"number"==typeof value&&(this._.outMin=value)},get:function(){return this._.outMin}},outMax:{set:function(value){"number"==typeof value&&(this._.outMax=value)},get:function(){return this._.outMax}},warp:{set:function(value){if("string"==typeof value){var f=WarpFunctions[value];f&&(this._.warp=f,this._.warpName=value)}},get:function(){return this._.warpName}}}),$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){this.tickID=tickID;var i,inMin=_.inMin,inMax=_.inMax,outMin=_.outMin,outMax=_.outMax,warp=_.warp,len=this.nodes.length,mul=_.mul,add=_.add,imax=cell.length;if(_.ar&&len){for(fn.inputSignalAR(this),i=0;imax>i;++i)cell[i]=warp(cell[i],inMin,inMax,outMin,outMax)*mul+add;fn.outputSignalAR(this)}else{var input=this.nodes.length?fn.inputSignalKR(this):0,value=warp(input,inMin,inMax,outMin,outMax)*mul+add;for(i=0;imax>i;++i)cell[i]=value}}return this};var WarpFunctions={linlin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:inMax===inMin?outMin:(x-inMin)/(inMax-inMin)*(outMax-outMin)+outMin},linexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===outMin?0:inMax===inMin?outMax:Math.pow(outMax/outMin,(x-inMin)/(inMax-inMin))*outMin},explin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin?outMax:Math.log(x/inMin)/Math.log(inMax/inMin)*(outMax-outMin)+outMin},expexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin||0===outMin?0:Math.pow(outMax/outMin,Math.log(x/inMin)/Math.log(inMax/inMin))*outMin}};fn.register("zmap",ZMapNode)}(timbre),!function(undefined){"use strict";function setupTypedArray(){function ArrayBuffer(_){for(var shift,a=new Array(_.byteLength),bytes=_.BYTES_PER_ELEMENT,i=0,imax=a.length;imax>i;++i)shift=i%bytes*8,a[i]=(_[i/bytes|0]&255<<shift)>>>shift;return a.__view=_,a}function TypedArray(klass,arg,offset,length){var a,b,bytes,i,imax;if(Array.isArray(arg))if(arg.__view)if("undefined"==typeof offset&&(offset=0),"undefined"==typeof length&&(length=arg.length-offset),bytes=klass.bytes,klass.type===floating)a=arg.__view.slice(offset/bytes|0,(offset+length)/bytes|0);else{for(b=arg.slice(offset,offset+length),a=new Array(b.length/bytes|0),i=0,imax=a.length;imax>i;++i)a[i]=0;for(i=0,imax=b.length;imax>i;++i)a[i/bytes|0]+=(255&b[i])<<i%bytes*8}else a=arg.slice();else a="number"==typeof arg&&arg>0?new Array(0|arg):[];if(klass.type!==floating)for(i=0,imax=a.length;imax>i;++i)a[i]=65535&(+a[i]||0);else for(i=0,imax=a.length;imax>i;++i)a[i]=a[i]||0;if(klass.type===signed)for(i=0,imax=a.length;imax>i;++i)a[i]&1<<8*bytes-1&&(a[i]-=1<<8*bytes);return a.__klass=klass,a.constructor=window[klass.name],a.set=set,a.subarray=subarray,a.BYTES_PER_ELEMENT=klass.bytes,a.byteLength=klass.bytes*a.length,a.byteOffset=offset||0,Object.defineProperty(a,"buffer",{get:function(){return new ArrayBuffer(this)}}),a}var unsigned=0,signed=1,floating=2,set=function(array,offset){"undefined"==typeof offset&&(offset=0);var i,imax=Math.min(this.length-offset,array.length);for(i=0;imax>i;++i)this[offset+i]=array[i]},subarray=function(begin,end){return"undefined"==typeof end&&(end=this.length),new this.constructor(this.slice(begin,end))};[["Int8Array",1,signed],["Uint8Array",1,unsigned],["Int16Array",2,signed],["Uint16Array",2,unsigned],["Int32Array",4,signed],["Uint32Array",4,unsigned],["Float32Array",4,floating],["Float64Array",8,floating]].forEach(function(_params){var name=_params[0],params={bytes:_params[1],type:_params[2],name:name};window[name]=function(arg,offset,length){return TypedArray.call(this,params,arg,offset,length)}})}"undefined"==typeof Float32Array&&setupTypedArray();var timbre=function(){return T.apply(null,arguments)},slice=Array.prototype.slice,FINISHED_STATE=0,PLAYING_STATE=1,UNSCHEDULED_STATE=2,SCHEDULED_STATE=3,ACCEPT_SAMPLERATES=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3],ACCEPT_CELLSIZES=[32,64,128,256],_ver="13.08.03",_sys=null,_constructors={},_factories={},_envtype="undefined"!=typeof module&&module.exports?"node":"undefined"!=typeof window?"browser":"unknown",_envmobile="browser"===_envtype&&/(iPhone|iPad|iPod|Android)/i.test(navigator.userAgent),_f64mode=!1,_bpm=120,T=function(){var t,m,args=slice.call(arguments),key=args[0];switch(typeof key){case"string":_constructors[key]?t=new _constructors[key](args.slice(1)):_factories[key]?t=_factories[key](args.slice(1)):(m=/^(.+?)(?:\.(ar|kr))?$/.exec(key),m&&(key=m[1],_constructors[key]?t=new _constructors[key](args.slice(1)):_factories[key]&&(t=_factories[key](args.slice(1))),t&&m[2]&&t[m[2]]()));break;case"number":t=new NumberWrapper(args);break;case"boolean":t=new BooleanWrapper(args);break;case"function":t=new FunctionWrapper(args);break;case"object":if(null!==key){if(key instanceof TimbreObject)return key;if(key.context instanceof TimbreObject)return key.context;isDictionary(key)?t=new ObjectWrapper(args):isArray(key)&&(t=new ArrayWrapper(args))}}t===undefined&&(t=new AddNode(args.slice(1)),console.warn('T("'+key+'") is not defined.'));var _=t._;return _.originkey=key,_.meta=__buildMetaData(t),_.emit("init"),t},__buildMetaData=function(instance){for(var names,desc,meta=instance._.meta,p=instance;null!==p&&p.constructor!==Object;){names=Object.getOwnPropertyNames(p);for(var i=0,imax=names.length;imax>i;++i)meta[names[i]]||(/^(constructor$|process$|_)/.test(names[i])?meta[names[i]]="ignore":(desc=Object.getOwnPropertyDescriptor(p,names[i]),"function"==typeof desc.value?meta[names[i]]="function":(desc.get||desc.set)&&(meta[names[i]]="property")));p=Object.getPrototypeOf(p)}return meta};Object.defineProperties(timbre,{version:{value:_ver},envtype:{value:_envtype},envmobile:{value:_envmobile},env:{get:function(){return _sys.impl.env}},samplerate:{get:function(){return _sys.samplerate}},channels:{get:function(){return _sys.channels}},cellsize:{get:function(){return _sys.cellsize}},currentTime:{get:function(){return _sys.currentTime}},isPlaying:{get:function(){return _sys.status===PLAYING_STATE}},isRecording:{get:function(){return _sys.status===SCHEDULED_STATE}},amp:{set:function(value){"number"==typeof value&&(_sys.amp=value)},get:function(){return _sys.amp}},bpm:{set:function(value){"number"==typeof value&&value>=5&&300>=value&&(_bpm=value)},get:function(){return _bpm}}}),timbre.bind=function(Klass,opts){return _sys.bind(Klass,opts),timbre},timbre.setup=function(opts){return _sys.setup(opts),timbre},timbre.play=function(){return _sys.play(),timbre},timbre.pause=function(){return _sys.pause(),timbre},timbre.reset=function(){return _sys.reset(),_sys.events.emit("reset"),timbre},timbre.on=timbre.addListener=function(type,listener){return _sys.on(type,listener),timbre},timbre.once=function(type,listener){return _sys.once(type,listener),timbre},timbre.off=timbre.removeListener=function(type,listener){return _sys.off(type,listener),timbre},timbre.removeAllListeners=function(type){return _sys.removeAllListeners(type),timbre},timbre.listeners=function(type){return _sys.listeners(type)},timbre.rec=function(){return _sys.rec.apply(_sys,arguments)},timbre.timevalue=function(){var getbpm=function(str){var m,bpm=_bpm;return(m=/^bpm(\d+(?:\.\d+)?)/i.exec(str))&&(bpm=Math.max(5,Math.min(300,+(m[1]||0)))),bpm};return function(str){var m,ms,x;if(m=/^(\d+(?:\.\d+)?)Hz$/i.exec(str))return 0===+m[1]?0:1e3/+m[1];if(m=/L(\d+)?(\.*)$/i.exec(str))return ms=60/getbpm(str)*(4/(m[1]||4))*1e3,ms*=[1,1.5,1.75,1.875][(m[2]||"").length]||1;if(m=/^(\d+(?:\.\d+)?|\.(?:\d+))(min|sec|m)s?$/i.exec(str))switch(m[2]){case"min":return 60*+(m[1]||0)*1e3;case"sec":return 1e3*+(m[1]||0);case"m":return+(m[1]||0)}return(m=/^(?:([0-5]?[0-9]):)?(?:([0-5]?[0-9]):)(?:([0-5]?[0-9]))(?:\.([0-9]{1,3}))?$/.exec(str))?(x=3600*(m[1]||0)+60*(m[2]||0)+(m[3]||0),x=1e3*x+(0|((m[4]||"")+"00").substr(0,3))):(m=/(\d+)\.(\d+)\.(\d+)$/i.exec(str))?(x=480*(4*m[1]+ +m[2])+ +m[3],60/getbpm(str)*(x/480)*1e3):(m=/(\d+)ticks$/i.exec(str))?60/getbpm(str)*(m[1]/480)*1e3:(m=/^(\d+)samples(?:\/(\d+)Hz)?$/i.exec(str))?1e3*m[1]/(m[2]||timbre.samplerate):0}}();var fn=timbre.fn={SignalArray:Float32Array,currentTimeIncr:0,emptycell:null,FINISHED_STATE:FINISHED_STATE,PLAYING_STATE:PLAYING_STATE,UNSCHEDULED_STATE:UNSCHEDULED_STATE,SCHEDULED_STATE:SCHEDULED_STATE},isArray=fn.isArray=Array.isArray,isDictionary=fn.isDictionary=function(object){return"object"==typeof object&&object.constructor===Object};fn.nop=function(){return this},fn.isSignalArray=function(obj){return obj instanceof fn.SignalArray?!0:Array.isArray(obj)&&obj.__klass&&2===obj.__klass.type?!0:!1},fn.extend=function(child,parent){function ctor(){this.constructor=child}parent=parent||TimbreObject;for(var key in parent)parent.hasOwnProperty(key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},fn.constructorof=function(ctor,Klass){for(var f=ctor&&ctor.prototype;f;){if(f===Klass.prototype)return!0;f=Object.getPrototypeOf(f)}return!1},fn.register=function(key,ctor){fn.constructorof(ctor,TimbreObject)?_constructors[key]=ctor:_factories[key]=ctor},fn.alias=function(key,alias){_constructors[alias]?_constructors[key]=_constructors[alias]:_factories[alias]&&(_factories[key]=_factories[alias])},fn.getClass=function(key){return _constructors[key]},fn.pointer=function(src,offset,length){return offset=src.byteOffset+offset*src.constructor.BYTES_PER_ELEMENT,"number"==typeof length?new src.constructor(src.buffer,offset,length):new src.constructor(src.buffer,offset)},fn.nextTick=function(func){return _sys.nextTick(func),timbre},fn.fixAR=function(self){self._.ar=!0,self._.aronly=!0},fn.fixKR=function(self){self._.ar=!1,self._.kronly=!0},fn.changeWithValue=function(){var _=this._,x=_.value*_.mul+_.add;isNaN(x)&&(x=0);for(var cell=this.cells[0],i=0,imax=cell.length;imax>i;++i)cell[i]=x},fn.changeWithValue.unremovable=!0,fn.clone=function(src){var new_instance=new src.constructor([]);return new_instance._.ar=src._.ar,new_instance._.mul=src._.mul,new_instance._.add=src._.add,new_instance._.bypassed=src._.bypassed,new_instance},fn.timer=function(){var make_onstart=function(self){return function(){-1===_sys.timers.indexOf(self)&&(_sys.timers.push(self),_sys.events.emit("addObject"),self._.emit("start"),fn.buddies_start(self))}},make_onstop=function(self){return function(){var i=_sys.timers.indexOf(self);-1!==i&&(_sys.timers.splice(i,1),self._.emit("stop"),_sys.events.emit("removeObject"),fn.buddies_stop(self))}};return function(self){var onstart=make_onstart(self),onstop=make_onstop(self);return self.nodeType=TimbreObject.TIMER,self.start=function(){return _sys.nextTick(onstart),self},self.stop=function(){return _sys.nextTick(onstop),self},self}}(),fn.listener=function(){var make_onlisten=function(self){return function(){-1===_sys.listeners.indexOf(self)&&(_sys.listeners.push(self),_sys.events.emit("addObject"),self._.emit("listen"),fn.buddies_start(self))}},make_onunlisten=function(self){return function(){var i=_sys.listeners.indexOf(self);-1!==i&&(_sys.listeners.splice(i,1),self._.emit("unlisten"),_sys.events.emit("removeObject"),fn.buddies_stop(self))}};return function(self){var onlisten=make_onlisten(self),onunlisten=make_onunlisten(self);return self.nodeType=TimbreObject.LISTENER,self.listen=function(){return arguments.length&&self.append.apply(self,arguments),self.nodes.length&&_sys.nextTick(onlisten),self},self.unlisten=function(){return arguments.length&&self.remove.apply(self,arguments),self.nodes.length||_sys.nextTick(onunlisten),self},self}}(),fn.make_onended=function(self,lastValue){return function(){if(self.playbackState=FINISHED_STATE,"number"==typeof lastValue)for(var cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=lastValue;self._.emit("ended")}},fn.inputSignalAR=function(self){var i,j,not_clear,tmp,tmpL,tmpR,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],nodes=self.nodes,imax=nodes.length,jmax=cell.length,tickID=self.tickID;if(2===self.numChannels){if(not_clear=!0,0!==imax){for(i=0;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE){nodes[i].process(tickID),cellL.set(nodes[i].cells[1]),cellR.set(nodes[i].cells[2]),not_clear=!1,++i;break}for(;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=jmax;j;)j-=8,cellL[j]+=tmpL[j],cellR[j]+=tmpR[j],cellL[j+1]+=tmpL[j+1],cellR[j+1]+=tmpR[j+1],cellL[j+2]+=tmpL[j+2],cellR[j+2]+=tmpR[j+2],cellL[j+3]+=tmpL[j+3],cellR[j+3]+=tmpR[j+3],cellL[j+4]+=tmpL[j+4],cellR[j+4]+=tmpR[j+4],cellL[j+5]+=tmpL[j+5],cellR[j+5]+=tmpR[j+5],cellL[j+6]+=tmpL[j+6],cellR[j+6]+=tmpR[j+6],cellL[j+7]+=tmpL[j+7],cellR[j+7]+=tmpR[j+7]}not_clear&&(cellL.set(fn.emptycell),cellR.set(fn.emptycell))}else{if(not_clear=!0,0!==imax){for(i=0;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE){nodes[i].process(tickID),cell.set(nodes[i].cells[0]),not_clear=!1,++i;break}for(;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE)for(tmp=nodes[i].process(tickID).cells[0],j=jmax;j;)j-=8,cell[j]+=tmp[j],cell[j+1]+=tmp[j+1],cell[j+2]+=tmp[j+2],cell[j+3]+=tmp[j+3],cell[j+4]+=tmp[j+4],cell[j+5]+=tmp[j+5],cell[j+6]+=tmp[j+6],cell[j+7]+=tmp[j+7]}not_clear&&cell.set(fn.emptycell)}},fn.inputSignalKR=function(self){var i,nodes=self.nodes,imax=nodes.length,tickID=self.tickID,tmp=0;for(i=0;imax>i;++i)nodes[i].playbackState===PLAYING_STATE&&(tmp+=nodes[i].process(tickID).cells[0][0]);return tmp},fn.outputSignalAR=function(self){var i,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],mul=self._.mul,add=self._.add;if(2===self.numChannels)for(i=cell.length;i;)i-=8,cellL[i]=cellL[i]*mul+add,cellR[i]=cellR[i]*mul+add,cellL[i+1]=cellL[i+1]*mul+add,cellR[i+1]=cellR[i+1]*mul+add,cellL[i+2]=cellL[i+2]*mul+add,cellR[i+2]=cellR[i+2]*mul+add,cellL[i+3]=cellL[i+3]*mul+add,cellR[i+3]=cellR[i+3]*mul+add,cellL[i+4]=cellL[i+4]*mul+add,cellR[i+4]=cellR[i+4]*mul+add,cellL[i+5]=cellL[i+5]*mul+add,cellR[i+5]=cellR[i+5]*mul+add,cellL[i+6]=cellL[i+6]*mul+add,cellR[i+6]=cellR[i+6]*mul+add,cellL[i+7]=cellL[i+7]*mul+add,cellR[i+7]=cellR[i+7]*mul+add,cell[i]=.5*(cellL[i]+cellR[i]),cell[i+1]=.5*(cellL[i+1]+cellR[i+1]),cell[i+2]=.5*(cellL[i+2]+cellR[i+2]),cell[i+3]=.5*(cellL[i+3]+cellR[i+3]),cell[i+4]=.5*(cellL[i+4]+cellR[i+4]),cell[i+5]=.5*(cellL[i+5]+cellR[i+5]),cell[i+6]=.5*(cellL[i+6]+cellR[i+6]),cell[i+7]=.5*(cellL[i+7]+cellR[i+7]);else if(1!==mul||0!==add)for(i=cell.length;i;)i-=8,cell[i]=cell[i]*mul+add,cell[i+1]=cell[i+1]*mul+add,cell[i+2]=cell[i+2]*mul+add,cell[i+3]=cell[i+3]*mul+add,cell[i+4]=cell[i+4]*mul+add,cell[i+5]=cell[i+5]*mul+add,cell[i+6]=cell[i+6]*mul+add,cell[i+7]=cell[i+7]*mul+add},fn.outputSignalKR=function(self){var i,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],mul=self._.mul,add=self._.add,value=cell[0]*mul+add;if(2===self.numChannels)for(i=cell.length;i;)i-=8,cell[i]=cell[i+1]=cell[i+2]=cell[i+3]=cell[i+4]=cell[i+5]=cell[i+6]=cell[i+7]=cellL[i]=cellL[i+1]=cellL[i+2]=cellL[i+3]=cellL[i+4]=cellL[i+5]=cellL[i+6]=cellL[i+7]=cellR[i]=cellR[i+1]=cellR[i+2]=cellR[i+3]=cellR[i+4]=cellR[i+5]=cellR[i+6]=cellR[i+7]=value;else for(i=cell.length;i;)i-=8,cell[i]=cell[i+1]=cell[i+2]=cell[i+3]=cell[i+4]=cell[i+5]=cell[i+6]=cell[i+7]=value},fn.buddies_start=function(self){var node,i,imax,buddies=self._.buddies;for(i=0,imax=buddies.length;imax>i;++i)switch(node=buddies[i],node.nodeType){case TimbreObject.DSP:node.play();break;case TimbreObject.TIMER:node.start();break;case TimbreObject.LISTENER:node.listen()}},fn.buddies_stop=function(self){var node,i,imax,buddies=self._.buddies;for(i=0,imax=buddies.length;imax>i;++i)switch(node=buddies[i],node.nodeType){case TimbreObject.DSP:node.pause();break;case TimbreObject.TIMER:node.stop();break;case TimbreObject.LISTENER:node.unlisten()}},fn.fix_iOS6_1_problem=function(flag){_sys.fix_iOS6_1_problem(flag)};var modules=timbre.modules={},EventEmitter=modules.EventEmitter=function(){function EventEmitter(context){this.context=context,this.events={}}var $=EventEmitter.prototype;return $.emit=function(type){var handler=this.events[type];if(!handler)return!1;var args;if("function"==typeof handler){switch(arguments.length){case 1:handler.call(this.context);break;case 2:handler.call(this.context,arguments[1]);break;case 3:handler.call(this.context,arguments[1],arguments[2]);break;default:args=slice.call(arguments,1),handler.apply(this.context,args)}return!0}if(isArray(handler)){args=slice.call(arguments,1);for(var listeners=handler.slice(),i=0,imax=listeners.length;imax>i;++i)listeners[i]instanceof TimbreObject?listeners[i].bang.apply(listeners[i],args):listeners[i].apply(this.context,args);return!0}return handler instanceof TimbreObject?(args=slice.call(arguments,1),void handler.bang.apply(handler,args)):!1},$.on=function(type,listener){if("function"!=typeof listener&&!(listener instanceof TimbreObject))throw new Error("addListener takes instances of Function or timbre.Object");var e=this.events;return e[type]?isArray(e[type])?e[type].push(listener):e[type]=[e[type],listener]:e[type]=listener,this},$.once=function(type,listener){var g,self=this;if("function"==typeof listener)g=function(){self.off(type,g),listener.apply(self.context,arguments)};else{if(!(listener instanceof TimbreObject))throw new Error("once takes instances of Function or timbre.Object");g=function(){self.off(type,g),listener.bang.apply(listener,arguments)}}return g.listener=listener,self.on(type,g),this},$.off=function(type,listener){if("function"!=typeof listener&&!(listener instanceof TimbreObject))throw new Error("removeListener takes instances of Function or timbre.Object");var e=this.events;if(!e[type])return this;var list=e[type];if(isArray(list)){for(var position=-1,i=0,imax=list.length;imax>i;++i)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;list.splice(position,1),0===list.length&&(e[type]=null)}else(list===listener||list.listener&&list.listener===listener)&&(e[type]=null);return this},$.removeAllListeners=function(type){var e=this.events,remain=!1,listeners=e[type];if(isArray(listeners))for(var i=listeners.length;i--;){var listener=listeners[i];listener.unremovable?remain=!0:this.off(type,listener)}else listeners&&(listeners.unremovable?remain=!0:this.off(type,listeners));return remain||(e[type]=null),this},$.listeners=function(type){var a,e=this.events;if(!e[type])return[];if(e=e[type],!isArray(e))return e.unremovable?[]:[e];e=e.slice(),a=[];for(var i=0,imax=e.length;imax>i;++i)e[i].unremovable||a.push(e[i]);return a},EventEmitter}(),Deferred=modules.Deferred=function(){function Deferred(context){this.context=context||this,this._state="pending",this._doneList=[],this._failList=[],this._promise=new Promise(this)}function Promise(object){this.context=object.context,this.then=object.then,this.done=function(){return object.done.apply(object,arguments),this},this.fail=function(){return object.fail.apply(object,arguments),this},this.pipe=function(){return object.pipe.apply(object,arguments)},this.always=function(){return object.always.apply(object,arguments),this},this.promise=function(){return this},this.isResolved=function(){return object.isResolved()},this.isRejected=function(){return object.isRejected()}}var $=Deferred.prototype,exec=function(statue,list,context,args){if("pending"===this._state){this._state=statue;for(var i=0,imax=list.length;imax>i;++i)list[i].apply(context,args);this._doneList=this._failList=null}},isDeferred=function(x){return x&&"function"==typeof x.promise};return $.resolve=function(){var args=slice.call(arguments,0);return exec.call(this,"resolved",this._doneList,this.context||this,args),this},$.resolveWith=function(context){var args=slice.call(arguments,1);return exec.call(this,"resolved",this._doneList,context,args),this},$.reject=function(){var args=slice.call(arguments,0);return exec.call(this,"rejected",this._failList,this.context||this,args),this},$.rejectWith=function(context){var args=slice.call(arguments,1);return exec.call(this,"rejected",this._failList,context,args),this},$.promise=function(){return this._promise},$.done=function(){for(var args=slice.call(arguments),isResolved="resolved"===this._state,isPending="pending"===this._state,list=this._doneList,i=0,imax=args.length;imax>i;++i)"function"==typeof args[i]&&(isResolved?args[i]():isPending&&list.push(args[i]));return this},$.fail=function(){for(var args=slice.call(arguments),isRejected="rejected"===this._state,isPending="pending"===this._state,list=this._failList,i=0,imax=args.length;imax>i;++i)"function"==typeof args[i]&&(isRejected?args[i]():isPending&&list.push(args[i]));return this},$.always=function(){return this.done.apply(this,arguments),this.fail.apply(this,arguments),this},$.then=function(done,fail){return this.done(done).fail(fail)},$.pipe=function(done,fail){var self=this,dfd=new Deferred(this.context);return this.done(function(){var res=done.apply(self.context,arguments);isDeferred(res)?res.then(function(){var args=slice.call(arguments);dfd.resolveWith.apply(dfd,[res].concat(args))}):dfd.resolveWith(self,res)}),this.fail(function(){if("function"==typeof fail){var res=fail.apply(self.context,arguments);isDeferred(res)&&res.fail(function(){var args=slice.call(arguments);dfd.rejectWith.apply(dfd,[res].concat(args))})}else dfd.reject.apply(dfd,arguments)}),dfd.promise()},$.isResolved=function(){return"resolved"===this._state},$.isRejected=function(){return"rejected"===this._state},$.state=function(){return this._state},Deferred.when=function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length;1!==length||isDeferred(subordinate)||(remaining=0);var deferred=1===remaining?subordinate:new Deferred,updateFunc=function(i,results){return function(value){results[i]=arguments.length>1?slice.call(arguments):value,--remaining||deferred.resolve.apply(deferred,results)}};if(length>1)for(var resolveResults=new Array(length),onfailed=function(){deferred.reject()};length>i;++i)resolveValues[i]&&isDeferred(resolveValues[i])?resolveValues[i].promise().done(updateFunc(i,resolveResults)).fail(onfailed):(resolveResults[i]=resolveValues[i],--remaining);return remaining||deferred.resolve.apply(deferred,resolveValues),deferred.promise()},Deferred}(),TimbreObject=timbre.Object=function(){function TimbreObject(numChannels,_args){this._={};var e=this._.events=new EventEmitter(this);if(this._.emit=function(){return e.emit.apply(e,arguments)},isDictionary(_args[0])){var params=_args.shift(),_in=params["in"];this.once("init",function(){this.set(params),_in&&(isArray(_in)?this.append.apply(this,_in):_in instanceof TimbreObject&&this.append(_in))})}switch(this.tickID=-1,this.nodes=_args.map(timbre),this.cells=[],this.numChannels=numChannels,numChannels){case 0:this.L=this.R=new ChannelObject(null),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 1:this.L=this.R=new ChannelObject(this),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 2:this.L=new ChannelObject(this),this.R=new ChannelObject(this),this.cells[0]=new fn.SignalArray(_sys.cellsize),this.cells[1]=this.L.cell,this.cells[2]=this.R.cell}this.playbackState=PLAYING_STATE,this.nodeType=TimbreObject.DSP,this._.ar=!0,this._.mul=1,this._.add=0,this._.dac=null,this._.bypassed=!1,this._.meta={},this._.samplerate=_sys.samplerate,this._.cellsize=_sys.cellsize,this._.buddies=[]}TimbreObject.DSP=1,TimbreObject.TIMER=2,TimbreObject.LISTENER=3;var $=TimbreObject.prototype;return Object.defineProperties($,{isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},isBypassed:{get:function(){return this._.bypassed}},isEnded:{get:function(){return!(1&this.playbackState)}},mul:{set:function(value){"number"==typeof value&&(this._.mul=value,this._.emit("setMul",value))},get:function(){return this._.mul}},add:{set:function(value){"number"==typeof value&&(this._.add=value,this._.emit("setAdd",value))},get:function(){return this._.add}},buddies:{set:function(value){isArray(value)||(value=[value]),this._.buddies=value.filter(function(node){return node instanceof TimbreObject})},get:function(){return this._.buddies}}}),$.toString=function(){return this.constructor.name},$.valueOf=function(){return _sys.tickID!==this.tickID&&this.process(_sys.tickID),this.cells[0][0]},$.append=function(){if(arguments.length>0){var list=slice.call(arguments).map(timbre);this.nodes=this.nodes.concat(list),this._.emit("append",list)}return this},$.appendTo=function(object){return object.append(this),this},$.remove=function(){if(arguments.length>0){for(var j,nodes=this.nodes,list=[],i=0,imax=arguments.length;imax>i;++i)-1!==(j=nodes.indexOf(arguments[i]))&&(list.push(nodes[j]),nodes.splice(j,1));list.length>0&&this._.emit("remove",list)}return this},$.removeFrom=function(object){return object.remove(this),this},$.removeAll=function(){var list=this.nodes.slice();return this.nodes=[],list.length>0&&this._.emit("remove",list),this},$.removeAtIndex=function(index){var item=this.nodes[index];return item&&(this.nodes.splice(index,1),this._.emit("remove",[item])),this},$.postMessage=function(message){return this._.emit("message",message),this},$.to=function(object){if(object instanceof TimbreObject)object.append(this);else{var args=slice.call(arguments);isDictionary(args[1])?args.splice(2,0,this):args.splice(1,0,this),object=T.apply(null,args)}return object},$.splice=function(ins,obj,rem){var i;return obj?obj instanceof TimbreObject&&(i=obj.nodes.indexOf(rem),-1!==i&&obj.nodes.splice(i,1),ins instanceof TimbreObject?(ins.nodes.push(this),obj.nodes.push(ins)):obj.nodes.push(this)):this._.dac&&(ins instanceof TimbreObject?rem instanceof TimbreObject?rem._.dac&&(rem._.dac._.node=ins,ins._.dac=rem._.dac,rem._.dac=null,ins.nodes.push(this)):this._.dac&&(this._.dac._.node=ins,ins._.dac=this._.dac,this._.dac=null,ins.nodes.push(this)):rem instanceof TimbreObject&&rem._.dac&&(rem._.dac._.node=this,this._.dac=rem._.dac,rem._.dac=null)),this},$.on=$.addListener=function(type,listener){return this._.events.on(type,listener),this},$.once=function(type,listener){return this._.events.once(type,listener),this},$.off=$.removeListener=function(type,listener){return this._.events.off(type,listener),this},$.removeAllListeners=function(type){return this._.events.removeAllListeners(type),this},$.listeners=function(type){return this._.events.listeners(type)},$.set=function(key,value){var x,desc,meta=this._.meta;switch(typeof key){case"string":switch(meta[key]){case"property":this[key]=value;break;case"function":this[key](value);break;default:for(x=this;null!==x;)desc=Object.getOwnPropertyDescriptor(x,key),desc&&("function"==typeof desc.value?(meta[key]="function",this[key](value)):(desc.get||desc.set)&&(meta[key]="property",this[key]=value)),x=Object.getPrototypeOf(x)}break;case"object":for(x in key)this.set(x,key[x])}return this},$.get=function(key){return"property"===this._.meta[key]?this[key]:void 0},$.bang=function(){return this._.emit.apply(this,["bang"].concat(slice.call(arguments))),this},$.process=fn.nop,$.bypass=function(){return this._.bypassed=0===arguments.length?!0:!!arguments[0],this},$.play=function(){var dac=this._.dac;return null===dac&&(dac=this._.dac=new SystemInlet(this)),dac.play()&&this._.emit.apply(this,["play"].concat(slice.call(arguments))),fn.buddies_start(this),this},$.pause=function(){var dac=this._.dac;return dac&&dac.playbackState===PLAYING_STATE&&(dac.pause(),this._.dac=null,this._.emit("pause")),fn.buddies_stop(this),this},$.start=$.stop=$.listen=$.unlisten=function(){return this},$.ar=function(){return(0===arguments.length?0:!arguments[0])?this.kr(!0):this._.kronly||(this._.ar=!0,this._.emit("ar",!0)),this},$.kr=function(){return(0===arguments.length?0:!arguments[0])?this.ar(!0):this._.aronly||(this._.ar=!1,this._.emit("ar",!1)),this},$.plot="browser"===_envtype?function(opts){var _=this._,canvas=opts.target;if(!canvas)return this;var foreground,width=opts.width||canvas.width||320,height=opts.height||canvas.height||240,offset_x=(opts.x||0)+.5,offset_y=opts.y||0,context=canvas.getContext("2d");foreground=opts.foreground!==undefined?opts.foreground:_.plotForeground||"rgb(  0, 128, 255)";var background;background=opts.background!==undefined?opts.background:_.plotBackground||"rgb(255, 255, 255)";var x,y,dy,y0,i,lineWidth=opts.lineWidth||_.plotLineWidth||1,cyclic=!!_.plotCyclic,data=_.plotData||this.cells[0],range=opts.range||_.plotRange||[-1.2,1.2],rangeMin=range[0],rangeDelta=height/(range[1]-rangeMin),dx=width/data.length,imax=data.length;if(context.save(),context.rect(offset_x,offset_y,width,height),null!==background&&(context.fillStyle=background,context.fillRect(offset_x,offset_y,width,height)),_.plotBefore&&_.plotBefore.call(this,context,offset_x,offset_y,width,height),_.plotBarStyle)for(context.fillStyle=foreground,x=0,i=0;imax>i;++i)dy=(data[i]-rangeMin)*rangeDelta,y=height-dy,context.fillRect(x+offset_x,y+offset_y,dx,dy),x+=dx;else{for(context.strokeStyle=foreground,context.lineWidth=lineWidth,context.beginPath(),x=0,y0=height-(data[0]-rangeMin)*rangeDelta,context.moveTo(x+offset_x,y0+offset_y),i=1;imax>i;++i)x+=dx,y=height-(data[i]-rangeMin)*rangeDelta,context.lineTo(x+offset_x,y+offset_y);cyclic?context.lineTo(x+dx+offset_x,y0+offset_y):context.lineTo(x+dx+offset_x,y+offset_y),context.stroke()}_.plotAfter&&_.plotAfter.call(this,context,offset_x,offset_y,width,height);var border=opts.border||_.plotBorder;return border&&(context.strokeStyle="string"==typeof border?border:"#000",context.lineWidth=1,context.strokeRect(offset_x,offset_y,width,height)),context.restore(),this}:fn.nop,TimbreObject}(),ChannelObject=timbre.ChannelObject=function(){function ChannelObject(parent){timbre.Object.call(this,-1,[]),fn.fixAR(this),this._.parent=parent,this.cell=new fn.SignalArray(_sys.cellsize),this.L=this.R=this,this.cells[0]=this.cells[1]=this.cells[2]=this.cell,this.numChannels=1}return fn.extend(ChannelObject),ChannelObject.prototype.process=function(tickID){return this.tickID!==tickID&&(this.tickID=tickID,this._.parent&&this._.parent.process(tickID)),this},ChannelObject}(),AddNode=function(){function AddNode(_args){TimbreObject.call(this,2,_args)}return fn.extend(AddNode),AddNode.prototype.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},fn.register("+",AddNode),AddNode}(),NumberWrapper=function(){function NumberWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.value=_args[0],isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(NumberWrapper);var $=NumberWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.value=isNaN(value)?0:value,fn.changeWithValue.call(this))},get:function(){return this._.value}}}),NumberWrapper}(),BooleanWrapper=function(){function BooleanWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.value=_args[0],isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(BooleanWrapper);var $=BooleanWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){this._.value=value?1:0,fn.changeWithValue.call(this)},get:function(){return!!this._.value}}}),BooleanWrapper}(),FunctionWrapper=function(){function FunctionWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.func=_args[0],this._.value=0,isDictionary(_args[1])){var params=_args[1];
this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(FunctionWrapper);var $=FunctionWrapper.prototype;return Object.defineProperties($,{func:{set:function(value){"function"==typeof value&&(this._.func=value)},get:function(){return this._.func}},args:{set:function(value){this._.args=isArray(value)?value:[value]},get:function(){return this._.args}}}),$.bang=function(){var _=this._,args=slice.call(arguments).concat(_.args),x=_.func.apply(this,args);return"number"==typeof x&&(_.value=x,fn.changeWithValue.call(this)),this._.emit("bang"),this},FunctionWrapper}(),ArrayWrapper=function(){function ArrayWrapper(_args){TimbreObject.call(this,1,[]);var i,imax;for(i=0,imax=_args[0].length;imax>i;++i)this.append(_args[0][i]);if(isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}}fn.extend(ArrayWrapper);var $=ArrayWrapper.prototype;return Object.defineProperties($,{}),$.bang=function(){var i,imax,args=["bang"].concat(slice.call(arguments)),nodes=this.nodes;for(i=0,imax=nodes.length;imax>i;++i)nodes[i].bang.apply(nodes[i],args);return this},$.postMessage=function(message){var i,imax,nodes=this.nodes;for(i=0,imax=nodes.length;imax>i;++i)nodes[i].postMessage(message);return this},$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},ArrayWrapper}(),ObjectWrapper=function(){function ObjectWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}}fn.extend(ObjectWrapper);var $=ObjectWrapper.prototype;return Object.defineProperties($,{}),ObjectWrapper}(),SystemInlet=function(){function SystemInlet(object){TimbreObject.call(this,2,[]),this.playbackState=FINISHED_STATE;var _=this._;_.node=object,_.onplay=make_onplay(this),_.onpause=make_onpause(this)}fn.extend(SystemInlet);var make_onplay=function(self){return function(){-1===_sys.inlets.indexOf(self)&&(_sys.inlets.push(self),_sys.events.emit("addObject"),self.playbackState=PLAYING_STATE,self._.emit("play"))}},make_onpause=function(self){return function(){var i=_sys.inlets.indexOf(self);-1!==i&&(_sys.inlets.splice(i,1),self.playbackState=FINISHED_STATE,self._.emit("pause"),_sys.events.emit("removeObject"))}},$=SystemInlet.prototype;return $.play=function(){return _sys.nextTick(this._.onplay),-1===_sys.inlets.indexOf(this)},$.pause=function(){_sys.nextTick(this._.onpause)},$.process=function(tickID){var node=this._.node;1&node.playbackState?(node.process(tickID),this.cells[1].set(node.cells[1]),this.cells[2].set(node.cells[2])):(this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell))},SystemInlet}(),SoundSystem=function(){function SoundSystem(){this.context=this,this.tickID=0,this.impl=null,this.amp=.8,this.status=FINISHED_STATE,this.samplerate=44100,this.channels=2,this.cellsize=64,this.streammsec=20,this.streamsize=0,this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this.deferred=null,this.recStart=0,this.recBuffers=null,this.delayProcess=make_delayProcess(this),this.events=null,fn.currentTimeIncr=1e3*this.cellsize/this.samplerate,fn.emptycell=new fn.SignalArray(this.cellsize),this.reset(!0)}var make_delayProcess=function(self){return function(){self.recStart=Date.now(),self.process()}},$=SoundSystem.prototype;$.bind=function(Klass,opts){if("function"==typeof Klass){var player=new Klass(this,opts);this.impl=player,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate)}return this},$.setup=function(params){return"object"==typeof params&&(-1!==ACCEPT_SAMPLERATES.indexOf(params.samplerate)&&(this.samplerate=params.samplerate<=this.impl.maxSamplerate?params.samplerate:this.impl.maxSamplerate),-1!==ACCEPT_CELLSIZES.indexOf(params.cellsize)&&(this.cellsize=params.cellsize),"undefined"!=typeof Float64Array&&"undefined"!=typeof params.f64&&(_f64mode=!!params.f64,fn.SignalArray=_f64mode?Float64Array:Float32Array)),fn.currentTimeIncr=1e3*this.cellsize/this.samplerate,fn.emptycell=new fn.SignalArray(this.cellsize),this},$.getAdjustSamples=function(samplerate){var samples,bits;return samplerate=samplerate||this.samplerate,samples=this.streammsec/1e3*samplerate,bits=Math.ceil(Math.log(samples)*Math.LOG2E),bits=8>bits?8:bits>14?14:bits,1<<bits},$.play=function(){return this.status===FINISHED_STATE&&(this.status=PLAYING_STATE,this.streamsize=this.getAdjustSamples(),this.strmL=new fn.SignalArray(this.streamsize),this.strmR=new fn.SignalArray(this.streamsize),this.impl.play(),this.events.emit("play")),this},$.pause=function(){return this.status===PLAYING_STATE&&(this.status=FINISHED_STATE,this.impl.pause(),this.events.emit("pause")),this},$.reset=function(deep){return deep&&(this.events=new EventEmitter(this).on("addObject",function(){this.status===FINISHED_STATE&&this.play()}).on("removeObject",function(){this.status===PLAYING_STATE&&this.inlets.length+this.timers.length+this.listeners.length===0&&this.pause()})),this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this},$.process=function(){var x,tmpL,tmpR,i,j,jmax,k,nextTicks,tickID=this.tickID,strmL=this.strmL,strmR=this.strmR,amp=this.amp,imax=this.streamsize,saved_i=0,kmax=this.cellsize,n=this.streamsize/this.cellsize,timers=this.timers,inlets=this.inlets,listeners=this.listeners,currentTimeIncr=fn.currentTimeIncr;for(i=0;imax>i;++i)strmL[i]=strmR[i]=0;for(;n--;){for(++tickID,j=0,jmax=timers.length;jmax>j;++j)1&timers[j].playbackState&&timers[j].process(tickID);for(j=0,jmax=inlets.length;jmax>j;++j)if(x=inlets[j],x.process(tickID),1&x.playbackState)for(tmpL=x.cells[1],tmpR=x.cells[2],k=0,i=saved_i;kmax>k;++k,++i)strmL[i]+=tmpL[k],strmR[i]+=tmpR[k];for(saved_i+=kmax,j=0,jmax=listeners.length;jmax>j;++j)1&listeners[j].playbackState&&listeners[j].process(tickID);for(this.currentTime+=currentTimeIncr,nextTicks=this.nextTicks.splice(0),j=0,jmax=nextTicks.length;jmax>j;++j)nextTicks[j]()}for(i=0;imax>i;++i)x=strmL[i]*amp,-1>x?x=-1:x>1&&(x=1),strmL[i]=x,x=strmR[i]*amp,-1>x?x=-1:x>1&&(x=1),strmR[i]=x;this.tickID=tickID;var currentTime=this.currentTime;if(this.status===SCHEDULED_STATE){if(2===this.recCh)this.recBuffers.push(new fn.SignalArray(strmL)),this.recBuffers.push(new fn.SignalArray(strmR));else{var strm=new fn.SignalArray(strmL.length);for(i=0,imax=strm.length;imax>i;++i)strm[i]=.5*(strmL[i]+strmR[i]);this.recBuffers.push(strm)}if(currentTime>=this.maxDuration)this.deferred.sub.reject();else if(currentTime>=this.recDuration)this.deferred.sub.resolve();else{var now=Date.now();now-this.recStart>20?setTimeout(this.delayProcess,10):this.process()}}},$.nextTick=function(func){this.status===FINISHED_STATE?func():this.nextTicks.push(func)},$.rec=function(){fn.fix_iOS6_1_problem(!0);var dfd=new Deferred(this);if(this.deferred)return console.warn("rec deferred is exists??"),dfd.reject().promise();if(this.status!==FINISHED_STATE)return console.log("status is not none",this.status),dfd.reject().promise();var i=0,args=arguments,opts=isDictionary(args[i])?args[i++]:{},func=args[i];if("function"!=typeof func)return console.warn("no function"),dfd.reject().promise();this.deferred=dfd,this.status=SCHEDULED_STATE,this.reset();var rec_inlet=new T("+"),inlet_dfd=new Deferred(this),outlet={done:function(){inlet_dfd.resolve.apply(inlet_dfd,slice.call(arguments))},send:function(){rec_inlet.append.apply(rec_inlet,arguments)}},self=this;return inlet_dfd.then(recdone,function(){fn.fix_iOS6_1_problem(!1),recdone.call(self,!0)}),this.deferred.sub=inlet_dfd,this.savedSamplerate=this.samplerate,this.samplerate=opts.samplerate||this.samplerate,this.recDuration=opts.recDuration||1/0,this.maxDuration=opts.maxDuration||6e5,this.recCh=opts.ch||1,2!==this.recCh&&(this.recCh=1),this.recBuffers=[],this.streamsize=this.getAdjustSamples(),this.strmL=new fn.SignalArray(this.streamsize),this.strmR=new fn.SignalArray(this.streamsize),this.inlets.push(rec_inlet),func(outlet),setTimeout(this.delayProcess,10),dfd.promise()};var recdone=function(){this.status=FINISHED_STATE,this.reset();var bufferLength,recBuffers=this.recBuffers,samplerate=this.samplerate,streamsize=this.streamsize;this.samplerate=this.savedSamplerate,bufferLength=1/0!==this.recDuration?this.recDuration*samplerate*.001|0:(recBuffers.length>>this.recCh-1)*streamsize;var result,i,imax=bufferLength/streamsize|0,j=0,k=0,remaining=bufferLength;if(2===this.recCh){var L=new fn.SignalArray(bufferLength),R=new fn.SignalArray(bufferLength),mixed=new fn.SignalArray(bufferLength);for(i=0;imax>i;++i)if(L.set(recBuffers[j++],k),R.set(recBuffers[j++],k),k+=streamsize,remaining-=streamsize,remaining>0&&streamsize>remaining){L.set(recBuffers[j++].subarray(0,remaining),k),R.set(recBuffers[j++].subarray(0,remaining),k);break}for(i=0,imax=bufferLength;imax>i;++i)mixed[i]=.5*(L[i]+R[i]);result={samplerate:samplerate,channels:2,buffer:[mixed,L,R]}}else{var buffer=new fn.SignalArray(bufferLength);for(i=0;imax>i;++i)if(buffer.set(recBuffers[j++],k),k+=streamsize,remaining-=streamsize,remaining>0&&streamsize>remaining){buffer.set(recBuffers[j++].subarray(0,remaining),k);break}result={samplerate:samplerate,channels:1,buffer:[buffer]}}var args=[].concat.apply([result],arguments);this.deferred.resolve.apply(this.deferred,args),this.deferred=null};return $.on=function(type,listeners){this.events.on(type,listeners)},$.once=function(type,listeners){this.events.once(type,listeners)},$.off=function(type,listener){this.events.off(type,listener)},$.removeAllListeners=function(type){this.events.removeListeners(type)},$.listeners=function(type){return this.events.listeners(type)},$.fix_iOS6_1_problem=function(flag){this.impl.fix_iOS6_1_problem&&this.impl.fix_iOS6_1_problem(flag)},SoundSystem}(),ImplClass=null;ImplClass="undefined"!=typeof webkitAudioContext?function(sys){var bufSrc,jsNode,context=new webkitAudioContext;fn._audioContext=context,this.maxSamplerate=context.sampleRate,this.defaultSamplerate=context.sampleRate,this.env="webkit";var ua=navigator.userAgent;if(ua.match(/linux/i)?sys.streammsec*=8:ua.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(sys.streammsec*=4),this.play=function(){var onaudioprocess,x,dx,jsn_streamsize=sys.getAdjustSamples(context.sampleRate),sys_streamsize=sys.streamsize;sys.samplerate===context.sampleRate?onaudioprocess=function(e){var outs=e.outputBuffer;sys.process(),outs.getChannelData(0).set(sys.strmL),outs.getChannelData(1).set(sys.strmR)}:2*sys.samplerate===context.sampleRate?onaudioprocess=function(e){var i,j,inL=sys.strmL,inR=sys.strmR,outs=e.outputBuffer,outL=outs.getChannelData(0),outR=outs.getChannelData(1),imax=outs.length;for(sys.process(),i=j=0;imax>i;i+=2,++j)outL[i]=outL[i+1]=inL[j],outR[i]=outR[i+1]=inR[j]}:(x=sys_streamsize,dx=sys.samplerate/context.sampleRate,onaudioprocess=function(e){var i,inL=sys.strmL,inR=sys.strmR,outs=e.outputBuffer,outL=outs.getChannelData(0),outR=outs.getChannelData(1),imax=outs.length;for(i=0;imax>i;++i)x>=sys_streamsize&&(sys.process(),x-=sys_streamsize),outL[i]=inL[0|x],outR[i]=inR[0|x],x+=dx}),bufSrc=context.createBufferSource(),jsNode=context.createJavaScriptNode(jsn_streamsize,2,sys.channels),jsNode.onaudioprocess=onaudioprocess,bufSrc.noteOn(0),bufSrc.connect(jsNode),jsNode.connect(context.destination)},this.pause=function(){bufSrc.disconnect(),jsNode.disconnect()},_envmobile){var n=0,buf=context.createBufferSource();this.fix_iOS6_1_problem=function(flag){n+=flag?1:-1,1===n?(buf.noteOn(0),buf.connect(context.destination)):0===n&&buf.disconnect()}}}:"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(sys){var timer=function(){var source="var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};",blob=new Blob([source],{type:"text/javascript"}),path=URL.createObjectURL(blob);return new Worker(path)}();this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="moz",this.play=function(){var audio=new Audio,interleaved=new Float32Array(sys.streamsize*sys.channels),streammsec=sys.streammsec,written=0,writtenIncr=sys.streamsize/sys.samplerate*1e3,start=Date.now(),onaudioprocess=function(){if(!(written>Date.now()-start)){var inL=sys.strmL,inR=sys.strmR,i=interleaved.length,j=inL.length;for(sys.process();j--;)interleaved[--i]=inR[j],interleaved[--i]=inL[j];audio.mozWriteAudio(interleaved),written+=writtenIncr}};audio.mozSetup(sys.channels,sys.samplerate),timer.onmessage=onaudioprocess,timer.postMessage(streammsec)},this.pause=function(){timer.postMessage(0)}}:function(){this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="nop",this.play=function(){},this.pause=function(){}},_sys=(new SoundSystem).bind(ImplClass);var exports=timbre;"node"===_envtype?module.exports=global.timbre=exports:"browser"===_envtype&&(exports.noConflict=function(){var _t=window.timbre,_T=window.T;return function(deep){return window.T===exports&&(window.T=_T),deep&&window.timbre===exports&&(window.timbre=_t),exports}}(),window.timbre=window.T=exports),function(){function getFlashPlayerVersion(subs){try{return nav.plugins&&nav.mimeTypes&&nav.mimeTypes.length?nav.plugins["Shockwave Flash"].description.match(/([0-9]+)/)[subs]:new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").match(/([0-9]+)/)[subs]}catch(e){return-1}}if("nop"===_sys.impl.env&&"browser"===_envtype&&!_envmobile){var nav=navigator;if(!(getFlashPlayerVersion(0)<10)){var swf,PlayerDivID="TimbreFlashPlayerDiv",src=function(){var scripts=document.getElementsByTagName("script");if(scripts&&scripts.length)for(var m,i=0,imax=scripts.length;imax>i;++i)if(m=/^(.*\/)timbre(?:\.dev)?\.js$/i.exec(scripts[i].src))return m[1]+"timbre.swf"}();window.timbrejs_flashfallback_init=function(){function TimbreFlashPlayer(sys){var timerId=0;this.maxSamplerate=44100,this.defaultSamplerate=44100,this.env="flash",this.play=function(){var onaudioprocess,interleaved=new Array(sys.streamsize*sys.channels),streammsec=sys.streammsec,written=0,writtenIncr=sys.streamsize/sys.samplerate*1e3,start=Date.now();onaudioprocess=function(){if(!(written>Date.now()-start)){var inL=sys.strmL,inR=sys.strmR,i=interleaved.length,j=inL.length;for(sys.process();j--;)interleaved[--i]=32768*inR[j]|0,interleaved[--i]=32768*inL[j]|0;swf.writeAudio(interleaved.join(" ")),written+=writtenIncr}},swf.setup?(swf.setup(sys.channels,sys.samplerate),timerId=setInterval(onaudioprocess,streammsec)):console.warn("Cannot find "+src)},this.pause=function(){0!==timerId&&(swf.cancel(),clearInterval(timerId),timerId=0)}}_sys.bind(TimbreFlashPlayer),delete window.timbrejs_flashfallback_init};var o,p,swfSrc=src,swfName=swfSrc+"?"+ +new Date,swfId="TimbreFlashPlayer",div=document.createElement("div");div.id=PlayerDivID,div.style.display="inline",div.width=div.height=1,nav.plugins&&nav.mimeTypes&&nav.mimeTypes.length?(o=document.createElement("object"),o.id=swfId,o.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",o.width=o.height=1,o.setAttribute("data",swfName),o.setAttribute("type","application/x-shockwave-flash"),p=document.createElement("param"),p.setAttribute("name","allowScriptAccess"),p.setAttribute("value","always"),o.appendChild(p),div.appendChild(o)):div.innerHTML='<object id="'+swfId+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1"><param name="movie" value="'+swfName+'" /><param name="bgcolor" value="#FFFFFF" /><param name="quality" value="high" /><param name="allowScriptAccess" value="always" /></object>',window.addEventListener("load",function(){document.body.appendChild(div),swf=document[swfId]})}}}()}(),function(T){"use strict";function Biquad(samplerate){this.samplerate=samplerate,this.frequency=340,this.Q=1,this.gain=0,this.x1L=this.x2L=this.y1L=this.y2L=0,this.x1R=this.x2R=this.y1R=this.y2R=0,this.b0=this.b1=this.b2=this.a1=this.a2=0,this.setType("lpf")}var $=Biquad.prototype;$.process=function(cellL,cellR){var xL,xR,yL,yR,i,imax,x1L=this.x1L,x2L=this.x2L,y1L=this.y1L,y2L=this.y2L,x1R=this.x1R,x2R=this.x2R,y1R=this.y1R,y2R=this.y2R,b0=this.b0,b1=this.b1,b2=this.b2,a1=this.a1,a2=this.a2;for(i=0,imax=cellL.length;imax>i;++i)xL=cellL[i],yL=b0*xL+b1*x1L+b2*x2L-a1*y1L-a2*y2L,x2L=x1L,x1L=xL,y2L=y1L,y1L=yL,xR=cellR[i],yR=b0*xR+b1*x1R+b2*x2R-a1*y1R-a2*y2R,x2R=x1R,x1R=xR,y2R=y1R,y1R=yR,cellL[i]=yL,cellR[i]=yR;this.x1L=x1L,this.x2L=x2L,this.y1L=y1L,this.y2L=y2L,this.x1R=x1R,this.x2R=x2R,this.y1R=y1R,this.y2R=y2R},$.setType=function(type){var f;(f=setParams[type])&&(this.type=type,f.call(this,this.frequency,this.Q,this.gain))},$.setParams=function(frequency,Q,dbGain){this.frequency=frequency,this.Q=Q,this.gain=dbGain;var f=setParams[this.type];return f&&f.call(this,frequency,Q,dbGain),this};var setParams={lowpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt(.5*(4-Math.sqrt(16-16/(g*g)))),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta-gamma);this.b0=2*alpha,this.b1=4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},highpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt((4-Math.sqrt(16-16/(g*g)))/2),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta+gamma);this.b0=2*alpha,this.b1=-4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},bandpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=alpha*ia0,this.b1=0,this.b2=-alpha*ia0,this.a1=-2*k*ia0,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=this.b1=this.b2=this.a1=this.a2=0},lowshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne+aMinusOne*k+k2);this.b0=A*(aPlusOne-aMinusOne*k+k2)*ia0,this.b1=2*A*(aMinusOne-aPlusOne*k)*ia0,this.b2=A*(aPlusOne-aMinusOne*k-k2)*ia0,this.a1=-2*(aMinusOne+aPlusOne*k)*ia0,this.a2=(aPlusOne+aMinusOne*k-k2)*ia0}},highshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne-aMinusOne*k+k2);this.b0=A*(aPlusOne+aMinusOne*k+k2)*ia0,this.b1=-2*A*(aMinusOne+aPlusOne*k)*ia0,this.b2=A*(aPlusOne+aMinusOne*k-k2)*ia0,this.a1=2*(aMinusOne-aPlusOne*k)*ia0,this.a2=(aPlusOne-aMinusOne*k-k2)*ia0}},peaking:function(frequency,Q,dbGain){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency){var A=Math.pow(10,dbGain/40);if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha/A);this.b0=(1+alpha*A)*ia0,this.b1=-2*k*ia0,this.b2=(1-alpha*A)*ia0,this.a1=this.b1,this.a2=(1-alpha/A)*ia0}else this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0}else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},notch:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=ia0,this.b1=-2*k*ia0,this.b2=ia0,this.a1=this.b1,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},allpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=(1-alpha)*ia0,this.b1=-2*k*ia0,this.b2=(1+alpha)*ia0,this.a1=this.b1,this.a2=this.b0}else this.b0=-1,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0}};setParams.lpf=setParams.lowpass,setParams.hpf=setParams.highpass,setParams.bpf=setParams.bandpass,setParams.bef=setParams.notch,setParams.brf=setParams.notch,setParams.apf=setParams.allpass,T.modules.Biquad=Biquad}(timbre),function(T){"use strict";function Chorus(samplerate){this.samplerate=samplerate;var bits=Math.round(Math.log(.1*samplerate)*Math.LOG2E);this.buffersize=1<<bits,this.bufferL=new T.fn.SignalArray(this.buffersize+1),this.bufferR=new T.fn.SignalArray(this.buffersize+1),this.wave=null,this._wave=null,this.writeIndex=this.buffersize>>1,this.readIndex=0,this.delayTime=20,this.rate=4,this.depth=20,this.feedback=.2,this.wet=.5,this.phase=0,this.phaseIncr=0,this.phaseStep=4,this.setWaveType("sin"),this.setDelayTime(this.delayTime),this.setRate(this.rate)}var $=Chorus.prototype,waves=[];waves[0]=function(){for(var wave=new Float32Array(512),i=0;512>i;++i)wave[i]=Math.sin(2*Math.PI*(i/512));return wave}(),waves[1]=function(){for(var x,wave=new Float32Array(512),i=0;512>i;++i)x=i/512-.25,wave[i]=1-4*Math.abs(Math.round(x)-x);return wave}(),$.setWaveType=function(waveType){"sin"===waveType?(this.wave=waveType,this._wave=waves[0]):"tri"===waveType&&(this.wave=waveType,this._wave=waves[1])},$.setDelayTime=function(delayTime){this.delayTime=delayTime;for(var readIndex=this.writeIndex-(delayTime*this.samplerate*.001|0);0>readIndex;)readIndex+=this.buffersize;this.readIndex=readIndex},$.setRate=function(rate){this.rate=rate,this.phaseIncr=512*this.rate/this.samplerate*this.phaseStep},$.process=function(cellL,cellR){var x,index,mod,i,j,bufferL=this.bufferL,bufferR=this.bufferR,size=this.buffersize,mask=size-1,wave=this._wave,phase=this.phase,phaseIncr=this.phaseIncr,writeIndex=this.writeIndex,readIndex=this.readIndex,depth=this.depth,feedback=this.feedback,wet=this.wet,dry=1-wet,imax=cellL.length,jmax=this.phaseStep;for(i=0;imax>i;){for(mod=wave[0|phase]*depth,phase+=phaseIncr;phase>512;)phase-=512;for(j=0;jmax>j;++j,++i)index=readIndex+size+mod&mask,x=.5*(bufferL[index]+bufferL[index+1]),bufferL[writeIndex]=cellL[i]-x*feedback,cellL[i]=cellL[i]*dry+x*wet,x=.5*(bufferR[index]+bufferR[index+1]),bufferR[writeIndex]=cellR[i]-x*feedback,cellR[i]=cellR[i]*dry+x*wet,writeIndex=writeIndex+1&mask,readIndex=readIndex+1&mask}this.phase=phase,this.writeIndex=writeIndex,this.readIndex=readIndex},T.modules.Chorus=Chorus}(timbre),function(T){"use strict";function Compressor(samplerate,channels){this.samplerate=samplerate,this.channels=channels,this.lastPreDelayFrames=0,this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.ratio=-1,this.slope=-1,this.linearThreshold=-1,this.dbThreshold=-1,this.dbKnee=-1,this.kneeThreshold=-1,this.kneeThresholdDb=-1,this.ykneeThresholdDb=-1,this.K=-1,this.attackTime=.003,this.releaseTime=.25,this.preDelayTime=.006,this.dbPostGain=0,this.effectBlend=1,this.releaseZone1=.09,this.releaseZone2=.16,this.releaseZone3=.42,this.releaseZone4=.98,this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1,this.delayBufferL=new T.fn.SignalArray(MaxPreDelayFrames),this.delayBufferR=2===channels?new T.fn.SignalArray(MaxPreDelayFrames):this.delayBufferL,this.preDelayTime=6,this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.maxAttackCompressionDiffDb=-1,this.meteringReleaseK=1-Math.exp(-1/(.325*this.samplerate)),this.setAttackTime(this.attackTime),this.setReleaseTime(this.releaseTime),this.setPreDelayTime(this.preDelayTime),this.setParams(-24,30,12)}var MaxPreDelayFrames=1024,MaxPreDelayFramesMask=MaxPreDelayFrames-1,DefaultPreDelayFrames=256,kSpacingDb=5,$=Compressor.prototype;$.clone=function(){var new_instance=new Compressor(this.samplerate,this.channels);return new_instance.setAttackTime(this.attackTime),new_instance.setReleaseTime(this.releaseTime),new_instance.setPreDelayTime(this.preDelayTime),new_instance.setParams(this.dbThreshold,this.dbKnee,this.ratio),new_instance},$.setAttackTime=function(value){this.attackTime=Math.max(.001,value),this._attackFrames=this.attackTime*this.samplerate},$.setReleaseTime=function(value){this.releaseTime=Math.max(.001,value);var releaseFrames=this.releaseTime*this.samplerate,satReleaseTime=.0025;this._satReleaseFrames=satReleaseTime*this.samplerate;var y1=releaseFrames*this.releaseZone1,y2=releaseFrames*this.releaseZone2,y3=releaseFrames*this.releaseZone3,y4=releaseFrames*this.releaseZone4;this._kA=.9999999999999998*y1+1.8432219684323923e-16*y2-1.9373394351676423e-16*y3+8.824516011816245e-18*y4,this._kB=-1.5788320352845888*y1+2.3305837032074286*y2-.9141194204840429*y3+.1623677525612032*y4,this._kC=.5334142869106424*y1-1.272736789213631*y2+.9258856042207512*y3-.18656310191776226*y4,this._kD=.08783463138207234*y1-.1694162967925622*y2+.08588057951595272*y3-.00429891410546283*y4,this._kE=-.042416883008123074*y1+.1115693827987602*y2-.09764676325265872*y3+.028494263462021576*y4},$.setPreDelayTime=function(preDelayTime){this.preDelayTime=preDelayTime;var preDelayFrames=preDelayTime*this.samplerate;if(preDelayFrames>MaxPreDelayFrames-1&&(preDelayFrames=MaxPreDelayFrames-1),this.lastPreDelayFrames!==preDelayFrames){this.lastPreDelayFrames=preDelayFrames;for(var i=0,imax=this.delayBufferL.length;imax>i;++i)this.delayBufferL[i]=this.delayBufferR[i]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=preDelayFrames}},$.setParams=function(dbThreshold,dbKnee,ratio){this._k=this.updateStaticCurveParameters(dbThreshold,dbKnee,ratio);var fullRangeGain=this.saturate(1,this._k),fullRangeMakeupGain=1/fullRangeGain;fullRangeMakeupGain=Math.pow(fullRangeMakeupGain,.6),this._masterLinearGain=Math.pow(10,.05*this.dbPostGain)*fullRangeMakeupGain},$.kneeCurve=function(x,k){return x<this.linearThreshold?x:this.linearThreshold+(1-Math.exp(-k*(x-this.linearThreshold)))/k},$.saturate=function(x,k){var y;if(x<this.kneeThreshold)y=this.kneeCurve(x,k);else{var xDb=x?20*Math.log(x)*Math.LOG10E:-1e3,yDb=this.ykneeThresholdDb+this.slope*(xDb-this.kneeThresholdDb);y=Math.pow(10,.05*yDb)}return y},$.slopeAt=function(x,k){if(x<this.linearThreshold)return 1;var x2=1.001*x,xDb=x?20*Math.log(x)*Math.LOG10E:-1e3,x2Db=x2?20*Math.log(x2)*Math.LOG10E:-1e3,y=this.kneeCurve(x,k),y2=this.kneeCurve(x2,k),yDb=y?20*Math.log(y)*Math.LOG10E:-1e3,y2Db=y2?20*Math.log(y2)*Math.LOG10E:-1e3;return(y2Db-yDb)/(x2Db-xDb)},$.kAtSlope=function(desiredSlope){for(var xDb=this.dbThreshold+this.dbKnee,x=Math.pow(10,.05*xDb),minK=.1,maxK=1e4,k=5,i=0;15>i;++i){var slope=this.slopeAt(x,k);desiredSlope>slope?maxK=k:minK=k,k=Math.sqrt(minK*maxK)}return k},$.updateStaticCurveParameters=function(dbThreshold,dbKnee,ratio){this.dbThreshold=dbThreshold,this.linearThreshold=Math.pow(10,.05*dbThreshold),this.dbKnee=dbKnee,this.ratio=ratio,this.slope=1/this.ratio,this.kneeThresholdDb=dbThreshold+dbKnee,this.kneeThreshold=Math.pow(10,.05*this.kneeThresholdDb);var k=this.kAtSlope(1/this.ratio),y=this.kneeCurve(this.kneeThreshold,k);return this.ykneeThresholdDb=y?20*Math.log(y)*Math.LOG10E:-1e3,this._k=k,this._k},$.process=function(cellL,cellR){for(var dryMix=1-this.effectBlend,wetMix=this.effectBlend,k=this._k,masterLinearGain=this._masterLinearGain,satReleaseFrames=this._satReleaseFrames,kA=this._kA,kB=this._kB,kC=this._kC,kD=this._kD,kE=this._kE,nDivisionFrames=64,nDivisions=cellL.length/nDivisionFrames,frameIndex=0,desiredGain=this.detectorAverage,compressorGain=this.compressorGain,maxAttackCompressionDiffDb=this.maxAttackCompressionDiffDb,i_attackFrames=1/this._attackFrames,preDelayReadIndex=this.preDelayReadIndex,preDelayWriteIndex=this.preDelayWriteIndex,detectorAverage=this.detectorAverage,delayBufferL=this.delayBufferL,delayBufferR=this.delayBufferR,meteringGain=this.meteringGain,meteringReleaseK=this.meteringReleaseK,i=0;nDivisions>i;++i){var envelopeRate,scaledDesiredGain=Math.asin(desiredGain)/(.5*Math.PI),isReleasing=scaledDesiredGain>compressorGain,x=compressorGain/scaledDesiredGain,compressionDiffDb=x?20*Math.log(x)*Math.LOG10E:-1e3;if((1/0===compressionDiffDb||isNaN(compressionDiffDb))&&(compressionDiffDb=-1),isReleasing){maxAttackCompressionDiffDb=-1,x=compressionDiffDb,x=-12>x?0:x>0?3:.25*(x+12);var x2=x*x,x3=x2*x,x4=x2*x2,_releaseFrames=kA+kB*x+kC*x2+kD*x3+kE*x4,_dbPerFrame=kSpacingDb/_releaseFrames;envelopeRate=Math.pow(10,.05*_dbPerFrame)}else{(-1===maxAttackCompressionDiffDb||compressionDiffDb>maxAttackCompressionDiffDb)&&(maxAttackCompressionDiffDb=compressionDiffDb);var effAttenDiffDb=Math.max(.5,maxAttackCompressionDiffDb);x=.25/effAttenDiffDb,envelopeRate=1-Math.pow(x,i_attackFrames)}for(var loopFrames=nDivisionFrames;loopFrames--;){var compressorInput=0,absUndelayedSource=.5*(cellL[frameIndex]+cellR[frameIndex]);delayBufferL[preDelayWriteIndex]=cellL[frameIndex],delayBufferR[preDelayWriteIndex]=cellR[frameIndex],0>absUndelayedSource&&(absUndelayedSource*=-1),absUndelayedSource>compressorInput&&(compressorInput=absUndelayedSource);var absInput=compressorInput;0>absInput&&(absInput*=-1);var shapedInput=this.saturate(absInput,k),attenuation=1e-4>=absInput?1:shapedInput/absInput,attenuationDb=attenuation?-20*Math.log(attenuation)*Math.LOG10E:1e3;2>attenuationDb&&(attenuationDb=2);var dbPerFrame=attenuationDb/satReleaseFrames,satReleaseRate=Math.pow(10,.05*dbPerFrame)-1,isRelease=attenuation>detectorAverage,rate=isRelease?satReleaseRate:1;detectorAverage+=(attenuation-detectorAverage)*rate,detectorAverage>1&&(detectorAverage=1),1>envelopeRate?compressorGain+=(scaledDesiredGain-compressorGain)*envelopeRate:(compressorGain*=envelopeRate,compressorGain>1&&(compressorGain=1));var postWarpCompressorGain=Math.sin(.5*Math.PI*compressorGain),totalGain=dryMix+wetMix*masterLinearGain*postWarpCompressorGain,dbRealGain=20*Math.log(postWarpCompressorGain)*Math.LOG10E;meteringGain>dbRealGain?meteringGain=dbRealGain:meteringGain+=(dbRealGain-meteringGain)*meteringReleaseK,cellL[frameIndex]=delayBufferL[preDelayReadIndex]*totalGain,cellR[frameIndex]=delayBufferR[preDelayReadIndex]*totalGain,frameIndex++,preDelayReadIndex=preDelayReadIndex+1&MaxPreDelayFramesMask,preDelayWriteIndex=preDelayWriteIndex+1&MaxPreDelayFramesMask}1e-6>detectorAverage&&(detectorAverage=1e-6),1e-6>compressorGain&&(compressorGain=1e-6)}this.preDelayReadIndex=preDelayReadIndex,this.preDelayWriteIndex=preDelayWriteIndex,this.detectorAverage=detectorAverage,this.compressorGain=compressorGain,this.maxAttackCompressionDiffDb=maxAttackCompressionDiffDb,this.meteringGain=meteringGain},$.reset=function(){this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1;for(var i=0,imax=this.delayBufferL.length;imax>i;++i)this.delayBufferL[i]=this.delayBufferR[i]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.maxAttackCompressionDiffDb=-1},T.modules.Compressor=Compressor}(timbre),function(T){"use strict";function Decoder(){}Decoder.prototype.decode=function(src,onloadedmetadata,onloadeddata){if("string"==typeof src){if(/\.wav$/.test(src))return Decoder.wav_decode(src,onloadedmetadata,onloadeddata);if(Decoder.ogg_decode&&/\.ogg$/.test(src))return Decoder.ogg_decode(src,onloadedmetadata,onloadeddata);if(Decoder.mp3_decode&&/\.mp3$/.test(src))return Decoder.mp3_decode(src,onloadedmetadata,onloadeddata)}else if("object"==typeof src){if("wav"===src.type)return Decoder.wav_decode(src.data,onloadedmetadata,onloadeddata);if(Decoder.ogg_decode&&"ogg"===src.type)return Decoder.ogg_decode(src.data,onloadedmetadata,onloadeddata);if(Decoder.mp3_decode&&"mp3"===src.type)return Decoder.mp3_decode(src.data,onloadedmetadata,onloadeddata)
}return Decoder.webkit_decode?"object"==typeof src?Decoder.webkit_decode(src.data||src,onloadedmetadata,onloadeddata):Decoder.webkit_decode(src,onloadedmetadata,onloadeddata):Decoder.moz_decode?Decoder.moz_decode(src,onloadedmetadata,onloadeddata):void onloadedmetadata(!1)},T.modules.Decoder=Decoder,Decoder.getBinaryWithPath="browser"===T.envtype?function(path,callback){T.fn.fix_iOS6_1_problem(!0);var xhr=new XMLHttpRequest;xhr.open("GET",path),xhr.responseType="arraybuffer",xhr.onreadystatechange=function(){4===xhr.readyState&&(xhr.response?callback(new Uint8Array(xhr.response)):void 0!==xhr.responseBody&&callback(new Uint8Array(VBArray(xhr.responseBody).toArray())),T.fn.fix_iOS6_1_problem(!1))},xhr.send()}:function(path,callback){callback("no support")};var _24bit_to_32bit=function(uint8){for(var b0,b1,b2,bb,x,int32=new Int32Array(uint8.length/3),i=0,imax=uint8.length,j=0;imax>i;)b0=uint8[i++],b1=uint8[i++],b2=uint8[i++],bb=b0+(b1<<8)+(b2<<16),x=8388608&bb?bb-16777216:bb,int32[j++]=x;return int32};Decoder.wav_decode=function(){var _decode=function(data,onloadedmetadata,onloadeddata){if("RIFF"!==String.fromCharCode(data[0],data[1],data[2],data[3]))return onloadedmetadata(!1);var l1=data[4]+(data[5]<<8)+(data[6]<<16)+(data[7]<<24);if(l1+8!==data.length)return onloadedmetadata(!1);if("WAVE"!==String.fromCharCode(data[8],data[9],data[10],data[11]))return onloadedmetadata(!1);if("fmt "!==String.fromCharCode(data[12],data[13],data[14],data[15]))return onloadedmetadata(!1);for(var channels=data[22]+(data[23]<<8),samplerate=data[24]+(data[25]<<8)+(data[26]<<16)+(data[27]<<24),bitSize=data[34]+(data[35]<<8),i=36;i<data.length&&"data"!==String.fromCharCode(data[i],data[i+1],data[i+2],data[i+3]);)i+=1;if(i>=data.length)return onloadedmetadata(!1);i+=4;var l2=data[i]+(data[i+1]<<8)+(data[i+2]<<16)+(data[i+3]<<24),duration=(l2/channels>>1)/samplerate;if(i+=4,l2>data.length-i)return onloadedmetadata(!1);var mixdown,bufferL,bufferR;mixdown=new Float32Array(duration*samplerate|0),2===channels&&(bufferL=new Float32Array(mixdown.length),bufferR=new Float32Array(mixdown.length)),onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration}),8===bitSize?data=new Int8Array(data.buffer,i):16===bitSize?data=new Int16Array(data.buffer,i):32===bitSize?data=new Int32Array(data.buffer,i):24===bitSize&&(data=_24bit_to_32bit(new Uint8Array(data.buffer,i)));var imax,j,x,k=1/((1<<bitSize-1)-1);if(2===channels)for(i=j=0,imax=mixdown.length;imax>i;++i)x=bufferL[i]=data[j++]*k,x+=bufferR[i]=data[j++]*k,mixdown[i]=.5*x;else for(i=0,imax=mixdown.length;imax>i;++i)mixdown[i]=data[i]*k;onloadeddata()};return function(src,onloadedmetadata,onloadeddata){"string"==typeof src?Decoder.getBinaryWithPath(src,function(data){_decode(data,onloadedmetadata,onloadeddata)}):_decode(src,onloadedmetadata,onloadeddata)}}(),Decoder.webkit_decode=function(){if("undefined"!=typeof webkitAudioContext){var ctx=T.fn._audioContext,_decode=function(data,onloadedmetadata,onloadeddata){var samplerate,channels,bufferL,bufferR,duration;if("string"==typeof data)return onloadeddata(!1);var buffer;try{buffer=ctx.createBuffer(data.buffer,!1)}catch(e){return onloadedmetadata(!1)}samplerate=ctx.sampleRate,channels=buffer.numberOfChannels,2===channels?(bufferL=buffer.getChannelData(0),bufferR=buffer.getChannelData(1)):bufferL=bufferR=buffer.getChannelData(0),duration=bufferL.length/samplerate;for(var mixdown=new Float32Array(bufferL),i=0,imax=mixdown.length;imax>i;++i)mixdown[i]=.5*(mixdown[i]+bufferR[i]);onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration}),onloadeddata()};return function(src,onloadedmetadata,onloadeddata){if(src instanceof File){var reader=new FileReader;reader.onload=function(e){_decode(new Uint8Array(e.target.result),onloadedmetadata,onloadeddata)},reader.readAsArrayBuffer(src)}else"string"==typeof src?Decoder.getBinaryWithPath(src,function(data){_decode(data,onloadedmetadata,onloadeddata)}):_decode(src,onloadedmetadata,onloadeddata)}}}(),Decoder.moz_decode=function(){return"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(src,onloadedmetadata,onloadeddata){var samplerate,channels,mixdown,bufferL,bufferR,duration,writeIndex=0,audio=new Audio(src);audio.volume=0,audio.addEventListener("loadedmetadata",function(){samplerate=audio.mozSampleRate,channels=audio.mozChannels,duration=audio.duration,mixdown=new Float32Array(audio.duration*samplerate|0),2===channels&&(bufferL=new Float32Array(audio.duration*samplerate|0),bufferR=new Float32Array(audio.duration*samplerate|0)),2===channels?audio.addEventListener("MozAudioAvailable",function(e){for(var x,samples=e.frameBuffer,i=0,imax=samples.length;imax>i;i+=2)x=bufferL[writeIndex]=samples[i],x+=bufferR[writeIndex]=samples[i+1],mixdown[writeIndex]=.5*x,writeIndex+=1},!1):audio.addEventListener("MozAudioAvailable",function(e){for(var samples=e.frameBuffer,i=0,imax=samples.length;imax>i;++i)mixdown[i]=samples[i],writeIndex+=1},!1),audio.play(),setTimeout(function(){onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration})},1e3)},!1),audio.addEventListener("ended",function(){onloadeddata()},!1),audio.load()}:void 0}()}(timbre),function(T){"use strict";function Envelope(samplerate){this.samplerate=samplerate||44100,this.value=ZERO,this.status=StatusWait,this.curve="linear",this.step=1,this.releaseNode=null,this.loopNode=null,this.emit=null,this._envValue=new EnvelopeValue(samplerate),this._table=[],this._initValue=ZERO,this._curveValue=0,this._defaultCurveType=CurveTypeLin,this._index=0,this._counter=0}function EnvelopeValue(samplerate){this.samplerate=samplerate,this.value=ZERO,this.step=1,this._curveType=CurveTypeLin,this._curveValue=0,this._grow=0,this._a2=0,this._b1=0,this._y1=0,this._y2=0}var ZERO=Envelope.ZERO=1e-6,CurveTypeSet=Envelope.CurveTypeSet=0,CurveTypeLin=Envelope.CurveTypeLin=1,CurveTypeExp=Envelope.CurveTypeExp=2,CurveTypeSin=Envelope.CurveTypeSin=3,CurveTypeWel=Envelope.CurveTypeWel=4,CurveTypeCurve=Envelope.CurveTypeCurve=5,CurveTypeSqr=Envelope.CurveTypeSqr=6,CurveTypeCub=Envelope.CurveTypeCub=7,StatusWait=Envelope.StatusWait=0,StatusGate=Envelope.StatusGate=1,StatusSustain=Envelope.StatusSustain=2,StatusRelease=Envelope.StatusRelease=3,StatusEnd=Envelope.StatusEnd=4,CurveTypeDict={set:CurveTypeSet,lin:CurveTypeLin,linear:CurveTypeLin,exp:CurveTypeExp,exponential:CurveTypeExp,sin:CurveTypeSin,sine:CurveTypeSin,wel:CurveTypeWel,welch:CurveTypeWel,sqr:CurveTypeSqr,squared:CurveTypeSqr,cub:CurveTypeCub,cubed:CurveTypeCub};Envelope.CurveTypeDict=CurveTypeDict;var $=Envelope.prototype;$.clone=function(){var new_instance=new Envelope(this.samplerate);return new_instance._table=this._table,new_instance._initValue=this._initValue,new_instance.setCurve(this.curve),null!==this.releaseNode&&new_instance.setReleaseNode(this.releaseNode+1),null!==this.loopNode&&new_instance.setLoopNode(this.loopNode+1),new_instance.setStep(this.step),new_instance.reset(),new_instance},$.setTable=function(value){this._initValue=value[0],this._table=value.slice(1),this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=StatusWait},$.setCurve=function(value){"number"==typeof value?(this._defaultCurveType=CurveTypeCurve,this._curveValue=value,this.curve=value):(this._defaultCurveType=CurveTypeDict[value]||null,this.curve=value)},$.setReleaseNode=function(value){"number"==typeof value&&value>0&&(this.releaseNode=value-1)},$.setLoopNode=function(value){"number"==typeof value&&value>0&&(this.loopNode=value-1)},$.setStep=function(step){this.step=this._envValue.step=step},$.reset=function(){this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=StatusWait},$.release=function(){null!==this.releaseNode&&(this._counter=0,this.status=StatusRelease)},$.getInfo=function(sustainTime){var i,imax,table=this._table,totalDuration=0,loopBeginTime=1/0,releaseBeginTime=1/0,isEndlessLoop=!1;for(i=0,imax=table.length;imax>i;++i){this.loopNode===i&&(loopBeginTime=totalDuration),this.releaseNode===i&&(sustainTime>totalDuration?totalDuration+=sustainTime:totalDuration=sustainTime,releaseBeginTime=totalDuration);var items=table[i];Array.isArray(items)&&(totalDuration+=items[1])}return 1/0!==loopBeginTime&&1/0===releaseBeginTime&&(totalDuration+=sustainTime,isEndlessLoop=!0),{totalDuration:totalDuration,loopBeginTime:loopBeginTime,releaseBeginTime:releaseBeginTime,isEndlessLoop:isEndlessLoop}},$.calcStatus=function(){var items,endValue,time,curveType,status=this.status,table=this._table,index=this._index,counter=this._counter,curveValue=this._curveValue,defaultCurveType=this._defaultCurveType,loopNode=this.loopNode,releaseNode=this.releaseNode,envValue=this._envValue,emit=null;switch(status){case StatusWait:case StatusEnd:break;case StatusGate:case StatusRelease:for(;0>=counter;)if(index>=table.length){if(status===StatusGate&&null!==loopNode){index=loopNode;continue}status=StatusEnd,counter=1/0,curveType=CurveTypeSet,emit="ended"}else if(status!==StatusGate||index!==releaseNode)items=table[index++],endValue=items[0],curveType=null===items[2]?defaultCurveType:items[2],curveType===CurveTypeCurve&&(curveValue=items[3],Math.abs(curveValue)<.001&&(curveType=CurveTypeLin)),time=items[1],counter=envValue.setNext(endValue,time,curveType,curveValue);else{if(null!==loopNode&&releaseNode>loopNode){index=loopNode;continue}status=StatusSustain,counter=1/0,curveType=CurveTypeSet,emit="sustained"}}return this.status=status,this.emit=emit,this._index=index,this._counter=counter,status},$.next=function(){return 1&this.calcStatus()&&(this.value=this._envValue.next()||ZERO),this._counter-=1,this.value},$.process=function(cell){var i,envValue=this._envValue,imax=cell.length;if(1&this.calcStatus())for(i=0;imax>i;++i)cell[i]=envValue.next()||ZERO;else{var value=this.value||ZERO;for(i=0;imax>i;++i)cell[i]=value}this.value=cell[imax-1],this._counter-=cell.length},EnvelopeValue.prototype.setNext=function(endValue,time,curveType,curveValue){var grow,w,a1,a2,b1,y1,y2,n=this.step,value=this.value,counter=.001*time*this.samplerate/n|0;switch(1>counter&&(counter=1,curveType=CurveTypeSet),curveType){case CurveTypeSet:this.value=endValue;break;case CurveTypeLin:grow=(endValue-value)/counter;break;case CurveTypeExp:grow=0!==value?Math.pow(endValue/value,1/counter):0;break;case CurveTypeSin:w=Math.PI/counter,a2=.5*(endValue+value),b1=2*Math.cos(w),y1=.5*(endValue-value),y2=y1*Math.sin(.5*Math.PI-w),value=a2-y1;break;case CurveTypeWel:w=.5*Math.PI/counter,b1=2*Math.cos(w),endValue>=value?(a2=value,y1=0,y2=-Math.sin(w)*(endValue-value)):(a2=endValue,y1=value-endValue,y2=Math.cos(w)*(value-endValue)),value=a2+y1;break;case CurveTypeCurve:a1=(endValue-value)/(1-Math.exp(curveValue)),a2=value+a1,b1=a1,grow=Math.exp(curveValue/counter);break;case CurveTypeSqr:y1=Math.sqrt(value),y2=Math.sqrt(endValue),grow=(y2-y1)/counter;break;case CurveTypeCub:y1=Math.pow(value,.33333333),y2=Math.pow(endValue,.33333333),grow=(y2-y1)/counter}return this.next=NextFunctions[curveType],this._grow=grow,this._a2=a2,this._b1=b1,this._y1=y1,this._y2=y2,counter};var NextFunctions=[];NextFunctions[CurveTypeSet]=function(){return this.value},NextFunctions[CurveTypeLin]=function(){return this.value+=this._grow,this.value},NextFunctions[CurveTypeExp]=function(){return this.value*=this._grow,this.value},NextFunctions[CurveTypeSin]=function(){var y0=this._b1*this._y1-this._y2;return this.value=this._a2-y0,this._y2=this._y1,this._y1=y0,this.value},NextFunctions[CurveTypeWel]=function(){var y0=this._b1*this._y1-this._y2;return this.value=this._a2+y0,this._y2=this._y1,this._y1=y0,this.value},NextFunctions[CurveTypeCurve]=function(){return this._b1*=this._grow,this.value=this._a2-this._b1,this.value},NextFunctions[CurveTypeSqr]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1,this.value},NextFunctions[CurveTypeCub]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1*this._y1,this.value},EnvelopeValue.prototype.next=NextFunctions[CurveTypeSet],T.modules.Envelope=Envelope,T.modules.EnvelopeValue=EnvelopeValue}(timbre),function(T){"use strict";function FFT(n){n="number"==typeof n?n:512,n=1<<Math.ceil(Math.log(n)*Math.LOG2E),this.length=n,this.buffer=new T.fn.SignalArray(n),this.real=new T.fn.SignalArray(n),this.imag=new T.fn.SignalArray(n),this._real=new T.fn.SignalArray(n),this._imag=new T.fn.SignalArray(n),this.mag=new T.fn.SignalArray(n>>1),this.minDecibels=-30,this.maxDecibels=-100;var params=FFTParams.get(n);this._bitrev=params.bitrev,this._sintable=params.sintable,this._costable=params.costable}var $=FFT.prototype;$.setWindow=function(key){if("string"==typeof key){var m=/([A-Za-z]+)(?:\(([01]\.?\d*)\))?/.exec(key);if(null!==m){var name=m[1].toLowerCase(),a=void 0!==m[2]?+m[2]:.25,f=WindowFunctions[name];if(f){this._window||(this._window=new T.fn.SignalArray(this.length));var w=this._window,n=0,N=this.length;for(a=0>a?0:a>1?1:a;N>n;++n)w[n]=f(n,N,a);this.windowName=key}}}},$.forward=function(_buffer){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this.real,imag=this.imag,window=this._window,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;if(window)for(i=0;n>i;++i)buffer[i]=_buffer[i]*window[i];else buffer.set(_buffer);for(i=0;n>i;++i)real[i]=buffer[bitrev[i]],imag[i]=0;for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}var rval,ival,mag=this.mag;for(i=0;n>i;++i)rval=real[i],ival=imag[i],mag[i]=Math.sqrt(rval*rval+ival*ival);return{real:real,imag:imag}},$.inverse=function(_real,_imag){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this._real,imag=this._imag,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;for(i=0;n>i;++i)j=bitrev[i],real[i]=+_real[j],imag[i]=-_imag[j];for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}for(i=0;n>i;++i)buffer[i]=real[i]/n;return buffer},$.getFrequencyData=function(array){var i,minDecibels=this.minDecibels,imax=Math.min(this.mag.length,array.length);if(imax){var x,mag=this.mag,peak=0;for(i=0;imax>i;++i)x=mag[i],array[i]=x?20*Math.log(x)*Math.LOG10E:minDecibels,peak<array[i]&&(peak=array[i])}return array};var FFTParams={get:function(n){return FFTParams[n]||function(){var i,imax,bitrev=function(){var x,i,j,k,n2;for(x=new Int16Array(n),n2=n>>1,i=j=0;x[i]=j,!(++i>=n);){for(k=n2;j>=k;)j-=k,k>>=1;j+=k}return x}(),k=Math.floor(Math.log(n)/Math.LN2),sintable=new T.fn.SignalArray((1<<k)-1),costable=new T.fn.SignalArray((1<<k)-1),PI2=2*Math.PI;for(i=0,imax=sintable.length;imax>i;++i)sintable[i]=Math.sin(PI2*(i/n)),costable[i]=Math.cos(PI2*(i/n));return FFTParams[n]={bitrev:bitrev,sintable:sintable,costable:costable},FFTParams[n]}()}},WindowFunctions=function(){var PI=Math.PI,PI2=2*Math.PI,abs=Math.abs,pow=Math.pow,cos=Math.cos,sin=Math.sin,sinc=function(x){return sin(PI*x)/(PI*x)},E=Math.E;return{rectangular:function(){return 1},hann:function(n,N){return.5*(1-cos(PI2*n/(N-1)))},hamming:function(n,N){return.54-.46*cos(PI2*n/(N-1))},tukery:function(n,N,a){return a*(N-1)/2>n?.5*(1+cos(PI*(2*n/(a*(N-1))-1))):n>(N-1)*(1-a/2)?.5*(1+cos(PI*(2*n/(a*(N-1))-2/a+1))):1},cosine:function(n,N){return sin(PI*n/(N-1))},lanczos:function(n,N){return sinc(2*n/(N-1)-1)},triangular:function(n,N){return 2/(N+1)*((N+1)/2-abs(n-(N-1)/2))},bartlett:function(n,N){return 2/(N-1)*((N-1)/2-abs(n-(N-1)/2))},gaussian:function(n,N,a){return pow(E,-.5*pow((n-(N-1)/2)/(a*(N-1)/2),2))},bartlettHann:function(n,N){return.62-.48*abs(n/(N-1)-.5)-.38*cos(PI2*n/(N-1))},blackman:function(n,N,a){var a0=(1-a)/2,a1=.5,a2=a/2;return a0-a1*cos(PI2*n/(N-1))+a2*cos(4*PI*n/(N-1))}}}();T.modules.FFT=FFT}(timbre),function(T){"use strict";function Oscillator(samplerate){this.samplerate=samplerate||44100,this.wave=null,this.step=1,this.frequency=0,this.value=0,this.phase=0,this.feedback=!1,this._x=0,this._lastouts=0,this._coeff=TABLE_SIZE/this.samplerate,this._radtoinc=TABLE_SIZE/(2*Math.PI)}function waveshape(sign,name,shape,width){var _wave,i,imax,j,jmax,wave=Wavetables[name];if(void 0!==wave){switch("function"==typeof wave&&(wave=wave()),shape){case"@1":for(i=512;1024>i;++i)wave[i]=0;break;case"@2":for(i=512;1024>i;++i)wave[i]=Math.abs(wave[i]);break;case"@3":for(i=256;512>i;++i)wave[i]=0;for(i=512;768>i;++i)wave[i]=Math.abs(wave[i]);for(i=768;1024>i;++i)wave[i]=0;break;case"@4":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=wave[i<<1];wave=_wave;break;case"@5":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=Math.abs(wave[i<<1]);wave=_wave}if(void 0!==width&&50!==width){for(width*=.01,width=0>width?0:width>1?1:width,_wave=new Float32Array(1024),imax=1024*width|0,i=0;imax>i;++i)_wave[i]=wave[i/imax*512|0];for(jmax=1024-imax,j=0;1024>i;++i,++j)_wave[i]=wave[j/jmax*512+512|0];wave=_wave}if("+"===sign)for(i=0;1024>i;++i)wave[i]=.5*wave[i]+.5;else if("-"===sign)for(i=0;1024>i;++i)wave[i]*=-1;return wave}}function wavb(src){var wave=new Float32Array(1024),n=src.length>>1;if(-1!==[2,4,8,16,32,64,128,256,512,1024].indexOf(n))for(var i=0,k=0;n>i;++i){var x=parseInt(src.substr(2*i,2),16);x=128&x?(x-256)/128:x/127;for(var j=0,jmax=1024/n;jmax>j;++j)wave[k++]=x}return wave}function wavc(src){var wave=new Float32Array(1024);if(8===src.length){var i,j,color=parseInt(src,16),bar=new Float32Array(8);for(bar[0]=1,i=0;7>i;++i)bar[i+1]=.0625*(15&color),color>>=4;for(i=0;8>i;++i){var x=0,dx=(i+1)/1024;for(j=0;1024>j;++j)wave[j]+=Math.sin(2*Math.PI*x)*bar[i],x+=dx}var absx,maxx=0;for(i=0;1024>i;++i)maxx<(absx=Math.abs(wave[i]))&&(maxx=absx);if(maxx>0)for(i=0;1024>i;++i)wave[i]/=maxx}return wave}var TABLE_SIZE=1024,TABLE_MASK=TABLE_SIZE-1,$=Oscillator.prototype;$.setWave=function(value){var i,dx,wave=this.wave;if(this.wave||(this.wave=new Float32Array(TABLE_SIZE+1)),"function"==typeof value)for(i=0;TABLE_SIZE>i;++i)wave[i]=value(i/TABLE_SIZE);else if(T.fn.isSignalArray(value))if(value.length===wave.length)wave.set(value);else for(dx=value.length/TABLE_SIZE,i=0;TABLE_SIZE>i;++i)wave[i]=value[i*dx|0];else"string"==typeof value&&void 0!==(dx=getWavetable(value))&&this.wave.set(dx);this.wave[TABLE_SIZE]=this.wave[0]},$.clone=function(){var new_instance=new Oscillator(this.samplerate);return new_instance.wave=this.wave,new_instance.step=this.step,new_instance.frequency=this.frequency,new_instance.value=this.value,new_instance.phase=this.phase,new_instance.feedback=this.feedback,new_instance},$.reset=function(){this._x=0},$.next=function(){var x=this._x,index=x+this.phase*this._radtoinc|0;return this.value=this.wave[index&TABLE_MASK],x+=this.frequency*this._coeff*this.step,x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value},$.process=function(cell){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this.frequency*this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=dx;this._lastouts=lastouts}else{var phaseoffset=this.phase*radtoinc;for(i=0;imax>i;++i)phase=x+phaseoffset,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=dx}x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithFreqArray=function(cell,freqs){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=freqs[i]*dx;this._lastouts=lastouts}else{var phaseoffset=this.phase*this._radtoinc;for(i=0;imax>i;++i)phase=x+phaseoffset,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=freqs[i]*dx}x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithPhaseArray=function(cell,phases){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this.frequency*this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=dx;this._lastouts=lastouts}else for(i=0;imax>i;++i)phase=x+phases[i]*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=dx;x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithFreqAndPhaseArray=function(cell,freqs,phases){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=freqs[i]*dx;this._lastouts=lastouts}else for(i=0;imax>i;++i)phase=x+phases[i]*TABLE_SIZE,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=freqs[i]*dx;x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]};var getWavetable=function(key){var wave=Wavetables[key];if(void 0!==wave)return"function"==typeof wave&&(wave=wave()),wave;var m;if(m=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(key),null!==m){var sign=m[1],name=m[2],shape=m[3],width=m[4];if(wave=waveshape(sign,name,shape,width),void 0!==wave)return Wavetables[key]=wave,wave}return m=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(key),null!==m?wavb(m[1]):(m=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(key),null!==m?wavc(m[1]):void 0)};Oscillator.getWavetable=getWavetable;var setWavetable=function(name,value){var dx,i,wave=new Float32Array(1024);if("function"==typeof value)for(i=0;1024>i;++i)wave[i]=value(i/1024);else if(T.fn.isSignalArray(value))if(value.length===wave.length)wave.set(value);else for(dx=value.length/1024,i=0;1024>i;++i)wave[i]=value[i*dx|0];Wavetables[name]=wave};Oscillator.setWavetable=setWavetable;var Wavetables={sin:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=Math.sin(2*Math.PI*(i/1024));return wave},cos:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=Math.cos(2*Math.PI*(i/1024));return wave},pulse:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=512>i?1:-1;return wave},tri:function(){for(var x,wave=new Float32Array(1024),i=0;1024>i;++i)x=i/1024-.25,wave[i]=1-4*Math.abs(Math.round(x)-x);return wave},saw:function(){for(var x,wave=new Float32Array(1024),i=0;1024>i;++i)x=i/1024,wave[i]=2*(x-Math.round(x));return wave},fami:function(){for(var d=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-.125,-.25,-.375,-.5,-.625,-.75,-.875,-1,-1,-.875,-.75,-.625,-.5,-.375,-.25,-.125],wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=d[i/1024*d.length|0];return wave},konami:function(){for(var d=[-.625,-.875,-.125,.75,.5,.125,.5,.75,.25,-.125,.5,.875,.625,0,.25,.375,-.125,-.75,0,.625,.125,-.5,-.375,-.125,-.75,-1,-.625,0,-.375,-.875,-.625,-.25],wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=d[i/1024*d.length|0];return wave}};T.modules.Oscillator=Oscillator}(timbre),function(T){"use strict";function Reverb(samplerate,buffersize){this.samplerate=samplerate;var i,imax,k=samplerate/44100;for(imax=2*CombParams.length,this.comb=new Array(imax),this.combout=new Array(imax),i=0;imax>i;++i)this.comb[i]=new CombFilter(CombParams[i%CombParams.length]*k),this.combout[i]=new T.fn.SignalArray(buffersize);for(imax=2*AllpassParams.length,this.allpass=new Array(imax),i=0;imax>i;++i)this.allpass[i]=new AllpassFilter(AllpassParams[i%AllpassParams.length]*k);this.outputs=[new T.fn.SignalArray(buffersize),new T.fn.SignalArray(buffersize)],this.damp=0,this.wet=.33,this.setRoomSize(.5),this.setDamp(.5)}function CombFilter(buffersize){this.buffer=new T.fn.SignalArray(0|buffersize),this.buffersize=this.buffer.length,this.bufidx=0,this.feedback=0,this.filterstore=0,this.damp=0}function AllpassFilter(buffersize){this.buffer=new T.fn.SignalArray(0|buffersize),this.buffersize=this.buffer.length,this.bufidx=0}var CombParams=[1116,1188,1277,1356,1422,1491,1557,1617],AllpassParams=[225,556,441,341],$=Reverb.prototype;$.setRoomSize=function(roomsize){var comb=this.comb,value=.28*roomsize+.7;this.roomsize=roomsize,comb[0].feedback=comb[1].feedback=comb[2].feedback=comb[3].feedback=comb[4].feedback=comb[5].feedback=comb[6].feedback=comb[7].feedback=comb[8].feedback=comb[9].feedback=comb[10].feedback=comb[11].feedback=comb[12].feedback=comb[13].feedback=comb[14].feedback=comb[15].feedback=value},$.setDamp=function(damp){var comb=this.comb,value=.4*damp;this.damp=damp,comb[0].damp=comb[1].damp=comb[2].damp=comb[3].damp=comb[4].damp=comb[5].damp=comb[6].damp=comb[7].damp=comb[8].damp=comb[9].damp=comb[10].damp=comb[11].damp=comb[12].damp=comb[13].damp=comb[14].damp=comb[15].damp=value},$.process=function(cellL,cellR){var i,comb=this.comb,combout=this.combout,allpass=this.allpass,output0=this.outputs[0],output1=this.outputs[1],wet=this.wet,dry=1-wet,imax=cellL.length;for(comb[0].process(cellL,combout[0]),comb[1].process(cellL,combout[1]),comb[2].process(cellL,combout[2]),comb[3].process(cellL,combout[3]),comb[4].process(cellL,combout[4]),comb[5].process(cellL,combout[5]),comb[6].process(cellL,combout[6]),comb[7].process(cellL,combout[7]),comb[8].process(cellR,combout[8]),comb[9].process(cellR,combout[9]),comb[10].process(cellR,combout[10]),comb[11].process(cellR,combout[11]),comb[12].process(cellR,combout[12]),comb[13].process(cellR,combout[13]),comb[14].process(cellR,combout[14]),comb[15].process(cellR,combout[15]),i=0;imax>i;++i)output0[i]=combout[0][i]+combout[1][i]+combout[2][i]+combout[3][i]+combout[4][i]+combout[5][i]+combout[6][i]+combout[7][i],output1[i]=combout[8][i]+combout[9][i]+combout[10][i]+combout[11][i]+combout[12][i]+combout[13][i]+combout[14][i]+combout[15][i];for(allpass[0].process(output0,output0),allpass[1].process(output0,output0),allpass[2].process(output0,output0),allpass[3].process(output0,output0),allpass[4].process(output1,output1),allpass[5].process(output1,output1),allpass[6].process(output1,output1),allpass[7].process(output1,output1),i=0;imax>i;++i)cellL[i]=output0[i]*wet+cellL[i]*dry,cellR[i]=output1[i]*wet+cellR[i]*dry},CombFilter.prototype.process=function(input,output){var ins,outs,i,buffer=this.buffer,buffersize=this.buffersize,bufidx=this.bufidx,filterstore=this.filterstore,feedback=this.feedback,damp1=this.damp,damp2=1-damp1,imax=input.length;for(i=0;imax>i;++i)ins=.015*input[i],outs=buffer[bufidx],filterstore=outs*damp2+filterstore*damp1,buffer[bufidx]=ins+filterstore*feedback,++bufidx>=buffersize&&(bufidx=0),output[i]=outs;this.bufidx=bufidx,this.filterstore=filterstore},AllpassFilter.prototype.process=function(input,output){var ins,outs,bufout,i,buffer=this.buffer,buffersize=this.buffersize,bufidx=this.bufidx,imax=input.length;for(i=0;imax>i;++i)ins=input[i],bufout=buffer[bufidx],outs=-ins+bufout,buffer[bufidx]=ins+.5*bufout,++bufidx>=buffersize&&(bufidx=0),output[i]=outs;this.bufidx=bufidx},T.modules.Reverb=Reverb}(timbre),function(T){"use strict";function Scissor(soundbuffer){return new Tape(soundbuffer)}function Tape(soundbuffer){if(this.fragments=[],soundbuffer){var samplerate=soundbuffer.samplerate||44100,duration=soundbuffer.buffer[0].length/samplerate;this.fragments.push(new Fragment(soundbuffer,0,duration))}}function Fragment(soundbuffer,start,duration,reverse,pitch,stretch,pan){soundbuffer||(soundbuffer=silencebuffer),this.buffer=soundbuffer.buffer[0],this.samplerate=soundbuffer.samplerate||44100,this.start=start,this._duration=duration,this.reverse=reverse||!1,this.pitch=pitch||100,this.stretch=stretch||!1,this.pan=pan||50}function TapeStream(tape,samplerate){this.tape=tape,this.fragments=tape.fragments,this.samplerate=samplerate||44100,this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5}var DummyBuffer=new Float32Array(60),silencebuffer={buffer:DummyBuffer,samplerate:1};Scissor.silence=function(duration){return new Scissor(silencebuffer).slice(0,1).fill(duration)},Scissor.join=function(tapes){for(var new_instance=new Tape,i=0;i<tapes.length;i++)tapes[i]instanceof Tape&&new_instance.add_fragments(tapes[i].fragments);return new_instance},Scissor.Tape=Tape,Tape.prototype.add_fragment=function(fragment){return this.fragments.push(fragment),this},Tape.prototype.add_fragments=function(fragments){for(var i=0;i<fragments.length;i++)this.fragments.push(fragments[i]);return this},Tape.prototype.duration=function(){for(var result=0,i=0;i<this.fragments.length;i++)result+=this.fragments[i].duration();return result},Tape.prototype.slice=function(start,length){var duration=this.duration();start+length>duration&&(length=duration-start);for(var new_instance=new Tape,remainingstart=start,remaininglength=length,i=0;i<this.fragments.length;i++){var fragment=this.fragments[i],items=fragment.create(remainingstart,remaininglength),new_fragment=items[0];if(remainingstart=items[1],remaininglength=items[2],new_fragment&&new_instance.add_fragment(new_fragment),0===remaininglength)break}return new_instance},Tape.prototype.cut=Tape.prototype.slice,Tape.prototype.concat=function(other){var new_instance=new Tape;return new_instance.add_fragments(this.fragments),new_instance.add_fragments(other.fragments),new_instance},Tape.prototype.loop=function(count){var i,orig_fragments=[];for(i=0;i<this.fragments.length;i++)orig_fragments.push(this.fragments[i].clone());var new_instance=new Tape;for(i=0;count>i;i++)new_instance.add_fragments(orig_fragments);return new_instance},Tape.prototype.times=Tape.prototype.loop,Tape.prototype.split=function(count){for(var splitted_duration=this.duration()/count,results=[],i=0;count>i;i++)results.push(this.slice(i*splitted_duration,splitted_duration));return results},Tape.prototype.fill=function(filled_duration){var duration=this.duration();if(0===duration)throw"EmptyFragment";var loop_count=filled_duration/duration|0,remain=filled_duration%duration;return this.loop(loop_count).plus(this.slice(0,remain))},Tape.prototype.replace=function(start,length,replaced){var new_instance=new Tape,offset=start+length;new_instance=new_instance.plus(this.slice(0,start));var new_instance_duration=new_instance.duration();start>new_instance_duration&&(new_instance=new_instance.plus(Scissor.silence(start-new_instance_duration))),new_instance=new_instance.plus(replaced);var duration=this.duration();return duration>offset&&(new_instance=new_instance.plus(this.slice(offset,duration-offset))),new_instance},Tape.prototype.reverse=function(){for(var new_instance=new Tape,i=this.fragments.length;i--;){var fragment=this.fragments[i].clone();fragment.reverse=!fragment.isReversed(),new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.pitch=function(pitch,stretch){var new_instance=new Tape;stretch=stretch||!1;for(var i=0;i<this.fragments.length;i++){var fragment=this.fragments[i].clone();fragment.pitch*=.01*pitch,fragment.stretch=stretch,new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.stretch=function(factor){var factor_for_pitch=1/(.01*factor)*100;return this.pitch(factor_for_pitch,!0)},Tape.prototype.pan=function(right_percent){var new_instance=new Tape;right_percent>100?right_percent=100:0>right_percent&&(right_percent=0);
for(var i=0;i<this.fragments.length;i++){var fragment=this.fragments[i].clone();fragment.pan=right_percent,new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.silence=function(){return Scissor.silence(this.duration())},Tape.prototype.join=function(tapes){for(var new_instance=new Tape,i=0;i<tapes.length;i++)tapes[i]instanceof Tape&&new_instance.add_fragments(tapes[i].fragments);return new_instance},Tape.prototype.getBuffer=function(){var samplerate=44100;this.fragments.length>0&&(samplerate=this.fragments[0].samplerate);var stream=new TapeStream(this,samplerate),total_samples=this.duration()*samplerate|0;return{samplerate:samplerate,buffer:stream.fetch(total_samples)}},Fragment.prototype.duration=function(){return this._duration*(100/this.pitch)},Fragment.prototype.original_duration=function(){return this._duration},Fragment.prototype.isReversed=function(){return this.reverse},Fragment.prototype.isStretched=function(){return this.stretched},Fragment.prototype.create=function(remaining_start,remaining_length){var duration=this.duration();if(remaining_start>=duration)return[null,remaining_start-duration,remaining_length];var new_length,have_remain_to_retuen=remaining_start+remaining_length>=duration;have_remain_to_retuen?(new_length=duration-remaining_start,remaining_length-=new_length):(new_length=remaining_length,remaining_length=0);var new_fragment=this.clone();return new_fragment.start=this.start+remaining_start*this.pitch*.01,new_fragment._duration=new_length*this.pitch*.01,new_fragment.reverse=!1,[new_fragment,0,remaining_length]},Fragment.prototype.clone=function(){var new_instance=new Fragment;return new_instance.buffer=this.buffer,new_instance.samplerate=this.samplerate,new_instance.start=this.start,new_instance._duration=this._duration,new_instance.reverse=this.reverse,new_instance.pitch=this.pitch,new_instance.stretch=this.stretch,new_instance.pan=this.pan,new_instance},Scissor.Fragment=Fragment,Scissor.TapeStream=TapeStream,TapeStream.prototype.reset=function(){return this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5,this.isLooped=!1,this},TapeStream.prototype.fetch=function(n){var cellL=new T.fn.SignalArray(n),cellR=new T.fn.SignalArray(n),fragments=this.fragments;if(0===fragments.length)return[cellL,cellR];for(var pan,samplerate=100*this.samplerate,buffer=this.buffer,bufferIndex=this.bufferIndex,bufferIndexIncr=this.bufferIndexIncr,bufferBeginIndex=this.bufferBeginIndex,bufferEndIndex=this.bufferEndIndex,fragment=this.fragment,fragmentIndex=this.fragmentIndex,panL=this.panL,panR=this.panR,i=0;n>i;i++){for(;!buffer||bufferBeginIndex>bufferIndex||bufferIndex>=bufferEndIndex;)if(!fragment||fragmentIndex<fragments.length)fragment=fragments[fragmentIndex++],buffer=fragment.buffer,bufferIndexIncr=fragment.samplerate/samplerate*fragment.pitch,bufferBeginIndex=fragment.start*fragment.samplerate,bufferEndIndex=bufferBeginIndex+fragment.original_duration()*fragment.samplerate,pan=.01*fragment.pan,panL=1-pan,panR=pan,fragment.reverse?(bufferIndexIncr*=-1,bufferIndex=bufferEndIndex+bufferIndexIncr):bufferIndex=bufferBeginIndex;else{if(!this.isLooped){this.isEnded=!0,buffer=DummyBuffer,bufferIndexIncr=0,bufferIndex=0;break}buffer=null,bufferIndex=0,bufferIndexIncr=0,bufferBeginIndex=0,bufferEndIndex=0,fragment=null,fragmentIndex=0}cellL[i]=buffer[0|bufferIndex]*panL,cellR[i]=buffer[0|bufferIndex]*panR,bufferIndex+=bufferIndexIncr}return this.buffer=buffer,this.bufferIndex=bufferIndex,this.bufferIndexIncr=bufferIndexIncr,this.bufferBeginIndex=bufferBeginIndex,this.bufferEndIndex=bufferEndIndex,this.fragment=fragment,this.fragmentIndex=fragmentIndex,this.panL=panL,this.panR=panR,[cellL,cellR]},T.modules.Scissor=Scissor}(timbre),function(T){"use strict";function StereoDelay(samplerate){this.samplerate=samplerate;var bits=Math.ceil(Math.log(1.5*samplerate)*Math.LOG2E);this.buffersize=1<<bits,this.buffermask=this.buffersize-1,this.writeBufferL=new T.fn.SignalArray(this.buffersize),this.writeBufferR=new T.fn.SignalArray(this.buffersize),this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR,this.delaytime=null,this.feedback=null,this.cross=null,this.mix=null,this.prevL=0,this.prevR=0,this.readIndex=0,this.writeIndex=0,this.setParams(125,.25,!1,.45)}var $=StereoDelay.prototype;$.setParams=function(delaytime,feedback,cross,mix){if(this.delaytime!==delaytime){this.delaytime=delaytime;var offset=.001*delaytime*this.samplerate|0;offset>this.buffermask&&(offset=this.buffermask),this.writeIndex=this.readIndex+offset&this.buffermask}this.feedback!==feedback&&(this.feedback=feedback),this.cross!==cross&&(this.cross=cross,cross?(this.readBufferL=this.writeBufferR,this.readBufferR=this.writeBufferL):(this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR)),this.mix!==mix&&(this.mix=mix)},$.process=function(cellL,cellR){var x,i,readBufferL=this.readBufferL,readBufferR=this.readBufferR,writeBufferL=this.writeBufferL,writeBufferR=this.writeBufferR,readIndex=this.readIndex,writeIndex=this.writeIndex,mask=this.buffermask,fb=this.feedback,wet=this.mix,dry=1-wet,prevL=this.prevL,prevR=this.prevR,imax=cellL.length;for(i=0;imax>i;++i)x=readBufferL[readIndex],writeBufferL[writeIndex]=cellL[i]-x*fb,cellL[i]=prevL=.5*(cellL[i]*dry+x*wet+prevL),x=readBufferR[readIndex],writeBufferR[writeIndex]=cellR[i]-x*fb,cellR[i]=prevR=.5*(cellR[i]*dry+x*wet+prevR),readIndex+=1,writeIndex=writeIndex+1&mask;this.readIndex=readIndex&this.buffermask,this.writeIndex=writeIndex,this.prevL=prevL,this.prevR=prevR},T.modules.StereoDelay=StereoDelay}(timbre),function(T){"use strict";var fn=T.fn,modules=T.modules;fn.register("audio",function(_args){var BufferNode=fn.getClass("buffer"),instance=new BufferNode(_args);return instance.playbackState=fn.FINISHED_STATE,instance._.isLoaded=!1,Object.defineProperties(instance,{isLoaded:{get:function(){return this._.isLoaded}}}),instance.load=load,instance.loadthis=loadthis,instance});var load=function(src){var self=this,_=this._,dfd=new modules.Deferred(this),args=arguments,i=1;dfd.done(function(){self._.emit("done")}),"function"==typeof args[i]&&(dfd.done(args[i++]),"function"==typeof args[i]&&dfd.fail(args[i++])),_.loadedTime=0;var onloadedmetadata=function(result,msg){var _=self._;result?(self.playbackState=fn.PLAYING_STATE,_.samplerate=result.samplerate,_.channels=result.channels,_.bufferMix=null,_.buffer=result.buffer,_.phase=0,_.phaseIncr=result.samplerate/T.samplerate,_.duration=1e3*result.duration,_.currentTime=0,_.isReversed&&(_.phaseIncr*=-1,_.phase=result.buffer[0].length+_.phaseIncr),self._.emit("loadedmetadata")):dfd.reject(msg)},onloadeddata=function(){self._.isLoaded=!0,self._.plotFlush=!0,self._.emit("loadeddata"),dfd.resolveWith(self)};return(new modules.Decoder).decode(src,onloadedmetadata,onloadeddata),dfd.promise()},loadthis=function(){return load.apply(this,arguments),this}}(timbre),function(T){"use strict";function BiquadNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.biquad=new Biquad(_.samplerate),_.freq=T(340),_.band=T(1),_.gain=T(0),_.plotBefore=plotBefore,_.plotRange=[-18,18],_.plotFlush=!0}var fn=T.fn,FFT=T.modules.FFT,Biquad=T.modules.Biquad,PLOT_LOW_FREQ=20;fn.extend(BiquadNode);var plotBefore=function(context,x,y,width,height){context.lineWidth=1,context.strokeStyle="rgb(192, 192, 192)";for(var nyquist=.5*this._.samplerate,i=1;10>=i;++i)for(var j=1;4>=j;j++){var f=i*Math.pow(10,j);if(!(PLOT_LOW_FREQ>=f||f>=nyquist)){context.beginPath();var _x=Math.log(f/PLOT_LOW_FREQ)/Math.log(nyquist/PLOT_LOW_FREQ);_x=(_x*width+x|0)+.5,context.moveTo(_x,y),context.lineTo(_x,y+height),context.stroke()}}var h=height/6;for(i=1;6>i;i++){context.beginPath();var _y=(y+i*h|0)+.5;context.moveTo(x,_y),context.lineTo(x+width,_y),context.stroke()}},$=BiquadNode.prototype;Object.defineProperties($,{type:{set:function(value){var _=this._;value!==_.biquad.type&&(_.biquad.setType(value),_.plotFlush=!0)},get:function(){return this._.biquad.type}},freq:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}},cutoff:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}},res:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},Q:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},band:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},gain:{set:function(value){this._.gain=T(value)},get:function(){return this._.gain}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var freq=_.freq.process(tickID).cells[0][0],band=_.band.process(tickID).cells[0][0],gain=_.gain.process(tickID).cells[0][0];(_.prevFreq!==freq||_.prevband!==band||_.prevGain!==gain)&&(_.prevFreq=freq,_.prevband=band,_.prevGain=gain,_.biquad.setParams(freq,band,gain),_.plotFlush=!0),_.bypassed||_.biquad.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)}return this};var fft=new FFT(2048),super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var biquad=new Biquad(this._.samplerate);biquad.setType(this.type),biquad.setParams(this.freq.valueOf(),this.band.valueOf(),this.gain.valueOf());var impluse=new Float32Array(fft.length);impluse[0]=1,biquad.process(impluse,impluse),fft.forward(impluse);var i,j,f,index,delta,x0,x1,xx,size=512,data=new Float32Array(size),nyquist=.5*this._.samplerate,spectrum=new Float32Array(size);for(fft.getFrequencyData(spectrum),i=0;size>i;++i)f=Math.pow(nyquist/PLOT_LOW_FREQ,i/size)*PLOT_LOW_FREQ,j=f/(nyquist/spectrum.length),index=0|j,delta=j-index,0===index?x1=x0=xx=spectrum[index]:(x0=spectrum[index-1],x1=spectrum[index],xx=(1-delta)*x0+delta*x1),data[i]=xx;this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("biquad",BiquadNode),fn.register("lowpass",function(_args){return new BiquadNode(_args).set("type","lowpass")}),fn.register("highpass",function(_args){return new BiquadNode(_args).set("type","highpass")}),fn.register("bandpass",function(_args){return new BiquadNode(_args).set("type","bandpass")}),fn.register("lowshelf",function(_args){return new BiquadNode(_args).set("type","lowshelf")}),fn.register("highshelf",function(_args){return new BiquadNode(_args).set("type","highshelf")}),fn.register("peaking",function(_args){return new BiquadNode(_args).set("type","peaking")}),fn.register("notch",function(_args){return new BiquadNode(_args).set("type","notch")}),fn.register("allpass",function(_args){return new BiquadNode(_args).set("type","allpass")}),fn.alias("lpf","lowpass"),fn.alias("hpf","highpass"),fn.alias("bpf","bandpass"),fn.alias("bef","notch"),fn.alias("brf","notch"),fn.alias("apf","allpass")}(timbre),function(T){"use strict";function BufferNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.pitch=T(1),_.samplerate=44100,_.channels=0,_.bufferMix=null,_.buffer=[],_.isLooped=!1,_.isReversed=!1,_.duration=0,_.currentTime=0,_.currentTimeObj=null,_.phase=0,_.phaseIncr=0,_.onended=fn.make_onended(this,0),_.onlooped=make_onlooped(this)}var fn=T.fn,Tape=T.modules.Scissor.Tape,isSignalArray=function(obj){return fn.isSignalArray(obj)||obj instanceof Float32Array};fn.extend(BufferNode);var make_onlooped=function(self){return function(){var _=self._;_.phase>=_.buffer[0].length?_.phase=0:_.phase<0&&(_.phase=_.buffer[0].length+_.phaseIncr),self._.emit("looped")}},$=BufferNode.prototype,setBuffer=function(value){var _=this._;if("object"==typeof value){var samplerate,channels,buffer=[];isSignalArray(value)?(buffer[0]=value,channels=1):"object"==typeof value&&(value instanceof T.Object?value=value.buffer:value instanceof Tape&&(value=value.getBuffer()),Array.isArray(value.buffer)?isSignalArray(value.buffer[0])&&(isSignalArray(value.buffer[1])&&isSignalArray(value.buffer[2])?(channels=2,buffer=value.buffer):(channels=1,buffer=[value.buffer[0]])):isSignalArray(value.buffer)&&(channels=1,buffer=[value.buffer]),"number"==typeof value.samplerate&&(samplerate=value.samplerate)),buffer.length&&(samplerate>0&&(_.samplerate=value.samplerate),_.bufferMix=null,_.buffer=buffer,_.phase=0,_.phaseIncr=_.samplerate/T.samplerate,_.duration=1e3*_.buffer[0].length/_.samplerate,_.currentTime=0,_.plotFlush=!0,this.reverse(_.isReversed))}};Object.defineProperties($,{buffer:{set:setBuffer,get:function(){var _=this._;return{samplerate:_.samplerate,channels:_.channels,buffer:_.buffer}}},pitch:{set:function(value){this._.pitch=T(value)},get:function(){return this._.pitch}},isLooped:{get:function(){return this._.isLooped}},isReversed:{get:function(){return this._.isReversed}},samplerate:{get:function(){return this._.samplerate}},duration:{get:function(){return this._.duration}},currentTime:{set:function(value){if("number"==typeof value){var _=this._;value>=0&&value<=_.duration&&(_.phase=value/1e3*_.samplerate,_.currentTime=value)}else value instanceof T.Object?this._.currentTimeObj=value:null===value&&(this._.currentTimeObj=null)},get:function(){return this._.currentTimeObj?this._.currentTimeObj:this._.currentTime}}}),$.clone=function(){var _=this._,instance=fn.clone(this);return _.buffer.length&&setBuffer.call(instance,{buffer:_.buffer,samplerate:_.samplerate,channels:_.channels}),instance.loop(_.isLooped),instance.reverse(_.isReversed),instance},$.slice=function(begin,end){var _=this._,instance=T(_.originkey),isReversed=_.isReversed;if(_.buffer.length){if(begin="number"==typeof begin?.001*begin*_.samplerate|0:0,end="number"==typeof end?.001*end*_.samplerate|0:_.buffer[0].length,begin>end){var tmp=begin;begin=end,end=tmp,isReversed=!isReversed}2===_.channels?setBuffer.call(instance,{buffer:[fn.pointer(_.buffer[0],begin,end-begin),fn.pointer(_.buffer[1],begin,end-begin),fn.pointer(_.buffer[2],begin,end-begin)],samplerate:_.samplerate}):setBuffer.call(instance,{buffer:fn.pointer(_.buffer[0],begin,end-begin),samplerate:_.samplerate}),instance.playbackState=fn.PLAYING_STATE}return instance.loop(_.isLooped),instance.reverse(_.isReversed),instance},$.reverse=function(value){var _=this._;return _.isReversed=!!value,_.isReversed?(_.phaseIncr>0&&(_.phaseIncr*=-1),0===_.phase&&_.buffer.length&&(_.phase=_.buffer[0].length+_.phaseIncr)):_.phaseIncr<0&&(_.phaseIncr*=-1),this},$.loop=function(value){return this._.isLooped=!!value,this},$.bang=function(value){return this.playbackState=value===!1?fn.FINISHED_STATE:fn.PLAYING_STATE,this._.phase=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(!_.buffer.length)return this;if(this.tickID!==tickID){this.tickID=tickID;var i,bufferL,bufferR,cellL=this.cells[1],cellR=this.cells[2],phase=_.phase,imax=_.cellsize;if(2===_.channels?(bufferL=_.buffer[1],bufferR=_.buffer[2]):bufferL=bufferR=_.buffer[0],_.currentTimeObj){var t,pos=_.currentTimeObj.process(tickID).cells[0],sr=.001*_.samplerate;for(i=0;imax>i;++i)t=pos[i],phase=t*sr,cellL[i]=bufferL[0|phase]||0,cellR[i]=bufferR[0|phase]||0;_.phase=phase,_.currentTime=t}else{var pitch=_.pitch.process(tickID).cells[0][0],phaseIncr=_.phaseIncr*pitch;for(i=0;imax>i;++i)cellL[i]=bufferL[0|phase]||0,cellR[i]=bufferR[0|phase]||0,phase+=phaseIncr;phase>=bufferL.length?fn.nextTick(_.isLooped?_.onlooped:_.onended):0>phase&&fn.nextTick(_.isLooped?_.onlooped:_.onended),_.phase=phase,_.currentTime+=fn.currentTimeIncr}fn.outputSignalAR(this)}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var bufferL,bufferR,_=this._;if(_.plotFlush){2===_.channels?(bufferL=_.buffer[1],bufferR=_.buffer[2]):bufferL=bufferR=_.buffer[0];for(var data=new Float32Array(2048),x=0,xIncr=bufferL.length/2048,i=0;2048>i;i++)data[i]=.5*(bufferL[0|x]+bufferR[0|x]),x+=xIncr;_.plotData=data,_.plotFlush=null}return super_plot.call(this,opts)},fn.register("buffer",BufferNode)}(timbre),function(T){"use strict";function ChorusNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var chorus=new Chorus(this._.samplerate);chorus.setDelayTime(20),chorus.setRate(4),chorus.depth=20,chorus.feedback=.2,chorus.mix=.33,this._.chorus=chorus}var fn=T.fn,Chorus=T.modules.Chorus;fn.extend(ChorusNode);var $=ChorusNode.prototype;Object.defineProperties($,{type:{set:function(value){this._.chorus.setDelayTime(value)},get:function(){return this._.chorus.wave}},delay:{set:function(value){value>=.5&&80>=value&&this._.chorus.setDelayTime(value)},get:function(){return this._.chorus.delayTime}},rate:{set:function(value){"number"==typeof value&&value>0&&this._.chorus.setRate(value)},get:function(){return this._.chorus.rate}},depth:{set:function(value){"number"==typeof value&&value>=0&&100>=value&&(value*=this._.samplerate/44100,this._.chorus.depth=value)},get:function(){return this._.chorus.depth}},fb:{set:function(value){"number"==typeof value&&value>=-1&&1>=value&&(this._.chorus.feedback=.99996*value)},get:function(){return this._.chorus.feedback}},mix:{set:function(value){this._.mix=T(value)},get:function(){return this._.mix}}}),$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,fn.inputSignalAR(this),_.bypassed||_.chorus.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)),this},fn.register("chorus",ChorusNode)}(timbre),function(T){"use strict";function ClipNode(_args){T.Object.call(this,2,_args);var _=this._;_.min=-.8,_.max=.8}var fn=T.fn;fn.extend(ClipNode);var $=ClipNode.prototype;Object.defineProperties($,{minmax:{set:function(value){var _=this._;"number"==typeof value&&(_.min=-Math.abs(value),_.max=-_.min)},get:function(){return this._.max}},min:{set:function(value){var _=this._;"number"==typeof value&&(_.max<value?_.max=value:_.min=value)},get:function(){return this._.min}},max:{set:function(value){var _=this._;"number"==typeof value&&(value<_.min?_.min=value:_.max=value)},get:function(){return this._.max}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,value,cellL=this.cells[1],cellR=this.cells[2],imax=cellL.length,min=_.min,max=_.max;if(_.ar){for(fn.inputSignalAR(this),i=0;imax>i;++i)value=cellL[i],min>value?value=min:value>max&&(value=max),cellL[i]=value,value=cellR[i],min>value?value=min:value>max&&(value=max),cellR[i]=value;fn.outputSignalAR(this)}else value=fn.inputSignalKR(this),min>value?value=min:value>max&&(value=max),this.cells[0][0]=value,fn.outputSignalKR(this)}return this},fn.register("clip",ClipNode)}(timbre),function(T){"use strict";function CompressorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.prevThresh=-24,_.prevKnee=30,_.prevRatio=12,_.thresh=T(_.prevThresh),_.knee=T(_.prevKnee),_.ratio=T(_.prevRatio),_.postGain=6,_.reduction=0,_.attack=3,_.release=25,_.comp=new Compressor(_.samplerate),_.comp.dbPostGain=_.postGain,_.comp.setAttackTime(.001*_.attack),_.comp.setReleaseTime(.001*_.release),_.comp.setPreDelayTime(6),_.comp.setParams(_.prevThresh,_.prevKnee,_.prevRatio)}var fn=T.fn,timevalue=T.timevalue,Compressor=T.modules.Compressor;fn.extend(CompressorNode);var $=CompressorNode.prototype;Object.defineProperties($,{thresh:{set:function(value){this._.thresh=T(value)},get:function(){return this._.thresh}},thre:{set:function(value){this._.thresh=T(value)},get:function(){return this._.thre}},knee:{set:function(value){this._.kne=T(value)},get:function(){return this._.knee}},ratio:{set:function(value){this._.ratio=T(value)},get:function(){return this._.ratio}},gain:{set:function(value){"number"==typeof value&&(this._.comp.dbPostGain=value)},get:function(){return this._.comp.dbPostGain}},attack:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&(value=0>value?0:value>1e3?1e3:value,this._.attack=value,this._.comp.setAttackTime(.001*value))},get:function(){return this._.attack}},release:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&(value=0>value?0:value>1e3?1e3:value,this._.release=value,this._.comp.setReleaseTime(.001*value))},get:function(){return this._.release}},reduction:{get:function(){return this._.reduction}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var thresh=_.thresh.process(tickID).cells[0][0],knee=_.knee.process(tickID).cells[0][0],ratio=_.ratio.process(tickID).cells[0][0];(_.prevThresh!==thresh||_.prevKnee!==knee||_.prevRatio!==ratio)&&(_.prevThresh=thresh,_.prevKnee=knee,_.prevRatio=ratio,_.comp.setParams(thresh,knee,ratio)),_.bypassed||(_.comp.process(this.cells[1],this.cells[2]),_.reduction=_.comp.meteringGain),fn.outputSignalAR(this)}return this},fn.register("comp",CompressorNode)}(timbre),function(T){"use strict";function DelayNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.time=T(100),_.fb=T(.2),_.cross=T(!1),_.mix=.33,_.delay=new StereoDelay(_.samplerate)}var fn=T.fn,timevalue=T.timevalue,StereoDelay=T.modules.StereoDelay;fn.extend(DelayNode);var $=DelayNode.prototype;Object.defineProperties($,{time:{set:function(value){"string"==typeof value&&(value=timevalue(value)),this._.time=T(value)},get:function(){return this._.time}},fb:{set:function(value){this._.fb=T(value)},get:function(){return this._.fb}},cross:{set:function(value){this._.cross=T(value)},get:function(){return this._.cross}},mix:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.mix=value)},get:function(){return this._.mix}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var time=_.time.process(tickID).cells[0][0],fb=_.fb.process(tickID).cells[0][0],cross=0!==_.cross.process(tickID).cells[0][0],mix=_.mix;(_.prevTime!==time||_.prevFb!==fb||_.prevCross!==cross||_.prevMix!==mix)&&(_.prevTime=time,_.prevFb=fb,_.prevCross=cross,_.prevMix=mix,_.delay.setParams(time,fb,cross,mix)),fn.inputSignalAR(this),_.bypassed||_.delay.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)}return this},fn.register("delay",DelayNode)}(timbre),function(T){"use strict";function DistNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.pre=T(60),_.post=T(-18),_.x1L=_.x2L=_.y1L=_.y2L=0,_.x1R=_.x2R=_.y1R=_.y2R=0,_.b0=_.b1=_.b2=_.a1=_.a2=0,_.cutoff=0,_.Q=1,_.preScale=0,_.postScale=0}var fn=T.fn;fn.extend(DistNode);var $=DistNode.prototype;Object.defineProperties($,{cutoff:{set:function(value){"number"==typeof value&&value>0&&(this._.cutoff=value)},get:function(){return this._.cutoff}},pre:{set:function(value){this._.pre=T(value)},get:function(){return this._.pre}},post:{set:function(value){this._.post=T(value)},get:function(){return this._.post}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var preGain=-_.pre.process(tickID).cells[0][0],postGain=-_.post.process(tickID).cells[0][0];if((_.prevPreGain!==preGain||_.prevPostGain!==postGain)&&(_.prevPreGain=preGain,_.prevPostGain=postGain,_.preScale=Math.pow(10,.05*-preGain),_.postScale=Math.pow(10,.05*-postGain)),!_.bypassed){var i,imax,value,x0,y0,cellL=this.cells[1],cellR=this.cells[2],preScale=_.preScale,postScale=_.postScale;if(_.cutoff){_.prevCutoff!==_.cutoff&&(_.prevCutoff=_.cutoff,lowpass_params(_));var x1L=_.x1L,x2L=_.x2L,y1L=_.y1L,y2L=_.y2L,x1R=_.x1R,x2R=_.x2R,y1R=_.y1R,y2R=_.y2R,b0=_.b0,b1=_.b1,b2=_.b2,a1=_.a1,a2=_.a2;for(i=0,imax=cellL.length;imax>i;++i)x0=cellL[i]*preScale,y0=b0*x0+b1*x1L+b2*x2L-a1*y1L-a2*y2L,value=y0*postScale,-1>value?value=-1:value>1&&(value=1),cellL[i]=value,x2L=x1L,x1L=x0,y2L=y1L,y1L=y0,x0=cellR[i]*preScale,y0=b0*x0+b1*x1R+b2*x2R-a1*y1R-a2*y2R,value=y0*postScale,-1>value?value=-1:value>1&&(value=1),cellR[i]=value,x2R=x1R,x1R=x0,y2R=y1R,y1R=y0;_.x1L=x1L,_.x2L=x2L,_.y1L=y1L,_.y2L=y2L,_.x1R=x1R,_.x2R=x2R,_.y1R=y1R,_.y2R=y2R}else for(i=0,imax=cellL.length;imax>i;++i)value=cellL[i]*preScale*postScale,-1>value?value=-1:value>1&&(value=1),cellL[i]=value,value=cellR[i]*preScale*postScale,-1>value?value=-1:value>1&&(value=1),cellR[i]=value}fn.outputSignalAR(this)}return this};var lowpass_params=function(_){var w0=2*Math.PI*_.cutoff/_.samplerate,cos=Math.cos(w0),sin=Math.sin(w0),alpha=sin/(2*_.Q),ia0=1/(1+alpha);_.b0=.5*(1-cos)*ia0,_.b1=1-cos*ia0,_.b2=.5*(1-cos)*ia0,_.a1=-2*cos*ia0,_.a2=1-alpha*ia0};fn.register("dist",DistNode)}(timbre),function(T){"use strict";function DivNode(_args){T.Object.call(this,2,_args),this._.ar=!1}var fn=T.fn;fn.extend(DivNode);var $=DivNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,div,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)div=tmpL[j],cellL[j]=0===div?0:cellL[j]/div,div=tmpR[j],cellR[j]=0===div?0:cellR[j]/div;else for(j=0;jmax>j;++j)cellL[j]=cellR[i]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)div=nodes[i].process(tickID).cells[0][0],tmp=0===div?0:tmp/div;else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("/",DivNode)}(timbre),function(T){"use strict";function EnvNode(_args){T.Object.call(this,2,_args);var _=this._;_.env=new Envelope(_.samplerate),_.env.setStep(_.cellsize),_.tmp=new fn.SignalArray(_.cellsize),_.ar=!1,_.plotFlush=!0,_.onended=make_onended(this),this.on("ar",onar)}function envValue(opts,min,def,name1,name2,func){var x=def;return"number"==typeof opts[name1]?x=opts[name1]:"number"==typeof opts[name2]?x=opts[name2]:func&&("string"==typeof opts[name1]?x=func(opts[name1]):"string"==typeof opts[name2]&&(x=func(opts[name2]))),min>x&&(x=min),x}var fn=T.fn,timevalue=T.timevalue,Envelope=T.modules.Envelope,isDictionary=fn.isDictionary;fn.extend(EnvNode);var onar=function(value){this._.env.setStep(value?1:this._.cellsize)},make_onended=function(self){return function(){self._.emit("ended")}},$=EnvNode.prototype;Object.defineProperties($,{table:{set:function(value){Array.isArray(value)&&(setTable.call(this,value),this._.plotFlush=!0)},get:function(){return this._.env.table}},curve:{set:function(value){this._.env.setCurve(value)},get:function(){return this._.env.curve}},releaseNode:{set:function(value){this._.env.setReleaseNode(value),this._.plotFlush=!0},get:function(){return this._.env.releaseNode+1}},loopNode:{set:function(value){this._.env.setLoopNode(value),this._.plotFlush=!0},get:function(){return this._.env.loopNode+1}}}),$.clone=function(){var instance=fn.clone(this);return instance._.env=this._.env.clone(),instance},$.reset=function(){return this._.env.reset(),this},$.release=function(){var _=this._;return _.env.release(),_.emit("released"),this},$.bang=function(){var _=this._;return _.env.reset(),_.env.status=Envelope.StatusGate,_.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;var value,emit=null;if(_.ar){var tmp=_.tmp;for(_.env.process(tmp),i=0;imax>i;++i)cellL[i]*=tmp[i],cellR[i]*=tmp[i];emit=_.env.emit}else{for(value=_.env.next(),i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value;emit=_.env.emit}fn.outputSignalAR(this),emit&&("ended"===emit?fn.nextTick(_.onended):this._.emit(emit,_.value))}return this};var setTable=function(list){for(var value,time,curveType,curveValue,env=this._.env,table=[list[0]||ZERO],i=1,imax=list.length;imax>i;++i)value=list[i][0]||ZERO,time=list[i][1],curveType=list[i][2],"number"!=typeof time&&(time="string"==typeof time?timevalue(time):10),10>time&&(time=10),"number"==typeof curveType?(curveValue=curveType,curveType=Envelope.CurveTypeCurve):(curveType=Envelope.CurveTypeDict[curveType]||null,curveValue=0),table.push([value,time,curveType,curveValue]);env.setTable(table)},super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var i,imax,env=this._.env.clone(),info=env.getInfo(1e3),totalDuration=info.totalDuration,loopBeginTime=info.loopBeginTime,releaseBeginTime=info.releaseBeginTime,data=new Float32Array(256),duration=0,durationIncr=totalDuration/data.length,isReleased=!1,samples=.001*totalDuration*this._.samplerate|0;for(samples/=data.length,env.setStep(samples),env.status=Envelope.StatusGate,i=0,imax=data.length;imax>i;++i)data[i]=env.next(),duration+=durationIncr,!isReleased&&duration>=releaseBeginTime&&(env.release(),isReleased=!0);this._.plotData=data,this._.plotBefore=function(context,x,y,width,height){var x1,w;1/0!==loopBeginTime&&1/0!==releaseBeginTime&&(x1=x+width*(loopBeginTime/totalDuration),w=x+width*(releaseBeginTime/totalDuration),w-=x1,context.fillStyle="rgba(224, 224, 224, 0.8)",context.fillRect(x1,0,w,height)),1/0!==releaseBeginTime&&(x1=x+width*(releaseBeginTime/totalDuration),w=width-x1,context.fillStyle="rgba(212, 212, 212, 0.8)",context.fillRect(x1,0,w,height))};var minValue=1/0,maxValue=-1/0;for(i=0;imax>i;++i)data[i]<minValue?minValue=data[i]:data[i]>maxValue&&(maxValue=data[i]);1>maxValue&&(maxValue=1),this._.plotRange=[minValue,maxValue],this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("env",EnvNode);var ZERO=Envelope.ZERO;fn.register("perc",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),r=envValue(opts,10,1e3,"r","releaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[ZERO,r]],new EnvNode(_args)}),fn.register("adsr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","decayTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[s,d],[ZERO,r]],opts.releaseNode=3,new EnvNode(_args)}),fn.register("adshr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),h=envValue(opts,10,500,"h","holdTime",timevalue),r=envValue(opts,10,1e3,"r","decayTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[s,d],[s,h],[ZERO,r]],new EnvNode(_args)}),fn.register("asr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","releaseTime",timevalue);return opts.table=[ZERO,[s,a],[ZERO,r]],opts.releaseNode=2,new EnvNode(_args)}),fn.register("dadsr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],dl=envValue(opts,10,100,"dl","delayTime",timevalue),a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[ZERO,dl],[lv,a],[s,d],[ZERO,r]],opts.releaseNode=4,new EnvNode(_args)}),fn.register("ahdsfr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),h=envValue(opts,10,10,"h","holdTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),f=envValue(opts,10,5e3,"f","fadeTime",timevalue),r=envValue(opts,10,1e3,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[lv,h],[s,d],[ZERO,f],[ZERO,r]],opts.releaseNode=5,new EnvNode(_args)}),fn.register("linen",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),s=envValue(opts,10,1e3,"s","sustainTime",timevalue),r=envValue(opts,10,1e3,"r","releaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");
return opts.table=[ZERO,[lv,a],[lv,s],[ZERO,r]],new EnvNode(_args)}),fn.register("env.tri",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],dur=envValue(opts,20,1e3,"dur","duration",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return dur*=.5,opts.table=[ZERO,[lv,dur],[ZERO,dur]],new EnvNode(_args)}),fn.register("env.cutoff",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],r=envValue(opts,10,100,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[lv,[ZERO,r]],new EnvNode(_args)})}(timbre),function(T){"use strict";function EQNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.biquads=new Array(7),_.plotBefore=plotBefore,_.plotRange=[-18,18],_.plotFlush=!0}var fn=T.fn,FFT=T.modules.FFT,Biquad=T.modules.Biquad,PLOT_LOW_FREQ=20,PARAM_NAMES={hpf:0,lf:1,lmf:2,mf:3,hmf:4,hf:5,lpf:6};fn.extend(EQNode);var plotBefore=function(context,x,y,width,height){context.lineWidth=1,context.strokeStyle="rgb(192, 192, 192)";for(var nyquist=.5*this._.samplerate,i=1;10>=i;++i)for(var j=1;4>=j;j++){var f=i*Math.pow(10,j);if(!(PLOT_LOW_FREQ>=f||f>=nyquist)){context.beginPath();var _x=Math.log(f/PLOT_LOW_FREQ)/Math.log(nyquist/PLOT_LOW_FREQ);_x=(_x*width+x|0)+.5,context.moveTo(_x,y),context.lineTo(_x,y+height),context.stroke()}}var h=height/6;for(i=1;6>i;i++){context.beginPath();var _y=(y+i*h|0)+.5;context.moveTo(x,_y),context.lineTo(x+width,_y),context.stroke()}},$=EQNode.prototype;Object.defineProperties($,{params:{set:function(value){if("object"==typeof value)for(var keys=Object.keys(value),i=0,imax=keys.length;imax>i;++i){var items=value[keys[i]];Array.isArray(items)?this.setParams(keys[i],items[0],items[1],items[2]):this.setParams(keys[i])}}}}),$.setParams=function(index,freq,Q,gain){var _=this._;if("string"==typeof index&&(index=PARAM_NAMES[index]),index>=0&&index<_.biquads.length){if(index|=0,"number"==typeof freq&&"number"==typeof Q){"number"!=typeof gain&&(gain=0);var biquad=_.biquads[index];if(!biquad)switch(biquad=_.biquads[index]=new Biquad(_.samplerate),index){case 0:biquad.setType("highpass");break;case _.biquads.length-1:biquad.setType("lowpass");break;default:biquad.setType("peaking")}biquad.setParams(freq,Q,gain)}else _.biquads[index]=void 0;_.plotFlush=!0}return this},$.getParams=function(index){var _=this._,biquad=_.biquads[0|index];return biquad?{freq:biquad.frequency,Q:biquad.Q,gain:biquad.gain}:void 0},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),!_.bypassed)for(var cellL=this.cells[1],cellR=this.cells[2],biquads=_.biquads,i=0,imax=biquads.length;imax>i;++i)biquads[i]&&biquads[i].process(cellL,cellR);fn.outputSignalAR(this)}return this};var fft=new FFT(2048),super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var _=this._,impluse=new Float32Array(fft.length);impluse[0]=1;for(var i=0,imax=_.biquads.length;imax>i;++i){var params=this.getParams(i);if(params){var biquad=new Biquad(_.samplerate);biquad.setType(0===i?"highpass":i===imax-1?"lowpass":"peaking"),biquad.setParams(params.freq,params.Q,params.gain),biquad.process(impluse,impluse)}}fft.forward(impluse);var j,f,index,delta,x0,x1,xx,size=512,data=new Float32Array(size),nyquist=.5*_.samplerate,spectrum=new Float32Array(size);for(fft.getFrequencyData(spectrum),i=0;size>i;++i)f=Math.pow(nyquist/PLOT_LOW_FREQ,i/size)*PLOT_LOW_FREQ,j=f/(nyquist/spectrum.length),index=0|j,delta=j-index,0===index?x1=x0=xx=spectrum[index]:(x0=spectrum[index-1],x1=spectrum[index],xx=(1-delta)*x0+delta*x1),data[i]=xx;this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("eq",EQNode)}(timbre),function(T){"use strict";function FFTNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this),this.real=new T.ChannelObject(this),this.imag=new T.ChannelObject(this),this.cells[3]=this.real.cell,this.cells[4]=this.imag.cell;var _=this._;_.fft=new FFT(2*_.cellsize),_.fftCell=new fn.SignalArray(_.fft.length),_.prevCell=new fn.SignalArray(_.cellsize),_.freqs=new fn.SignalArray(_.fft.length>>1),_.plotFlush=!0,_.plotRange=[0,32],_.plotBarStyle=!0}var fn=T.fn,FFT=T.modules.FFT;fn.extend(FFTNode);var $=FFTNode.prototype;Object.defineProperties($,{window:{set:function(value){this._.fft.setWindow(value)},get:function(){return this._.fft.windowName}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var cell=this.cells[0],cellsize=_.cellsize;_.fftCell.set(_.prevCell),_.fftCell.set(cell,cellsize),_.fft.forward(_.fftCell),_.prevCell.set(cell),_.plotFlush=!0,this.cells[3].set(_.fft.real.subarray(0,cellsize)),this.cells[4].set(_.fft.imag.subarray(0,cellsize))}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),super_plot.call(this,opts)},fn.register("fft",FFTNode)}(timbre),function(T){"use strict";function FNoiseNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.freq=T(440),_.reg=32768,_.shortFlag=!1,_.phase=0,_.lastValue=0}var fn=T.fn;fn.extend(FNoiseNode);var $=FNoiseNode.prototype;Object.defineProperties($,{shortFlag:{set:function(value){this._.shortFlag=!!value},get:function(){return this._.shortFlag}},freq:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}}}),$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){this.tickID=tickID;var i,imax,lastValue=_.lastValue,phase=_.phase,phaseStep=_.freq.process(tickID).cells[0][0]/_.samplerate,reg=_.reg,mul=_.mul,add=_.add;if(_.shortFlag)for(i=0,imax=cell.length;imax>i;++i)phase>=1&&(reg>>=1,reg|=(1&(reg^reg>>6))<<15,lastValue=(1&reg)-.5,phase-=1),cell[i]=lastValue*mul+add,phase+=phaseStep;else for(i=0,imax=cell.length;imax>i;++i)phase>=1&&(reg>>=1,reg|=(1&(reg^reg>>1))<<15,lastValue=(1&reg)-.5,phase-=1),cell[i]=lastValue*mul+add,phase+=phaseStep;_.reg=reg,_.phase=phase,_.lastValue=lastValue}return this},fn.register("fnoise",FNoiseNode)}(timbre),function(T){"use strict";function GateNode(_args){T.Object.call(this,2,_args),fn.fixAR(this),this._.selected=0,this._.outputs=[]}var fn=T.fn,GateChannelNode=function(){function GateChannelNode(parent){T.Object.call(this,2,[]),fn.fixAR(this),this._.parent=parent}return fn.extend(GateChannelNode),GateChannelNode.prototype.process=function(tickID){return this.tickID!==tickID&&(this.tickID=tickID,this._.parent.process(tickID)),this},GateChannelNode}();fn.extend(GateNode);var $=GateNode.prototype;Object.defineProperties($,{selected:{set:function(value){var _=this._;if("number"==typeof value){_.selected=value;for(var outputs=_.outputs,i=0,imax=outputs.length;imax>i;++i)outputs[i]&&(outputs[i].cells[0].set(fn.emptycell),outputs[i].cells[1].set(fn.emptycell),outputs[i].cells[2].set(fn.emptycell))}},get:function(){return this._.selected}}}),$.at=function(index){var _=this._,output=_.outputs[index];return output||(_.outputs[index]=output=new GateChannelNode(this)),output},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var output=_.outputs[_.selected];output&&(output.cells[0].set(this.cells[0]),output.cells[1].set(this.cells[1]),output.cells[2].set(this.cells[2]))}return this},fn.register("gate",GateNode)}(timbre),function(T){"use strict";function IFFTNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.fft=new FFT(2*_.cellsize),_.fftCell=new fn.SignalArray(this._.fft.length),_.realBuffer=new fn.SignalArray(this._.fft.length),_.imagBuffer=new fn.SignalArray(this._.fft.length)}var fn=T.fn,FFT=T.modules.FFT;fn.extend(IFFTNode);var $=IFFTNode.prototype;Object.defineProperties($,{real:{set:function(value){this._.real=T(value)},get:function(){return this._.real}},imag:{set:function(value){this._.imag=T(value)},get:function(){return this._.imag}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID&&(this.tickID=tickID,_.real&&_.imag)){var cell=this.cells[0],real=_.realBuffer,imag=_.imagBuffer,_real=_.real.process(tickID).cells[0],_imag=_.imag.process(tickID).cells[0];real.set(_real),imag.set(_imag),cell.set(_.fft.inverse(real,imag).subarray(0,_.cellsize)),fn.outputSignalAR(this)}return this},fn.register("ifft",IFFTNode)}(timbre),function(T){"use strict";function IntervalNode(_args){T.Object.call(this,1,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.interval=T(1e3),_.count=0,_.delay=0,_.timeout=1/0,_.currentTime=0,_.delaySamples=0,_.countSamples=0,_.onended=fn.make_onended(this),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue;fn.extend(IntervalNode);var onstart=function(){var _=this._;this.playbackState=fn.PLAYING_STATE,_.delaySamples=.001*_.samplerate*_.delay|0,_.countSamples=_.count=_.currentTime=0};Object.defineProperty(onstart,"unremovable",{value:!0,writable:!1});var $=IntervalNode.prototype;Object.defineProperties($,{interval:{set:function(value){"string"==typeof value&&(value=timevalue(value),0>=value&&(value=0)),this._.interval=T(value)},get:function(){return this._.interval}},delay:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this._.delay=value,this._.delaySamples=.001*this._.samplerate*value|0)},get:function(){return this._.delay}},count:{set:function(value){"number"==typeof value&&(this._.count=value)},get:function(){return this._.count}},timeout:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this._.timeout=value)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),$.bang=function(){var _=this._;return this.playbackState=fn.PLAYING_STATE,_.delaySamples=.001*_.samplerate*_.delay|0,_.countSamples=_.count=_.currentTime=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID,_.delaySamples>0&&(_.delaySamples-=cell.length);var interval=_.interval.process(tickID).cells[0][0];if(_.delaySamples<=0&&(_.countSamples-=cell.length,_.countSamples<=0)){_.countSamples+=_.samplerate*interval*.001|0;for(var nodes=this.nodes,count=_.count,x=count*_.mul+_.add,j=0,jmax=cell.length;jmax>j;++j)cell[j]=x;for(var i=0,imax=nodes.length;imax>i;++i)nodes[i].bang(count);_.count+=1}_.currentTime+=fn.currentTimeIncr,_.currentTime>=_.timeout&&fn.nextTick(_.onended)}return this},fn.register("interval",IntervalNode)}(timbre),function(T){"use strict";function LagNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._,bits=Math.ceil(Math.log(_.samplerate)*Math.LOG2E);_.buffersize=1<<bits,_.buffermask=_.buffersize-1,_.buffer=new fn.SignalArray(_.buffersize),_.time=0,_.readIndex=0,_.writeIndex=0}var fn=T.fn,timevalue=T.timevalue;fn.extend(LagNode);var $=LagNode.prototype;Object.defineProperties($,{time:{set:function(value){if("string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0){var _=this._;_.time=value;var offset=.001*value*_.samplerate|0;offset>_.buffermask&&(offset=_.buffermask),_.writeIndex=_.readIndex+offset&_.buffermask}},get:function(){return this._.time}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var i,cell=this.cells[0],buffer=_.buffer,mask=_.buffermask,readIndex=_.readIndex,writeIndex=_.writeIndex,imax=cell.length;for(i=0;imax>i;++i)buffer[writeIndex]=cell[i],cell[i]=buffer[readIndex],readIndex+=1,writeIndex=writeIndex+1&mask;_.readIndex=readIndex&mask,_.writeIndex=writeIndex,fn.outputSignalAR(this)}return this},fn.register("lag",LagNode)}(timbre),function(T){"use strict";function MapNode(_args){T.Object.call(this,1,_args);var _=this._;_.input=0,_.value=0,_.prev=null,_.ar=!1,_.map=defaultFunction}var fn=T.fn;fn.extend(MapNode);var defaultFunction=function(x){return x},$=MapNode.prototype;Object.defineProperties($,{input:{set:function(value){"number"==typeof value&&(this._.input=value)},get:function(){return this._.input}},map:{set:function(value){"function"==typeof value&&(this._.map=value)},get:function(){return this._.map}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(input){return this._.map?this._.map(input):0},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var map=_.map;if(map)for(i=0;imax>i;++i)cell[i]=map(cell[i]);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=len?fn.inputSignalKR(this):_.input;_.map&&_.prev!==input&&(_.prev=input,_.value=_.map(input));var value=_.value*_.mul+_.add;for(i=0;imax>i;++i)cell[i]=value}}return this},fn.register("map",MapNode)}(timbre),function(T){"use strict";function MaxNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MaxNode);var $=MaxNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,val,nodes=this.nodes,imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0],cell.set(tmp),i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)val=tmp[j],cell[j]<val&&(cell[j]=val);else for(j=0;jmax>j;++j)cell[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)val=nodes[i].process(tickID).cells[0][0],val>tmp&&(tmp=val);else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("max",MaxNode)}(timbre),function(T){"use strict";function MediaStreamNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.src=_.func=null,_.bufferL=new fn.SignalArray(BUFFER_SIZE),_.bufferR=new fn.SignalArray(BUFFER_SIZE),_.readIndex=0,_.writeIndex=0,_.totalRead=0,_.totalWrite=0}if("browser"===T.envtype){var fn=T.fn,BUFFER_SIZE=4096,BUFFER_MASK=BUFFER_SIZE-1;fn.extend(MediaStreamNode);var $=MediaStreamNode.prototype;$.listen=function(audio){var _impl=impl[T.env];_impl&&(_impl.set.call(this,audio),_impl.listen.call(this))},$.unlisten=function(){var _impl=impl[T.env];_impl&&_impl.unlisten.call(this),this.cells[0].set(fn.emptycell),this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell);for(var _=this._,bufferL=_.bufferL,bufferR=_.bufferR,i=0,imax=bufferL.length;imax>i;++i)bufferL[i]=bufferR[i]=0},$.process=function(tickID){var _=this._;if(null===_.src)return this;if(this.tickID!==tickID){this.tickID=tickID;var cellsize=_.cellsize;if(_.totalWrite>_.totalRead+cellsize){var begin=_.readIndex,end=begin+cellsize;this.cells[1].set(_.bufferL.subarray(begin,end)),this.cells[2].set(_.bufferR.subarray(begin,end)),_.readIndex=end&BUFFER_MASK,_.totalRead+=cellsize}fn.outputSignalAR(this)}return this};var impl={};impl.webkit={set:function(src){var _=this._;if(src instanceof HTMLMediaElement){var context=fn._audioContext;_.src=context.createMediaElementSource(src)}},listen:function(){var _=this._,context=fn._audioContext;_.gain=context.createGainNode(),_.gain.gain.value=0,_.node=context.createJavaScriptNode(1024,2,2),_.node.onaudioprocess=onaudioprocess(this),_.src.connect(_.node),_.node.connect(_.gain),_.gain.connect(context.destination)},unlisten:function(){var _=this._;_.src&&_.src.disconnect(),_.gain&&_.gain.disconnect(),_.node&&_.node.disconnect()}};var onaudioprocess=function(self){return function(e){var _=self._,ins=e.inputBuffer,length=ins.length,writeIndex=_.writeIndex;_.bufferL.set(ins.getChannelData(0),writeIndex),_.bufferR.set(ins.getChannelData(1),writeIndex),_.writeIndex=writeIndex+length&BUFFER_MASK,_.totalWrite+=length}};impl.moz={set:function(src){var _=this._;src instanceof HTMLAudioElement&&(_.src=src,_.istep=_.samplerate/src.mozSampleRate)},listen:function(){var _=this._,o0=_.bufferL,o1=_.bufferR,prev0=0,prev1=0;2===_.src.mozChannels?(_.x=0,_.func=function(e){var x,i,writeIndex=_.writeIndex,totalWrite=_.totalWrite,samples=e.frameBuffer,istep=_.istep,imax=samples.length;for(x=_.x,i=0;imax>i;i+=2){for(x+=istep;x>0;)o0[writeIndex]=.5*(samples[i]+prev0),o1[writeIndex]=.5*(samples[i+1]+prev1),writeIndex=writeIndex+1&BUFFER_MASK,++totalWrite,x-=1;prev0=samples[i],prev1=samples[i+1]}_.x=x,_.writeIndex=writeIndex,_.totalWrite=totalWrite}):(_.x=0,_.func=function(e){var x,i,writeIndex=_.writeIndex,totalWrite=_.totalWrite,samples=e.frameBuffer,istep=_.istep,imax=samples.length;for(x=_.x,i=0;imax>i;++i){for(x+=istep;x>=0;)o0[writeIndex]=o1[writeIndex]=.5*(samples[i]+prev0),writeIndex=writeIndex+1&BUFFER_MASK,++totalWrite,x-=1;prev0=samples[i]}_.x=x,_.writeIndex=writeIndex,_.totalWrite=totalWrite}),_.src.addEventListener("MozAudioAvailable",_.func)},unlisten:function(){var _=this._;_.func&&(_.src.removeEventListener("MozAudioAvailable",_.func),_.func=null)}},fn.register("mediastream",MediaStreamNode)}}(timbre),function(T){"use strict";function MidiCpsNode(_args){T.Object.call(this,1,_args);var _=this._;_.midi=0,_.value=0,_.prev=null,_.a4=440,_.ar=!1}var fn=T.fn;fn.extend(MidiCpsNode);var $=MidiCpsNode.prototype;Object.defineProperties($,{midi:{set:function(value){"number"==typeof value&&(this._.midi=value)},get:function(){return this._.midi}},a4:{set:function(value){"number"==typeof value&&(this._.a4=value,this._.prev=null)},get:function(){return this._.a4}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(midi){var _=this._;return _.a4*Math.pow(2,(midi-69)/12)},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cell=this.cells[0],len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var a4=_.a4;for(i=0;imax>i;++i)cell[i]=a4*Math.pow(2,(cell[i]-69)/12);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=len?fn.inputSignalKR(this):_.midi;_.prev!==input&&(_.prev=input,_.value=_.a4*Math.pow(2,(input-69)/12)),cell[0]=_.value,fn.outputSignalKR(this)}}return this},fn.register("midicps",MidiCpsNode)}(timbre),function(T){"use strict";function MidiRatioNode(_args){T.Object.call(this,1,_args);var _=this._;_.midi=0,_.value=0,_.prev=null,_.range=12,_.ar=!1}var fn=T.fn;fn.extend(MidiRatioNode);var $=MidiRatioNode.prototype;Object.defineProperties($,{midi:{set:function(value){"number"==typeof value&&(this._.midi=value)},get:function(){return this._.midi}},range:{set:function(value){"number"==typeof value&&value>0&&(this._.range=value)},get:function(){return this._.range}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(midi){var _=this._;return Math.pow(2,midi/_.range)},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var range=_.range;for(i=0;imax>i;++i)cell[i]=Math.pow(2,cell[i]/range);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=this.nodes.length?fn.inputSignalKR(this):_.midi;_.prev!==input&&(_.prev=input,_.value=Math.pow(2,input/_.range));var value=_.value*_.mul+_.add;for(i=0;imax>i;++i)cell[i]=value}}return this},fn.register("midiratio",MidiRatioNode)}(timbre),function(T){"use strict";function MinNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MinNode);var $=MinNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,val,nodes=this.nodes,imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0],cell.set(tmp),i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)val=tmp[j],cell[j]>val&&(cell[j]=val);else for(j=0;jmax>j;++j)cell[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)val=nodes[i].process(tickID).cells[0][0],tmp>val&&(tmp=val);else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("min",MinNode)}(timbre),function(T){"use strict";function MML(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.tracks=[],_.onended=fn.make_onended(this),_.currentTime=0,this.on("start",onstart)}var fn=T.fn;fn.extend(MML);var onstart=function(){var self=this,_=this._,mml=_.mml;"string"==typeof mml&&(mml=[mml]),_.tracks=mml.map(function(mml,i){return new MMLTrack(self,i,mml)}),_.currentTime=0,this.playbackState=fn.PLAYING_STATE};Object.defineProperty(onstart,"unremoved",{value:!0,writable:!1});var $=MML.prototype;Object.defineProperties($,{mml:{set:function(value){var _=this._;("string"==typeof value||Array.isArray(value))&&(_.mml=value)},get:function(){return this._.mml}},currentTime:{get:function(){return this._.currentTime}}}),$.on=$.addListener=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.on(type,listener),this},$.once=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.once(type,listener),this},$.off=$.removeListener=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.off(type,listener),this},$.removeAllListeners=function(type){return"mml"===type&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),type="data"),this._.events.removeAllListeners(type),this},$.listeners=function(type){return"mml"===type&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),type="data"),this._.events.listeners(type)},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,tracks=_.tracks;for(i=0,imax=tracks.length;imax>i;++i)tracks[i].process();for(;i--;)tracks[i].ended&&tracks.splice(i,1);0===tracks.length&&fn.nextTick(_.onended),_.currentTime+=fn.currentTimeIncr}return this},fn.register("mml",MML);var MMLTrack=function(){function MMLTrack(sequencer,trackNum,mml){var _=this._={};_.sequencer=sequencer,_.trackNum=trackNum,_.commands=compile(mml),_.status={t:120,l:4,o:4,v:12,q:6,dot:0,tie:!1},_.index=0,_.queue=[],_.currentTime=0,_.queueTime=0,_.segnoIndex=-1,_.loopStack=[],_.prevNote=0,_.remain=1/0,this.ended=!1,sched(this)}var EOF=0,NOTEON=1,NOTEOFF=2,COMMAND=3;MMLTrack.prototype.process=function(){var _=this._,sequencer=_.sequencer,trackNum=_.trackNum,queue=_.queue,eof=!1;if(queue.length)for(;queue[0][0]<=_.currentTime;){var nextItem=_.queue.shift();switch(nextItem[1]){case NOTEON:noteOn(sequencer,trackNum,nextItem[2],nextItem[3]),_.remain=nextItem[4],sched(this);break;case NOTEOFF:noteOff(sequencer,trackNum,nextItem[2],nextItem[3]);break;case COMMAND:command(sequencer,nextItem[2]);break;case EOF:eof=!0}if(0===queue.length)break}_.remain-=fn.currentTimeIncr,eof&&(this.ended=!0),_.currentTime+=fn.currentTimeIncr};var noteOn=function(sequencer,trackNum,noteNum,velocity){var gen,i,imax,nodes=sequencer.nodes;for(i=0,imax=nodes.length;imax>i;++i)gen=nodes[i],gen.noteOn?gen.noteOn(noteNum,velocity):gen.bang();sequencer._.emit("data","noteOn",{trackNum:trackNum,noteNum:noteNum,velocity:velocity})},noteOff=function(sequencer,trackNum,noteNum,velocity){var gen,i,imax,nodes=sequencer.nodes;for(i=0,imax=nodes.length;imax>i;++i)gen=nodes[i],gen.noteOff?gen.noteOff(noteNum,velocity):gen.release&&gen.release();sequencer._.emit("data","noteOff",{trackNum:trackNum,noteNum:noteNum,velocity:velocity})},command=function(sequencer,cmd){sequencer._.emit("data","command",{command:cmd})},sched=function(self){var cmd,tempo,val,len,dot,vel,duration,quantize,pending,_queueTime,peek,i,imax,_=self._,commands=(_.sequencer,_.commands),queue=_.queue,index=_.index,status=_.status,queueTime=_.queueTime,loopStack=_.loopStack;pending=[];outer:for(;;){if(commands.length<=index){if(!(_.segnoIndex>=0))break;index=_.segnoIndex}switch(cmd=commands[index++],cmd.name){case"@":queue.push([queueTime,COMMAND,cmd.val]);break;case"n":if(tempo=status.t||120,null!==cmd.len?(len=cmd.len,dot=cmd.dot||0):(len=status.l,dot=cmd.dot||status.dot),duration=60/tempo*(4/len)*1e3,duration*=[1,1.5,1.75,1.875][dot]||1,vel=status.v<<3,status.tie){for(i=queue.length;i--;)if(queue[i][2]){queue.splice(i,1);break}val=_.prevNote}else val=_.prevNote=cmd.val+12*(status.o+1),queue.push([queueTime,NOTEON,val,vel,duration]);if(len>0){if(quantize=status.q/8,1>quantize)for(_queueTime=queueTime+duration*quantize,queue.push([_queueTime,NOTEOFF,val,vel]),i=0,imax=pending.length;imax>i;++i)queue.push([_queueTime,NOTEOFF,pending[i],vel]);if(pending=[],queueTime+=duration,!status.tie)break outer}else pending.push(val);status.tie=!1;break;case"r":tempo=status.t||120,null!==cmd.len?(len=cmd.len,dot=cmd.dot||0):(len=status.l,dot=cmd.dot||status.dot),len>0&&(duration=60/tempo*(4/len)*1e3,duration*=[1,1.5,1.75,1.875][dot]||1,queueTime+=duration);break;case"l":status.l=cmd.val,status.dot=cmd.dot;break;case"o":status.o=cmd.val;break;case"<":status.o<9&&(status.o+=1);break;case">":status.o>0&&(status.o-=1);break;case"v":status.v=cmd.val;break;case"(":status.v<15&&(status.v+=1);break;case")":status.v>0&&(status.v-=1);break;case"q":status.q=cmd.val;break;case"&":status.tie=!0;break;case"$":_.segnoIndex=index;break;case"[":loopStack.push([index,null,null]);break;case"|":peek=loopStack[loopStack.length-1],peek&&1===peek[1]&&(loopStack.pop(),index=peek[2]);break;case"]":peek=loopStack[loopStack.length-1],peek&&(null===peek[1]&&(peek[1]=cmd.count,peek[2]=index),peek[1]-=1,0===peek[1]?loopStack.pop():index=peek[0]);break;case"t":status.t=null===cmd.val?120:cmd.val;break;case"EOF":queue.push([queueTime,EOF])}}_.index=index,_.queueTime=queueTime},compile=function(mml){var def,re,m,cmd,i,imax,j,jmax,checked=new Array(mml.length),commands=[];for(i=0,imax=MMLCommands.length;imax>i;++i)for(def=MMLCommands[i],re=def.re;m=re.exec(mml);){if(!checked[m.index]){for(j=0,jmax=m[0].length;jmax>j;++j)checked[m.index+j]=!0;cmd=def.func?def.func(m):{name:m[0]},cmd&&(cmd.index=m.index,cmd.origin=m[0],commands.push(cmd))}for(;re.lastIndex<mml.length&&checked[re.lastIndex];)++re.lastIndex}return commands.sort(function(a,b){return a.index-b.index}),commands.push({name:"EOF"}),commands},MMLCommands=[{re:/@(\d*)/g,func:function(m){return{name:"@",val:m[1]||null}}},{re:/([cdefgab])([\-+]?)(\d*)(\.*)/g,func:function(m){return{name:"n",val:{c:0,d:2,e:4,f:5,g:7,a:9,b:11}[m[1]]+({"-":-1,"+":1}[m[2]]||0),len:""===m[3]?null:Math.min(0|m[3],64),dot:m[4].length}}},{re:/r(\d*)(\.*)/g,func:function(m){return{name:"r",len:""===m[1]?null:Math.max(1,Math.min(0|m[1],64)),dot:m[2].length}}},{re:/&/g},{re:/l(\d*)(\.*)/g,func:function(m){return{name:"l",val:""===m[1]?4:Math.min(0|m[1],64),dot:m[2].length}}},{re:/o([0-9])/g,func:function(m){return{name:"o",val:""===m[1]?4:0|m[1]}}},{re:/[<>]/g},{re:/v(\d*)/g,func:function(m){return{name:"v",val:""===m[1]?12:Math.min(0|m[1],15)}}},{re:/[()]/g},{re:/q([0-8])/g,func:function(m){return{name:"q",val:""===m[1]?6:Math.min(0|m[1],8)}}},{re:/\[/g},{re:/\|/g},{re:/\](\d*)/g,func:function(m){return{name:"]",count:0|m[1]||2}}},{re:/t(\d*)/g,func:function(m){return{name:"t",val:""===m[1]?null:Math.max(5,Math.min(0|m[1],300))}}},{re:/\$/g}];return MMLTrack}()}(timbre),function(T){"use strict";function MonoNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MonoNode),MonoNode.prototype.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},fn.register("mono",MonoNode)}(timbre),function(T){"use strict";function MulNode(_args){T.Object.call(this,2,_args)}var fn=T.fn;fn.extend(MulNode);var $=MulNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)cellL[j]*=tmpL[j],cellR[j]*=tmpR[j];else for(j=0;jmax>j;++j)cellL[j]=cellR[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)tmp*=nodes[i].process(tickID).cells[0][0];else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("*",MulNode)}(timbre),function(T){"use strict";function NDictNode(_args){T.Object.call(this,1,_args);var _=this._;_.defaultValue=0,_.index=0,_.dict={},_.ar=!1}var fn=T.fn;fn.extend(NDictNode);var $=NDictNode.prototype;Object.defineProperties($,{dict:{set:function(value){if("object"==typeof value)this._.dict=value;else if("function"==typeof value){for(var dict={},i=0;128>i;++i)dict[i]=value(i);this._.dict=dict}},get:function(){return this._.dict}},defaultValue:{set:function(value){"number"==typeof value&&(this._.defaultValue=value)},get:function(){return this._.defaultValue}},index:{set:function(value){"number"==typeof value&&(this._.index=value)},get:function(){return this._.index}}}),$.at=function(index){var _=this._;return(_.dict[0|index]||_.defaultValue)*_.mul+_.add},$.clear=function(){return this._.dict={},this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var index,value,i,len=this.nodes.length,dict=_.dict,defaultValue=_.defaultValue,mul=_.mul,add=_.add,imax=cell.length;if(_.ar&&len){for(fn.inputSignalAR(this),i=0;imax>i;++i)index=cell[i],index=0>index?index-.5|0:index+.5|0,cell[i]=(dict[index]||defaultValue)*mul+add;fn.outputSignalAR(this)}else for(index=this.nodes.length?fn.inputSignalKR(this):_.index,index=0>index?index-.5|0:index+.5|0,value=(dict[index]||defaultValue)*mul+add,i=0;imax>i;++i)cell[i]=value}return this},fn.register("ndict",NDictNode)}(timbre),function(T){"use strict";function NoiseNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(NoiseNode);var $=NoiseNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,x,mul=_.mul,add=_.add;if(_.ar)for(i=0,imax=cell.length;imax>i;++i)cell[i]=(2*Math.random()-1)*mul+add;else for(x=(2*Math.random()+1)*mul+add,i=0,imax=cell.length;imax>i;++i)cell[i]=x}return this},fn.register("noise",NoiseNode)}(timbre),function(T){"use strict";function OscNode(_args){T.Object.call(this,2,_args);var _=this._;_.freq=T(440),_.phase=T(0),_.osc=new Oscillator(_.samplerate),_.tmp=new fn.SignalArray(_.cellsize),_.osc.step=_.cellsize,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue,Oscillator=T.modules.Oscillator;fn.extend(OscNode);var oninit=function(){var _=this._;this.wave||(this.wave="sin"),_.plotData=_.osc.wave,_.plotLineWidth=2,_.plotCyclic=!0,_.plotBefore=plotBefore},$=OscNode.prototype;Object.defineProperties($,{wave:{set:function(value){this._.osc.setWave(value)},get:function(){return this._.osc.wave}},freq:{set:function(value){"string"==typeof value&&(value=timevalue(value),value=0>=value?0:1e3/value),this._.freq=T(value)},get:function(){return this._.freq}},phase:{set:function(value){this._.phase=T(value),this._.osc.feedback=!1},get:function(){return this._.phase}},fb:{set:function(value){this._.phase=T(value),this._.osc.feedback=!0},get:function(){return this._.phase}}}),$.clone=function(){var instance=fn.clone(this);return instance._.osc=this._.osc.clone(),instance._.freq=this._.freq,instance._.phase=this._.phase,instance},$.bang=function(){return this._.osc.reset(),this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;
var osc=_.osc,freq=_.freq.process(tickID).cells[0],phase=_.phase.process(tickID).cells[0];if(osc.frequency=freq[0],osc.phase=phase[0],_.ar){var tmp=_.tmp;for(_.freq.isAr?_.phase.isAr?osc.processWithFreqAndPhaseArray(tmp,freq,phase):osc.processWithFreqArray(tmp,freq):_.phase.isAr?osc.processWithPhaseArray(tmp,phase):osc.process(tmp),i=0;imax>i;++i)cellL[i]*=tmp[i],cellR[i]*=tmp[i]}else{var value=osc.next();for(i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value}fn.outputSignalAR(this)}return this};var plotBefore;"browser"===T.envtype&&(plotBefore=function(context,offset_x,offset_y,width,height){var y=(height>>1)+.5;context.strokeStyle="#ccc",context.lineWidth=1,context.beginPath(),context.moveTo(offset_x,y+offset_y),context.lineTo(offset_x+width,y+offset_y),context.stroke()}),fn.register("osc",OscNode),fn.register("sin",function(_args){return new OscNode(_args).set("wave","sin")}),fn.register("cos",function(_args){return new OscNode(_args).set("wave","cos")}),fn.register("pulse",function(_args){return new OscNode(_args).set("wave","pulse")}),fn.register("tri",function(_args){return new OscNode(_args).set("wave","tri")}),fn.register("saw",function(_args){return new OscNode(_args).set("wave","saw")}),fn.register("fami",function(_args){return new OscNode(_args).set("wave","fami")}),fn.register("konami",function(_args){return new OscNode(_args).set("wave","konami")}),fn.register("+sin",function(_args){return new OscNode(_args).set("wave","+sin").kr()}),fn.register("+pulse",function(_args){return new OscNode(_args).set("wave","+pulse").kr()}),fn.register("+tri",function(_args){return new OscNode(_args).set("wave","+tri").kr()}),fn.register("+saw",function(_args){return new OscNode(_args).set("wave","+saw").kr()}),fn.alias("square","pulse")}(timbre),function(T){"use strict";function PanNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.pos=T(0),_.panL=.5,_.panR=.5}var fn=T.fn;fn.extend(PanNode);var $=PanNode.prototype;Object.defineProperties($,{pos:{set:function(value){this._.pos=T(value)},get:function(){return this._.pos}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var pos=_.pos.process(tickID).cells[0][0];_.prevPos!==pos&&(_.panL=1-pos,_.panR=_.prevPos=pos);var i,j,tmp,nodes=this.nodes,cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cellL.length;if(imax){for(tmp=nodes[0].process(tickID).cells[0],j=0;jmax>j;++j)cellL[j]=cellR[j]=tmp[j];for(i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)cellL[j]=cellR[j]+=tmp[j];var panL=_.panL,panR=_.panR;for(j=0;jmax>j;++j)cellL[j]=cellL[j]*panL,cellR[j]=cellR[j]*panR}else cellL.set(fn.emptycell),cellR.set(fn.emptycell);fn.outputSignalAR(this)}return this},fn.register("pan",PanNode)}(timbre),function(T){"use strict";function ParamNode(_args){T.Object.call(this,2,_args);var _=this._;_.value=0,_.env=new EnvelopeValue(_.samplerate),_.env.step=_.cellsize,_.curve="lin",_.counter=0,_.ar=!1,_.onended=make_onended(this),this.on("ar",onar)}var fn=T.fn,timevalue=T.timevalue,Envelope=T.modules.Envelope,EnvelopeValue=T.modules.EnvelopeValue;fn.extend(ParamNode);var make_onended=function(self,lastValue){return function(){if("number"==typeof lastValue)for(var cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],value=self._.env.value,i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=value;self._.emit("ended")}},onar=function(value){this._.env.step=value?1:this._.cellsize},$=ParamNode.prototype;Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.env.value=value)},get:function(){return this._.env.value}}}),$.to=function(nextValue,time,curve){var _=this._,env=_.env;if("string"==typeof time?time=timevalue(time):"undefined"==typeof time&&(time=0),"undefined"==typeof curve)_.counter=env.setNext(nextValue,time,Envelope.CurveTypeLin),_.curve="lin";else{var _curve=Envelope.CurveTypeDict[curve];_.counter="undefined"==typeof _curve?env.setNext(nextValue,time,Envelope.CurveTypeCurve,curve):env.setNext(nextValue,time,_curve),_.curve=curve}return _.plotFlush=!0,this},$.setAt=function(nextValue,time){var _=this._;return this.to(_.env.value,time,"set"),_.atValue=nextValue,this},$.linTo=function(nextValue,time){return this.to(nextValue,time,"lin")},$.expTo=function(nextValue,time){return this.to(nextValue,time,"exp")},$.sinTo=function(nextValue,time){return this.to(nextValue,time,"sin")},$.welTo=function(nextValue,time){return this.to(nextValue,time,"wel")},$.sqrTo=function(nextValue,time){return this.to(nextValue,time,"sqr")},$.cubTo=function(nextValue,time){return this.to(nextValue,time,"cub")},$.cancel=function(){var _=this._;return _.counter=_.env.setNext(_.env.value,0,Envelope.CurveTypeSet),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,value,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize,env=_.env,counter=_.counter;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;if(0>=counter&&("set"===_.curve?env.setNext(_.atValue,0,Envelope.CurveTypeSet):env.setNext(env.value,0,Envelope.CurveTypeSet),fn.nextTick(_.onended),_.counter=1/0),_.ar){for(i=0;imax>i;++i)value=env.next(),cellL[i]*=value,cellR[i]*=value;_.counter-=_.cellsize}else{for(value=env.next(),i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value;_.counter-=1}fn.outputSignalAR(this),_.value=value}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var _=this._;if(_.plotFlush){var curve,i,imax,env=new EnvelopeValue(128),data=new Float32Array(128);if("set"===_.curve)for(i=100,imax=data.length;imax>i;++i)data[i]=1;else for(curve=Envelope.CurveTypeDict[_.curve],"undefined"==typeof curve?env.setNext(1,1e3,Envelope.CurveTypeCurve,_.curve):env.setNext(1,1e3,curve),i=0,imax=data.length;imax>i;++i)data[i]=env.next();_.plotData=data,_.plotRange=[0,1],_.plotFlush=null}return super_plot.call(this,opts)},fn.register("param",ParamNode)}(timbre),function(T){"use strict";function PhaserNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.freq=T("sin",{freq:1,add:1e3,mul:250}).kr(),_.Q=T(1),_.allpass=[],this.steps=2}var fn=T.fn,Biquad=T.modules.Biquad;fn.extend(PhaserNode);var $=PhaserNode.prototype;Object.defineProperties($,{freq:{set:function(value){this._.freq=value},get:function(){return this._.freq}},Q:{set:function(value){this._.Q=T(value)},get:function(){return this._.Q}},steps:{set:function(value){if("number"==typeof value){if(value|=0,2===value||4===value||8===value||12===value){var allpass=this._.allpass;if(allpass.length<value)for(var i=allpass.length;value>i;++i)allpass[i]=new Biquad(this._.samplerate),allpass[i].setType("allpass")}this._.steps=value}},get:function(){return this._.steps}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),!_.bypassed){var i,cellL=this.cells[1],cellR=this.cells[2],freq=_.freq.process(tickID).cells[0][0],Q=_.Q.process(tickID).cells[0][0],steps=_.steps;for(i=0;steps>i;i+=2)_.allpass[i].setParams(freq,Q,0),_.allpass[i].process(cellL,cellR),_.allpass[i+1].setParams(freq,Q,0),_.allpass[i+1].process(cellL,cellR)}fn.outputSignalAR(this)}return this},fn.register("phaser",PhaserNode)}(timbre),function(T){"use strict";function PinkNoiseNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);for(var whites=new Uint8Array(5),i=0;5>i;++i)whites[i]=(Math.random()*(1<<30)|0)%25;this._.whites=whites,this._.key=0}var MAX_KEY=31,fn=T.fn;fn.extend(PinkNoiseNode);var $=PinkNoiseNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,j,last_key,sum,diff,key=_.key,whites=_.whites,mul=_.mul,add=_.add;for(i=0,imax=cell.length;imax>i;++i){for(last_key=key++,key>MAX_KEY&&(key=0),diff=last_key^key,j=sum=0;5>j;++j)diff&1<<j&&(whites[j]=(Math.random()*(1<<30)|0)%25),sum+=whites[j];cell[i]=(.01666666*sum-1)*mul+add}_.key=key}return this},fn.register("pink",PinkNoiseNode)}(timbre),function(T){"use strict";function PluckNode(_args){T.Object.call(this,1,_args),this._.freq=440,this._.buffer=null,this._.index=0}var fn=T.fn;fn.extend(PluckNode);var $=PluckNode.prototype;Object.defineProperties($,{freq:{set:function(value){"number"==typeof value&&(0>value&&(value=0),this._.freq=value)},get:function(){return this._.freq}}}),$.bang=function(){for(var _=this._,freq=_.freq,size=_.samplerate/freq+.5|0,buffer=_.buffer=new fn.SignalArray(size),i=0;size>i;++i)buffer[i]=2*Math.random()-1;return _.index=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var buffer=_.buffer;if(buffer){var write,x,i,bufferLength=buffer.length,index=_.index,mul=_.mul,add=_.add,imax=cell.length;for(i=0;imax>i;++i)write=index,x=buffer[index++],index>=bufferLength&&(index=0),x=.5*(x+buffer[index]),buffer[write]=x,cell[i]=x*mul+add;_.index=index}}return this},fn.register("pluck",PluckNode)}(timbre),function(T){"use strict";function RecNode(_args){T.Object.call(this,1,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.timeout=5e3,_.status=STATUS_WAIT,_.writeIndex=0,_.writeIndexIncr=1,_.currentTime=0,_.currentTimeIncr=1e3/_.samplerate,_.onended=make_onended(this)}var fn=T.fn,timevalue=T.timevalue,STATUS_WAIT=0,STATUS_REC=1;fn.extend(RecNode);var make_onended=function(self){return function(){var _=self._,buffer=new fn.SignalArray(_.buffer.subarray(0,0|_.writeIndex));_.status=STATUS_WAIT,_.writeIndex=0,_.currentTime=0,_.emit("ended",{buffer:buffer,samplerate:_.samplerate})}},$=RecNode.prototype;Object.defineProperties($,{timeout:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(this._.timeout=value)},get:function(){return this._.timeout}},samplerate:{set:function(value){"number"==typeof value&&value>0&&value<=this._.samplerate&&(this._.samplerate=value)},get:function(){return this._.samplerate}},currentTime:{get:function(){return this._.currentTime}}}),$.start=function(){var len,_=this._;return _.status===STATUS_WAIT&&(len=.01*_.timeout*_.samplerate|0,(!_.buffer||_.buffer.length<len)&&(_.buffer=new fn.SignalArray(len)),_.writeIndex=0,_.writeIndexIncr=_.samplerate/T.samplerate,_.currentTime=0,_.status=STATUS_REC,_.emit("start"),this.listen()),this},$.stop=function(){var _=this._;return _.status===STATUS_REC&&(_.status=STATUS_WAIT,_.emit("stop"),fn.nextTick(_.onended),this.unlisten()),this},$.bang=function(){return this._.status===STATUS_WAIT?this.srart():this._.status===STATUS_REC&&this.stop(),this._.emit("bang"),this},$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),_.status===STATUS_REC){var i,imax=cell.length,buffer=_.buffer,timeout=_.timeout,writeIndex=_.writeIndex,writeIndexIncr=_.writeIndexIncr,currentTime=_.currentTime,currentTimeIncr=_.currentTimeIncr;for(i=0;imax>i;++i)buffer[0|writeIndex]=cell[i],writeIndex+=writeIndexIncr,currentTime+=currentTimeIncr,currentTime>=timeout&&fn.nextTick(_.onended);_.writeIndex=writeIndex,_.currentTime=currentTime}fn.outputSignalAR(this)}return this},fn.register("record",RecNode),fn.alias("rec","record")}(timbre),function(T){"use strict";function ReverbNode(_args){T.Object.call(this,2,_args),fn.fixAR(this),this._.reverb=new Reverb(this._.samplerate,this._.cellsize)}var fn=T.fn,Reverb=T.modules.Reverb;fn.extend(ReverbNode);var $=ReverbNode.prototype;Object.defineProperties($,{room:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.setRoomSize(value))},get:function(){return this._.reverb.roomsize}},damp:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.setDamp(value))},get:function(){return this._.reverb.damp}},mix:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.wet=value)},get:function(){return this._.reverb.wet}}}),$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,fn.inputSignalAR(this),_.bypassed||_.reverb.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)),this},fn.register("reverb",ReverbNode)}(timbre),function(T){"use strict";function ScheduleNode(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.queue=[],_.currentTime=0,_.maxRemain=1e3}var fn=T.fn,timevalue=T.timevalue;fn.extend(ScheduleNode);var $=ScheduleNode.prototype;Object.defineProperties($,{queue:{get:function(){return this._.queue}},remain:{get:function(){return this._.queue.length}},maxRemain:{set:function(value){"number"==typeof value&&value>0&&(this._.maxRemain=value)},get:function(){return this._.maxRemain}},isEmpty:{get:function(){return 0===this._.queue.length}},currentTime:{get:function(){return this._.currentTime}}}),$.sched=function(delta,item,args){return"string"==typeof delta&&(delta=timevalue(delta)),"number"==typeof delta&&this.schedAbs(this._.currentTime+delta,item,args),this},$.schedAbs=function(time,item,args){if("string"==typeof time&&(time=timevalue(time)),"number"==typeof time){var _=this._,queue=_.queue;if(queue.length>=_.maxRemain)return this;for(var i=queue.length;i--&&!(queue[i][0]<time););queue.splice(i+1,0,[time,T(item),args])}return this},$.advance=function(delta){return"string"==typeof delta&&(delta=timevalue(delta)),"number"==typeof delta&&(this._.currentTime+=delta),this},$.clear=function(){return this._.queue.splice(0),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var emit=null,queue=_.queue;if(queue.length)for(;queue[0][0]<_.currentTime;){var nextItem=_.queue.shift();if(nextItem[1].bang(nextItem[2]),emit="sched",0===queue.length){emit="empty";break}}_.currentTime+=fn.currentTimeIncr,emit&&_.emit(emit)}return this},fn.register("schedule",ScheduleNode),fn.alias("sched","schedule")}(timbre),function(T){"use strict";function ScopeNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.samples=0,_.writeIndex=0,_.plotFlush=!0,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue;fn.extend(ScopeNode);var oninit=function(){this._.buffer||(this.size=1024),this._.interval||(this.interval=1e3)},$=ScopeNode.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.buffer&&"number"==typeof value){var n=64>value?64:value>2048?2048:value;_.buffer=new fn.SignalArray(n),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},interval:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*_.samplerate/_.buffer.length,_.samplesIncr<1&&(_.samplesIncr=1)):_.reservedinterval=value)},get:function(){return this._.interval}}}),$.bang=function(){for(var _=this._,buffer=_.buffer,i=0,imax=buffer.length;imax>i;++i)buffer[i]=0;return _.samples=0,_.writeIndex=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var i,cell=this.cells[0],imax=_.cellsize,samples=_.samples,samplesIncr=_.samplesIncr,buffer=_.buffer,writeIndex=_.writeIndex,emit=!1,bufferlength=buffer.length;for(i=0;imax>i;++i)0>=samples&&(buffer[writeIndex++]=cell[i],writeIndex>=bufferlength&&(writeIndex=0),emit=_.plotFlush=!0,samples+=samplesIncr),--samples;_.samples=samples,_.writeIndex=writeIndex,emit&&this._.emit("data")}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var _=this._;if(_.plotFlush){for(var buffer=_.buffer,mask=buffer.length-1,data=new Float32Array(buffer.length),j=_.writeIndex,i=0,imax=buffer.length;imax>i;i++)data[i]=buffer[++j&mask];_.plotData=data,_.plotFlush=null}return super_plot.call(this,opts)},fn.register("scope",ScopeNode)}(timbre),function(T){"use strict";function ScriptProcessorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.numberOfInputs=0,_.numberOfOutputs=0,_.bufferSize=0,_.bufferMask=0,_.duration=0,_.inputBufferL=null,_.inputBufferR=null,_.outputBufferL=null,_.outputBufferR=null,_.onaudioprocess=null,_.index=0,this.once("init",oninit)}function AudioBuffer(self,buffers){this.samplerate=self._.samplerate,this.length=self._.bufferSize,this.duration=self._.duration,this.numberOfChannels=buffers.length,this.getChannelData=function(n){return buffers[n]}}function AudioProcessingEvent(self){var _=self._;this.node=self,this.playbackTime=T.currentTime,this.inputBuffer=2===_.numberOfInputs?new AudioBuffer(self,[_.inputBufferL,_.inputBufferR]):new AudioBuffer(self,[_.inputBufferL]),this.outputBuffer=2===_.numberOfOutputs?new AudioBuffer(self,[_.outputBufferL,_.outputBufferR]):new AudioBuffer(self,[_.outputBufferL])}var fn=T.fn;fn.extend(ScriptProcessorNode);var oninit=function(){var _=this._;0===_.numberOfInputs&&(this.numberOfInputs=1),0===_.numberOfOutputs&&(this.numberOfOutputs=1),0===_.bufferSize&&(this.bufferSize=1024)},$=ScriptProcessorNode.prototype;Object.defineProperties($,{numberOfInputs:{set:function(value){var _=this._;0===_.numberOfInputs&&(_.numberOfInputs=2===value?2:1)},get:function(){return this._.numberOfInputs}},numberOfOutputs:{set:function(value){var _=this._;0===_.numberOfOutputs&&(_.numberOfOutputs=2===value?2:1)},get:function(){return this._.numberOfOutputs}},bufferSize:{set:function(value){var _=this._;0===_.bufferSize&&-1!==[256,512,1024,2048,4096,8192,16384].indexOf(value)&&(_.bufferSize=value,_.bufferMask=value-1,_.duration=value/_.samplerate,_.inputBufferL=new fn.SignalArray(value),_.inputBufferR=new fn.SignalArray(value),_.outputBufferL=new fn.SignalArray(value),_.outputBufferR=new fn.SignalArray(value))},get:function(){return this._.bufferSize}},onaudioprocess:{set:function(value){"function"==typeof value&&(this._.onaudioprocess=value)},get:function(){return this._.onaudioprocess}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var buffer,cellsize=_.cellsize,bufferMask=_.bufferMask,begin=_.index,end=begin+cellsize,cellL=this.cells[1],cellR=this.cells[2];if(fn.inputSignalAR(this),2===_.numberOfInputs)_.inputBufferL.set(cellL,begin),_.inputBufferR.set(cellR,begin);else{buffer=_.inputBufferL;for(var i=0;cellsize>i;i++)buffer[begin+i]=.5*(cellL[i]+cellR[i])}cellL.set(_.outputBufferL.subarray(begin,end)),cellR.set(_.outputBufferR.subarray(begin,end)),_.index=end&bufferMask,0===_.index&&_.onaudioprocess&&(_.onaudioprocess(new AudioProcessingEvent(this)),1===_.numberOfOutputs&&_.outputBufferR.set(_.outputBufferL)),fn.outputSignalAR(this)}return this},fn.register("script",ScriptProcessorNode)}(timbre),function(T){"use strict";function SelectorNode(_args){T.Object.call(this,2,_args),this._.selected=0,this._.background=!1}var fn=T.fn;fn.extend(SelectorNode);var $=SelectorNode.prototype;Object.defineProperties($,{selected:{set:function(value){"number"==typeof value&&(this._.selected=value,this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell))},get:function(){return this._.selected}},background:{set:function(value){this._.background=!!value},get:function(){return this._.background}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,nodes=this.nodes,imax=nodes.length;if(_.background)for(i=0;imax>i;++i)nodes[i].process(tickID);var tmp=nodes[_.selected];tmp&&(_.background||tmp.process(tickID),this.cells[1].set(tmp.cells[1]),this.cells[2].set(tmp.cells[2])),fn.outputSignalAR(this)}return this},fn.register("selector",SelectorNode)}(timbre),function(T){"use strict";function SpectrumNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.status=WAIT_STATE,_.samples=0,_.samplesIncr=0,_.writeIndex=0,_.plotFlush=!0,_.plotRange=[0,32],_.plotBarStyle=!0,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue,FFT=T.modules.FFT,WAIT_STATE=0,EXEC_STATE=1;fn.extend(SpectrumNode);var oninit=function(){var _=this._;_.fft||(this.size=512),_.interval||(this.interval=500)},$=SpectrumNode.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.fft&&"number"==typeof value){var n=256>value?256:value>2048?2048:value;_.fft=new FFT(n),_.buffer=new fn.SignalArray(_.fft.length),_.freqs=new fn.SignalArray(_.fft.length>>1),_.reservedwindow&&(_.fft.setWindow(_.reservedwindow),_.reservedwindow=null),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},window:{set:function(value){this._.fft.setWindow(value)},get:function(){return this._.fft.windowName}},interval:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*_.samplerate,_.samplesIncr<_.buffer.length&&(_.samplesIncr=_.buffer.length,_.interval=1e3*_.samplesIncr/_.samplerate)):_.reservedinterval=value)},get:function(){return this._.interval}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}},real:{get:function(){return this._.fft.real}},imag:{get:function(){return this._.fft.imag}}}),$.bang=function(){return this._.samples=0,this._.writeIndex=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var i,emit,cell=this.cells[0],imax=cell.length,status=_.status,samples=_.samples,samplesIncr=_.samplesIncr,writeIndex=_.writeIndex,buffer=_.buffer,bufferLength=buffer.length;for(i=0;imax>i;++i)0>=samples&&status===WAIT_STATE&&(status=EXEC_STATE,writeIndex=0,samples+=samplesIncr),status===EXEC_STATE&&(buffer[writeIndex++]=cell[i],writeIndex>=bufferLength&&(_.fft.forward(buffer),emit=_.plotFlush=!0,status=WAIT_STATE)),--samples;_.samples=samples,_.status=status,_.writeIndex=writeIndex,emit&&this._.emit("data")}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),super_plot.call(this,opts)},fn.register("spectrum",SpectrumNode)}(timbre),function(T){"use strict";function SubtractNode(_args){T.Object.call(this,2,_args),this._.ar=!1}var fn=T.fn;fn.extend(SubtractNode);var $=SubtractNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)cellL[j]-=tmpL[j],cellR[j]-=tmpR[j];else for(j=0;jmax>j;++j)cellL[j]=cellR[i]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)tmp-=nodes[i].process(tickID).cells[0][0];else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("-",SubtractNode)}(timbre),function(T){"use strict";function SynthDefNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.poly=4,_.genList=[],_.genDict={},_.synthdef=null,_.remGen=make_remGen(this),_.onended=fn.make_onended(this)}var fn=T.fn;fn.extend(SynthDefNode);var $=SynthDefNode.prototype;Object.defineProperties($,{def:{set:function(value){"function"==typeof value&&(this._.synthdef=value)},get:function(){return this._.synthdef}},poly:{set:function(value){"number"==typeof value&&value>0&&64>=value&&(this._.poly=value)},get:function(){return this._.poly}}});var make_doneAction=function(self,opts){return function(){self._.remGen(opts.gen)}},make_remGen=function(self){return function(gen){var _=self._,i=_.genList.indexOf(gen);-1!==i&&_.genList.splice(i,1),"undefined"!=typeof gen.noteNum&&(_.genDict[gen.noteNum]=null)}},noteOn=function(noteNum,freq,velocity,_opts){velocity|=0,0>=velocity?this.noteOff(this,noteNum):velocity>127&&(velocity=127);var _=this._,list=_.genList,dict=_.genDict,gen=dict[noteNum];gen&&_.remGen(gen);var opts={freq:freq,noteNum:noteNum,velocity:velocity,mul:.0078125*velocity};if(_opts)for(var key in _opts)opts[key]=_opts[key];opts.doneAction=make_doneAction(this,opts),gen=_.synthdef.call(this,opts),gen instanceof T.Object&&(gen.noteNum=noteNum,list.push(gen),dict[noteNum]=opts.gen=gen,this.playbackState=fn.PLAYING_STATE,list.length>_.poly&&_.remGen(list[0]))},midicps=function(){for(var table=new Float32Array(128),i=0;128>i;++i)table[i]=440*Math.pow(2,1*(i-69)/12);return table}(),cpsmidi=function(cps){return cps>0?Math.log(1*cps/440)*Math.LOG2E*12+69:0};$.noteOn=function(noteNum,velocity,_opts){var freq=midicps[noteNum]||440*Math.pow(2,(noteNum-69)/12);return noteOn.call(this,noteNum+.5|0,freq,velocity,_opts),this},$.noteOff=function(noteNum){var gen=this._.genDict[noteNum];return gen&&gen.release&&gen.release(),this},$.noteOnWithFreq=function(freq,velocity,_opts){var noteNum=cpsmidi(freq);return noteOn.call(this,noteNum+.5|0,freq,velocity,_opts),this},$.noteOffWithFreq=function(freq){var noteNum=cpsmidi(freq);return this.noteOff(noteNum+.5|0)},$.allNoteOff=function(){for(var list=this._.genList,i=0,imax=list.length;imax>i;++i)list[i].release&&list[i].release()},$.allSoundOff=function(){for(var _=this._,list=_.genList,dict=_.genDict;list.length;)delete dict[list.shift().noteNum]},$.synth=function(_opts){var gen,_=this._,list=_.genList,opts={};if(_opts)for(var key in _opts)opts[key]=_opts[key];return opts.doneAction=make_doneAction(this,opts),gen=_.synthdef.call(this,opts),gen instanceof T.Object&&(list.push(gen),opts.gen=gen,this.playbackState=fn.PLAYING_STATE,list.length>_.poly&&_.remGen(list[0])),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){if(this.tickID=tickID,this.playbackState===fn.PLAYING_STATE){var gen,i,imax,j,tmpL,tmpR,list=_.genList,cellL=this.cells[1],cellR=this.cells[2],jmax=cell.length;if(list.length)for(gen=list[0],gen.process(tickID),cellL.set(gen.cells[1]),cellR.set(gen.cells[2]),i=1,imax=list.length;imax>i;++i)for(gen=list[i],gen.process(tickID),tmpL=gen.cells[1],tmpR=gen.cells[2],j=0;jmax>j;++j)cellL[j]+=tmpL[j],cellR[j]+=tmpR[j];else fn.nextTick(_.onended)}fn.outputSignalAR(this)}return this},fn.register("SynthDef",SynthDefNode);var env_desc={set:function(value){fn.isDictionary(value)?"string"==typeof value.type&&(this._.env=value):value instanceof T.Object&&(this._.env=value)},get:function(){return this._.env}};fn.register("OscGen",function(){var osc_desc={set:function(value){value instanceof T.Object&&(this._.osc=value)},get:function(){return this._.osc}},wave_desc={set:function(value){"string"==typeof value&&(this._.wave=value)},get:function(){return this._.wave}},synthdef=function(opts){var synth,osc,env,envtype,_=this._;return osc=_.osc||null,env=_.env||{},envtype=env.type||"perc",osc instanceof T.Object&&"function"==typeof osc.clone&&(osc=osc.clone()),osc||(osc=T("osc",{wave:_.wave})),osc.freq=opts.freq,osc.mul=osc.mul*opts.velocity/128,synth=osc,env instanceof T.Object?"function"==typeof env.clone&&(synth=env.clone().append(synth)):synth=T(envtype,env,synth),synth.on("ended",opts.doneAction).bang(),synth};return function(_args){var instance=new SynthDefNode(_args);return instance._.wave="sin",Object.defineProperties(instance,{env:env_desc,osc:osc_desc,wave:wave_desc}),instance.def=synthdef,instance}}()),fn.register("PluckGen",function(){var synthdef=function(opts){var synth,env,envtype,_=this._;return env=_.env||{},envtype=env.type||"perc",synth=T("pluck",{freq:opts.freq,mul:opts.velocity/128}).bang(),env instanceof T.Object?"function"==typeof env.clone&&(synth=env.clone().append(synth)):synth=T(envtype,env,synth),synth.on("ended",opts.doneAction).bang(),synth};return function(_args){var instance=new SynthDefNode(_args);return Object.defineProperties(instance,{env:env_desc}),instance.def=synthdef,instance}}())}(timbre),function(T){"use strict";function ScissorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.isLooped=!1,_.onended=fn.make_onended(this,0)}var fn=T.fn,Scissor=T.modules.Scissor,Tape=Scissor.Tape,TapeStream=Scissor.TapeStream,isSignalArray=fn.isSignalArray;fn.extend(ScissorNode);var $=ScissorNode.prototype;Object.defineProperties($,{tape:{set:function(tape){tape instanceof Tape?(this.playbackState=fn.PLAYING_STATE,this._.tape=tape,this._.tapeStream=new TapeStream(tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped):(tape instanceof T.Object&&tape.buffer&&(tape=tape.buffer),"object"==typeof tape&&Array.isArray(tape.buffer)&&isSignalArray(tape.buffer[0])&&(this.playbackState=fn.PLAYING_STATE,this._.tape=new Scissor(tape),this._.tapeStream=new TapeStream(this._.tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped))},get:function(){return this._.tape}},isLooped:{get:function(){return this._.isLooped}},buffer:{get:function(){return this._.tape?this._.tape.getBuffer():void 0}}}),$.loop=function(value){return this._.isLooped=!!value,this._.tapeStream&&(this._.tapeStream.isLooped=this._.isLooped),this},$.bang=function(){return this.playbackState=fn.PLAYING_STATE,this._.tapeStream&&this._.tapeStream.reset(),this._.emit("bang"),this},$.getBuffer=function(){return this._.tape?this._.tape.getBuffer():void 0},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var tapeStream=_.tapeStream;if(tapeStream){var cellL=this.cells[1],cellR=this.cells[2],tmp=tapeStream.fetch(cellL.length);cellL.set(tmp[0]),cellR.set(tmp[1]),this.playbackState===fn.PLAYING_STATE&&tapeStream.isEnded&&fn.nextTick(_.onended)}fn.outputSignalAR(this)}return this},fn.register("tape",ScissorNode)}(timbre),function(T){"use strict";function TaskNode(_args){T.Object.call(this,1,_args),fn.timer(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.task=[],_.i=0,_.j=0,_.imax=0,_.jmax=0,_.wait=0,_.count=0,_.args={},_.doNum=1,_.initFunc=fn.nop,_.onended=make_onended(this),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue,FunctionWrapper=T(function(){}).constructor;fn.extend(TaskNode);var onstart=function(){var args,_=this._;this.playbackState=fn.PLAYING_STATE,_.task=this.nodes.map(function(x){return x instanceof FunctionWrapper?x.func:!1}).filter(function(x){return!!x}),_.i=_.j=0,_.imax=_.doNum,_.jmax=_.task.length,args=_.initFunc(),fn.isDictionary(args)||(args={param:args}),_.args=args},make_onended=function(self){return function(){self.playbackState=fn.FINISHED_STATE;var _=self._,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],lastValue=_.args;if("number"==typeof lastValue)for(var i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=lastValue;_.emit("ended",_.args)}},$=TaskNode.prototype;Object.defineProperties($,{"do":{set:function(value){"number"==typeof value&&value>0&&(this._.doNum=1/0===value?1/0:0|value)},get:function(){return this._.doNum}},init:{set:function(value){"function"==typeof value&&(this._.initFunc=value)},get:function(){return this._.initFunc}}}),$.bang=function(){var _=this._;return _.count=0,_.emit("bang"),this},$.wait=function(time){return"string"==typeof time&&(time=timevalue(time)),"number"==typeof time&&time>0&&(this._.count+=this._.samplerate*time*.001|0),this},$.process=function(tickID){var func,cell=this.cells[0],_=this._;if(this.tickID!==tickID&&(this.tickID=tickID,_.i<_.imax)){for(;_.count<=0;){if(_.j>=_.jmax){if(++_.i,_.i>=_.imax){fn.nextTick(_.onended);break}_.j=0}func=_.task[_.j++],func&&func.call(this,_.i,_.args)}_.count-=cell.length}return this},fn.register("task",TaskNode)}(timbre),function(T){"use strict";function TimeoutNode(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.currentTime=0,_.samplesMax=0,_.samples=0,_.onended=fn.make_onended(this),this.once("init",oninit),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue;fn.extend(TimeoutNode);var oninit=function(){this._.timeout||(this.timeout=1e3)
},onstart=function(){this.playbackState=fn.PLAYING_STATE};Object.defineProperty(onstart,"unremovable",{value:!0,writable:!1});var $=TimeoutNode.prototype;Object.defineProperties($,{timeout:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this.playbackState=fn.PLAYING_STATE,_.timeout=value,_.samplesMax=.001*_.samplerate*value|0,_.samples=_.samplesMax)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),$.bang=function(){var _=this._;return this.playbackState=fn.PLAYING_STATE,_.samples=_.samplesMax,_.currentTime=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){if(this.tickID=tickID,_.samples>0&&(_.samples-=cell.length),_.samples<=0){for(var nodes=this.nodes,i=0,imax=nodes.length;imax>i;++i)nodes[i].bang();fn.nextTick(_.onended)}_.currentTime+=fn.currentTimeIncr}return this},fn.register("timeout",TimeoutNode)}(timbre),function(T){"use strict";function WaveShaperNode(_args){T.Object.call(this,1,_args),fn.fixAR(this),this._.curve=null}var fn=T.fn;fn.extend(WaveShaperNode);var $=WaveShaperNode.prototype;Object.defineProperties($,{curve:{set:function(value){fn.isSignalArray(value)&&(this._.curve=value)},get:function(){return this._.curve}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),_.curve){var x,i,cell=this.cells[0],curve=_.curve,len=curve.length,imax=_.cellsize;for(i=0;imax>i;++i)x=.5*(cell[i]+1)*len+.5|0,0>x?x=0:x>=len-1&&(x=len-1),cell[i]=curve[x]}fn.outputSignalAR(this)}return this},fn.register("waveshaper",WaveShaperNode)}(timbre),function(T){"use strict";function ZMapNode(_args){T.Object.call(this,1,_args);var _=this._;_.inMin=0,_.inMax=1,_.outMin=0,_.outMax=1,_.ar=!1,this.once("init",oninit)}var fn=T.fn;fn.extend(ZMapNode);var oninit=function(){this._.warp||(this.warp="linlin")},$=ZMapNode.prototype;Object.defineProperties($,{inMin:{set:function(value){"number"==typeof value&&(this._.inMin=value)},get:function(){return this._.inMin}},inMax:{set:function(value){"number"==typeof value&&(this._.inMax=value)},get:function(){return this._.inMax}},outMin:{set:function(value){"number"==typeof value&&(this._.outMin=value)},get:function(){return this._.outMin}},outMax:{set:function(value){"number"==typeof value&&(this._.outMax=value)},get:function(){return this._.outMax}},warp:{set:function(value){if("string"==typeof value){var f=WarpFunctions[value];f&&(this._.warp=f,this._.warpName=value)}},get:function(){return this._.warpName}}}),$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){this.tickID=tickID;var i,inMin=_.inMin,inMax=_.inMax,outMin=_.outMin,outMax=_.outMax,warp=_.warp,len=this.nodes.length,mul=_.mul,add=_.add,imax=cell.length;if(_.ar&&len){for(fn.inputSignalAR(this),i=0;imax>i;++i)cell[i]=warp(cell[i],inMin,inMax,outMin,outMax)*mul+add;fn.outputSignalAR(this)}else{var input=this.nodes.length?fn.inputSignalKR(this):0,value=warp(input,inMin,inMax,outMin,outMax)*mul+add;for(i=0;imax>i;++i)cell[i]=value}}return this};var WarpFunctions={linlin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:inMax===inMin?outMin:(x-inMin)/(inMax-inMin)*(outMax-outMin)+outMin},linexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===outMin?0:inMax===inMin?outMax:Math.pow(outMax/outMin,(x-inMin)/(inMax-inMin))*outMin},explin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin?outMax:Math.log(x/inMin)/Math.log(inMax/inMin)*(outMax-outMin)+outMin},expexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin||0===outMin?0:Math.pow(outMax/outMin,Math.log(x/inMin)/Math.log(inMax/inMin))*outMin}};fn.register("zmap",ZMapNode)}(timbre),!function(undefined){"use strict";function setupTypedArray(){function ArrayBuffer(_){for(var shift,a=new Array(_.byteLength),bytes=_.BYTES_PER_ELEMENT,i=0,imax=a.length;imax>i;++i)shift=i%bytes*8,a[i]=(_[i/bytes|0]&255<<shift)>>>shift;return a.__view=_,a}function TypedArray(klass,arg,offset,length){var a,b,bytes,i,imax;if(Array.isArray(arg))if(arg.__view)if("undefined"==typeof offset&&(offset=0),"undefined"==typeof length&&(length=arg.length-offset),bytes=klass.bytes,klass.type===floating)a=arg.__view.slice(offset/bytes|0,(offset+length)/bytes|0);else{for(b=arg.slice(offset,offset+length),a=new Array(b.length/bytes|0),i=0,imax=a.length;imax>i;++i)a[i]=0;for(i=0,imax=b.length;imax>i;++i)a[i/bytes|0]+=(255&b[i])<<i%bytes*8}else a=arg.slice();else a="number"==typeof arg&&arg>0?new Array(0|arg):[];if(klass.type!==floating)for(i=0,imax=a.length;imax>i;++i)a[i]=65535&(+a[i]||0);else for(i=0,imax=a.length;imax>i;++i)a[i]=a[i]||0;if(klass.type===signed)for(i=0,imax=a.length;imax>i;++i)a[i]&1<<8*bytes-1&&(a[i]-=1<<8*bytes);return a.__klass=klass,a.constructor=window[klass.name],a.set=set,a.subarray=subarray,a.BYTES_PER_ELEMENT=klass.bytes,a.byteLength=klass.bytes*a.length,a.byteOffset=offset||0,Object.defineProperty(a,"buffer",{get:function(){return new ArrayBuffer(this)}}),a}var unsigned=0,signed=1,floating=2,set=function(array,offset){"undefined"==typeof offset&&(offset=0);var i,imax=Math.min(this.length-offset,array.length);for(i=0;imax>i;++i)this[offset+i]=array[i]},subarray=function(begin,end){return"undefined"==typeof end&&(end=this.length),new this.constructor(this.slice(begin,end))};[["Int8Array",1,signed],["Uint8Array",1,unsigned],["Int16Array",2,signed],["Uint16Array",2,unsigned],["Int32Array",4,signed],["Uint32Array",4,unsigned],["Float32Array",4,floating],["Float64Array",8,floating]].forEach(function(_params){var name=_params[0],params={bytes:_params[1],type:_params[2],name:name};window[name]=function(arg,offset,length){return TypedArray.call(this,params,arg,offset,length)}})}"undefined"==typeof Float32Array&&setupTypedArray();var timbre=function(){return T.apply(null,arguments)},slice=Array.prototype.slice,FINISHED_STATE=0,PLAYING_STATE=1,UNSCHEDULED_STATE=2,SCHEDULED_STATE=3,ACCEPT_SAMPLERATES=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3],ACCEPT_CELLSIZES=[32,64,128,256],_ver="13.08.03",_sys=null,_constructors={},_factories={},_envtype="undefined"!=typeof module&&module.exports?"node":"undefined"!=typeof window?"browser":"unknown",_envmobile="browser"===_envtype&&/(iPhone|iPad|iPod|Android)/i.test(navigator.userAgent),_f64mode=!1,_bpm=120,T=function(){var t,m,args=slice.call(arguments),key=args[0];switch(typeof key){case"string":_constructors[key]?t=new _constructors[key](args.slice(1)):_factories[key]?t=_factories[key](args.slice(1)):(m=/^(.+?)(?:\.(ar|kr))?$/.exec(key),m&&(key=m[1],_constructors[key]?t=new _constructors[key](args.slice(1)):_factories[key]&&(t=_factories[key](args.slice(1))),t&&m[2]&&t[m[2]]()));break;case"number":t=new NumberWrapper(args);break;case"boolean":t=new BooleanWrapper(args);break;case"function":t=new FunctionWrapper(args);break;case"object":if(null!==key){if(key instanceof TimbreObject)return key;if(key.context instanceof TimbreObject)return key.context;isDictionary(key)?t=new ObjectWrapper(args):isArray(key)&&(t=new ArrayWrapper(args))}}t===undefined&&(t=new AddNode(args.slice(1)),console.warn('T("'+key+'") is not defined.'));var _=t._;return _.originkey=key,_.meta=__buildMetaData(t),_.emit("init"),t},__buildMetaData=function(instance){for(var names,desc,meta=instance._.meta,p=instance;null!==p&&p.constructor!==Object;){names=Object.getOwnPropertyNames(p);for(var i=0,imax=names.length;imax>i;++i)meta[names[i]]||(/^(constructor$|process$|_)/.test(names[i])?meta[names[i]]="ignore":(desc=Object.getOwnPropertyDescriptor(p,names[i]),"function"==typeof desc.value?meta[names[i]]="function":(desc.get||desc.set)&&(meta[names[i]]="property")));p=Object.getPrototypeOf(p)}return meta};Object.defineProperties(timbre,{version:{value:_ver},envtype:{value:_envtype},envmobile:{value:_envmobile},env:{get:function(){return _sys.impl.env}},samplerate:{get:function(){return _sys.samplerate}},channels:{get:function(){return _sys.channels}},cellsize:{get:function(){return _sys.cellsize}},currentTime:{get:function(){return _sys.currentTime}},isPlaying:{get:function(){return _sys.status===PLAYING_STATE}},isRecording:{get:function(){return _sys.status===SCHEDULED_STATE}},amp:{set:function(value){"number"==typeof value&&(_sys.amp=value)},get:function(){return _sys.amp}},bpm:{set:function(value){"number"==typeof value&&value>=5&&300>=value&&(_bpm=value)},get:function(){return _bpm}}}),timbre.bind=function(Klass,opts){return _sys.bind(Klass,opts),timbre},timbre.setup=function(opts){return _sys.setup(opts),timbre},timbre.play=function(){return _sys.play(),timbre},timbre.pause=function(){return _sys.pause(),timbre},timbre.reset=function(){return _sys.reset(),_sys.events.emit("reset"),timbre},timbre.on=timbre.addListener=function(type,listener){return _sys.on(type,listener),timbre},timbre.once=function(type,listener){return _sys.once(type,listener),timbre},timbre.off=timbre.removeListener=function(type,listener){return _sys.off(type,listener),timbre},timbre.removeAllListeners=function(type){return _sys.removeAllListeners(type),timbre},timbre.listeners=function(type){return _sys.listeners(type)},timbre.rec=function(){return _sys.rec.apply(_sys,arguments)},timbre.timevalue=function(){var getbpm=function(str){var m,bpm=_bpm;return(m=/^bpm(\d+(?:\.\d+)?)/i.exec(str))&&(bpm=Math.max(5,Math.min(300,+(m[1]||0)))),bpm};return function(str){var m,ms,x;if(m=/^(\d+(?:\.\d+)?)Hz$/i.exec(str))return 0===+m[1]?0:1e3/+m[1];if(m=/L(\d+)?(\.*)$/i.exec(str))return ms=60/getbpm(str)*(4/(m[1]||4))*1e3,ms*=[1,1.5,1.75,1.875][(m[2]||"").length]||1;if(m=/^(\d+(?:\.\d+)?|\.(?:\d+))(min|sec|m)s?$/i.exec(str))switch(m[2]){case"min":return 60*+(m[1]||0)*1e3;case"sec":return 1e3*+(m[1]||0);case"m":return+(m[1]||0)}return(m=/^(?:([0-5]?[0-9]):)?(?:([0-5]?[0-9]):)(?:([0-5]?[0-9]))(?:\.([0-9]{1,3}))?$/.exec(str))?(x=3600*(m[1]||0)+60*(m[2]||0)+(m[3]||0),x=1e3*x+(0|((m[4]||"")+"00").substr(0,3))):(m=/(\d+)\.(\d+)\.(\d+)$/i.exec(str))?(x=480*(4*m[1]+ +m[2])+ +m[3],60/getbpm(str)*(x/480)*1e3):(m=/(\d+)ticks$/i.exec(str))?60/getbpm(str)*(m[1]/480)*1e3:(m=/^(\d+)samples(?:\/(\d+)Hz)?$/i.exec(str))?1e3*m[1]/(m[2]||timbre.samplerate):0}}();var fn=timbre.fn={SignalArray:Float32Array,currentTimeIncr:0,emptycell:null,FINISHED_STATE:FINISHED_STATE,PLAYING_STATE:PLAYING_STATE,UNSCHEDULED_STATE:UNSCHEDULED_STATE,SCHEDULED_STATE:SCHEDULED_STATE},isArray=fn.isArray=Array.isArray,isDictionary=fn.isDictionary=function(object){return"object"==typeof object&&object.constructor===Object};fn.nop=function(){return this},fn.isSignalArray=function(obj){return obj instanceof fn.SignalArray?!0:Array.isArray(obj)&&obj.__klass&&2===obj.__klass.type?!0:!1},fn.extend=function(child,parent){function ctor(){this.constructor=child}parent=parent||TimbreObject;for(var key in parent)parent.hasOwnProperty(key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},fn.constructorof=function(ctor,Klass){for(var f=ctor&&ctor.prototype;f;){if(f===Klass.prototype)return!0;f=Object.getPrototypeOf(f)}return!1},fn.register=function(key,ctor){fn.constructorof(ctor,TimbreObject)?_constructors[key]=ctor:_factories[key]=ctor},fn.alias=function(key,alias){_constructors[alias]?_constructors[key]=_constructors[alias]:_factories[alias]&&(_factories[key]=_factories[alias])},fn.getClass=function(key){return _constructors[key]},fn.pointer=function(src,offset,length){return offset=src.byteOffset+offset*src.constructor.BYTES_PER_ELEMENT,"number"==typeof length?new src.constructor(src.buffer,offset,length):new src.constructor(src.buffer,offset)},fn.nextTick=function(func){return _sys.nextTick(func),timbre},fn.fixAR=function(self){self._.ar=!0,self._.aronly=!0},fn.fixKR=function(self){self._.ar=!1,self._.kronly=!0},fn.changeWithValue=function(){var _=this._,x=_.value*_.mul+_.add;isNaN(x)&&(x=0);for(var cell=this.cells[0],i=0,imax=cell.length;imax>i;++i)cell[i]=x},fn.changeWithValue.unremovable=!0,fn.clone=function(src){var new_instance=new src.constructor([]);return new_instance._.ar=src._.ar,new_instance._.mul=src._.mul,new_instance._.add=src._.add,new_instance._.bypassed=src._.bypassed,new_instance},fn.timer=function(){var make_onstart=function(self){return function(){-1===_sys.timers.indexOf(self)&&(_sys.timers.push(self),_sys.events.emit("addObject"),self._.emit("start"),fn.buddies_start(self))}},make_onstop=function(self){return function(){var i=_sys.timers.indexOf(self);-1!==i&&(_sys.timers.splice(i,1),self._.emit("stop"),_sys.events.emit("removeObject"),fn.buddies_stop(self))}};return function(self){var onstart=make_onstart(self),onstop=make_onstop(self);return self.nodeType=TimbreObject.TIMER,self.start=function(){return _sys.nextTick(onstart),self},self.stop=function(){return _sys.nextTick(onstop),self},self}}(),fn.listener=function(){var make_onlisten=function(self){return function(){-1===_sys.listeners.indexOf(self)&&(_sys.listeners.push(self),_sys.events.emit("addObject"),self._.emit("listen"),fn.buddies_start(self))}},make_onunlisten=function(self){return function(){var i=_sys.listeners.indexOf(self);-1!==i&&(_sys.listeners.splice(i,1),self._.emit("unlisten"),_sys.events.emit("removeObject"),fn.buddies_stop(self))}};return function(self){var onlisten=make_onlisten(self),onunlisten=make_onunlisten(self);return self.nodeType=TimbreObject.LISTENER,self.listen=function(){return arguments.length&&self.append.apply(self,arguments),self.nodes.length&&_sys.nextTick(onlisten),self},self.unlisten=function(){return arguments.length&&self.remove.apply(self,arguments),self.nodes.length||_sys.nextTick(onunlisten),self},self}}(),fn.make_onended=function(self,lastValue){return function(){if(self.playbackState=FINISHED_STATE,"number"==typeof lastValue)for(var cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=lastValue;self._.emit("ended")}},fn.inputSignalAR=function(self){var i,j,not_clear,tmp,tmpL,tmpR,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],nodes=self.nodes,imax=nodes.length,jmax=cell.length,tickID=self.tickID;if(2===self.numChannels){if(not_clear=!0,0!==imax){for(i=0;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE){nodes[i].process(tickID),cellL.set(nodes[i].cells[1]),cellR.set(nodes[i].cells[2]),not_clear=!1,++i;break}for(;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=jmax;j;)j-=8,cellL[j]+=tmpL[j],cellR[j]+=tmpR[j],cellL[j+1]+=tmpL[j+1],cellR[j+1]+=tmpR[j+1],cellL[j+2]+=tmpL[j+2],cellR[j+2]+=tmpR[j+2],cellL[j+3]+=tmpL[j+3],cellR[j+3]+=tmpR[j+3],cellL[j+4]+=tmpL[j+4],cellR[j+4]+=tmpR[j+4],cellL[j+5]+=tmpL[j+5],cellR[j+5]+=tmpR[j+5],cellL[j+6]+=tmpL[j+6],cellR[j+6]+=tmpR[j+6],cellL[j+7]+=tmpL[j+7],cellR[j+7]+=tmpR[j+7]}not_clear&&(cellL.set(fn.emptycell),cellR.set(fn.emptycell))}else{if(not_clear=!0,0!==imax){for(i=0;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE){nodes[i].process(tickID),cell.set(nodes[i].cells[0]),not_clear=!1,++i;break}for(;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE)for(tmp=nodes[i].process(tickID).cells[0],j=jmax;j;)j-=8,cell[j]+=tmp[j],cell[j+1]+=tmp[j+1],cell[j+2]+=tmp[j+2],cell[j+3]+=tmp[j+3],cell[j+4]+=tmp[j+4],cell[j+5]+=tmp[j+5],cell[j+6]+=tmp[j+6],cell[j+7]+=tmp[j+7]}not_clear&&cell.set(fn.emptycell)}},fn.inputSignalKR=function(self){var i,nodes=self.nodes,imax=nodes.length,tickID=self.tickID,tmp=0;for(i=0;imax>i;++i)nodes[i].playbackState===PLAYING_STATE&&(tmp+=nodes[i].process(tickID).cells[0][0]);return tmp},fn.outputSignalAR=function(self){var i,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],mul=self._.mul,add=self._.add;if(2===self.numChannels)for(i=cell.length;i;)i-=8,cellL[i]=cellL[i]*mul+add,cellR[i]=cellR[i]*mul+add,cellL[i+1]=cellL[i+1]*mul+add,cellR[i+1]=cellR[i+1]*mul+add,cellL[i+2]=cellL[i+2]*mul+add,cellR[i+2]=cellR[i+2]*mul+add,cellL[i+3]=cellL[i+3]*mul+add,cellR[i+3]=cellR[i+3]*mul+add,cellL[i+4]=cellL[i+4]*mul+add,cellR[i+4]=cellR[i+4]*mul+add,cellL[i+5]=cellL[i+5]*mul+add,cellR[i+5]=cellR[i+5]*mul+add,cellL[i+6]=cellL[i+6]*mul+add,cellR[i+6]=cellR[i+6]*mul+add,cellL[i+7]=cellL[i+7]*mul+add,cellR[i+7]=cellR[i+7]*mul+add,cell[i]=.5*(cellL[i]+cellR[i]),cell[i+1]=.5*(cellL[i+1]+cellR[i+1]),cell[i+2]=.5*(cellL[i+2]+cellR[i+2]),cell[i+3]=.5*(cellL[i+3]+cellR[i+3]),cell[i+4]=.5*(cellL[i+4]+cellR[i+4]),cell[i+5]=.5*(cellL[i+5]+cellR[i+5]),cell[i+6]=.5*(cellL[i+6]+cellR[i+6]),cell[i+7]=.5*(cellL[i+7]+cellR[i+7]);else if(1!==mul||0!==add)for(i=cell.length;i;)i-=8,cell[i]=cell[i]*mul+add,cell[i+1]=cell[i+1]*mul+add,cell[i+2]=cell[i+2]*mul+add,cell[i+3]=cell[i+3]*mul+add,cell[i+4]=cell[i+4]*mul+add,cell[i+5]=cell[i+5]*mul+add,cell[i+6]=cell[i+6]*mul+add,cell[i+7]=cell[i+7]*mul+add},fn.outputSignalKR=function(self){var i,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],mul=self._.mul,add=self._.add,value=cell[0]*mul+add;if(2===self.numChannels)for(i=cell.length;i;)i-=8,cell[i]=cell[i+1]=cell[i+2]=cell[i+3]=cell[i+4]=cell[i+5]=cell[i+6]=cell[i+7]=cellL[i]=cellL[i+1]=cellL[i+2]=cellL[i+3]=cellL[i+4]=cellL[i+5]=cellL[i+6]=cellL[i+7]=cellR[i]=cellR[i+1]=cellR[i+2]=cellR[i+3]=cellR[i+4]=cellR[i+5]=cellR[i+6]=cellR[i+7]=value;else for(i=cell.length;i;)i-=8,cell[i]=cell[i+1]=cell[i+2]=cell[i+3]=cell[i+4]=cell[i+5]=cell[i+6]=cell[i+7]=value},fn.buddies_start=function(self){var node,i,imax,buddies=self._.buddies;for(i=0,imax=buddies.length;imax>i;++i)switch(node=buddies[i],node.nodeType){case TimbreObject.DSP:node.play();break;case TimbreObject.TIMER:node.start();break;case TimbreObject.LISTENER:node.listen()}},fn.buddies_stop=function(self){var node,i,imax,buddies=self._.buddies;for(i=0,imax=buddies.length;imax>i;++i)switch(node=buddies[i],node.nodeType){case TimbreObject.DSP:node.pause();break;case TimbreObject.TIMER:node.stop();break;case TimbreObject.LISTENER:node.unlisten()}},fn.fix_iOS6_1_problem=function(flag){_sys.fix_iOS6_1_problem(flag)};var modules=timbre.modules={},EventEmitter=modules.EventEmitter=function(){function EventEmitter(context){this.context=context,this.events={}}var $=EventEmitter.prototype;return $.emit=function(type){var handler=this.events[type];if(!handler)return!1;var args;if("function"==typeof handler){switch(arguments.length){case 1:handler.call(this.context);break;case 2:handler.call(this.context,arguments[1]);break;case 3:handler.call(this.context,arguments[1],arguments[2]);break;default:args=slice.call(arguments,1),handler.apply(this.context,args)}return!0}if(isArray(handler)){args=slice.call(arguments,1);for(var listeners=handler.slice(),i=0,imax=listeners.length;imax>i;++i)listeners[i]instanceof TimbreObject?listeners[i].bang.apply(listeners[i],args):listeners[i].apply(this.context,args);return!0}return handler instanceof TimbreObject?(args=slice.call(arguments,1),void handler.bang.apply(handler,args)):!1},$.on=function(type,listener){if("function"!=typeof listener&&!(listener instanceof TimbreObject))throw new Error("addListener takes instances of Function or timbre.Object");var e=this.events;return e[type]?isArray(e[type])?e[type].push(listener):e[type]=[e[type],listener]:e[type]=listener,this},$.once=function(type,listener){var g,self=this;if("function"==typeof listener)g=function(){self.off(type,g),listener.apply(self.context,arguments)};else{if(!(listener instanceof TimbreObject))throw new Error("once takes instances of Function or timbre.Object");g=function(){self.off(type,g),listener.bang.apply(listener,arguments)}}return g.listener=listener,self.on(type,g),this},$.off=function(type,listener){if("function"!=typeof listener&&!(listener instanceof TimbreObject))throw new Error("removeListener takes instances of Function or timbre.Object");var e=this.events;if(!e[type])return this;var list=e[type];if(isArray(list)){for(var position=-1,i=0,imax=list.length;imax>i;++i)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;list.splice(position,1),0===list.length&&(e[type]=null)}else(list===listener||list.listener&&list.listener===listener)&&(e[type]=null);return this},$.removeAllListeners=function(type){var e=this.events,remain=!1,listeners=e[type];if(isArray(listeners))for(var i=listeners.length;i--;){var listener=listeners[i];listener.unremovable?remain=!0:this.off(type,listener)}else listeners&&(listeners.unremovable?remain=!0:this.off(type,listeners));return remain||(e[type]=null),this},$.listeners=function(type){var a,e=this.events;if(!e[type])return[];if(e=e[type],!isArray(e))return e.unremovable?[]:[e];e=e.slice(),a=[];for(var i=0,imax=e.length;imax>i;++i)e[i].unremovable||a.push(e[i]);return a},EventEmitter}(),Deferred=modules.Deferred=function(){function Deferred(context){this.context=context||this,this._state="pending",this._doneList=[],this._failList=[],this._promise=new Promise(this)}function Promise(object){this.context=object.context,this.then=object.then,this.done=function(){return object.done.apply(object,arguments),this},this.fail=function(){return object.fail.apply(object,arguments),this},this.pipe=function(){return object.pipe.apply(object,arguments)},this.always=function(){return object.always.apply(object,arguments),this},this.promise=function(){return this},this.isResolved=function(){return object.isResolved()},this.isRejected=function(){return object.isRejected()}}var $=Deferred.prototype,exec=function(statue,list,context,args){if("pending"===this._state){this._state=statue;for(var i=0,imax=list.length;imax>i;++i)list[i].apply(context,args);this._doneList=this._failList=null}},isDeferred=function(x){return x&&"function"==typeof x.promise};return $.resolve=function(){var args=slice.call(arguments,0);return exec.call(this,"resolved",this._doneList,this.context||this,args),this},$.resolveWith=function(context){var args=slice.call(arguments,1);return exec.call(this,"resolved",this._doneList,context,args),this},$.reject=function(){var args=slice.call(arguments,0);return exec.call(this,"rejected",this._failList,this.context||this,args),this},$.rejectWith=function(context){var args=slice.call(arguments,1);return exec.call(this,"rejected",this._failList,context,args),this},$.promise=function(){return this._promise},$.done=function(){for(var args=slice.call(arguments),isResolved="resolved"===this._state,isPending="pending"===this._state,list=this._doneList,i=0,imax=args.length;imax>i;++i)"function"==typeof args[i]&&(isResolved?args[i]():isPending&&list.push(args[i]));return this},$.fail=function(){for(var args=slice.call(arguments),isRejected="rejected"===this._state,isPending="pending"===this._state,list=this._failList,i=0,imax=args.length;imax>i;++i)"function"==typeof args[i]&&(isRejected?args[i]():isPending&&list.push(args[i]));return this},$.always=function(){return this.done.apply(this,arguments),this.fail.apply(this,arguments),this},$.then=function(done,fail){return this.done(done).fail(fail)},$.pipe=function(done,fail){var self=this,dfd=new Deferred(this.context);return this.done(function(){var res=done.apply(self.context,arguments);isDeferred(res)?res.then(function(){var args=slice.call(arguments);dfd.resolveWith.apply(dfd,[res].concat(args))}):dfd.resolveWith(self,res)}),this.fail(function(){if("function"==typeof fail){var res=fail.apply(self.context,arguments);isDeferred(res)&&res.fail(function(){var args=slice.call(arguments);dfd.rejectWith.apply(dfd,[res].concat(args))})}else dfd.reject.apply(dfd,arguments)}),dfd.promise()},$.isResolved=function(){return"resolved"===this._state},$.isRejected=function(){return"rejected"===this._state},$.state=function(){return this._state},Deferred.when=function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length;1!==length||isDeferred(subordinate)||(remaining=0);var deferred=1===remaining?subordinate:new Deferred,updateFunc=function(i,results){return function(value){results[i]=arguments.length>1?slice.call(arguments):value,--remaining||deferred.resolve.apply(deferred,results)}};if(length>1)for(var resolveResults=new Array(length),onfailed=function(){deferred.reject()};length>i;++i)resolveValues[i]&&isDeferred(resolveValues[i])?resolveValues[i].promise().done(updateFunc(i,resolveResults)).fail(onfailed):(resolveResults[i]=resolveValues[i],--remaining);return remaining||deferred.resolve.apply(deferred,resolveValues),deferred.promise()},Deferred}(),TimbreObject=timbre.Object=function(){function TimbreObject(numChannels,_args){this._={};var e=this._.events=new EventEmitter(this);if(this._.emit=function(){return e.emit.apply(e,arguments)},isDictionary(_args[0])){var params=_args.shift(),_in=params["in"];this.once("init",function(){this.set(params),_in&&(isArray(_in)?this.append.apply(this,_in):_in instanceof TimbreObject&&this.append(_in))})}switch(this.tickID=-1,this.nodes=_args.map(timbre),this.cells=[],this.numChannels=numChannels,numChannels){case 0:this.L=this.R=new ChannelObject(null),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 1:this.L=this.R=new ChannelObject(this),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 2:this.L=new ChannelObject(this),this.R=new ChannelObject(this),this.cells[0]=new fn.SignalArray(_sys.cellsize),this.cells[1]=this.L.cell,this.cells[2]=this.R.cell}this.playbackState=PLAYING_STATE,this.nodeType=TimbreObject.DSP,this._.ar=!0,this._.mul=1,this._.add=0,this._.dac=null,this._.bypassed=!1,this._.meta={},this._.samplerate=_sys.samplerate,this._.cellsize=_sys.cellsize,this._.buddies=[]}TimbreObject.DSP=1,TimbreObject.TIMER=2,TimbreObject.LISTENER=3;var $=TimbreObject.prototype;return Object.defineProperties($,{isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},isBypassed:{get:function(){return this._.bypassed}},isEnded:{get:function(){return!(1&this.playbackState)}},mul:{set:function(value){"number"==typeof value&&(this._.mul=value,this._.emit("setMul",value))},get:function(){return this._.mul}},add:{set:function(value){"number"==typeof value&&(this._.add=value,this._.emit("setAdd",value))},get:function(){return this._.add}},buddies:{set:function(value){isArray(value)||(value=[value]),this._.buddies=value.filter(function(node){return node instanceof TimbreObject})},get:function(){return this._.buddies}}}),$.toString=function(){return this.constructor.name},$.valueOf=function(){return _sys.tickID!==this.tickID&&this.process(_sys.tickID),this.cells[0][0]},$.append=function(){if(arguments.length>0){var list=slice.call(arguments).map(timbre);this.nodes=this.nodes.concat(list),this._.emit("append",list)}return this},$.appendTo=function(object){return object.append(this),this},$.remove=function(){if(arguments.length>0){for(var j,nodes=this.nodes,list=[],i=0,imax=arguments.length;imax>i;++i)-1!==(j=nodes.indexOf(arguments[i]))&&(list.push(nodes[j]),nodes.splice(j,1));list.length>0&&this._.emit("remove",list)}return this},$.removeFrom=function(object){return object.remove(this),this},$.removeAll=function(){var list=this.nodes.slice();return this.nodes=[],list.length>0&&this._.emit("remove",list),this},$.removeAtIndex=function(index){var item=this.nodes[index];return item&&(this.nodes.splice(index,1),this._.emit("remove",[item])),this},$.postMessage=function(message){return this._.emit("message",message),this},$.to=function(object){if(object instanceof TimbreObject)object.append(this);else{var args=slice.call(arguments);isDictionary(args[1])?args.splice(2,0,this):args.splice(1,0,this),object=T.apply(null,args)}return object},$.splice=function(ins,obj,rem){var i;return obj?obj instanceof TimbreObject&&(i=obj.nodes.indexOf(rem),-1!==i&&obj.nodes.splice(i,1),ins instanceof TimbreObject?(ins.nodes.push(this),obj.nodes.push(ins)):obj.nodes.push(this)):this._.dac&&(ins instanceof TimbreObject?rem instanceof TimbreObject?rem._.dac&&(rem._.dac._.node=ins,ins._.dac=rem._.dac,rem._.dac=null,ins.nodes.push(this)):this._.dac&&(this._.dac._.node=ins,ins._.dac=this._.dac,this._.dac=null,ins.nodes.push(this)):rem instanceof TimbreObject&&rem._.dac&&(rem._.dac._.node=this,this._.dac=rem._.dac,rem._.dac=null)),this},$.on=$.addListener=function(type,listener){return this._.events.on(type,listener),this},$.once=function(type,listener){return this._.events.once(type,listener),this},$.off=$.removeListener=function(type,listener){return this._.events.off(type,listener),this},$.removeAllListeners=function(type){return this._.events.removeAllListeners(type),this},$.listeners=function(type){return this._.events.listeners(type)},$.set=function(key,value){var x,desc,meta=this._.meta;switch(typeof key){case"string":switch(meta[key]){case"property":this[key]=value;break;case"function":this[key](value);break;default:for(x=this;null!==x;)desc=Object.getOwnPropertyDescriptor(x,key),desc&&("function"==typeof desc.value?(meta[key]="function",this[key](value)):(desc.get||desc.set)&&(meta[key]="property",this[key]=value)),x=Object.getPrototypeOf(x)}break;case"object":for(x in key)this.set(x,key[x])}return this},$.get=function(key){return"property"===this._.meta[key]?this[key]:void 0},$.bang=function(){return this._.emit.apply(this,["bang"].concat(slice.call(arguments))),this},$.process=fn.nop,$.bypass=function(){return this._.bypassed=0===arguments.length?!0:!!arguments[0],this},$.play=function(){var dac=this._.dac;return null===dac&&(dac=this._.dac=new SystemInlet(this)),dac.play()&&this._.emit.apply(this,["play"].concat(slice.call(arguments))),fn.buddies_start(this),this},$.pause=function(){var dac=this._.dac;return dac&&dac.playbackState===PLAYING_STATE&&(dac.pause(),this._.dac=null,this._.emit("pause")),fn.buddies_stop(this),this},$.start=$.stop=$.listen=$.unlisten=function(){return this},$.ar=function(){return(0===arguments.length?0:!arguments[0])?this.kr(!0):this._.kronly||(this._.ar=!0,this._.emit("ar",!0)),this},$.kr=function(){return(0===arguments.length?0:!arguments[0])?this.ar(!0):this._.aronly||(this._.ar=!1,this._.emit("ar",!1)),this},$.plot="browser"===_envtype?function(opts){var _=this._,canvas=opts.target;if(!canvas)return this;var foreground,width=opts.width||canvas.width||320,height=opts.height||canvas.height||240,offset_x=(opts.x||0)+.5,offset_y=opts.y||0,context=canvas.getContext("2d");foreground=opts.foreground!==undefined?opts.foreground:_.plotForeground||"rgb(  0, 128, 255)";var background;background=opts.background!==undefined?opts.background:_.plotBackground||"rgb(255, 255, 255)";var x,y,dy,y0,i,lineWidth=opts.lineWidth||_.plotLineWidth||1,cyclic=!!_.plotCyclic,data=_.plotData||this.cells[0],range=opts.range||_.plotRange||[-1.2,1.2],rangeMin=range[0],rangeDelta=height/(range[1]-rangeMin),dx=width/data.length,imax=data.length;if(context.save(),context.rect(offset_x,offset_y,width,height),null!==background&&(context.fillStyle=background,context.fillRect(offset_x,offset_y,width,height)),_.plotBefore&&_.plotBefore.call(this,context,offset_x,offset_y,width,height),_.plotBarStyle)for(context.fillStyle=foreground,x=0,i=0;imax>i;++i)dy=(data[i]-rangeMin)*rangeDelta,y=height-dy,context.fillRect(x+offset_x,y+offset_y,dx,dy),x+=dx;else{for(context.strokeStyle=foreground,context.lineWidth=lineWidth,context.beginPath(),x=0,y0=height-(data[0]-rangeMin)*rangeDelta,context.moveTo(x+offset_x,y0+offset_y),i=1;imax>i;++i)x+=dx,y=height-(data[i]-rangeMin)*rangeDelta,context.lineTo(x+offset_x,y+offset_y);cyclic?context.lineTo(x+dx+offset_x,y0+offset_y):context.lineTo(x+dx+offset_x,y+offset_y),context.stroke()}_.plotAfter&&_.plotAfter.call(this,context,offset_x,offset_y,width,height);var border=opts.border||_.plotBorder;return border&&(context.strokeStyle="string"==typeof border?border:"#000",context.lineWidth=1,context.strokeRect(offset_x,offset_y,width,height)),context.restore(),this}:fn.nop,TimbreObject}(),ChannelObject=timbre.ChannelObject=function(){function ChannelObject(parent){timbre.Object.call(this,-1,[]),fn.fixAR(this),this._.parent=parent,this.cell=new fn.SignalArray(_sys.cellsize),this.L=this.R=this,this.cells[0]=this.cells[1]=this.cells[2]=this.cell,this.numChannels=1
}return fn.extend(ChannelObject),ChannelObject.prototype.process=function(tickID){return this.tickID!==tickID&&(this.tickID=tickID,this._.parent&&this._.parent.process(tickID)),this},ChannelObject}(),AddNode=function(){function AddNode(_args){TimbreObject.call(this,2,_args)}return fn.extend(AddNode),AddNode.prototype.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},fn.register("+",AddNode),AddNode}(),NumberWrapper=function(){function NumberWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.value=_args[0],isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(NumberWrapper);var $=NumberWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.value=isNaN(value)?0:value,fn.changeWithValue.call(this))},get:function(){return this._.value}}}),NumberWrapper}(),BooleanWrapper=function(){function BooleanWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.value=_args[0],isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(BooleanWrapper);var $=BooleanWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){this._.value=value?1:0,fn.changeWithValue.call(this)},get:function(){return!!this._.value}}}),BooleanWrapper}(),FunctionWrapper=function(){function FunctionWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.func=_args[0],this._.value=0,isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(FunctionWrapper);var $=FunctionWrapper.prototype;return Object.defineProperties($,{func:{set:function(value){"function"==typeof value&&(this._.func=value)},get:function(){return this._.func}},args:{set:function(value){this._.args=isArray(value)?value:[value]},get:function(){return this._.args}}}),$.bang=function(){var _=this._,args=slice.call(arguments).concat(_.args),x=_.func.apply(this,args);return"number"==typeof x&&(_.value=x,fn.changeWithValue.call(this)),this._.emit("bang"),this},FunctionWrapper}(),ArrayWrapper=function(){function ArrayWrapper(_args){TimbreObject.call(this,1,[]);var i,imax;for(i=0,imax=_args[0].length;imax>i;++i)this.append(_args[0][i]);if(isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}}fn.extend(ArrayWrapper);var $=ArrayWrapper.prototype;return Object.defineProperties($,{}),$.bang=function(){var i,imax,args=["bang"].concat(slice.call(arguments)),nodes=this.nodes;for(i=0,imax=nodes.length;imax>i;++i)nodes[i].bang.apply(nodes[i],args);return this},$.postMessage=function(message){var i,imax,nodes=this.nodes;for(i=0,imax=nodes.length;imax>i;++i)nodes[i].postMessage(message);return this},$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},ArrayWrapper}(),ObjectWrapper=function(){function ObjectWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}}fn.extend(ObjectWrapper);var $=ObjectWrapper.prototype;return Object.defineProperties($,{}),ObjectWrapper}(),SystemInlet=function(){function SystemInlet(object){TimbreObject.call(this,2,[]),this.playbackState=FINISHED_STATE;var _=this._;_.node=object,_.onplay=make_onplay(this),_.onpause=make_onpause(this)}fn.extend(SystemInlet);var make_onplay=function(self){return function(){-1===_sys.inlets.indexOf(self)&&(_sys.inlets.push(self),_sys.events.emit("addObject"),self.playbackState=PLAYING_STATE,self._.emit("play"))}},make_onpause=function(self){return function(){var i=_sys.inlets.indexOf(self);-1!==i&&(_sys.inlets.splice(i,1),self.playbackState=FINISHED_STATE,self._.emit("pause"),_sys.events.emit("removeObject"))}},$=SystemInlet.prototype;return $.play=function(){return _sys.nextTick(this._.onplay),-1===_sys.inlets.indexOf(this)},$.pause=function(){_sys.nextTick(this._.onpause)},$.process=function(tickID){var node=this._.node;1&node.playbackState?(node.process(tickID),this.cells[1].set(node.cells[1]),this.cells[2].set(node.cells[2])):(this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell))},SystemInlet}(),SoundSystem=function(){function SoundSystem(){this.context=this,this.tickID=0,this.impl=null,this.amp=.8,this.status=FINISHED_STATE,this.samplerate=44100,this.channels=2,this.cellsize=64,this.streammsec=20,this.streamsize=0,this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this.deferred=null,this.recStart=0,this.recBuffers=null,this.delayProcess=make_delayProcess(this),this.events=null,fn.currentTimeIncr=1e3*this.cellsize/this.samplerate,fn.emptycell=new fn.SignalArray(this.cellsize),this.reset(!0)}var make_delayProcess=function(self){return function(){self.recStart=Date.now(),self.process()}},$=SoundSystem.prototype;$.bind=function(Klass,opts){if("function"==typeof Klass){var player=new Klass(this,opts);this.impl=player,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate)}return this},$.setup=function(params){return"object"==typeof params&&(-1!==ACCEPT_SAMPLERATES.indexOf(params.samplerate)&&(this.samplerate=params.samplerate<=this.impl.maxSamplerate?params.samplerate:this.impl.maxSamplerate),-1!==ACCEPT_CELLSIZES.indexOf(params.cellsize)&&(this.cellsize=params.cellsize),"undefined"!=typeof Float64Array&&"undefined"!=typeof params.f64&&(_f64mode=!!params.f64,fn.SignalArray=_f64mode?Float64Array:Float32Array)),fn.currentTimeIncr=1e3*this.cellsize/this.samplerate,fn.emptycell=new fn.SignalArray(this.cellsize),this},$.getAdjustSamples=function(samplerate){var samples,bits;return samplerate=samplerate||this.samplerate,samples=this.streammsec/1e3*samplerate,bits=Math.ceil(Math.log(samples)*Math.LOG2E),bits=8>bits?8:bits>14?14:bits,1<<bits},$.play=function(){return this.status===FINISHED_STATE&&(this.status=PLAYING_STATE,this.streamsize=this.getAdjustSamples(),this.strmL=new fn.SignalArray(this.streamsize),this.strmR=new fn.SignalArray(this.streamsize),this.impl.play(),this.events.emit("play")),this},$.pause=function(){return this.status===PLAYING_STATE&&(this.status=FINISHED_STATE,this.impl.pause(),this.events.emit("pause")),this},$.reset=function(deep){return deep&&(this.events=new EventEmitter(this).on("addObject",function(){this.status===FINISHED_STATE&&this.play()}).on("removeObject",function(){this.status===PLAYING_STATE&&this.inlets.length+this.timers.length+this.listeners.length===0&&this.pause()})),this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this},$.process=function(){var x,tmpL,tmpR,i,j,jmax,k,nextTicks,tickID=this.tickID,strmL=this.strmL,strmR=this.strmR,amp=this.amp,imax=this.streamsize,saved_i=0,kmax=this.cellsize,n=this.streamsize/this.cellsize,timers=this.timers,inlets=this.inlets,listeners=this.listeners,currentTimeIncr=fn.currentTimeIncr;for(i=0;imax>i;++i)strmL[i]=strmR[i]=0;for(;n--;){for(++tickID,j=0,jmax=timers.length;jmax>j;++j)1&timers[j].playbackState&&timers[j].process(tickID);for(j=0,jmax=inlets.length;jmax>j;++j)if(x=inlets[j],x.process(tickID),1&x.playbackState)for(tmpL=x.cells[1],tmpR=x.cells[2],k=0,i=saved_i;kmax>k;++k,++i)strmL[i]+=tmpL[k],strmR[i]+=tmpR[k];for(saved_i+=kmax,j=0,jmax=listeners.length;jmax>j;++j)1&listeners[j].playbackState&&listeners[j].process(tickID);for(this.currentTime+=currentTimeIncr,nextTicks=this.nextTicks.splice(0),j=0,jmax=nextTicks.length;jmax>j;++j)nextTicks[j]()}for(i=0;imax>i;++i)x=strmL[i]*amp,-1>x?x=-1:x>1&&(x=1),strmL[i]=x,x=strmR[i]*amp,-1>x?x=-1:x>1&&(x=1),strmR[i]=x;this.tickID=tickID;var currentTime=this.currentTime;if(this.status===SCHEDULED_STATE){if(2===this.recCh)this.recBuffers.push(new fn.SignalArray(strmL)),this.recBuffers.push(new fn.SignalArray(strmR));else{var strm=new fn.SignalArray(strmL.length);for(i=0,imax=strm.length;imax>i;++i)strm[i]=.5*(strmL[i]+strmR[i]);this.recBuffers.push(strm)}if(currentTime>=this.maxDuration)this.deferred.sub.reject();else if(currentTime>=this.recDuration)this.deferred.sub.resolve();else{var now=Date.now();now-this.recStart>20?setTimeout(this.delayProcess,10):this.process()}}},$.nextTick=function(func){this.status===FINISHED_STATE?func():this.nextTicks.push(func)},$.rec=function(){fn.fix_iOS6_1_problem(!0);var dfd=new Deferred(this);if(this.deferred)return console.warn("rec deferred is exists??"),dfd.reject().promise();if(this.status!==FINISHED_STATE)return console.log("status is not none",this.status),dfd.reject().promise();var i=0,args=arguments,opts=isDictionary(args[i])?args[i++]:{},func=args[i];if("function"!=typeof func)return console.warn("no function"),dfd.reject().promise();this.deferred=dfd,this.status=SCHEDULED_STATE,this.reset();var rec_inlet=new T("+"),inlet_dfd=new Deferred(this),outlet={done:function(){inlet_dfd.resolve.apply(inlet_dfd,slice.call(arguments))},send:function(){rec_inlet.append.apply(rec_inlet,arguments)}},self=this;return inlet_dfd.then(recdone,function(){fn.fix_iOS6_1_problem(!1),recdone.call(self,!0)}),this.deferred.sub=inlet_dfd,this.savedSamplerate=this.samplerate,this.samplerate=opts.samplerate||this.samplerate,this.recDuration=opts.recDuration||1/0,this.maxDuration=opts.maxDuration||6e5,this.recCh=opts.ch||1,2!==this.recCh&&(this.recCh=1),this.recBuffers=[],this.streamsize=this.getAdjustSamples(),this.strmL=new fn.SignalArray(this.streamsize),this.strmR=new fn.SignalArray(this.streamsize),this.inlets.push(rec_inlet),func(outlet),setTimeout(this.delayProcess,10),dfd.promise()};var recdone=function(){this.status=FINISHED_STATE,this.reset();var bufferLength,recBuffers=this.recBuffers,samplerate=this.samplerate,streamsize=this.streamsize;this.samplerate=this.savedSamplerate,bufferLength=1/0!==this.recDuration?this.recDuration*samplerate*.001|0:(recBuffers.length>>this.recCh-1)*streamsize;var result,i,imax=bufferLength/streamsize|0,j=0,k=0,remaining=bufferLength;if(2===this.recCh){var L=new fn.SignalArray(bufferLength),R=new fn.SignalArray(bufferLength),mixed=new fn.SignalArray(bufferLength);for(i=0;imax>i;++i)if(L.set(recBuffers[j++],k),R.set(recBuffers[j++],k),k+=streamsize,remaining-=streamsize,remaining>0&&streamsize>remaining){L.set(recBuffers[j++].subarray(0,remaining),k),R.set(recBuffers[j++].subarray(0,remaining),k);break}for(i=0,imax=bufferLength;imax>i;++i)mixed[i]=.5*(L[i]+R[i]);result={samplerate:samplerate,channels:2,buffer:[mixed,L,R]}}else{var buffer=new fn.SignalArray(bufferLength);for(i=0;imax>i;++i)if(buffer.set(recBuffers[j++],k),k+=streamsize,remaining-=streamsize,remaining>0&&streamsize>remaining){buffer.set(recBuffers[j++].subarray(0,remaining),k);break}result={samplerate:samplerate,channels:1,buffer:[buffer]}}var args=[].concat.apply([result],arguments);this.deferred.resolve.apply(this.deferred,args),this.deferred=null};return $.on=function(type,listeners){this.events.on(type,listeners)},$.once=function(type,listeners){this.events.once(type,listeners)},$.off=function(type,listener){this.events.off(type,listener)},$.removeAllListeners=function(type){this.events.removeListeners(type)},$.listeners=function(type){return this.events.listeners(type)},$.fix_iOS6_1_problem=function(flag){this.impl.fix_iOS6_1_problem&&this.impl.fix_iOS6_1_problem(flag)},SoundSystem}(),ImplClass=null;ImplClass="undefined"!=typeof webkitAudioContext?function(sys){var bufSrc,jsNode,context=new webkitAudioContext;fn._audioContext=context,this.maxSamplerate=context.sampleRate,this.defaultSamplerate=context.sampleRate,this.env="webkit";var ua=navigator.userAgent;if(ua.match(/linux/i)?sys.streammsec*=8:ua.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(sys.streammsec*=4),this.play=function(){var onaudioprocess,x,dx,jsn_streamsize=sys.getAdjustSamples(context.sampleRate),sys_streamsize=sys.streamsize;sys.samplerate===context.sampleRate?onaudioprocess=function(e){var outs=e.outputBuffer;sys.process(),outs.getChannelData(0).set(sys.strmL),outs.getChannelData(1).set(sys.strmR)}:2*sys.samplerate===context.sampleRate?onaudioprocess=function(e){var i,j,inL=sys.strmL,inR=sys.strmR,outs=e.outputBuffer,outL=outs.getChannelData(0),outR=outs.getChannelData(1),imax=outs.length;for(sys.process(),i=j=0;imax>i;i+=2,++j)outL[i]=outL[i+1]=inL[j],outR[i]=outR[i+1]=inR[j]}:(x=sys_streamsize,dx=sys.samplerate/context.sampleRate,onaudioprocess=function(e){var i,inL=sys.strmL,inR=sys.strmR,outs=e.outputBuffer,outL=outs.getChannelData(0),outR=outs.getChannelData(1),imax=outs.length;for(i=0;imax>i;++i)x>=sys_streamsize&&(sys.process(),x-=sys_streamsize),outL[i]=inL[0|x],outR[i]=inR[0|x],x+=dx}),bufSrc=context.createBufferSource(),jsNode=context.createJavaScriptNode(jsn_streamsize,2,sys.channels),jsNode.onaudioprocess=onaudioprocess,bufSrc.noteOn(0),bufSrc.connect(jsNode),jsNode.connect(context.destination)},this.pause=function(){bufSrc.disconnect(),jsNode.disconnect()},_envmobile){var n=0,buf=context.createBufferSource();this.fix_iOS6_1_problem=function(flag){n+=flag?1:-1,1===n?(buf.noteOn(0),buf.connect(context.destination)):0===n&&buf.disconnect()}}}:"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(sys){var timer=function(){var source="var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};",blob=new Blob([source],{type:"text/javascript"}),path=URL.createObjectURL(blob);return new Worker(path)}();this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="moz",this.play=function(){var audio=new Audio,interleaved=new Float32Array(sys.streamsize*sys.channels),streammsec=sys.streammsec,written=0,writtenIncr=sys.streamsize/sys.samplerate*1e3,start=Date.now(),onaudioprocess=function(){if(!(written>Date.now()-start)){var inL=sys.strmL,inR=sys.strmR,i=interleaved.length,j=inL.length;for(sys.process();j--;)interleaved[--i]=inR[j],interleaved[--i]=inL[j];audio.mozWriteAudio(interleaved),written+=writtenIncr}};audio.mozSetup(sys.channels,sys.samplerate),timer.onmessage=onaudioprocess,timer.postMessage(streammsec)},this.pause=function(){timer.postMessage(0)}}:function(){this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="nop",this.play=function(){},this.pause=function(){}},_sys=(new SoundSystem).bind(ImplClass);var exports=timbre;"node"===_envtype?module.exports=global.timbre=exports:"browser"===_envtype&&(exports.noConflict=function(){var _t=window.timbre,_T=window.T;return function(deep){return window.T===exports&&(window.T=_T),deep&&window.timbre===exports&&(window.timbre=_t),exports}}(),window.timbre=window.T=exports),function(){function getFlashPlayerVersion(subs){try{return nav.plugins&&nav.mimeTypes&&nav.mimeTypes.length?nav.plugins["Shockwave Flash"].description.match(/([0-9]+)/)[subs]:new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").match(/([0-9]+)/)[subs]}catch(e){return-1}}if("nop"===_sys.impl.env&&"browser"===_envtype&&!_envmobile){var nav=navigator;if(!(getFlashPlayerVersion(0)<10)){var swf,PlayerDivID="TimbreFlashPlayerDiv",src=function(){var scripts=document.getElementsByTagName("script");if(scripts&&scripts.length)for(var m,i=0,imax=scripts.length;imax>i;++i)if(m=/^(.*\/)timbre(?:\.dev)?\.js$/i.exec(scripts[i].src))return m[1]+"timbre.swf"}();window.timbrejs_flashfallback_init=function(){function TimbreFlashPlayer(sys){var timerId=0;this.maxSamplerate=44100,this.defaultSamplerate=44100,this.env="flash",this.play=function(){var onaudioprocess,interleaved=new Array(sys.streamsize*sys.channels),streammsec=sys.streammsec,written=0,writtenIncr=sys.streamsize/sys.samplerate*1e3,start=Date.now();onaudioprocess=function(){if(!(written>Date.now()-start)){var inL=sys.strmL,inR=sys.strmR,i=interleaved.length,j=inL.length;for(sys.process();j--;)interleaved[--i]=32768*inR[j]|0,interleaved[--i]=32768*inL[j]|0;swf.writeAudio(interleaved.join(" ")),written+=writtenIncr}},swf.setup?(swf.setup(sys.channels,sys.samplerate),timerId=setInterval(onaudioprocess,streammsec)):console.warn("Cannot find "+src)},this.pause=function(){0!==timerId&&(swf.cancel(),clearInterval(timerId),timerId=0)}}_sys.bind(TimbreFlashPlayer),delete window.timbrejs_flashfallback_init};var o,p,swfSrc=src,swfName=swfSrc+"?"+ +new Date,swfId="TimbreFlashPlayer",div=document.createElement("div");div.id=PlayerDivID,div.style.display="inline",div.width=div.height=1,nav.plugins&&nav.mimeTypes&&nav.mimeTypes.length?(o=document.createElement("object"),o.id=swfId,o.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",o.width=o.height=1,o.setAttribute("data",swfName),o.setAttribute("type","application/x-shockwave-flash"),p=document.createElement("param"),p.setAttribute("name","allowScriptAccess"),p.setAttribute("value","always"),o.appendChild(p),div.appendChild(o)):div.innerHTML='<object id="'+swfId+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1"><param name="movie" value="'+swfName+'" /><param name="bgcolor" value="#FFFFFF" /><param name="quality" value="high" /><param name="allowScriptAccess" value="always" /></object>',window.addEventListener("load",function(){document.body.appendChild(div),swf=document[swfId]})}}}()}(),function(T){"use strict";function Biquad(samplerate){this.samplerate=samplerate,this.frequency=340,this.Q=1,this.gain=0,this.x1L=this.x2L=this.y1L=this.y2L=0,this.x1R=this.x2R=this.y1R=this.y2R=0,this.b0=this.b1=this.b2=this.a1=this.a2=0,this.setType("lpf")}var $=Biquad.prototype;$.process=function(cellL,cellR){var xL,xR,yL,yR,i,imax,x1L=this.x1L,x2L=this.x2L,y1L=this.y1L,y2L=this.y2L,x1R=this.x1R,x2R=this.x2R,y1R=this.y1R,y2R=this.y2R,b0=this.b0,b1=this.b1,b2=this.b2,a1=this.a1,a2=this.a2;for(i=0,imax=cellL.length;imax>i;++i)xL=cellL[i],yL=b0*xL+b1*x1L+b2*x2L-a1*y1L-a2*y2L,x2L=x1L,x1L=xL,y2L=y1L,y1L=yL,xR=cellR[i],yR=b0*xR+b1*x1R+b2*x2R-a1*y1R-a2*y2R,x2R=x1R,x1R=xR,y2R=y1R,y1R=yR,cellL[i]=yL,cellR[i]=yR;this.x1L=x1L,this.x2L=x2L,this.y1L=y1L,this.y2L=y2L,this.x1R=x1R,this.x2R=x2R,this.y1R=y1R,this.y2R=y2R},$.setType=function(type){var f;(f=setParams[type])&&(this.type=type,f.call(this,this.frequency,this.Q,this.gain))},$.setParams=function(frequency,Q,dbGain){this.frequency=frequency,this.Q=Q,this.gain=dbGain;var f=setParams[this.type];return f&&f.call(this,frequency,Q,dbGain),this};var setParams={lowpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt(.5*(4-Math.sqrt(16-16/(g*g)))),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta-gamma);this.b0=2*alpha,this.b1=4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},highpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt((4-Math.sqrt(16-16/(g*g)))/2),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta+gamma);this.b0=2*alpha,this.b1=-4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},bandpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=alpha*ia0,this.b1=0,this.b2=-alpha*ia0,this.a1=-2*k*ia0,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=this.b1=this.b2=this.a1=this.a2=0},lowshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne+aMinusOne*k+k2);this.b0=A*(aPlusOne-aMinusOne*k+k2)*ia0,this.b1=2*A*(aMinusOne-aPlusOne*k)*ia0,this.b2=A*(aPlusOne-aMinusOne*k-k2)*ia0,this.a1=-2*(aMinusOne+aPlusOne*k)*ia0,this.a2=(aPlusOne+aMinusOne*k-k2)*ia0}},highshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne-aMinusOne*k+k2);this.b0=A*(aPlusOne+aMinusOne*k+k2)*ia0,this.b1=-2*A*(aMinusOne+aPlusOne*k)*ia0,this.b2=A*(aPlusOne+aMinusOne*k-k2)*ia0,this.a1=2*(aMinusOne-aPlusOne*k)*ia0,this.a2=(aPlusOne-aMinusOne*k-k2)*ia0}},peaking:function(frequency,Q,dbGain){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency){var A=Math.pow(10,dbGain/40);if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha/A);this.b0=(1+alpha*A)*ia0,this.b1=-2*k*ia0,this.b2=(1-alpha*A)*ia0,this.a1=this.b1,this.a2=(1-alpha/A)*ia0}else this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0}else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},notch:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=ia0,this.b1=-2*k*ia0,this.b2=ia0,this.a1=this.b1,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},allpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=(1-alpha)*ia0,this.b1=-2*k*ia0,this.b2=(1+alpha)*ia0,this.a1=this.b1,this.a2=this.b0}else this.b0=-1,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0}};setParams.lpf=setParams.lowpass,setParams.hpf=setParams.highpass,setParams.bpf=setParams.bandpass,setParams.bef=setParams.notch,setParams.brf=setParams.notch,setParams.apf=setParams.allpass,T.modules.Biquad=Biquad}(timbre),function(T){"use strict";function Chorus(samplerate){this.samplerate=samplerate;var bits=Math.round(Math.log(.1*samplerate)*Math.LOG2E);this.buffersize=1<<bits,this.bufferL=new T.fn.SignalArray(this.buffersize+1),this.bufferR=new T.fn.SignalArray(this.buffersize+1),this.wave=null,this._wave=null,this.writeIndex=this.buffersize>>1,this.readIndex=0,this.delayTime=20,this.rate=4,this.depth=20,this.feedback=.2,this.wet=.5,this.phase=0,this.phaseIncr=0,this.phaseStep=4,this.setWaveType("sin"),this.setDelayTime(this.delayTime),this.setRate(this.rate)}var $=Chorus.prototype,waves=[];waves[0]=function(){for(var wave=new Float32Array(512),i=0;512>i;++i)wave[i]=Math.sin(2*Math.PI*(i/512));return wave}(),waves[1]=function(){for(var x,wave=new Float32Array(512),i=0;512>i;++i)x=i/512-.25,wave[i]=1-4*Math.abs(Math.round(x)-x);return wave}(),$.setWaveType=function(waveType){"sin"===waveType?(this.wave=waveType,this._wave=waves[0]):"tri"===waveType&&(this.wave=waveType,this._wave=waves[1])},$.setDelayTime=function(delayTime){this.delayTime=delayTime;for(var readIndex=this.writeIndex-(delayTime*this.samplerate*.001|0);0>readIndex;)readIndex+=this.buffersize;this.readIndex=readIndex},$.setRate=function(rate){this.rate=rate,this.phaseIncr=512*this.rate/this.samplerate*this.phaseStep},$.process=function(cellL,cellR){var x,index,mod,i,j,bufferL=this.bufferL,bufferR=this.bufferR,size=this.buffersize,mask=size-1,wave=this._wave,phase=this.phase,phaseIncr=this.phaseIncr,writeIndex=this.writeIndex,readIndex=this.readIndex,depth=this.depth,feedback=this.feedback,wet=this.wet,dry=1-wet,imax=cellL.length,jmax=this.phaseStep;for(i=0;imax>i;){for(mod=wave[0|phase]*depth,phase+=phaseIncr;phase>512;)phase-=512;for(j=0;jmax>j;++j,++i)index=readIndex+size+mod&mask,x=.5*(bufferL[index]+bufferL[index+1]),bufferL[writeIndex]=cellL[i]-x*feedback,cellL[i]=cellL[i]*dry+x*wet,x=.5*(bufferR[index]+bufferR[index+1]),bufferR[writeIndex]=cellR[i]-x*feedback,cellR[i]=cellR[i]*dry+x*wet,writeIndex=writeIndex+1&mask,readIndex=readIndex+1&mask}this.phase=phase,this.writeIndex=writeIndex,this.readIndex=readIndex},T.modules.Chorus=Chorus}(timbre),function(T){"use strict";function Compressor(samplerate,channels){this.samplerate=samplerate,this.channels=channels,this.lastPreDelayFrames=0,this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.ratio=-1,this.slope=-1,this.linearThreshold=-1,this.dbThreshold=-1,this.dbKnee=-1,this.kneeThreshold=-1,this.kneeThresholdDb=-1,this.ykneeThresholdDb=-1,this.K=-1,this.attackTime=.003,this.releaseTime=.25,this.preDelayTime=.006,this.dbPostGain=0,this.effectBlend=1,this.releaseZone1=.09,this.releaseZone2=.16,this.releaseZone3=.42,this.releaseZone4=.98,this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1,this.delayBufferL=new T.fn.SignalArray(MaxPreDelayFrames),this.delayBufferR=2===channels?new T.fn.SignalArray(MaxPreDelayFrames):this.delayBufferL,this.preDelayTime=6,this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.maxAttackCompressionDiffDb=-1,this.meteringReleaseK=1-Math.exp(-1/(.325*this.samplerate)),this.setAttackTime(this.attackTime),this.setReleaseTime(this.releaseTime),this.setPreDelayTime(this.preDelayTime),this.setParams(-24,30,12)}var MaxPreDelayFrames=1024,MaxPreDelayFramesMask=MaxPreDelayFrames-1,DefaultPreDelayFrames=256,kSpacingDb=5,$=Compressor.prototype;$.clone=function(){var new_instance=new Compressor(this.samplerate,this.channels);return new_instance.setAttackTime(this.attackTime),new_instance.setReleaseTime(this.releaseTime),new_instance.setPreDelayTime(this.preDelayTime),new_instance.setParams(this.dbThreshold,this.dbKnee,this.ratio),new_instance},$.setAttackTime=function(value){this.attackTime=Math.max(.001,value),this._attackFrames=this.attackTime*this.samplerate},$.setReleaseTime=function(value){this.releaseTime=Math.max(.001,value);var releaseFrames=this.releaseTime*this.samplerate,satReleaseTime=.0025;this._satReleaseFrames=satReleaseTime*this.samplerate;var y1=releaseFrames*this.releaseZone1,y2=releaseFrames*this.releaseZone2,y3=releaseFrames*this.releaseZone3,y4=releaseFrames*this.releaseZone4;this._kA=.9999999999999998*y1+1.8432219684323923e-16*y2-1.9373394351676423e-16*y3+8.824516011816245e-18*y4,this._kB=-1.5788320352845888*y1+2.3305837032074286*y2-.9141194204840429*y3+.1623677525612032*y4,this._kC=.5334142869106424*y1-1.272736789213631*y2+.9258856042207512*y3-.18656310191776226*y4,this._kD=.08783463138207234*y1-.1694162967925622*y2+.08588057951595272*y3-.00429891410546283*y4,this._kE=-.042416883008123074*y1+.1115693827987602*y2-.09764676325265872*y3+.028494263462021576*y4},$.setPreDelayTime=function(preDelayTime){this.preDelayTime=preDelayTime;var preDelayFrames=preDelayTime*this.samplerate;if(preDelayFrames>MaxPreDelayFrames-1&&(preDelayFrames=MaxPreDelayFrames-1),this.lastPreDelayFrames!==preDelayFrames){this.lastPreDelayFrames=preDelayFrames;for(var i=0,imax=this.delayBufferL.length;imax>i;++i)this.delayBufferL[i]=this.delayBufferR[i]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=preDelayFrames}},$.setParams=function(dbThreshold,dbKnee,ratio){this._k=this.updateStaticCurveParameters(dbThreshold,dbKnee,ratio);var fullRangeGain=this.saturate(1,this._k),fullRangeMakeupGain=1/fullRangeGain;fullRangeMakeupGain=Math.pow(fullRangeMakeupGain,.6),this._masterLinearGain=Math.pow(10,.05*this.dbPostGain)*fullRangeMakeupGain},$.kneeCurve=function(x,k){return x<this.linearThreshold?x:this.linearThreshold+(1-Math.exp(-k*(x-this.linearThreshold)))/k},$.saturate=function(x,k){var y;if(x<this.kneeThreshold)y=this.kneeCurve(x,k);else{var xDb=x?20*Math.log(x)*Math.LOG10E:-1e3,yDb=this.ykneeThresholdDb+this.slope*(xDb-this.kneeThresholdDb);y=Math.pow(10,.05*yDb)}return y},$.slopeAt=function(x,k){if(x<this.linearThreshold)return 1;var x2=1.001*x,xDb=x?20*Math.log(x)*Math.LOG10E:-1e3,x2Db=x2?20*Math.log(x2)*Math.LOG10E:-1e3,y=this.kneeCurve(x,k),y2=this.kneeCurve(x2,k),yDb=y?20*Math.log(y)*Math.LOG10E:-1e3,y2Db=y2?20*Math.log(y2)*Math.LOG10E:-1e3;return(y2Db-yDb)/(x2Db-xDb)},$.kAtSlope=function(desiredSlope){for(var xDb=this.dbThreshold+this.dbKnee,x=Math.pow(10,.05*xDb),minK=.1,maxK=1e4,k=5,i=0;15>i;++i){var slope=this.slopeAt(x,k);desiredSlope>slope?maxK=k:minK=k,k=Math.sqrt(minK*maxK)}return k},$.updateStaticCurveParameters=function(dbThreshold,dbKnee,ratio){this.dbThreshold=dbThreshold,this.linearThreshold=Math.pow(10,.05*dbThreshold),this.dbKnee=dbKnee,this.ratio=ratio,this.slope=1/this.ratio,this.kneeThresholdDb=dbThreshold+dbKnee,this.kneeThreshold=Math.pow(10,.05*this.kneeThresholdDb);var k=this.kAtSlope(1/this.ratio),y=this.kneeCurve(this.kneeThreshold,k);return this.ykneeThresholdDb=y?20*Math.log(y)*Math.LOG10E:-1e3,this._k=k,this._k},$.process=function(cellL,cellR){for(var dryMix=1-this.effectBlend,wetMix=this.effectBlend,k=this._k,masterLinearGain=this._masterLinearGain,satReleaseFrames=this._satReleaseFrames,kA=this._kA,kB=this._kB,kC=this._kC,kD=this._kD,kE=this._kE,nDivisionFrames=64,nDivisions=cellL.length/nDivisionFrames,frameIndex=0,desiredGain=this.detectorAverage,compressorGain=this.compressorGain,maxAttackCompressionDiffDb=this.maxAttackCompressionDiffDb,i_attackFrames=1/this._attackFrames,preDelayReadIndex=this.preDelayReadIndex,preDelayWriteIndex=this.preDelayWriteIndex,detectorAverage=this.detectorAverage,delayBufferL=this.delayBufferL,delayBufferR=this.delayBufferR,meteringGain=this.meteringGain,meteringReleaseK=this.meteringReleaseK,i=0;nDivisions>i;++i){var envelopeRate,scaledDesiredGain=Math.asin(desiredGain)/(.5*Math.PI),isReleasing=scaledDesiredGain>compressorGain,x=compressorGain/scaledDesiredGain,compressionDiffDb=x?20*Math.log(x)*Math.LOG10E:-1e3;if((1/0===compressionDiffDb||isNaN(compressionDiffDb))&&(compressionDiffDb=-1),isReleasing){maxAttackCompressionDiffDb=-1,x=compressionDiffDb,x=-12>x?0:x>0?3:.25*(x+12);var x2=x*x,x3=x2*x,x4=x2*x2,_releaseFrames=kA+kB*x+kC*x2+kD*x3+kE*x4,_dbPerFrame=kSpacingDb/_releaseFrames;envelopeRate=Math.pow(10,.05*_dbPerFrame)}else{(-1===maxAttackCompressionDiffDb||compressionDiffDb>maxAttackCompressionDiffDb)&&(maxAttackCompressionDiffDb=compressionDiffDb);var effAttenDiffDb=Math.max(.5,maxAttackCompressionDiffDb);x=.25/effAttenDiffDb,envelopeRate=1-Math.pow(x,i_attackFrames)}for(var loopFrames=nDivisionFrames;loopFrames--;){var compressorInput=0,absUndelayedSource=.5*(cellL[frameIndex]+cellR[frameIndex]);delayBufferL[preDelayWriteIndex]=cellL[frameIndex],delayBufferR[preDelayWriteIndex]=cellR[frameIndex],0>absUndelayedSource&&(absUndelayedSource*=-1),absUndelayedSource>compressorInput&&(compressorInput=absUndelayedSource);var absInput=compressorInput;0>absInput&&(absInput*=-1);var shapedInput=this.saturate(absInput,k),attenuation=1e-4>=absInput?1:shapedInput/absInput,attenuationDb=attenuation?-20*Math.log(attenuation)*Math.LOG10E:1e3;2>attenuationDb&&(attenuationDb=2);var dbPerFrame=attenuationDb/satReleaseFrames,satReleaseRate=Math.pow(10,.05*dbPerFrame)-1,isRelease=attenuation>detectorAverage,rate=isRelease?satReleaseRate:1;detectorAverage+=(attenuation-detectorAverage)*rate,detectorAverage>1&&(detectorAverage=1),1>envelopeRate?compressorGain+=(scaledDesiredGain-compressorGain)*envelopeRate:(compressorGain*=envelopeRate,compressorGain>1&&(compressorGain=1));var postWarpCompressorGain=Math.sin(.5*Math.PI*compressorGain),totalGain=dryMix+wetMix*masterLinearGain*postWarpCompressorGain,dbRealGain=20*Math.log(postWarpCompressorGain)*Math.LOG10E;
meteringGain>dbRealGain?meteringGain=dbRealGain:meteringGain+=(dbRealGain-meteringGain)*meteringReleaseK,cellL[frameIndex]=delayBufferL[preDelayReadIndex]*totalGain,cellR[frameIndex]=delayBufferR[preDelayReadIndex]*totalGain,frameIndex++,preDelayReadIndex=preDelayReadIndex+1&MaxPreDelayFramesMask,preDelayWriteIndex=preDelayWriteIndex+1&MaxPreDelayFramesMask}1e-6>detectorAverage&&(detectorAverage=1e-6),1e-6>compressorGain&&(compressorGain=1e-6)}this.preDelayReadIndex=preDelayReadIndex,this.preDelayWriteIndex=preDelayWriteIndex,this.detectorAverage=detectorAverage,this.compressorGain=compressorGain,this.maxAttackCompressionDiffDb=maxAttackCompressionDiffDb,this.meteringGain=meteringGain},$.reset=function(){this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1;for(var i=0,imax=this.delayBufferL.length;imax>i;++i)this.delayBufferL[i]=this.delayBufferR[i]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.maxAttackCompressionDiffDb=-1},T.modules.Compressor=Compressor}(timbre),function(T){"use strict";function Decoder(){}Decoder.prototype.decode=function(src,onloadedmetadata,onloadeddata){if("string"==typeof src){if(/\.wav$/.test(src))return Decoder.wav_decode(src,onloadedmetadata,onloadeddata);if(Decoder.ogg_decode&&/\.ogg$/.test(src))return Decoder.ogg_decode(src,onloadedmetadata,onloadeddata);if(Decoder.mp3_decode&&/\.mp3$/.test(src))return Decoder.mp3_decode(src,onloadedmetadata,onloadeddata)}else if("object"==typeof src){if("wav"===src.type)return Decoder.wav_decode(src.data,onloadedmetadata,onloadeddata);if(Decoder.ogg_decode&&"ogg"===src.type)return Decoder.ogg_decode(src.data,onloadedmetadata,onloadeddata);if(Decoder.mp3_decode&&"mp3"===src.type)return Decoder.mp3_decode(src.data,onloadedmetadata,onloadeddata)}return Decoder.webkit_decode?"object"==typeof src?Decoder.webkit_decode(src.data||src,onloadedmetadata,onloadeddata):Decoder.webkit_decode(src,onloadedmetadata,onloadeddata):Decoder.moz_decode?Decoder.moz_decode(src,onloadedmetadata,onloadeddata):void onloadedmetadata(!1)},T.modules.Decoder=Decoder,Decoder.getBinaryWithPath="browser"===T.envtype?function(path,callback){T.fn.fix_iOS6_1_problem(!0);var xhr=new XMLHttpRequest;xhr.open("GET",path),xhr.responseType="arraybuffer",xhr.onreadystatechange=function(){4===xhr.readyState&&(xhr.response?callback(new Uint8Array(xhr.response)):void 0!==xhr.responseBody&&callback(new Uint8Array(VBArray(xhr.responseBody).toArray())),T.fn.fix_iOS6_1_problem(!1))},xhr.send()}:function(path,callback){callback("no support")};var _24bit_to_32bit=function(uint8){for(var b0,b1,b2,bb,x,int32=new Int32Array(uint8.length/3),i=0,imax=uint8.length,j=0;imax>i;)b0=uint8[i++],b1=uint8[i++],b2=uint8[i++],bb=b0+(b1<<8)+(b2<<16),x=8388608&bb?bb-16777216:bb,int32[j++]=x;return int32};Decoder.wav_decode=function(){var _decode=function(data,onloadedmetadata,onloadeddata){if("RIFF"!==String.fromCharCode(data[0],data[1],data[2],data[3]))return onloadedmetadata(!1);var l1=data[4]+(data[5]<<8)+(data[6]<<16)+(data[7]<<24);if(l1+8!==data.length)return onloadedmetadata(!1);if("WAVE"!==String.fromCharCode(data[8],data[9],data[10],data[11]))return onloadedmetadata(!1);if("fmt "!==String.fromCharCode(data[12],data[13],data[14],data[15]))return onloadedmetadata(!1);for(var channels=data[22]+(data[23]<<8),samplerate=data[24]+(data[25]<<8)+(data[26]<<16)+(data[27]<<24),bitSize=data[34]+(data[35]<<8),i=36;i<data.length&&"data"!==String.fromCharCode(data[i],data[i+1],data[i+2],data[i+3]);)i+=1;if(i>=data.length)return onloadedmetadata(!1);i+=4;var l2=data[i]+(data[i+1]<<8)+(data[i+2]<<16)+(data[i+3]<<24),duration=(l2/channels>>1)/samplerate;if(i+=4,l2>data.length-i)return onloadedmetadata(!1);var mixdown,bufferL,bufferR;mixdown=new Float32Array(duration*samplerate|0),2===channels&&(bufferL=new Float32Array(mixdown.length),bufferR=new Float32Array(mixdown.length)),onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration}),8===bitSize?data=new Int8Array(data.buffer,i):16===bitSize?data=new Int16Array(data.buffer,i):32===bitSize?data=new Int32Array(data.buffer,i):24===bitSize&&(data=_24bit_to_32bit(new Uint8Array(data.buffer,i)));var imax,j,x,k=1/((1<<bitSize-1)-1);if(2===channels)for(i=j=0,imax=mixdown.length;imax>i;++i)x=bufferL[i]=data[j++]*k,x+=bufferR[i]=data[j++]*k,mixdown[i]=.5*x;else for(i=0,imax=mixdown.length;imax>i;++i)mixdown[i]=data[i]*k;onloadeddata()};return function(src,onloadedmetadata,onloadeddata){"string"==typeof src?Decoder.getBinaryWithPath(src,function(data){_decode(data,onloadedmetadata,onloadeddata)}):_decode(src,onloadedmetadata,onloadeddata)}}(),Decoder.webkit_decode=function(){if("undefined"!=typeof webkitAudioContext){var ctx=T.fn._audioContext,_decode=function(data,onloadedmetadata,onloadeddata){var samplerate,channels,bufferL,bufferR,duration;if("string"==typeof data)return onloadeddata(!1);var buffer;try{buffer=ctx.createBuffer(data.buffer,!1)}catch(e){return onloadedmetadata(!1)}samplerate=ctx.sampleRate,channels=buffer.numberOfChannels,2===channels?(bufferL=buffer.getChannelData(0),bufferR=buffer.getChannelData(1)):bufferL=bufferR=buffer.getChannelData(0),duration=bufferL.length/samplerate;for(var mixdown=new Float32Array(bufferL),i=0,imax=mixdown.length;imax>i;++i)mixdown[i]=.5*(mixdown[i]+bufferR[i]);onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration}),onloadeddata()};return function(src,onloadedmetadata,onloadeddata){if(src instanceof File){var reader=new FileReader;reader.onload=function(e){_decode(new Uint8Array(e.target.result),onloadedmetadata,onloadeddata)},reader.readAsArrayBuffer(src)}else"string"==typeof src?Decoder.getBinaryWithPath(src,function(data){_decode(data,onloadedmetadata,onloadeddata)}):_decode(src,onloadedmetadata,onloadeddata)}}}(),Decoder.moz_decode=function(){return"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(src,onloadedmetadata,onloadeddata){var samplerate,channels,mixdown,bufferL,bufferR,duration,writeIndex=0,audio=new Audio(src);audio.volume=0,audio.addEventListener("loadedmetadata",function(){samplerate=audio.mozSampleRate,channels=audio.mozChannels,duration=audio.duration,mixdown=new Float32Array(audio.duration*samplerate|0),2===channels&&(bufferL=new Float32Array(audio.duration*samplerate|0),bufferR=new Float32Array(audio.duration*samplerate|0)),2===channels?audio.addEventListener("MozAudioAvailable",function(e){for(var x,samples=e.frameBuffer,i=0,imax=samples.length;imax>i;i+=2)x=bufferL[writeIndex]=samples[i],x+=bufferR[writeIndex]=samples[i+1],mixdown[writeIndex]=.5*x,writeIndex+=1},!1):audio.addEventListener("MozAudioAvailable",function(e){for(var samples=e.frameBuffer,i=0,imax=samples.length;imax>i;++i)mixdown[i]=samples[i],writeIndex+=1},!1),audio.play(),setTimeout(function(){onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration})},1e3)},!1),audio.addEventListener("ended",function(){onloadeddata()},!1),audio.load()}:void 0}()}(timbre),function(T){"use strict";function Envelope(samplerate){this.samplerate=samplerate||44100,this.value=ZERO,this.status=StatusWait,this.curve="linear",this.step=1,this.releaseNode=null,this.loopNode=null,this.emit=null,this._envValue=new EnvelopeValue(samplerate),this._table=[],this._initValue=ZERO,this._curveValue=0,this._defaultCurveType=CurveTypeLin,this._index=0,this._counter=0}function EnvelopeValue(samplerate){this.samplerate=samplerate,this.value=ZERO,this.step=1,this._curveType=CurveTypeLin,this._curveValue=0,this._grow=0,this._a2=0,this._b1=0,this._y1=0,this._y2=0}var ZERO=Envelope.ZERO=1e-6,CurveTypeSet=Envelope.CurveTypeSet=0,CurveTypeLin=Envelope.CurveTypeLin=1,CurveTypeExp=Envelope.CurveTypeExp=2,CurveTypeSin=Envelope.CurveTypeSin=3,CurveTypeWel=Envelope.CurveTypeWel=4,CurveTypeCurve=Envelope.CurveTypeCurve=5,CurveTypeSqr=Envelope.CurveTypeSqr=6,CurveTypeCub=Envelope.CurveTypeCub=7,StatusWait=Envelope.StatusWait=0,StatusGate=Envelope.StatusGate=1,StatusSustain=Envelope.StatusSustain=2,StatusRelease=Envelope.StatusRelease=3,StatusEnd=Envelope.StatusEnd=4,CurveTypeDict={set:CurveTypeSet,lin:CurveTypeLin,linear:CurveTypeLin,exp:CurveTypeExp,exponential:CurveTypeExp,sin:CurveTypeSin,sine:CurveTypeSin,wel:CurveTypeWel,welch:CurveTypeWel,sqr:CurveTypeSqr,squared:CurveTypeSqr,cub:CurveTypeCub,cubed:CurveTypeCub};Envelope.CurveTypeDict=CurveTypeDict;var $=Envelope.prototype;$.clone=function(){var new_instance=new Envelope(this.samplerate);return new_instance._table=this._table,new_instance._initValue=this._initValue,new_instance.setCurve(this.curve),null!==this.releaseNode&&new_instance.setReleaseNode(this.releaseNode+1),null!==this.loopNode&&new_instance.setLoopNode(this.loopNode+1),new_instance.setStep(this.step),new_instance.reset(),new_instance},$.setTable=function(value){this._initValue=value[0],this._table=value.slice(1),this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=StatusWait},$.setCurve=function(value){"number"==typeof value?(this._defaultCurveType=CurveTypeCurve,this._curveValue=value,this.curve=value):(this._defaultCurveType=CurveTypeDict[value]||null,this.curve=value)},$.setReleaseNode=function(value){"number"==typeof value&&value>0&&(this.releaseNode=value-1)},$.setLoopNode=function(value){"number"==typeof value&&value>0&&(this.loopNode=value-1)},$.setStep=function(step){this.step=this._envValue.step=step},$.reset=function(){this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=StatusWait},$.release=function(){null!==this.releaseNode&&(this._counter=0,this.status=StatusRelease)},$.getInfo=function(sustainTime){var i,imax,table=this._table,totalDuration=0,loopBeginTime=1/0,releaseBeginTime=1/0,isEndlessLoop=!1;for(i=0,imax=table.length;imax>i;++i){this.loopNode===i&&(loopBeginTime=totalDuration),this.releaseNode===i&&(sustainTime>totalDuration?totalDuration+=sustainTime:totalDuration=sustainTime,releaseBeginTime=totalDuration);var items=table[i];Array.isArray(items)&&(totalDuration+=items[1])}return 1/0!==loopBeginTime&&1/0===releaseBeginTime&&(totalDuration+=sustainTime,isEndlessLoop=!0),{totalDuration:totalDuration,loopBeginTime:loopBeginTime,releaseBeginTime:releaseBeginTime,isEndlessLoop:isEndlessLoop}},$.calcStatus=function(){var items,endValue,time,curveType,status=this.status,table=this._table,index=this._index,counter=this._counter,curveValue=this._curveValue,defaultCurveType=this._defaultCurveType,loopNode=this.loopNode,releaseNode=this.releaseNode,envValue=this._envValue,emit=null;switch(status){case StatusWait:case StatusEnd:break;case StatusGate:case StatusRelease:for(;0>=counter;)if(index>=table.length){if(status===StatusGate&&null!==loopNode){index=loopNode;continue}status=StatusEnd,counter=1/0,curveType=CurveTypeSet,emit="ended"}else if(status!==StatusGate||index!==releaseNode)items=table[index++],endValue=items[0],curveType=null===items[2]?defaultCurveType:items[2],curveType===CurveTypeCurve&&(curveValue=items[3],Math.abs(curveValue)<.001&&(curveType=CurveTypeLin)),time=items[1],counter=envValue.setNext(endValue,time,curveType,curveValue);else{if(null!==loopNode&&releaseNode>loopNode){index=loopNode;continue}status=StatusSustain,counter=1/0,curveType=CurveTypeSet,emit="sustained"}}return this.status=status,this.emit=emit,this._index=index,this._counter=counter,status},$.next=function(){return 1&this.calcStatus()&&(this.value=this._envValue.next()||ZERO),this._counter-=1,this.value},$.process=function(cell){var i,envValue=this._envValue,imax=cell.length;if(1&this.calcStatus())for(i=0;imax>i;++i)cell[i]=envValue.next()||ZERO;else{var value=this.value||ZERO;for(i=0;imax>i;++i)cell[i]=value}this.value=cell[imax-1],this._counter-=cell.length},EnvelopeValue.prototype.setNext=function(endValue,time,curveType,curveValue){var grow,w,a1,a2,b1,y1,y2,n=this.step,value=this.value,counter=.001*time*this.samplerate/n|0;switch(1>counter&&(counter=1,curveType=CurveTypeSet),curveType){case CurveTypeSet:this.value=endValue;break;case CurveTypeLin:grow=(endValue-value)/counter;break;case CurveTypeExp:grow=0!==value?Math.pow(endValue/value,1/counter):0;break;case CurveTypeSin:w=Math.PI/counter,a2=.5*(endValue+value),b1=2*Math.cos(w),y1=.5*(endValue-value),y2=y1*Math.sin(.5*Math.PI-w),value=a2-y1;break;case CurveTypeWel:w=.5*Math.PI/counter,b1=2*Math.cos(w),endValue>=value?(a2=value,y1=0,y2=-Math.sin(w)*(endValue-value)):(a2=endValue,y1=value-endValue,y2=Math.cos(w)*(value-endValue)),value=a2+y1;break;case CurveTypeCurve:a1=(endValue-value)/(1-Math.exp(curveValue)),a2=value+a1,b1=a1,grow=Math.exp(curveValue/counter);break;case CurveTypeSqr:y1=Math.sqrt(value),y2=Math.sqrt(endValue),grow=(y2-y1)/counter;break;case CurveTypeCub:y1=Math.pow(value,.33333333),y2=Math.pow(endValue,.33333333),grow=(y2-y1)/counter}return this.next=NextFunctions[curveType],this._grow=grow,this._a2=a2,this._b1=b1,this._y1=y1,this._y2=y2,counter};var NextFunctions=[];NextFunctions[CurveTypeSet]=function(){return this.value},NextFunctions[CurveTypeLin]=function(){return this.value+=this._grow,this.value},NextFunctions[CurveTypeExp]=function(){return this.value*=this._grow,this.value},NextFunctions[CurveTypeSin]=function(){var y0=this._b1*this._y1-this._y2;return this.value=this._a2-y0,this._y2=this._y1,this._y1=y0,this.value},NextFunctions[CurveTypeWel]=function(){var y0=this._b1*this._y1-this._y2;return this.value=this._a2+y0,this._y2=this._y1,this._y1=y0,this.value},NextFunctions[CurveTypeCurve]=function(){return this._b1*=this._grow,this.value=this._a2-this._b1,this.value},NextFunctions[CurveTypeSqr]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1,this.value},NextFunctions[CurveTypeCub]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1*this._y1,this.value},EnvelopeValue.prototype.next=NextFunctions[CurveTypeSet],T.modules.Envelope=Envelope,T.modules.EnvelopeValue=EnvelopeValue}(timbre),function(T){"use strict";function FFT(n){n="number"==typeof n?n:512,n=1<<Math.ceil(Math.log(n)*Math.LOG2E),this.length=n,this.buffer=new T.fn.SignalArray(n),this.real=new T.fn.SignalArray(n),this.imag=new T.fn.SignalArray(n),this._real=new T.fn.SignalArray(n),this._imag=new T.fn.SignalArray(n),this.mag=new T.fn.SignalArray(n>>1),this.minDecibels=-30,this.maxDecibels=-100;var params=FFTParams.get(n);this._bitrev=params.bitrev,this._sintable=params.sintable,this._costable=params.costable}var $=FFT.prototype;$.setWindow=function(key){if("string"==typeof key){var m=/([A-Za-z]+)(?:\(([01]\.?\d*)\))?/.exec(key);if(null!==m){var name=m[1].toLowerCase(),a=void 0!==m[2]?+m[2]:.25,f=WindowFunctions[name];if(f){this._window||(this._window=new T.fn.SignalArray(this.length));var w=this._window,n=0,N=this.length;for(a=0>a?0:a>1?1:a;N>n;++n)w[n]=f(n,N,a);this.windowName=key}}}},$.forward=function(_buffer){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this.real,imag=this.imag,window=this._window,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;if(window)for(i=0;n>i;++i)buffer[i]=_buffer[i]*window[i];else buffer.set(_buffer);for(i=0;n>i;++i)real[i]=buffer[bitrev[i]],imag[i]=0;for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}var rval,ival,mag=this.mag;for(i=0;n>i;++i)rval=real[i],ival=imag[i],mag[i]=Math.sqrt(rval*rval+ival*ival);return{real:real,imag:imag}},$.inverse=function(_real,_imag){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this._real,imag=this._imag,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;for(i=0;n>i;++i)j=bitrev[i],real[i]=+_real[j],imag[i]=-_imag[j];for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}for(i=0;n>i;++i)buffer[i]=real[i]/n;return buffer},$.getFrequencyData=function(array){var i,minDecibels=this.minDecibels,imax=Math.min(this.mag.length,array.length);if(imax){var x,mag=this.mag,peak=0;for(i=0;imax>i;++i)x=mag[i],array[i]=x?20*Math.log(x)*Math.LOG10E:minDecibels,peak<array[i]&&(peak=array[i])}return array};var FFTParams={get:function(n){return FFTParams[n]||function(){var i,imax,bitrev=function(){var x,i,j,k,n2;for(x=new Int16Array(n),n2=n>>1,i=j=0;x[i]=j,!(++i>=n);){for(k=n2;j>=k;)j-=k,k>>=1;j+=k}return x}(),k=Math.floor(Math.log(n)/Math.LN2),sintable=new T.fn.SignalArray((1<<k)-1),costable=new T.fn.SignalArray((1<<k)-1),PI2=2*Math.PI;for(i=0,imax=sintable.length;imax>i;++i)sintable[i]=Math.sin(PI2*(i/n)),costable[i]=Math.cos(PI2*(i/n));return FFTParams[n]={bitrev:bitrev,sintable:sintable,costable:costable},FFTParams[n]}()}},WindowFunctions=function(){var PI=Math.PI,PI2=2*Math.PI,abs=Math.abs,pow=Math.pow,cos=Math.cos,sin=Math.sin,sinc=function(x){return sin(PI*x)/(PI*x)},E=Math.E;return{rectangular:function(){return 1},hann:function(n,N){return.5*(1-cos(PI2*n/(N-1)))},hamming:function(n,N){return.54-.46*cos(PI2*n/(N-1))},tukery:function(n,N,a){return a*(N-1)/2>n?.5*(1+cos(PI*(2*n/(a*(N-1))-1))):n>(N-1)*(1-a/2)?.5*(1+cos(PI*(2*n/(a*(N-1))-2/a+1))):1},cosine:function(n,N){return sin(PI*n/(N-1))},lanczos:function(n,N){return sinc(2*n/(N-1)-1)},triangular:function(n,N){return 2/(N+1)*((N+1)/2-abs(n-(N-1)/2))},bartlett:function(n,N){return 2/(N-1)*((N-1)/2-abs(n-(N-1)/2))},gaussian:function(n,N,a){return pow(E,-.5*pow((n-(N-1)/2)/(a*(N-1)/2),2))},bartlettHann:function(n,N){return.62-.48*abs(n/(N-1)-.5)-.38*cos(PI2*n/(N-1))},blackman:function(n,N,a){var a0=(1-a)/2,a1=.5,a2=a/2;return a0-a1*cos(PI2*n/(N-1))+a2*cos(4*PI*n/(N-1))}}}();T.modules.FFT=FFT}(timbre),function(T){"use strict";function Oscillator(samplerate){this.samplerate=samplerate||44100,this.wave=null,this.step=1,this.frequency=0,this.value=0,this.phase=0,this.feedback=!1,this._x=0,this._lastouts=0,this._coeff=TABLE_SIZE/this.samplerate,this._radtoinc=TABLE_SIZE/(2*Math.PI)}function waveshape(sign,name,shape,width){var _wave,i,imax,j,jmax,wave=Wavetables[name];if(void 0!==wave){switch("function"==typeof wave&&(wave=wave()),shape){case"@1":for(i=512;1024>i;++i)wave[i]=0;break;case"@2":for(i=512;1024>i;++i)wave[i]=Math.abs(wave[i]);break;case"@3":for(i=256;512>i;++i)wave[i]=0;for(i=512;768>i;++i)wave[i]=Math.abs(wave[i]);for(i=768;1024>i;++i)wave[i]=0;break;case"@4":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=wave[i<<1];wave=_wave;break;case"@5":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=Math.abs(wave[i<<1]);wave=_wave}if(void 0!==width&&50!==width){for(width*=.01,width=0>width?0:width>1?1:width,_wave=new Float32Array(1024),imax=1024*width|0,i=0;imax>i;++i)_wave[i]=wave[i/imax*512|0];for(jmax=1024-imax,j=0;1024>i;++i,++j)_wave[i]=wave[j/jmax*512+512|0];wave=_wave}if("+"===sign)for(i=0;1024>i;++i)wave[i]=.5*wave[i]+.5;else if("-"===sign)for(i=0;1024>i;++i)wave[i]*=-1;return wave}}function wavb(src){var wave=new Float32Array(1024),n=src.length>>1;if(-1!==[2,4,8,16,32,64,128,256,512,1024].indexOf(n))for(var i=0,k=0;n>i;++i){var x=parseInt(src.substr(2*i,2),16);x=128&x?(x-256)/128:x/127;for(var j=0,jmax=1024/n;jmax>j;++j)wave[k++]=x}return wave}function wavc(src){var wave=new Float32Array(1024);if(8===src.length){var i,j,color=parseInt(src,16),bar=new Float32Array(8);for(bar[0]=1,i=0;7>i;++i)bar[i+1]=.0625*(15&color),color>>=4;for(i=0;8>i;++i){var x=0,dx=(i+1)/1024;for(j=0;1024>j;++j)wave[j]+=Math.sin(2*Math.PI*x)*bar[i],x+=dx}var absx,maxx=0;for(i=0;1024>i;++i)maxx<(absx=Math.abs(wave[i]))&&(maxx=absx);if(maxx>0)for(i=0;1024>i;++i)wave[i]/=maxx}return wave}var TABLE_SIZE=1024,TABLE_MASK=TABLE_SIZE-1,$=Oscillator.prototype;$.setWave=function(value){var i,dx,wave=this.wave;if(this.wave||(this.wave=new Float32Array(TABLE_SIZE+1)),"function"==typeof value)for(i=0;TABLE_SIZE>i;++i)wave[i]=value(i/TABLE_SIZE);else if(T.fn.isSignalArray(value))if(value.length===wave.length)wave.set(value);else for(dx=value.length/TABLE_SIZE,i=0;TABLE_SIZE>i;++i)wave[i]=value[i*dx|0];else"string"==typeof value&&void 0!==(dx=getWavetable(value))&&this.wave.set(dx);this.wave[TABLE_SIZE]=this.wave[0]},$.clone=function(){var new_instance=new Oscillator(this.samplerate);return new_instance.wave=this.wave,new_instance.step=this.step,new_instance.frequency=this.frequency,new_instance.value=this.value,new_instance.phase=this.phase,new_instance.feedback=this.feedback,new_instance},$.reset=function(){this._x=0},$.next=function(){var x=this._x,index=x+this.phase*this._radtoinc|0;return this.value=this.wave[index&TABLE_MASK],x+=this.frequency*this._coeff*this.step,x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value},$.process=function(cell){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this.frequency*this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=dx;this._lastouts=lastouts}else{var phaseoffset=this.phase*radtoinc;for(i=0;imax>i;++i)phase=x+phaseoffset,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=dx}x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithFreqArray=function(cell,freqs){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=freqs[i]*dx;this._lastouts=lastouts}else{var phaseoffset=this.phase*this._radtoinc;for(i=0;imax>i;++i)phase=x+phaseoffset,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=freqs[i]*dx}x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithPhaseArray=function(cell,phases){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this.frequency*this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=dx;this._lastouts=lastouts}else for(i=0;imax>i;++i)phase=x+phases[i]*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=dx;x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithFreqAndPhaseArray=function(cell,freqs,phases){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=freqs[i]*dx;this._lastouts=lastouts}else for(i=0;imax>i;++i)phase=x+phases[i]*TABLE_SIZE,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=freqs[i]*dx;x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]};var getWavetable=function(key){var wave=Wavetables[key];if(void 0!==wave)return"function"==typeof wave&&(wave=wave()),wave;var m;if(m=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(key),null!==m){var sign=m[1],name=m[2],shape=m[3],width=m[4];if(wave=waveshape(sign,name,shape,width),void 0!==wave)return Wavetables[key]=wave,wave}return m=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(key),null!==m?wavb(m[1]):(m=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(key),null!==m?wavc(m[1]):void 0)};Oscillator.getWavetable=getWavetable;var setWavetable=function(name,value){var dx,i,wave=new Float32Array(1024);if("function"==typeof value)for(i=0;1024>i;++i)wave[i]=value(i/1024);else if(T.fn.isSignalArray(value))if(value.length===wave.length)wave.set(value);else for(dx=value.length/1024,i=0;1024>i;++i)wave[i]=value[i*dx|0];Wavetables[name]=wave};Oscillator.setWavetable=setWavetable;var Wavetables={sin:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=Math.sin(2*Math.PI*(i/1024));return wave},cos:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=Math.cos(2*Math.PI*(i/1024));return wave},pulse:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=512>i?1:-1;return wave},tri:function(){for(var x,wave=new Float32Array(1024),i=0;1024>i;++i)x=i/1024-.25,wave[i]=1-4*Math.abs(Math.round(x)-x);return wave},saw:function(){for(var x,wave=new Float32Array(1024),i=0;1024>i;++i)x=i/1024,wave[i]=2*(x-Math.round(x));return wave},fami:function(){for(var d=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-.125,-.25,-.375,-.5,-.625,-.75,-.875,-1,-1,-.875,-.75,-.625,-.5,-.375,-.25,-.125],wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=d[i/1024*d.length|0];return wave},konami:function(){for(var d=[-.625,-.875,-.125,.75,.5,.125,.5,.75,.25,-.125,.5,.875,.625,0,.25,.375,-.125,-.75,0,.625,.125,-.5,-.375,-.125,-.75,-1,-.625,0,-.375,-.875,-.625,-.25],wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=d[i/1024*d.length|0];return wave}};T.modules.Oscillator=Oscillator}(timbre),function(T){"use strict";function Reverb(samplerate,buffersize){this.samplerate=samplerate;var i,imax,k=samplerate/44100;for(imax=2*CombParams.length,this.comb=new Array(imax),this.combout=new Array(imax),i=0;imax>i;++i)this.comb[i]=new CombFilter(CombParams[i%CombParams.length]*k),this.combout[i]=new T.fn.SignalArray(buffersize);for(imax=2*AllpassParams.length,this.allpass=new Array(imax),i=0;imax>i;++i)this.allpass[i]=new AllpassFilter(AllpassParams[i%AllpassParams.length]*k);this.outputs=[new T.fn.SignalArray(buffersize),new T.fn.SignalArray(buffersize)],this.damp=0,this.wet=.33,this.setRoomSize(.5),this.setDamp(.5)}function CombFilter(buffersize){this.buffer=new T.fn.SignalArray(0|buffersize),this.buffersize=this.buffer.length,this.bufidx=0,this.feedback=0,this.filterstore=0,this.damp=0}function AllpassFilter(buffersize){this.buffer=new T.fn.SignalArray(0|buffersize),this.buffersize=this.buffer.length,this.bufidx=0}var CombParams=[1116,1188,1277,1356,1422,1491,1557,1617],AllpassParams=[225,556,441,341],$=Reverb.prototype;$.setRoomSize=function(roomsize){var comb=this.comb,value=.28*roomsize+.7;this.roomsize=roomsize,comb[0].feedback=comb[1].feedback=comb[2].feedback=comb[3].feedback=comb[4].feedback=comb[5].feedback=comb[6].feedback=comb[7].feedback=comb[8].feedback=comb[9].feedback=comb[10].feedback=comb[11].feedback=comb[12].feedback=comb[13].feedback=comb[14].feedback=comb[15].feedback=value},$.setDamp=function(damp){var comb=this.comb,value=.4*damp;this.damp=damp,comb[0].damp=comb[1].damp=comb[2].damp=comb[3].damp=comb[4].damp=comb[5].damp=comb[6].damp=comb[7].damp=comb[8].damp=comb[9].damp=comb[10].damp=comb[11].damp=comb[12].damp=comb[13].damp=comb[14].damp=comb[15].damp=value},$.process=function(cellL,cellR){var i,comb=this.comb,combout=this.combout,allpass=this.allpass,output0=this.outputs[0],output1=this.outputs[1],wet=this.wet,dry=1-wet,imax=cellL.length;for(comb[0].process(cellL,combout[0]),comb[1].process(cellL,combout[1]),comb[2].process(cellL,combout[2]),comb[3].process(cellL,combout[3]),comb[4].process(cellL,combout[4]),comb[5].process(cellL,combout[5]),comb[6].process(cellL,combout[6]),comb[7].process(cellL,combout[7]),comb[8].process(cellR,combout[8]),comb[9].process(cellR,combout[9]),comb[10].process(cellR,combout[10]),comb[11].process(cellR,combout[11]),comb[12].process(cellR,combout[12]),comb[13].process(cellR,combout[13]),comb[14].process(cellR,combout[14]),comb[15].process(cellR,combout[15]),i=0;imax>i;++i)output0[i]=combout[0][i]+combout[1][i]+combout[2][i]+combout[3][i]+combout[4][i]+combout[5][i]+combout[6][i]+combout[7][i],output1[i]=combout[8][i]+combout[9][i]+combout[10][i]+combout[11][i]+combout[12][i]+combout[13][i]+combout[14][i]+combout[15][i];for(allpass[0].process(output0,output0),allpass[1].process(output0,output0),allpass[2].process(output0,output0),allpass[3].process(output0,output0),allpass[4].process(output1,output1),allpass[5].process(output1,output1),allpass[6].process(output1,output1),allpass[7].process(output1,output1),i=0;imax>i;++i)cellL[i]=output0[i]*wet+cellL[i]*dry,cellR[i]=output1[i]*wet+cellR[i]*dry},CombFilter.prototype.process=function(input,output){var ins,outs,i,buffer=this.buffer,buffersize=this.buffersize,bufidx=this.bufidx,filterstore=this.filterstore,feedback=this.feedback,damp1=this.damp,damp2=1-damp1,imax=input.length;for(i=0;imax>i;++i)ins=.015*input[i],outs=buffer[bufidx],filterstore=outs*damp2+filterstore*damp1,buffer[bufidx]=ins+filterstore*feedback,++bufidx>=buffersize&&(bufidx=0),output[i]=outs;this.bufidx=bufidx,this.filterstore=filterstore},AllpassFilter.prototype.process=function(input,output){var ins,outs,bufout,i,buffer=this.buffer,buffersize=this.buffersize,bufidx=this.bufidx,imax=input.length;for(i=0;imax>i;++i)ins=input[i],bufout=buffer[bufidx],outs=-ins+bufout,buffer[bufidx]=ins+.5*bufout,++bufidx>=buffersize&&(bufidx=0),output[i]=outs;this.bufidx=bufidx},T.modules.Reverb=Reverb}(timbre),function(T){"use strict";function Scissor(soundbuffer){return new Tape(soundbuffer)}function Tape(soundbuffer){if(this.fragments=[],soundbuffer){var samplerate=soundbuffer.samplerate||44100,duration=soundbuffer.buffer[0].length/samplerate;this.fragments.push(new Fragment(soundbuffer,0,duration))}}function Fragment(soundbuffer,start,duration,reverse,pitch,stretch,pan){soundbuffer||(soundbuffer=silencebuffer),this.buffer=soundbuffer.buffer[0],this.samplerate=soundbuffer.samplerate||44100,this.start=start,this._duration=duration,this.reverse=reverse||!1,this.pitch=pitch||100,this.stretch=stretch||!1,this.pan=pan||50}function TapeStream(tape,samplerate){this.tape=tape,this.fragments=tape.fragments,this.samplerate=samplerate||44100,this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5}var DummyBuffer=new Float32Array(60),silencebuffer={buffer:DummyBuffer,samplerate:1};Scissor.silence=function(duration){return new Scissor(silencebuffer).slice(0,1).fill(duration)},Scissor.join=function(tapes){for(var new_instance=new Tape,i=0;i<tapes.length;i++)tapes[i]instanceof Tape&&new_instance.add_fragments(tapes[i].fragments);return new_instance},Scissor.Tape=Tape,Tape.prototype.add_fragment=function(fragment){return this.fragments.push(fragment),this},Tape.prototype.add_fragments=function(fragments){for(var i=0;i<fragments.length;i++)this.fragments.push(fragments[i]);return this},Tape.prototype.duration=function(){for(var result=0,i=0;i<this.fragments.length;i++)result+=this.fragments[i].duration();return result},Tape.prototype.slice=function(start,length){var duration=this.duration();start+length>duration&&(length=duration-start);for(var new_instance=new Tape,remainingstart=start,remaininglength=length,i=0;i<this.fragments.length;i++){var fragment=this.fragments[i],items=fragment.create(remainingstart,remaininglength),new_fragment=items[0];if(remainingstart=items[1],remaininglength=items[2],new_fragment&&new_instance.add_fragment(new_fragment),0===remaininglength)break}return new_instance},Tape.prototype.cut=Tape.prototype.slice,Tape.prototype.concat=function(other){var new_instance=new Tape;return new_instance.add_fragments(this.fragments),new_instance.add_fragments(other.fragments),new_instance},Tape.prototype.loop=function(count){var i,orig_fragments=[];for(i=0;i<this.fragments.length;i++)orig_fragments.push(this.fragments[i].clone());var new_instance=new Tape;
for(i=0;count>i;i++)new_instance.add_fragments(orig_fragments);return new_instance},Tape.prototype.times=Tape.prototype.loop,Tape.prototype.split=function(count){for(var splitted_duration=this.duration()/count,results=[],i=0;count>i;i++)results.push(this.slice(i*splitted_duration,splitted_duration));return results},Tape.prototype.fill=function(filled_duration){var duration=this.duration();if(0===duration)throw"EmptyFragment";var loop_count=filled_duration/duration|0,remain=filled_duration%duration;return this.loop(loop_count).plus(this.slice(0,remain))},Tape.prototype.replace=function(start,length,replaced){var new_instance=new Tape,offset=start+length;new_instance=new_instance.plus(this.slice(0,start));var new_instance_duration=new_instance.duration();start>new_instance_duration&&(new_instance=new_instance.plus(Scissor.silence(start-new_instance_duration))),new_instance=new_instance.plus(replaced);var duration=this.duration();return duration>offset&&(new_instance=new_instance.plus(this.slice(offset,duration-offset))),new_instance},Tape.prototype.reverse=function(){for(var new_instance=new Tape,i=this.fragments.length;i--;){var fragment=this.fragments[i].clone();fragment.reverse=!fragment.isReversed(),new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.pitch=function(pitch,stretch){var new_instance=new Tape;stretch=stretch||!1;for(var i=0;i<this.fragments.length;i++){var fragment=this.fragments[i].clone();fragment.pitch*=.01*pitch,fragment.stretch=stretch,new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.stretch=function(factor){var factor_for_pitch=1/(.01*factor)*100;return this.pitch(factor_for_pitch,!0)},Tape.prototype.pan=function(right_percent){var new_instance=new Tape;right_percent>100?right_percent=100:0>right_percent&&(right_percent=0);for(var i=0;i<this.fragments.length;i++){var fragment=this.fragments[i].clone();fragment.pan=right_percent,new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.silence=function(){return Scissor.silence(this.duration())},Tape.prototype.join=function(tapes){for(var new_instance=new Tape,i=0;i<tapes.length;i++)tapes[i]instanceof Tape&&new_instance.add_fragments(tapes[i].fragments);return new_instance},Tape.prototype.getBuffer=function(){var samplerate=44100;this.fragments.length>0&&(samplerate=this.fragments[0].samplerate);var stream=new TapeStream(this,samplerate),total_samples=this.duration()*samplerate|0;return{samplerate:samplerate,buffer:stream.fetch(total_samples)}},Fragment.prototype.duration=function(){return this._duration*(100/this.pitch)},Fragment.prototype.original_duration=function(){return this._duration},Fragment.prototype.isReversed=function(){return this.reverse},Fragment.prototype.isStretched=function(){return this.stretched},Fragment.prototype.create=function(remaining_start,remaining_length){var duration=this.duration();if(remaining_start>=duration)return[null,remaining_start-duration,remaining_length];var new_length,have_remain_to_retuen=remaining_start+remaining_length>=duration;have_remain_to_retuen?(new_length=duration-remaining_start,remaining_length-=new_length):(new_length=remaining_length,remaining_length=0);var new_fragment=this.clone();return new_fragment.start=this.start+remaining_start*this.pitch*.01,new_fragment._duration=new_length*this.pitch*.01,new_fragment.reverse=!1,[new_fragment,0,remaining_length]},Fragment.prototype.clone=function(){var new_instance=new Fragment;return new_instance.buffer=this.buffer,new_instance.samplerate=this.samplerate,new_instance.start=this.start,new_instance._duration=this._duration,new_instance.reverse=this.reverse,new_instance.pitch=this.pitch,new_instance.stretch=this.stretch,new_instance.pan=this.pan,new_instance},Scissor.Fragment=Fragment,Scissor.TapeStream=TapeStream,TapeStream.prototype.reset=function(){return this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5,this.isLooped=!1,this},TapeStream.prototype.fetch=function(n){var cellL=new T.fn.SignalArray(n),cellR=new T.fn.SignalArray(n),fragments=this.fragments;if(0===fragments.length)return[cellL,cellR];for(var pan,samplerate=100*this.samplerate,buffer=this.buffer,bufferIndex=this.bufferIndex,bufferIndexIncr=this.bufferIndexIncr,bufferBeginIndex=this.bufferBeginIndex,bufferEndIndex=this.bufferEndIndex,fragment=this.fragment,fragmentIndex=this.fragmentIndex,panL=this.panL,panR=this.panR,i=0;n>i;i++){for(;!buffer||bufferBeginIndex>bufferIndex||bufferIndex>=bufferEndIndex;)if(!fragment||fragmentIndex<fragments.length)fragment=fragments[fragmentIndex++],buffer=fragment.buffer,bufferIndexIncr=fragment.samplerate/samplerate*fragment.pitch,bufferBeginIndex=fragment.start*fragment.samplerate,bufferEndIndex=bufferBeginIndex+fragment.original_duration()*fragment.samplerate,pan=.01*fragment.pan,panL=1-pan,panR=pan,fragment.reverse?(bufferIndexIncr*=-1,bufferIndex=bufferEndIndex+bufferIndexIncr):bufferIndex=bufferBeginIndex;else{if(!this.isLooped){this.isEnded=!0,buffer=DummyBuffer,bufferIndexIncr=0,bufferIndex=0;break}buffer=null,bufferIndex=0,bufferIndexIncr=0,bufferBeginIndex=0,bufferEndIndex=0,fragment=null,fragmentIndex=0}cellL[i]=buffer[0|bufferIndex]*panL,cellR[i]=buffer[0|bufferIndex]*panR,bufferIndex+=bufferIndexIncr}return this.buffer=buffer,this.bufferIndex=bufferIndex,this.bufferIndexIncr=bufferIndexIncr,this.bufferBeginIndex=bufferBeginIndex,this.bufferEndIndex=bufferEndIndex,this.fragment=fragment,this.fragmentIndex=fragmentIndex,this.panL=panL,this.panR=panR,[cellL,cellR]},T.modules.Scissor=Scissor}(timbre),function(T){"use strict";function StereoDelay(samplerate){this.samplerate=samplerate;var bits=Math.ceil(Math.log(1.5*samplerate)*Math.LOG2E);this.buffersize=1<<bits,this.buffermask=this.buffersize-1,this.writeBufferL=new T.fn.SignalArray(this.buffersize),this.writeBufferR=new T.fn.SignalArray(this.buffersize),this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR,this.delaytime=null,this.feedback=null,this.cross=null,this.mix=null,this.prevL=0,this.prevR=0,this.readIndex=0,this.writeIndex=0,this.setParams(125,.25,!1,.45)}var $=StereoDelay.prototype;$.setParams=function(delaytime,feedback,cross,mix){if(this.delaytime!==delaytime){this.delaytime=delaytime;var offset=.001*delaytime*this.samplerate|0;offset>this.buffermask&&(offset=this.buffermask),this.writeIndex=this.readIndex+offset&this.buffermask}this.feedback!==feedback&&(this.feedback=feedback),this.cross!==cross&&(this.cross=cross,cross?(this.readBufferL=this.writeBufferR,this.readBufferR=this.writeBufferL):(this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR)),this.mix!==mix&&(this.mix=mix)},$.process=function(cellL,cellR){var x,i,readBufferL=this.readBufferL,readBufferR=this.readBufferR,writeBufferL=this.writeBufferL,writeBufferR=this.writeBufferR,readIndex=this.readIndex,writeIndex=this.writeIndex,mask=this.buffermask,fb=this.feedback,wet=this.mix,dry=1-wet,prevL=this.prevL,prevR=this.prevR,imax=cellL.length;for(i=0;imax>i;++i)x=readBufferL[readIndex],writeBufferL[writeIndex]=cellL[i]-x*fb,cellL[i]=prevL=.5*(cellL[i]*dry+x*wet+prevL),x=readBufferR[readIndex],writeBufferR[writeIndex]=cellR[i]-x*fb,cellR[i]=prevR=.5*(cellR[i]*dry+x*wet+prevR),readIndex+=1,writeIndex=writeIndex+1&mask;this.readIndex=readIndex&this.buffermask,this.writeIndex=writeIndex,this.prevL=prevL,this.prevR=prevR},T.modules.StereoDelay=StereoDelay}(timbre),function(T){"use strict";var fn=T.fn,modules=T.modules;fn.register("audio",function(_args){var BufferNode=fn.getClass("buffer"),instance=new BufferNode(_args);return instance.playbackState=fn.FINISHED_STATE,instance._.isLoaded=!1,Object.defineProperties(instance,{isLoaded:{get:function(){return this._.isLoaded}}}),instance.load=load,instance.loadthis=loadthis,instance});var load=function(src){var self=this,_=this._,dfd=new modules.Deferred(this),args=arguments,i=1;dfd.done(function(){self._.emit("done")}),"function"==typeof args[i]&&(dfd.done(args[i++]),"function"==typeof args[i]&&dfd.fail(args[i++])),_.loadedTime=0;var onloadedmetadata=function(result,msg){var _=self._;result?(self.playbackState=fn.PLAYING_STATE,_.samplerate=result.samplerate,_.channels=result.channels,_.bufferMix=null,_.buffer=result.buffer,_.phase=0,_.phaseIncr=result.samplerate/T.samplerate,_.duration=1e3*result.duration,_.currentTime=0,_.isReversed&&(_.phaseIncr*=-1,_.phase=result.buffer[0].length+_.phaseIncr),self._.emit("loadedmetadata")):dfd.reject(msg)},onloadeddata=function(){self._.isLoaded=!0,self._.plotFlush=!0,self._.emit("loadeddata"),dfd.resolveWith(self)};return(new modules.Decoder).decode(src,onloadedmetadata,onloadeddata),dfd.promise()},loadthis=function(){return load.apply(this,arguments),this}}(timbre),function(T){"use strict";function BiquadNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.biquad=new Biquad(_.samplerate),_.freq=T(340),_.band=T(1),_.gain=T(0),_.plotBefore=plotBefore,_.plotRange=[-18,18],_.plotFlush=!0}var fn=T.fn,FFT=T.modules.FFT,Biquad=T.modules.Biquad,PLOT_LOW_FREQ=20;fn.extend(BiquadNode);var plotBefore=function(context,x,y,width,height){context.lineWidth=1,context.strokeStyle="rgb(192, 192, 192)";for(var nyquist=.5*this._.samplerate,i=1;10>=i;++i)for(var j=1;4>=j;j++){var f=i*Math.pow(10,j);if(!(PLOT_LOW_FREQ>=f||f>=nyquist)){context.beginPath();var _x=Math.log(f/PLOT_LOW_FREQ)/Math.log(nyquist/PLOT_LOW_FREQ);_x=(_x*width+x|0)+.5,context.moveTo(_x,y),context.lineTo(_x,y+height),context.stroke()}}var h=height/6;for(i=1;6>i;i++){context.beginPath();var _y=(y+i*h|0)+.5;context.moveTo(x,_y),context.lineTo(x+width,_y),context.stroke()}},$=BiquadNode.prototype;Object.defineProperties($,{type:{set:function(value){var _=this._;value!==_.biquad.type&&(_.biquad.setType(value),_.plotFlush=!0)},get:function(){return this._.biquad.type}},freq:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}},cutoff:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}},res:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},Q:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},band:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},gain:{set:function(value){this._.gain=T(value)},get:function(){return this._.gain}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var freq=_.freq.process(tickID).cells[0][0],band=_.band.process(tickID).cells[0][0],gain=_.gain.process(tickID).cells[0][0];(_.prevFreq!==freq||_.prevband!==band||_.prevGain!==gain)&&(_.prevFreq=freq,_.prevband=band,_.prevGain=gain,_.biquad.setParams(freq,band,gain),_.plotFlush=!0),_.bypassed||_.biquad.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)}return this};var fft=new FFT(2048),super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var biquad=new Biquad(this._.samplerate);biquad.setType(this.type),biquad.setParams(this.freq.valueOf(),this.band.valueOf(),this.gain.valueOf());var impluse=new Float32Array(fft.length);impluse[0]=1,biquad.process(impluse,impluse),fft.forward(impluse);var i,j,f,index,delta,x0,x1,xx,size=512,data=new Float32Array(size),nyquist=.5*this._.samplerate,spectrum=new Float32Array(size);for(fft.getFrequencyData(spectrum),i=0;size>i;++i)f=Math.pow(nyquist/PLOT_LOW_FREQ,i/size)*PLOT_LOW_FREQ,j=f/(nyquist/spectrum.length),index=0|j,delta=j-index,0===index?x1=x0=xx=spectrum[index]:(x0=spectrum[index-1],x1=spectrum[index],xx=(1-delta)*x0+delta*x1),data[i]=xx;this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("biquad",BiquadNode),fn.register("lowpass",function(_args){return new BiquadNode(_args).set("type","lowpass")}),fn.register("highpass",function(_args){return new BiquadNode(_args).set("type","highpass")}),fn.register("bandpass",function(_args){return new BiquadNode(_args).set("type","bandpass")}),fn.register("lowshelf",function(_args){return new BiquadNode(_args).set("type","lowshelf")}),fn.register("highshelf",function(_args){return new BiquadNode(_args).set("type","highshelf")}),fn.register("peaking",function(_args){return new BiquadNode(_args).set("type","peaking")}),fn.register("notch",function(_args){return new BiquadNode(_args).set("type","notch")}),fn.register("allpass",function(_args){return new BiquadNode(_args).set("type","allpass")}),fn.alias("lpf","lowpass"),fn.alias("hpf","highpass"),fn.alias("bpf","bandpass"),fn.alias("bef","notch"),fn.alias("brf","notch"),fn.alias("apf","allpass")}(timbre),function(T){"use strict";function BufferNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.pitch=T(1),_.samplerate=44100,_.channels=0,_.bufferMix=null,_.buffer=[],_.isLooped=!1,_.isReversed=!1,_.duration=0,_.currentTime=0,_.currentTimeObj=null,_.phase=0,_.phaseIncr=0,_.onended=fn.make_onended(this,0),_.onlooped=make_onlooped(this)}var fn=T.fn,Tape=T.modules.Scissor.Tape,isSignalArray=function(obj){return fn.isSignalArray(obj)||obj instanceof Float32Array};fn.extend(BufferNode);var make_onlooped=function(self){return function(){var _=self._;_.phase>=_.buffer[0].length?_.phase=0:_.phase<0&&(_.phase=_.buffer[0].length+_.phaseIncr),self._.emit("looped")}},$=BufferNode.prototype,setBuffer=function(value){var _=this._;if("object"==typeof value){var samplerate,channels,buffer=[];isSignalArray(value)?(buffer[0]=value,channels=1):"object"==typeof value&&(value instanceof T.Object?value=value.buffer:value instanceof Tape&&(value=value.getBuffer()),Array.isArray(value.buffer)?isSignalArray(value.buffer[0])&&(isSignalArray(value.buffer[1])&&isSignalArray(value.buffer[2])?(channels=2,buffer=value.buffer):(channels=1,buffer=[value.buffer[0]])):isSignalArray(value.buffer)&&(channels=1,buffer=[value.buffer]),"number"==typeof value.samplerate&&(samplerate=value.samplerate)),buffer.length&&(samplerate>0&&(_.samplerate=value.samplerate),_.bufferMix=null,_.buffer=buffer,_.phase=0,_.phaseIncr=_.samplerate/T.samplerate,_.duration=1e3*_.buffer[0].length/_.samplerate,_.currentTime=0,_.plotFlush=!0,this.reverse(_.isReversed))}};Object.defineProperties($,{buffer:{set:setBuffer,get:function(){var _=this._;return{samplerate:_.samplerate,channels:_.channels,buffer:_.buffer}}},pitch:{set:function(value){this._.pitch=T(value)},get:function(){return this._.pitch}},isLooped:{get:function(){return this._.isLooped}},isReversed:{get:function(){return this._.isReversed}},samplerate:{get:function(){return this._.samplerate}},duration:{get:function(){return this._.duration}},currentTime:{set:function(value){if("number"==typeof value){var _=this._;value>=0&&value<=_.duration&&(_.phase=value/1e3*_.samplerate,_.currentTime=value)}else value instanceof T.Object?this._.currentTimeObj=value:null===value&&(this._.currentTimeObj=null)},get:function(){return this._.currentTimeObj?this._.currentTimeObj:this._.currentTime}}}),$.clone=function(){var _=this._,instance=fn.clone(this);return _.buffer.length&&setBuffer.call(instance,{buffer:_.buffer,samplerate:_.samplerate,channels:_.channels}),instance.loop(_.isLooped),instance.reverse(_.isReversed),instance},$.slice=function(begin,end){var _=this._,instance=T(_.originkey),isReversed=_.isReversed;if(_.buffer.length){if(begin="number"==typeof begin?.001*begin*_.samplerate|0:0,end="number"==typeof end?.001*end*_.samplerate|0:_.buffer[0].length,begin>end){var tmp=begin;begin=end,end=tmp,isReversed=!isReversed}2===_.channels?setBuffer.call(instance,{buffer:[fn.pointer(_.buffer[0],begin,end-begin),fn.pointer(_.buffer[1],begin,end-begin),fn.pointer(_.buffer[2],begin,end-begin)],samplerate:_.samplerate}):setBuffer.call(instance,{buffer:fn.pointer(_.buffer[0],begin,end-begin),samplerate:_.samplerate}),instance.playbackState=fn.PLAYING_STATE}return instance.loop(_.isLooped),instance.reverse(_.isReversed),instance},$.reverse=function(value){var _=this._;return _.isReversed=!!value,_.isReversed?(_.phaseIncr>0&&(_.phaseIncr*=-1),0===_.phase&&_.buffer.length&&(_.phase=_.buffer[0].length+_.phaseIncr)):_.phaseIncr<0&&(_.phaseIncr*=-1),this},$.loop=function(value){return this._.isLooped=!!value,this},$.bang=function(value){return this.playbackState=value===!1?fn.FINISHED_STATE:fn.PLAYING_STATE,this._.phase=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(!_.buffer.length)return this;if(this.tickID!==tickID){this.tickID=tickID;var i,bufferL,bufferR,cellL=this.cells[1],cellR=this.cells[2],phase=_.phase,imax=_.cellsize;if(2===_.channels?(bufferL=_.buffer[1],bufferR=_.buffer[2]):bufferL=bufferR=_.buffer[0],_.currentTimeObj){var t,pos=_.currentTimeObj.process(tickID).cells[0],sr=.001*_.samplerate;for(i=0;imax>i;++i)t=pos[i],phase=t*sr,cellL[i]=bufferL[0|phase]||0,cellR[i]=bufferR[0|phase]||0;_.phase=phase,_.currentTime=t}else{var pitch=_.pitch.process(tickID).cells[0][0],phaseIncr=_.phaseIncr*pitch;for(i=0;imax>i;++i)cellL[i]=bufferL[0|phase]||0,cellR[i]=bufferR[0|phase]||0,phase+=phaseIncr;phase>=bufferL.length?fn.nextTick(_.isLooped?_.onlooped:_.onended):0>phase&&fn.nextTick(_.isLooped?_.onlooped:_.onended),_.phase=phase,_.currentTime+=fn.currentTimeIncr}fn.outputSignalAR(this)}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var bufferL,bufferR,_=this._;if(_.plotFlush){2===_.channels?(bufferL=_.buffer[1],bufferR=_.buffer[2]):bufferL=bufferR=_.buffer[0];for(var data=new Float32Array(2048),x=0,xIncr=bufferL.length/2048,i=0;2048>i;i++)data[i]=.5*(bufferL[0|x]+bufferR[0|x]),x+=xIncr;_.plotData=data,_.plotFlush=null}return super_plot.call(this,opts)},fn.register("buffer",BufferNode)}(timbre),function(T){"use strict";function ChorusNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var chorus=new Chorus(this._.samplerate);chorus.setDelayTime(20),chorus.setRate(4),chorus.depth=20,chorus.feedback=.2,chorus.mix=.33,this._.chorus=chorus}var fn=T.fn,Chorus=T.modules.Chorus;fn.extend(ChorusNode);var $=ChorusNode.prototype;Object.defineProperties($,{type:{set:function(value){this._.chorus.setDelayTime(value)},get:function(){return this._.chorus.wave}},delay:{set:function(value){value>=.5&&80>=value&&this._.chorus.setDelayTime(value)},get:function(){return this._.chorus.delayTime}},rate:{set:function(value){"number"==typeof value&&value>0&&this._.chorus.setRate(value)},get:function(){return this._.chorus.rate}},depth:{set:function(value){"number"==typeof value&&value>=0&&100>=value&&(value*=this._.samplerate/44100,this._.chorus.depth=value)},get:function(){return this._.chorus.depth}},fb:{set:function(value){"number"==typeof value&&value>=-1&&1>=value&&(this._.chorus.feedback=.99996*value)},get:function(){return this._.chorus.feedback}},mix:{set:function(value){this._.mix=T(value)},get:function(){return this._.mix}}}),$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,fn.inputSignalAR(this),_.bypassed||_.chorus.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)),this},fn.register("chorus",ChorusNode)}(timbre),function(T){"use strict";function ClipNode(_args){T.Object.call(this,2,_args);var _=this._;_.min=-.8,_.max=.8}var fn=T.fn;fn.extend(ClipNode);var $=ClipNode.prototype;Object.defineProperties($,{minmax:{set:function(value){var _=this._;"number"==typeof value&&(_.min=-Math.abs(value),_.max=-_.min)},get:function(){return this._.max}},min:{set:function(value){var _=this._;"number"==typeof value&&(_.max<value?_.max=value:_.min=value)},get:function(){return this._.min}},max:{set:function(value){var _=this._;"number"==typeof value&&(value<_.min?_.min=value:_.max=value)},get:function(){return this._.max}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,value,cellL=this.cells[1],cellR=this.cells[2],imax=cellL.length,min=_.min,max=_.max;if(_.ar){for(fn.inputSignalAR(this),i=0;imax>i;++i)value=cellL[i],min>value?value=min:value>max&&(value=max),cellL[i]=value,value=cellR[i],min>value?value=min:value>max&&(value=max),cellR[i]=value;fn.outputSignalAR(this)}else value=fn.inputSignalKR(this),min>value?value=min:value>max&&(value=max),this.cells[0][0]=value,fn.outputSignalKR(this)}return this},fn.register("clip",ClipNode)}(timbre),function(T){"use strict";function CompressorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.prevThresh=-24,_.prevKnee=30,_.prevRatio=12,_.thresh=T(_.prevThresh),_.knee=T(_.prevKnee),_.ratio=T(_.prevRatio),_.postGain=6,_.reduction=0,_.attack=3,_.release=25,_.comp=new Compressor(_.samplerate),_.comp.dbPostGain=_.postGain,_.comp.setAttackTime(.001*_.attack),_.comp.setReleaseTime(.001*_.release),_.comp.setPreDelayTime(6),_.comp.setParams(_.prevThresh,_.prevKnee,_.prevRatio)}var fn=T.fn,timevalue=T.timevalue,Compressor=T.modules.Compressor;fn.extend(CompressorNode);var $=CompressorNode.prototype;Object.defineProperties($,{thresh:{set:function(value){this._.thresh=T(value)},get:function(){return this._.thresh}},thre:{set:function(value){this._.thresh=T(value)},get:function(){return this._.thre}},knee:{set:function(value){this._.kne=T(value)},get:function(){return this._.knee}},ratio:{set:function(value){this._.ratio=T(value)},get:function(){return this._.ratio}},gain:{set:function(value){"number"==typeof value&&(this._.comp.dbPostGain=value)},get:function(){return this._.comp.dbPostGain}},attack:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&(value=0>value?0:value>1e3?1e3:value,this._.attack=value,this._.comp.setAttackTime(.001*value))},get:function(){return this._.attack}},release:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&(value=0>value?0:value>1e3?1e3:value,this._.release=value,this._.comp.setReleaseTime(.001*value))},get:function(){return this._.release}},reduction:{get:function(){return this._.reduction}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var thresh=_.thresh.process(tickID).cells[0][0],knee=_.knee.process(tickID).cells[0][0],ratio=_.ratio.process(tickID).cells[0][0];(_.prevThresh!==thresh||_.prevKnee!==knee||_.prevRatio!==ratio)&&(_.prevThresh=thresh,_.prevKnee=knee,_.prevRatio=ratio,_.comp.setParams(thresh,knee,ratio)),_.bypassed||(_.comp.process(this.cells[1],this.cells[2]),_.reduction=_.comp.meteringGain),fn.outputSignalAR(this)}return this},fn.register("comp",CompressorNode)}(timbre),function(T){"use strict";function DelayNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.time=T(100),_.fb=T(.2),_.cross=T(!1),_.mix=.33,_.delay=new StereoDelay(_.samplerate)}var fn=T.fn,timevalue=T.timevalue,StereoDelay=T.modules.StereoDelay;fn.extend(DelayNode);var $=DelayNode.prototype;Object.defineProperties($,{time:{set:function(value){"string"==typeof value&&(value=timevalue(value)),this._.time=T(value)},get:function(){return this._.time}},fb:{set:function(value){this._.fb=T(value)},get:function(){return this._.fb}},cross:{set:function(value){this._.cross=T(value)},get:function(){return this._.cross}},mix:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.mix=value)},get:function(){return this._.mix}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var time=_.time.process(tickID).cells[0][0],fb=_.fb.process(tickID).cells[0][0],cross=0!==_.cross.process(tickID).cells[0][0],mix=_.mix;(_.prevTime!==time||_.prevFb!==fb||_.prevCross!==cross||_.prevMix!==mix)&&(_.prevTime=time,_.prevFb=fb,_.prevCross=cross,_.prevMix=mix,_.delay.setParams(time,fb,cross,mix)),fn.inputSignalAR(this),_.bypassed||_.delay.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)}return this},fn.register("delay",DelayNode)}(timbre),function(T){"use strict";function DistNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.pre=T(60),_.post=T(-18),_.x1L=_.x2L=_.y1L=_.y2L=0,_.x1R=_.x2R=_.y1R=_.y2R=0,_.b0=_.b1=_.b2=_.a1=_.a2=0,_.cutoff=0,_.Q=1,_.preScale=0,_.postScale=0}var fn=T.fn;fn.extend(DistNode);var $=DistNode.prototype;Object.defineProperties($,{cutoff:{set:function(value){"number"==typeof value&&value>0&&(this._.cutoff=value)},get:function(){return this._.cutoff}},pre:{set:function(value){this._.pre=T(value)},get:function(){return this._.pre}},post:{set:function(value){this._.post=T(value)},get:function(){return this._.post}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var preGain=-_.pre.process(tickID).cells[0][0],postGain=-_.post.process(tickID).cells[0][0];if((_.prevPreGain!==preGain||_.prevPostGain!==postGain)&&(_.prevPreGain=preGain,_.prevPostGain=postGain,_.preScale=Math.pow(10,.05*-preGain),_.postScale=Math.pow(10,.05*-postGain)),!_.bypassed){var i,imax,value,x0,y0,cellL=this.cells[1],cellR=this.cells[2],preScale=_.preScale,postScale=_.postScale;if(_.cutoff){_.prevCutoff!==_.cutoff&&(_.prevCutoff=_.cutoff,lowpass_params(_));var x1L=_.x1L,x2L=_.x2L,y1L=_.y1L,y2L=_.y2L,x1R=_.x1R,x2R=_.x2R,y1R=_.y1R,y2R=_.y2R,b0=_.b0,b1=_.b1,b2=_.b2,a1=_.a1,a2=_.a2;for(i=0,imax=cellL.length;imax>i;++i)x0=cellL[i]*preScale,y0=b0*x0+b1*x1L+b2*x2L-a1*y1L-a2*y2L,value=y0*postScale,-1>value?value=-1:value>1&&(value=1),cellL[i]=value,x2L=x1L,x1L=x0,y2L=y1L,y1L=y0,x0=cellR[i]*preScale,y0=b0*x0+b1*x1R+b2*x2R-a1*y1R-a2*y2R,value=y0*postScale,-1>value?value=-1:value>1&&(value=1),cellR[i]=value,x2R=x1R,x1R=x0,y2R=y1R,y1R=y0;_.x1L=x1L,_.x2L=x2L,_.y1L=y1L,_.y2L=y2L,_.x1R=x1R,_.x2R=x2R,_.y1R=y1R,_.y2R=y2R}else for(i=0,imax=cellL.length;imax>i;++i)value=cellL[i]*preScale*postScale,-1>value?value=-1:value>1&&(value=1),cellL[i]=value,value=cellR[i]*preScale*postScale,-1>value?value=-1:value>1&&(value=1),cellR[i]=value}fn.outputSignalAR(this)}return this};var lowpass_params=function(_){var w0=2*Math.PI*_.cutoff/_.samplerate,cos=Math.cos(w0),sin=Math.sin(w0),alpha=sin/(2*_.Q),ia0=1/(1+alpha);_.b0=.5*(1-cos)*ia0,_.b1=1-cos*ia0,_.b2=.5*(1-cos)*ia0,_.a1=-2*cos*ia0,_.a2=1-alpha*ia0};fn.register("dist",DistNode)}(timbre),function(T){"use strict";function DivNode(_args){T.Object.call(this,2,_args),this._.ar=!1}var fn=T.fn;fn.extend(DivNode);var $=DivNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,div,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)div=tmpL[j],cellL[j]=0===div?0:cellL[j]/div,div=tmpR[j],cellR[j]=0===div?0:cellR[j]/div;else for(j=0;jmax>j;++j)cellL[j]=cellR[i]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)div=nodes[i].process(tickID).cells[0][0],tmp=0===div?0:tmp/div;else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("/",DivNode)}(timbre),function(T){"use strict";function EnvNode(_args){T.Object.call(this,2,_args);var _=this._;_.env=new Envelope(_.samplerate),_.env.setStep(_.cellsize),_.tmp=new fn.SignalArray(_.cellsize),_.ar=!1,_.plotFlush=!0,_.onended=make_onended(this),this.on("ar",onar)}function envValue(opts,min,def,name1,name2,func){var x=def;return"number"==typeof opts[name1]?x=opts[name1]:"number"==typeof opts[name2]?x=opts[name2]:func&&("string"==typeof opts[name1]?x=func(opts[name1]):"string"==typeof opts[name2]&&(x=func(opts[name2]))),min>x&&(x=min),x}var fn=T.fn,timevalue=T.timevalue,Envelope=T.modules.Envelope,isDictionary=fn.isDictionary;fn.extend(EnvNode);var onar=function(value){this._.env.setStep(value?1:this._.cellsize)},make_onended=function(self){return function(){self._.emit("ended")}},$=EnvNode.prototype;Object.defineProperties($,{table:{set:function(value){Array.isArray(value)&&(setTable.call(this,value),this._.plotFlush=!0)},get:function(){return this._.env.table}},curve:{set:function(value){this._.env.setCurve(value)},get:function(){return this._.env.curve}},releaseNode:{set:function(value){this._.env.setReleaseNode(value),this._.plotFlush=!0},get:function(){return this._.env.releaseNode+1}},loopNode:{set:function(value){this._.env.setLoopNode(value),this._.plotFlush=!0},get:function(){return this._.env.loopNode+1}}}),$.clone=function(){var instance=fn.clone(this);return instance._.env=this._.env.clone(),instance},$.reset=function(){return this._.env.reset(),this},$.release=function(){var _=this._;return _.env.release(),_.emit("released"),this},$.bang=function(){var _=this._;return _.env.reset(),_.env.status=Envelope.StatusGate,_.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;var value,emit=null;if(_.ar){var tmp=_.tmp;for(_.env.process(tmp),i=0;imax>i;++i)cellL[i]*=tmp[i],cellR[i]*=tmp[i];emit=_.env.emit}else{for(value=_.env.next(),i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value;emit=_.env.emit}fn.outputSignalAR(this),emit&&("ended"===emit?fn.nextTick(_.onended):this._.emit(emit,_.value))}return this};var setTable=function(list){for(var value,time,curveType,curveValue,env=this._.env,table=[list[0]||ZERO],i=1,imax=list.length;imax>i;++i)value=list[i][0]||ZERO,time=list[i][1],curveType=list[i][2],"number"!=typeof time&&(time="string"==typeof time?timevalue(time):10),10>time&&(time=10),"number"==typeof curveType?(curveValue=curveType,curveType=Envelope.CurveTypeCurve):(curveType=Envelope.CurveTypeDict[curveType]||null,curveValue=0),table.push([value,time,curveType,curveValue]);env.setTable(table)},super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var i,imax,env=this._.env.clone(),info=env.getInfo(1e3),totalDuration=info.totalDuration,loopBeginTime=info.loopBeginTime,releaseBeginTime=info.releaseBeginTime,data=new Float32Array(256),duration=0,durationIncr=totalDuration/data.length,isReleased=!1,samples=.001*totalDuration*this._.samplerate|0;for(samples/=data.length,env.setStep(samples),env.status=Envelope.StatusGate,i=0,imax=data.length;imax>i;++i)data[i]=env.next(),duration+=durationIncr,!isReleased&&duration>=releaseBeginTime&&(env.release(),isReleased=!0);this._.plotData=data,this._.plotBefore=function(context,x,y,width,height){var x1,w;1/0!==loopBeginTime&&1/0!==releaseBeginTime&&(x1=x+width*(loopBeginTime/totalDuration),w=x+width*(releaseBeginTime/totalDuration),w-=x1,context.fillStyle="rgba(224, 224, 224, 0.8)",context.fillRect(x1,0,w,height)),1/0!==releaseBeginTime&&(x1=x+width*(releaseBeginTime/totalDuration),w=width-x1,context.fillStyle="rgba(212, 212, 212, 0.8)",context.fillRect(x1,0,w,height))};var minValue=1/0,maxValue=-1/0;for(i=0;imax>i;++i)data[i]<minValue?minValue=data[i]:data[i]>maxValue&&(maxValue=data[i]);1>maxValue&&(maxValue=1),this._.plotRange=[minValue,maxValue],this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("env",EnvNode);var ZERO=Envelope.ZERO;fn.register("perc",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),r=envValue(opts,10,1e3,"r","releaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[ZERO,r]],new EnvNode(_args)}),fn.register("adsr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","decayTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[s,d],[ZERO,r]],opts.releaseNode=3,new EnvNode(_args)}),fn.register("adshr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),h=envValue(opts,10,500,"h","holdTime",timevalue),r=envValue(opts,10,1e3,"r","decayTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");
return opts.table=[ZERO,[lv,a],[s,d],[s,h],[ZERO,r]],new EnvNode(_args)}),fn.register("asr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","releaseTime",timevalue);return opts.table=[ZERO,[s,a],[ZERO,r]],opts.releaseNode=2,new EnvNode(_args)}),fn.register("dadsr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],dl=envValue(opts,10,100,"dl","delayTime",timevalue),a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[ZERO,dl],[lv,a],[s,d],[ZERO,r]],opts.releaseNode=4,new EnvNode(_args)}),fn.register("ahdsfr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),h=envValue(opts,10,10,"h","holdTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),f=envValue(opts,10,5e3,"f","fadeTime",timevalue),r=envValue(opts,10,1e3,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[lv,h],[s,d],[ZERO,f],[ZERO,r]],opts.releaseNode=5,new EnvNode(_args)}),fn.register("linen",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),s=envValue(opts,10,1e3,"s","sustainTime",timevalue),r=envValue(opts,10,1e3,"r","releaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[lv,s],[ZERO,r]],new EnvNode(_args)}),fn.register("env.tri",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],dur=envValue(opts,20,1e3,"dur","duration",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return dur*=.5,opts.table=[ZERO,[lv,dur],[ZERO,dur]],new EnvNode(_args)}),fn.register("env.cutoff",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],r=envValue(opts,10,100,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[lv,[ZERO,r]],new EnvNode(_args)})}(timbre),function(T){"use strict";function EQNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.biquads=new Array(7),_.plotBefore=plotBefore,_.plotRange=[-18,18],_.plotFlush=!0}var fn=T.fn,FFT=T.modules.FFT,Biquad=T.modules.Biquad,PLOT_LOW_FREQ=20,PARAM_NAMES={hpf:0,lf:1,lmf:2,mf:3,hmf:4,hf:5,lpf:6};fn.extend(EQNode);var plotBefore=function(context,x,y,width,height){context.lineWidth=1,context.strokeStyle="rgb(192, 192, 192)";for(var nyquist=.5*this._.samplerate,i=1;10>=i;++i)for(var j=1;4>=j;j++){var f=i*Math.pow(10,j);if(!(PLOT_LOW_FREQ>=f||f>=nyquist)){context.beginPath();var _x=Math.log(f/PLOT_LOW_FREQ)/Math.log(nyquist/PLOT_LOW_FREQ);_x=(_x*width+x|0)+.5,context.moveTo(_x,y),context.lineTo(_x,y+height),context.stroke()}}var h=height/6;for(i=1;6>i;i++){context.beginPath();var _y=(y+i*h|0)+.5;context.moveTo(x,_y),context.lineTo(x+width,_y),context.stroke()}},$=EQNode.prototype;Object.defineProperties($,{params:{set:function(value){if("object"==typeof value)for(var keys=Object.keys(value),i=0,imax=keys.length;imax>i;++i){var items=value[keys[i]];Array.isArray(items)?this.setParams(keys[i],items[0],items[1],items[2]):this.setParams(keys[i])}}}}),$.setParams=function(index,freq,Q,gain){var _=this._;if("string"==typeof index&&(index=PARAM_NAMES[index]),index>=0&&index<_.biquads.length){if(index|=0,"number"==typeof freq&&"number"==typeof Q){"number"!=typeof gain&&(gain=0);var biquad=_.biquads[index];if(!biquad)switch(biquad=_.biquads[index]=new Biquad(_.samplerate),index){case 0:biquad.setType("highpass");break;case _.biquads.length-1:biquad.setType("lowpass");break;default:biquad.setType("peaking")}biquad.setParams(freq,Q,gain)}else _.biquads[index]=void 0;_.plotFlush=!0}return this},$.getParams=function(index){var _=this._,biquad=_.biquads[0|index];return biquad?{freq:biquad.frequency,Q:biquad.Q,gain:biquad.gain}:void 0},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),!_.bypassed)for(var cellL=this.cells[1],cellR=this.cells[2],biquads=_.biquads,i=0,imax=biquads.length;imax>i;++i)biquads[i]&&biquads[i].process(cellL,cellR);fn.outputSignalAR(this)}return this};var fft=new FFT(2048),super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var _=this._,impluse=new Float32Array(fft.length);impluse[0]=1;for(var i=0,imax=_.biquads.length;imax>i;++i){var params=this.getParams(i);if(params){var biquad=new Biquad(_.samplerate);biquad.setType(0===i?"highpass":i===imax-1?"lowpass":"peaking"),biquad.setParams(params.freq,params.Q,params.gain),biquad.process(impluse,impluse)}}fft.forward(impluse);var j,f,index,delta,x0,x1,xx,size=512,data=new Float32Array(size),nyquist=.5*_.samplerate,spectrum=new Float32Array(size);for(fft.getFrequencyData(spectrum),i=0;size>i;++i)f=Math.pow(nyquist/PLOT_LOW_FREQ,i/size)*PLOT_LOW_FREQ,j=f/(nyquist/spectrum.length),index=0|j,delta=j-index,0===index?x1=x0=xx=spectrum[index]:(x0=spectrum[index-1],x1=spectrum[index],xx=(1-delta)*x0+delta*x1),data[i]=xx;this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("eq",EQNode)}(timbre),function(T){"use strict";function FFTNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this),this.real=new T.ChannelObject(this),this.imag=new T.ChannelObject(this),this.cells[3]=this.real.cell,this.cells[4]=this.imag.cell;var _=this._;_.fft=new FFT(2*_.cellsize),_.fftCell=new fn.SignalArray(_.fft.length),_.prevCell=new fn.SignalArray(_.cellsize),_.freqs=new fn.SignalArray(_.fft.length>>1),_.plotFlush=!0,_.plotRange=[0,32],_.plotBarStyle=!0}var fn=T.fn,FFT=T.modules.FFT;fn.extend(FFTNode);var $=FFTNode.prototype;Object.defineProperties($,{window:{set:function(value){this._.fft.setWindow(value)},get:function(){return this._.fft.windowName}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var cell=this.cells[0],cellsize=_.cellsize;_.fftCell.set(_.prevCell),_.fftCell.set(cell,cellsize),_.fft.forward(_.fftCell),_.prevCell.set(cell),_.plotFlush=!0,this.cells[3].set(_.fft.real.subarray(0,cellsize)),this.cells[4].set(_.fft.imag.subarray(0,cellsize))}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),super_plot.call(this,opts)},fn.register("fft",FFTNode)}(timbre),function(T){"use strict";function FNoiseNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.freq=T(440),_.reg=32768,_.shortFlag=!1,_.phase=0,_.lastValue=0}var fn=T.fn;fn.extend(FNoiseNode);var $=FNoiseNode.prototype;Object.defineProperties($,{shortFlag:{set:function(value){this._.shortFlag=!!value},get:function(){return this._.shortFlag}},freq:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}}}),$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){this.tickID=tickID;var i,imax,lastValue=_.lastValue,phase=_.phase,phaseStep=_.freq.process(tickID).cells[0][0]/_.samplerate,reg=_.reg,mul=_.mul,add=_.add;if(_.shortFlag)for(i=0,imax=cell.length;imax>i;++i)phase>=1&&(reg>>=1,reg|=(1&(reg^reg>>6))<<15,lastValue=(1&reg)-.5,phase-=1),cell[i]=lastValue*mul+add,phase+=phaseStep;else for(i=0,imax=cell.length;imax>i;++i)phase>=1&&(reg>>=1,reg|=(1&(reg^reg>>1))<<15,lastValue=(1&reg)-.5,phase-=1),cell[i]=lastValue*mul+add,phase+=phaseStep;_.reg=reg,_.phase=phase,_.lastValue=lastValue}return this},fn.register("fnoise",FNoiseNode)}(timbre),function(T){"use strict";function GateNode(_args){T.Object.call(this,2,_args),fn.fixAR(this),this._.selected=0,this._.outputs=[]}var fn=T.fn,GateChannelNode=function(){function GateChannelNode(parent){T.Object.call(this,2,[]),fn.fixAR(this),this._.parent=parent}return fn.extend(GateChannelNode),GateChannelNode.prototype.process=function(tickID){return this.tickID!==tickID&&(this.tickID=tickID,this._.parent.process(tickID)),this},GateChannelNode}();fn.extend(GateNode);var $=GateNode.prototype;Object.defineProperties($,{selected:{set:function(value){var _=this._;if("number"==typeof value){_.selected=value;for(var outputs=_.outputs,i=0,imax=outputs.length;imax>i;++i)outputs[i]&&(outputs[i].cells[0].set(fn.emptycell),outputs[i].cells[1].set(fn.emptycell),outputs[i].cells[2].set(fn.emptycell))}},get:function(){return this._.selected}}}),$.at=function(index){var _=this._,output=_.outputs[index];return output||(_.outputs[index]=output=new GateChannelNode(this)),output},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var output=_.outputs[_.selected];output&&(output.cells[0].set(this.cells[0]),output.cells[1].set(this.cells[1]),output.cells[2].set(this.cells[2]))}return this},fn.register("gate",GateNode)}(timbre),function(T){"use strict";function IFFTNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.fft=new FFT(2*_.cellsize),_.fftCell=new fn.SignalArray(this._.fft.length),_.realBuffer=new fn.SignalArray(this._.fft.length),_.imagBuffer=new fn.SignalArray(this._.fft.length)}var fn=T.fn,FFT=T.modules.FFT;fn.extend(IFFTNode);var $=IFFTNode.prototype;Object.defineProperties($,{real:{set:function(value){this._.real=T(value)},get:function(){return this._.real}},imag:{set:function(value){this._.imag=T(value)},get:function(){return this._.imag}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID&&(this.tickID=tickID,_.real&&_.imag)){var cell=this.cells[0],real=_.realBuffer,imag=_.imagBuffer,_real=_.real.process(tickID).cells[0],_imag=_.imag.process(tickID).cells[0];real.set(_real),imag.set(_imag),cell.set(_.fft.inverse(real,imag).subarray(0,_.cellsize)),fn.outputSignalAR(this)}return this},fn.register("ifft",IFFTNode)}(timbre),function(T){"use strict";function IntervalNode(_args){T.Object.call(this,1,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.interval=T(1e3),_.count=0,_.delay=0,_.timeout=1/0,_.currentTime=0,_.delaySamples=0,_.countSamples=0,_.onended=fn.make_onended(this),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue;fn.extend(IntervalNode);var onstart=function(){var _=this._;this.playbackState=fn.PLAYING_STATE,_.delaySamples=.001*_.samplerate*_.delay|0,_.countSamples=_.count=_.currentTime=0};Object.defineProperty(onstart,"unremovable",{value:!0,writable:!1});var $=IntervalNode.prototype;Object.defineProperties($,{interval:{set:function(value){"string"==typeof value&&(value=timevalue(value),0>=value&&(value=0)),this._.interval=T(value)},get:function(){return this._.interval}},delay:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this._.delay=value,this._.delaySamples=.001*this._.samplerate*value|0)},get:function(){return this._.delay}},count:{set:function(value){"number"==typeof value&&(this._.count=value)},get:function(){return this._.count}},timeout:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this._.timeout=value)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),$.bang=function(){var _=this._;return this.playbackState=fn.PLAYING_STATE,_.delaySamples=.001*_.samplerate*_.delay|0,_.countSamples=_.count=_.currentTime=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID,_.delaySamples>0&&(_.delaySamples-=cell.length);var interval=_.interval.process(tickID).cells[0][0];if(_.delaySamples<=0&&(_.countSamples-=cell.length,_.countSamples<=0)){_.countSamples+=_.samplerate*interval*.001|0;for(var nodes=this.nodes,count=_.count,x=count*_.mul+_.add,j=0,jmax=cell.length;jmax>j;++j)cell[j]=x;for(var i=0,imax=nodes.length;imax>i;++i)nodes[i].bang(count);_.count+=1}_.currentTime+=fn.currentTimeIncr,_.currentTime>=_.timeout&&fn.nextTick(_.onended)}return this},fn.register("interval",IntervalNode)}(timbre),function(T){"use strict";function LagNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._,bits=Math.ceil(Math.log(_.samplerate)*Math.LOG2E);_.buffersize=1<<bits,_.buffermask=_.buffersize-1,_.buffer=new fn.SignalArray(_.buffersize),_.time=0,_.readIndex=0,_.writeIndex=0}var fn=T.fn,timevalue=T.timevalue;fn.extend(LagNode);var $=LagNode.prototype;Object.defineProperties($,{time:{set:function(value){if("string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0){var _=this._;_.time=value;var offset=.001*value*_.samplerate|0;offset>_.buffermask&&(offset=_.buffermask),_.writeIndex=_.readIndex+offset&_.buffermask}},get:function(){return this._.time}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var i,cell=this.cells[0],buffer=_.buffer,mask=_.buffermask,readIndex=_.readIndex,writeIndex=_.writeIndex,imax=cell.length;for(i=0;imax>i;++i)buffer[writeIndex]=cell[i],cell[i]=buffer[readIndex],readIndex+=1,writeIndex=writeIndex+1&mask;_.readIndex=readIndex&mask,_.writeIndex=writeIndex,fn.outputSignalAR(this)}return this},fn.register("lag",LagNode)}(timbre),function(T){"use strict";function MapNode(_args){T.Object.call(this,1,_args);var _=this._;_.input=0,_.value=0,_.prev=null,_.ar=!1,_.map=defaultFunction}var fn=T.fn;fn.extend(MapNode);var defaultFunction=function(x){return x},$=MapNode.prototype;Object.defineProperties($,{input:{set:function(value){"number"==typeof value&&(this._.input=value)},get:function(){return this._.input}},map:{set:function(value){"function"==typeof value&&(this._.map=value)},get:function(){return this._.map}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(input){return this._.map?this._.map(input):0},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var map=_.map;if(map)for(i=0;imax>i;++i)cell[i]=map(cell[i]);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=len?fn.inputSignalKR(this):_.input;_.map&&_.prev!==input&&(_.prev=input,_.value=_.map(input));var value=_.value*_.mul+_.add;for(i=0;imax>i;++i)cell[i]=value}}return this},fn.register("map",MapNode)}(timbre),function(T){"use strict";function MaxNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MaxNode);var $=MaxNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,val,nodes=this.nodes,imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0],cell.set(tmp),i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)val=tmp[j],cell[j]<val&&(cell[j]=val);else for(j=0;jmax>j;++j)cell[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)val=nodes[i].process(tickID).cells[0][0],val>tmp&&(tmp=val);else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("max",MaxNode)}(timbre),function(T){"use strict";function MediaStreamNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.src=_.func=null,_.bufferL=new fn.SignalArray(BUFFER_SIZE),_.bufferR=new fn.SignalArray(BUFFER_SIZE),_.readIndex=0,_.writeIndex=0,_.totalRead=0,_.totalWrite=0}if("browser"===T.envtype){var fn=T.fn,BUFFER_SIZE=4096,BUFFER_MASK=BUFFER_SIZE-1;fn.extend(MediaStreamNode);var $=MediaStreamNode.prototype;$.listen=function(audio){var _impl=impl[T.env];_impl&&(_impl.set.call(this,audio),_impl.listen.call(this))},$.unlisten=function(){var _impl=impl[T.env];_impl&&_impl.unlisten.call(this),this.cells[0].set(fn.emptycell),this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell);for(var _=this._,bufferL=_.bufferL,bufferR=_.bufferR,i=0,imax=bufferL.length;imax>i;++i)bufferL[i]=bufferR[i]=0},$.process=function(tickID){var _=this._;if(null===_.src)return this;if(this.tickID!==tickID){this.tickID=tickID;var cellsize=_.cellsize;if(_.totalWrite>_.totalRead+cellsize){var begin=_.readIndex,end=begin+cellsize;this.cells[1].set(_.bufferL.subarray(begin,end)),this.cells[2].set(_.bufferR.subarray(begin,end)),_.readIndex=end&BUFFER_MASK,_.totalRead+=cellsize}fn.outputSignalAR(this)}return this};var impl={};impl.webkit={set:function(src){var _=this._;if(src instanceof HTMLMediaElement){var context=fn._audioContext;_.src=context.createMediaElementSource(src)}},listen:function(){var _=this._,context=fn._audioContext;_.gain=context.createGainNode(),_.gain.gain.value=0,_.node=context.createJavaScriptNode(1024,2,2),_.node.onaudioprocess=onaudioprocess(this),_.src.connect(_.node),_.node.connect(_.gain),_.gain.connect(context.destination)},unlisten:function(){var _=this._;_.src&&_.src.disconnect(),_.gain&&_.gain.disconnect(),_.node&&_.node.disconnect()}};var onaudioprocess=function(self){return function(e){var _=self._,ins=e.inputBuffer,length=ins.length,writeIndex=_.writeIndex;_.bufferL.set(ins.getChannelData(0),writeIndex),_.bufferR.set(ins.getChannelData(1),writeIndex),_.writeIndex=writeIndex+length&BUFFER_MASK,_.totalWrite+=length}};impl.moz={set:function(src){var _=this._;src instanceof HTMLAudioElement&&(_.src=src,_.istep=_.samplerate/src.mozSampleRate)},listen:function(){var _=this._,o0=_.bufferL,o1=_.bufferR,prev0=0,prev1=0;2===_.src.mozChannels?(_.x=0,_.func=function(e){var x,i,writeIndex=_.writeIndex,totalWrite=_.totalWrite,samples=e.frameBuffer,istep=_.istep,imax=samples.length;for(x=_.x,i=0;imax>i;i+=2){for(x+=istep;x>0;)o0[writeIndex]=.5*(samples[i]+prev0),o1[writeIndex]=.5*(samples[i+1]+prev1),writeIndex=writeIndex+1&BUFFER_MASK,++totalWrite,x-=1;prev0=samples[i],prev1=samples[i+1]}_.x=x,_.writeIndex=writeIndex,_.totalWrite=totalWrite}):(_.x=0,_.func=function(e){var x,i,writeIndex=_.writeIndex,totalWrite=_.totalWrite,samples=e.frameBuffer,istep=_.istep,imax=samples.length;for(x=_.x,i=0;imax>i;++i){for(x+=istep;x>=0;)o0[writeIndex]=o1[writeIndex]=.5*(samples[i]+prev0),writeIndex=writeIndex+1&BUFFER_MASK,++totalWrite,x-=1;prev0=samples[i]}_.x=x,_.writeIndex=writeIndex,_.totalWrite=totalWrite}),_.src.addEventListener("MozAudioAvailable",_.func)},unlisten:function(){var _=this._;_.func&&(_.src.removeEventListener("MozAudioAvailable",_.func),_.func=null)}},fn.register("mediastream",MediaStreamNode)}}(timbre),function(T){"use strict";function MidiCpsNode(_args){T.Object.call(this,1,_args);var _=this._;_.midi=0,_.value=0,_.prev=null,_.a4=440,_.ar=!1}var fn=T.fn;fn.extend(MidiCpsNode);var $=MidiCpsNode.prototype;Object.defineProperties($,{midi:{set:function(value){"number"==typeof value&&(this._.midi=value)},get:function(){return this._.midi}},a4:{set:function(value){"number"==typeof value&&(this._.a4=value,this._.prev=null)},get:function(){return this._.a4}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(midi){var _=this._;return _.a4*Math.pow(2,(midi-69)/12)},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cell=this.cells[0],len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var a4=_.a4;for(i=0;imax>i;++i)cell[i]=a4*Math.pow(2,(cell[i]-69)/12);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=len?fn.inputSignalKR(this):_.midi;_.prev!==input&&(_.prev=input,_.value=_.a4*Math.pow(2,(input-69)/12)),cell[0]=_.value,fn.outputSignalKR(this)}}return this},fn.register("midicps",MidiCpsNode)}(timbre),function(T){"use strict";function MidiRatioNode(_args){T.Object.call(this,1,_args);var _=this._;_.midi=0,_.value=0,_.prev=null,_.range=12,_.ar=!1}var fn=T.fn;fn.extend(MidiRatioNode);var $=MidiRatioNode.prototype;Object.defineProperties($,{midi:{set:function(value){"number"==typeof value&&(this._.midi=value)},get:function(){return this._.midi}},range:{set:function(value){"number"==typeof value&&value>0&&(this._.range=value)},get:function(){return this._.range}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(midi){var _=this._;return Math.pow(2,midi/_.range)},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var range=_.range;for(i=0;imax>i;++i)cell[i]=Math.pow(2,cell[i]/range);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=this.nodes.length?fn.inputSignalKR(this):_.midi;_.prev!==input&&(_.prev=input,_.value=Math.pow(2,input/_.range));var value=_.value*_.mul+_.add;for(i=0;imax>i;++i)cell[i]=value}}return this},fn.register("midiratio",MidiRatioNode)}(timbre),function(T){"use strict";function MinNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MinNode);var $=MinNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,val,nodes=this.nodes,imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0],cell.set(tmp),i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)val=tmp[j],cell[j]>val&&(cell[j]=val);else for(j=0;jmax>j;++j)cell[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)val=nodes[i].process(tickID).cells[0][0],tmp>val&&(tmp=val);else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("min",MinNode)}(timbre),function(T){"use strict";function MML(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.tracks=[],_.onended=fn.make_onended(this),_.currentTime=0,this.on("start",onstart)}var fn=T.fn;fn.extend(MML);var onstart=function(){var self=this,_=this._,mml=_.mml;"string"==typeof mml&&(mml=[mml]),_.tracks=mml.map(function(mml,i){return new MMLTrack(self,i,mml)}),_.currentTime=0,this.playbackState=fn.PLAYING_STATE};Object.defineProperty(onstart,"unremoved",{value:!0,writable:!1});var $=MML.prototype;Object.defineProperties($,{mml:{set:function(value){var _=this._;("string"==typeof value||Array.isArray(value))&&(_.mml=value)},get:function(){return this._.mml}},currentTime:{get:function(){return this._.currentTime}}}),$.on=$.addListener=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.on(type,listener),this},$.once=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.once(type,listener),this},$.off=$.removeListener=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.off(type,listener),this},$.removeAllListeners=function(type){return"mml"===type&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),type="data"),this._.events.removeAllListeners(type),this},$.listeners=function(type){return"mml"===type&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),type="data"),this._.events.listeners(type)},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,tracks=_.tracks;for(i=0,imax=tracks.length;imax>i;++i)tracks[i].process();for(;i--;)tracks[i].ended&&tracks.splice(i,1);0===tracks.length&&fn.nextTick(_.onended),_.currentTime+=fn.currentTimeIncr}return this},fn.register("mml",MML);var MMLTrack=function(){function MMLTrack(sequencer,trackNum,mml){var _=this._={};_.sequencer=sequencer,_.trackNum=trackNum,_.commands=compile(mml),_.status={t:120,l:4,o:4,v:12,q:6,dot:0,tie:!1},_.index=0,_.queue=[],_.currentTime=0,_.queueTime=0,_.segnoIndex=-1,_.loopStack=[],_.prevNote=0,_.remain=1/0,this.ended=!1,sched(this)}var EOF=0,NOTEON=1,NOTEOFF=2,COMMAND=3;MMLTrack.prototype.process=function(){var _=this._,sequencer=_.sequencer,trackNum=_.trackNum,queue=_.queue,eof=!1;if(queue.length)for(;queue[0][0]<=_.currentTime;){var nextItem=_.queue.shift();switch(nextItem[1]){case NOTEON:noteOn(sequencer,trackNum,nextItem[2],nextItem[3]),_.remain=nextItem[4],sched(this);break;case NOTEOFF:noteOff(sequencer,trackNum,nextItem[2],nextItem[3]);break;case COMMAND:command(sequencer,nextItem[2]);break;case EOF:eof=!0}if(0===queue.length)break}_.remain-=fn.currentTimeIncr,eof&&(this.ended=!0),_.currentTime+=fn.currentTimeIncr};var noteOn=function(sequencer,trackNum,noteNum,velocity){var gen,i,imax,nodes=sequencer.nodes;for(i=0,imax=nodes.length;imax>i;++i)gen=nodes[i],gen.noteOn?gen.noteOn(noteNum,velocity):gen.bang();sequencer._.emit("data","noteOn",{trackNum:trackNum,noteNum:noteNum,velocity:velocity})},noteOff=function(sequencer,trackNum,noteNum,velocity){var gen,i,imax,nodes=sequencer.nodes;for(i=0,imax=nodes.length;imax>i;++i)gen=nodes[i],gen.noteOff?gen.noteOff(noteNum,velocity):gen.release&&gen.release();sequencer._.emit("data","noteOff",{trackNum:trackNum,noteNum:noteNum,velocity:velocity})},command=function(sequencer,cmd){sequencer._.emit("data","command",{command:cmd})},sched=function(self){var cmd,tempo,val,len,dot,vel,duration,quantize,pending,_queueTime,peek,i,imax,_=self._,commands=(_.sequencer,_.commands),queue=_.queue,index=_.index,status=_.status,queueTime=_.queueTime,loopStack=_.loopStack;pending=[];outer:for(;;){if(commands.length<=index){if(!(_.segnoIndex>=0))break;index=_.segnoIndex}switch(cmd=commands[index++],cmd.name){case"@":queue.push([queueTime,COMMAND,cmd.val]);break;case"n":if(tempo=status.t||120,null!==cmd.len?(len=cmd.len,dot=cmd.dot||0):(len=status.l,dot=cmd.dot||status.dot),duration=60/tempo*(4/len)*1e3,duration*=[1,1.5,1.75,1.875][dot]||1,vel=status.v<<3,status.tie){for(i=queue.length;i--;)if(queue[i][2]){queue.splice(i,1);break}val=_.prevNote}else val=_.prevNote=cmd.val+12*(status.o+1),queue.push([queueTime,NOTEON,val,vel,duration]);if(len>0){if(quantize=status.q/8,1>quantize)for(_queueTime=queueTime+duration*quantize,queue.push([_queueTime,NOTEOFF,val,vel]),i=0,imax=pending.length;imax>i;++i)queue.push([_queueTime,NOTEOFF,pending[i],vel]);if(pending=[],queueTime+=duration,!status.tie)break outer}else pending.push(val);status.tie=!1;break;case"r":tempo=status.t||120,null!==cmd.len?(len=cmd.len,dot=cmd.dot||0):(len=status.l,dot=cmd.dot||status.dot),len>0&&(duration=60/tempo*(4/len)*1e3,duration*=[1,1.5,1.75,1.875][dot]||1,queueTime+=duration);break;case"l":status.l=cmd.val,status.dot=cmd.dot;break;case"o":status.o=cmd.val;break;case"<":status.o<9&&(status.o+=1);break;case">":status.o>0&&(status.o-=1);break;case"v":status.v=cmd.val;break;case"(":status.v<15&&(status.v+=1);break;case")":status.v>0&&(status.v-=1);break;case"q":status.q=cmd.val;break;case"&":status.tie=!0;break;case"$":_.segnoIndex=index;break;case"[":loopStack.push([index,null,null]);break;case"|":peek=loopStack[loopStack.length-1],peek&&1===peek[1]&&(loopStack.pop(),index=peek[2]);break;case"]":peek=loopStack[loopStack.length-1],peek&&(null===peek[1]&&(peek[1]=cmd.count,peek[2]=index),peek[1]-=1,0===peek[1]?loopStack.pop():index=peek[0]);break;case"t":status.t=null===cmd.val?120:cmd.val;break;case"EOF":queue.push([queueTime,EOF])}}_.index=index,_.queueTime=queueTime},compile=function(mml){var def,re,m,cmd,i,imax,j,jmax,checked=new Array(mml.length),commands=[];for(i=0,imax=MMLCommands.length;imax>i;++i)for(def=MMLCommands[i],re=def.re;m=re.exec(mml);){if(!checked[m.index]){for(j=0,jmax=m[0].length;jmax>j;++j)checked[m.index+j]=!0;cmd=def.func?def.func(m):{name:m[0]},cmd&&(cmd.index=m.index,cmd.origin=m[0],commands.push(cmd))}for(;re.lastIndex<mml.length&&checked[re.lastIndex];)++re.lastIndex}return commands.sort(function(a,b){return a.index-b.index}),commands.push({name:"EOF"}),commands},MMLCommands=[{re:/@(\d*)/g,func:function(m){return{name:"@",val:m[1]||null}}},{re:/([cdefgab])([\-+]?)(\d*)(\.*)/g,func:function(m){return{name:"n",val:{c:0,d:2,e:4,f:5,g:7,a:9,b:11}[m[1]]+({"-":-1,"+":1}[m[2]]||0),len:""===m[3]?null:Math.min(0|m[3],64),dot:m[4].length}}},{re:/r(\d*)(\.*)/g,func:function(m){return{name:"r",len:""===m[1]?null:Math.max(1,Math.min(0|m[1],64)),dot:m[2].length}}},{re:/&/g},{re:/l(\d*)(\.*)/g,func:function(m){return{name:"l",val:""===m[1]?4:Math.min(0|m[1],64),dot:m[2].length}}},{re:/o([0-9])/g,func:function(m){return{name:"o",val:""===m[1]?4:0|m[1]}}},{re:/[<>]/g},{re:/v(\d*)/g,func:function(m){return{name:"v",val:""===m[1]?12:Math.min(0|m[1],15)}}},{re:/[()]/g},{re:/q([0-8])/g,func:function(m){return{name:"q",val:""===m[1]?6:Math.min(0|m[1],8)}}},{re:/\[/g},{re:/\|/g},{re:/\](\d*)/g,func:function(m){return{name:"]",count:0|m[1]||2}}},{re:/t(\d*)/g,func:function(m){return{name:"t",val:""===m[1]?null:Math.max(5,Math.min(0|m[1],300))}}},{re:/\$/g}];return MMLTrack}()}(timbre),function(T){"use strict";function MonoNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MonoNode),MonoNode.prototype.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},fn.register("mono",MonoNode)}(timbre),function(T){"use strict";function MulNode(_args){T.Object.call(this,2,_args)}var fn=T.fn;fn.extend(MulNode);var $=MulNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)cellL[j]*=tmpL[j],cellR[j]*=tmpR[j];else for(j=0;jmax>j;++j)cellL[j]=cellR[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)tmp*=nodes[i].process(tickID).cells[0][0];else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("*",MulNode)}(timbre),function(T){"use strict";function NDictNode(_args){T.Object.call(this,1,_args);var _=this._;_.defaultValue=0,_.index=0,_.dict={},_.ar=!1}var fn=T.fn;fn.extend(NDictNode);var $=NDictNode.prototype;Object.defineProperties($,{dict:{set:function(value){if("object"==typeof value)this._.dict=value;else if("function"==typeof value){for(var dict={},i=0;128>i;++i)dict[i]=value(i);this._.dict=dict}},get:function(){return this._.dict}},defaultValue:{set:function(value){"number"==typeof value&&(this._.defaultValue=value)},get:function(){return this._.defaultValue}},index:{set:function(value){"number"==typeof value&&(this._.index=value)},get:function(){return this._.index}}}),$.at=function(index){var _=this._;return(_.dict[0|index]||_.defaultValue)*_.mul+_.add},$.clear=function(){return this._.dict={},this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var index,value,i,len=this.nodes.length,dict=_.dict,defaultValue=_.defaultValue,mul=_.mul,add=_.add,imax=cell.length;if(_.ar&&len){for(fn.inputSignalAR(this),i=0;imax>i;++i)index=cell[i],index=0>index?index-.5|0:index+.5|0,cell[i]=(dict[index]||defaultValue)*mul+add;fn.outputSignalAR(this)}else for(index=this.nodes.length?fn.inputSignalKR(this):_.index,index=0>index?index-.5|0:index+.5|0,value=(dict[index]||defaultValue)*mul+add,i=0;imax>i;++i)cell[i]=value}return this},fn.register("ndict",NDictNode)}(timbre),function(T){"use strict";function NoiseNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(NoiseNode);var $=NoiseNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;
var i,imax,x,mul=_.mul,add=_.add;if(_.ar)for(i=0,imax=cell.length;imax>i;++i)cell[i]=(2*Math.random()-1)*mul+add;else for(x=(2*Math.random()+1)*mul+add,i=0,imax=cell.length;imax>i;++i)cell[i]=x}return this},fn.register("noise",NoiseNode)}(timbre),function(T){"use strict";function OscNode(_args){T.Object.call(this,2,_args);var _=this._;_.freq=T(440),_.phase=T(0),_.osc=new Oscillator(_.samplerate),_.tmp=new fn.SignalArray(_.cellsize),_.osc.step=_.cellsize,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue,Oscillator=T.modules.Oscillator;fn.extend(OscNode);var oninit=function(){var _=this._;this.wave||(this.wave="sin"),_.plotData=_.osc.wave,_.plotLineWidth=2,_.plotCyclic=!0,_.plotBefore=plotBefore},$=OscNode.prototype;Object.defineProperties($,{wave:{set:function(value){this._.osc.setWave(value)},get:function(){return this._.osc.wave}},freq:{set:function(value){"string"==typeof value&&(value=timevalue(value),value=0>=value?0:1e3/value),this._.freq=T(value)},get:function(){return this._.freq}},phase:{set:function(value){this._.phase=T(value),this._.osc.feedback=!1},get:function(){return this._.phase}},fb:{set:function(value){this._.phase=T(value),this._.osc.feedback=!0},get:function(){return this._.phase}}}),$.clone=function(){var instance=fn.clone(this);return instance._.osc=this._.osc.clone(),instance._.freq=this._.freq,instance._.phase=this._.phase,instance},$.bang=function(){return this._.osc.reset(),this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;var osc=_.osc,freq=_.freq.process(tickID).cells[0],phase=_.phase.process(tickID).cells[0];if(osc.frequency=freq[0],osc.phase=phase[0],_.ar){var tmp=_.tmp;for(_.freq.isAr?_.phase.isAr?osc.processWithFreqAndPhaseArray(tmp,freq,phase):osc.processWithFreqArray(tmp,freq):_.phase.isAr?osc.processWithPhaseArray(tmp,phase):osc.process(tmp),i=0;imax>i;++i)cellL[i]*=tmp[i],cellR[i]*=tmp[i]}else{var value=osc.next();for(i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value}fn.outputSignalAR(this)}return this};var plotBefore;"browser"===T.envtype&&(plotBefore=function(context,offset_x,offset_y,width,height){var y=(height>>1)+.5;context.strokeStyle="#ccc",context.lineWidth=1,context.beginPath(),context.moveTo(offset_x,y+offset_y),context.lineTo(offset_x+width,y+offset_y),context.stroke()}),fn.register("osc",OscNode),fn.register("sin",function(_args){return new OscNode(_args).set("wave","sin")}),fn.register("cos",function(_args){return new OscNode(_args).set("wave","cos")}),fn.register("pulse",function(_args){return new OscNode(_args).set("wave","pulse")}),fn.register("tri",function(_args){return new OscNode(_args).set("wave","tri")}),fn.register("saw",function(_args){return new OscNode(_args).set("wave","saw")}),fn.register("fami",function(_args){return new OscNode(_args).set("wave","fami")}),fn.register("konami",function(_args){return new OscNode(_args).set("wave","konami")}),fn.register("+sin",function(_args){return new OscNode(_args).set("wave","+sin").kr()}),fn.register("+pulse",function(_args){return new OscNode(_args).set("wave","+pulse").kr()}),fn.register("+tri",function(_args){return new OscNode(_args).set("wave","+tri").kr()}),fn.register("+saw",function(_args){return new OscNode(_args).set("wave","+saw").kr()}),fn.alias("square","pulse")}(timbre),function(T){"use strict";function PanNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.pos=T(0),_.panL=.5,_.panR=.5}var fn=T.fn;fn.extend(PanNode);var $=PanNode.prototype;Object.defineProperties($,{pos:{set:function(value){this._.pos=T(value)},get:function(){return this._.pos}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var pos=_.pos.process(tickID).cells[0][0];_.prevPos!==pos&&(_.panL=1-pos,_.panR=_.prevPos=pos);var i,j,tmp,nodes=this.nodes,cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cellL.length;if(imax){for(tmp=nodes[0].process(tickID).cells[0],j=0;jmax>j;++j)cellL[j]=cellR[j]=tmp[j];for(i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)cellL[j]=cellR[j]+=tmp[j];var panL=_.panL,panR=_.panR;for(j=0;jmax>j;++j)cellL[j]=cellL[j]*panL,cellR[j]=cellR[j]*panR}else cellL.set(fn.emptycell),cellR.set(fn.emptycell);fn.outputSignalAR(this)}return this},fn.register("pan",PanNode)}(timbre),function(T){"use strict";function ParamNode(_args){T.Object.call(this,2,_args);var _=this._;_.value=0,_.env=new EnvelopeValue(_.samplerate),_.env.step=_.cellsize,_.curve="lin",_.counter=0,_.ar=!1,_.onended=make_onended(this),this.on("ar",onar)}var fn=T.fn,timevalue=T.timevalue,Envelope=T.modules.Envelope,EnvelopeValue=T.modules.EnvelopeValue;fn.extend(ParamNode);var make_onended=function(self,lastValue){return function(){if("number"==typeof lastValue)for(var cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],value=self._.env.value,i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=value;self._.emit("ended")}},onar=function(value){this._.env.step=value?1:this._.cellsize},$=ParamNode.prototype;Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.env.value=value)},get:function(){return this._.env.value}}}),$.to=function(nextValue,time,curve){var _=this._,env=_.env;if("string"==typeof time?time=timevalue(time):"undefined"==typeof time&&(time=0),"undefined"==typeof curve)_.counter=env.setNext(nextValue,time,Envelope.CurveTypeLin),_.curve="lin";else{var _curve=Envelope.CurveTypeDict[curve];_.counter="undefined"==typeof _curve?env.setNext(nextValue,time,Envelope.CurveTypeCurve,curve):env.setNext(nextValue,time,_curve),_.curve=curve}return _.plotFlush=!0,this},$.setAt=function(nextValue,time){var _=this._;return this.to(_.env.value,time,"set"),_.atValue=nextValue,this},$.linTo=function(nextValue,time){return this.to(nextValue,time,"lin")},$.expTo=function(nextValue,time){return this.to(nextValue,time,"exp")},$.sinTo=function(nextValue,time){return this.to(nextValue,time,"sin")},$.welTo=function(nextValue,time){return this.to(nextValue,time,"wel")},$.sqrTo=function(nextValue,time){return this.to(nextValue,time,"sqr")},$.cubTo=function(nextValue,time){return this.to(nextValue,time,"cub")},$.cancel=function(){var _=this._;return _.counter=_.env.setNext(_.env.value,0,Envelope.CurveTypeSet),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,value,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize,env=_.env,counter=_.counter;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;if(0>=counter&&("set"===_.curve?env.setNext(_.atValue,0,Envelope.CurveTypeSet):env.setNext(env.value,0,Envelope.CurveTypeSet),fn.nextTick(_.onended),_.counter=1/0),_.ar){for(i=0;imax>i;++i)value=env.next(),cellL[i]*=value,cellR[i]*=value;_.counter-=_.cellsize}else{for(value=env.next(),i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value;_.counter-=1}fn.outputSignalAR(this),_.value=value}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var _=this._;if(_.plotFlush){var curve,i,imax,env=new EnvelopeValue(128),data=new Float32Array(128);if("set"===_.curve)for(i=100,imax=data.length;imax>i;++i)data[i]=1;else for(curve=Envelope.CurveTypeDict[_.curve],"undefined"==typeof curve?env.setNext(1,1e3,Envelope.CurveTypeCurve,_.curve):env.setNext(1,1e3,curve),i=0,imax=data.length;imax>i;++i)data[i]=env.next();_.plotData=data,_.plotRange=[0,1],_.plotFlush=null}return super_plot.call(this,opts)},fn.register("param",ParamNode)}(timbre),function(T){"use strict";function PhaserNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.freq=T("sin",{freq:1,add:1e3,mul:250}).kr(),_.Q=T(1),_.allpass=[],this.steps=2}var fn=T.fn,Biquad=T.modules.Biquad;fn.extend(PhaserNode);var $=PhaserNode.prototype;Object.defineProperties($,{freq:{set:function(value){this._.freq=value},get:function(){return this._.freq}},Q:{set:function(value){this._.Q=T(value)},get:function(){return this._.Q}},steps:{set:function(value){if("number"==typeof value){if(value|=0,2===value||4===value||8===value||12===value){var allpass=this._.allpass;if(allpass.length<value)for(var i=allpass.length;value>i;++i)allpass[i]=new Biquad(this._.samplerate),allpass[i].setType("allpass")}this._.steps=value}},get:function(){return this._.steps}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),!_.bypassed){var i,cellL=this.cells[1],cellR=this.cells[2],freq=_.freq.process(tickID).cells[0][0],Q=_.Q.process(tickID).cells[0][0],steps=_.steps;for(i=0;steps>i;i+=2)_.allpass[i].setParams(freq,Q,0),_.allpass[i].process(cellL,cellR),_.allpass[i+1].setParams(freq,Q,0),_.allpass[i+1].process(cellL,cellR)}fn.outputSignalAR(this)}return this},fn.register("phaser",PhaserNode)}(timbre),function(T){"use strict";function PinkNoiseNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);for(var whites=new Uint8Array(5),i=0;5>i;++i)whites[i]=(Math.random()*(1<<30)|0)%25;this._.whites=whites,this._.key=0}var MAX_KEY=31,fn=T.fn;fn.extend(PinkNoiseNode);var $=PinkNoiseNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,j,last_key,sum,diff,key=_.key,whites=_.whites,mul=_.mul,add=_.add;for(i=0,imax=cell.length;imax>i;++i){for(last_key=key++,key>MAX_KEY&&(key=0),diff=last_key^key,j=sum=0;5>j;++j)diff&1<<j&&(whites[j]=(Math.random()*(1<<30)|0)%25),sum+=whites[j];cell[i]=(.01666666*sum-1)*mul+add}_.key=key}return this},fn.register("pink",PinkNoiseNode)}(timbre),function(T){"use strict";function PluckNode(_args){T.Object.call(this,1,_args),this._.freq=440,this._.buffer=null,this._.index=0}var fn=T.fn;fn.extend(PluckNode);var $=PluckNode.prototype;Object.defineProperties($,{freq:{set:function(value){"number"==typeof value&&(0>value&&(value=0),this._.freq=value)},get:function(){return this._.freq}}}),$.bang=function(){for(var _=this._,freq=_.freq,size=_.samplerate/freq+.5|0,buffer=_.buffer=new fn.SignalArray(size),i=0;size>i;++i)buffer[i]=2*Math.random()-1;return _.index=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var buffer=_.buffer;if(buffer){var write,x,i,bufferLength=buffer.length,index=_.index,mul=_.mul,add=_.add,imax=cell.length;for(i=0;imax>i;++i)write=index,x=buffer[index++],index>=bufferLength&&(index=0),x=.5*(x+buffer[index]),buffer[write]=x,cell[i]=x*mul+add;_.index=index}}return this},fn.register("pluck",PluckNode)}(timbre),function(T){"use strict";function RecNode(_args){T.Object.call(this,1,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.timeout=5e3,_.status=STATUS_WAIT,_.writeIndex=0,_.writeIndexIncr=1,_.currentTime=0,_.currentTimeIncr=1e3/_.samplerate,_.onended=make_onended(this)}var fn=T.fn,timevalue=T.timevalue,STATUS_WAIT=0,STATUS_REC=1;fn.extend(RecNode);var make_onended=function(self){return function(){var _=self._,buffer=new fn.SignalArray(_.buffer.subarray(0,0|_.writeIndex));_.status=STATUS_WAIT,_.writeIndex=0,_.currentTime=0,_.emit("ended",{buffer:buffer,samplerate:_.samplerate})}},$=RecNode.prototype;Object.defineProperties($,{timeout:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(this._.timeout=value)},get:function(){return this._.timeout}},samplerate:{set:function(value){"number"==typeof value&&value>0&&value<=this._.samplerate&&(this._.samplerate=value)},get:function(){return this._.samplerate}},currentTime:{get:function(){return this._.currentTime}}}),$.start=function(){var len,_=this._;return _.status===STATUS_WAIT&&(len=.01*_.timeout*_.samplerate|0,(!_.buffer||_.buffer.length<len)&&(_.buffer=new fn.SignalArray(len)),_.writeIndex=0,_.writeIndexIncr=_.samplerate/T.samplerate,_.currentTime=0,_.status=STATUS_REC,_.emit("start"),this.listen()),this},$.stop=function(){var _=this._;return _.status===STATUS_REC&&(_.status=STATUS_WAIT,_.emit("stop"),fn.nextTick(_.onended),this.unlisten()),this},$.bang=function(){return this._.status===STATUS_WAIT?this.srart():this._.status===STATUS_REC&&this.stop(),this._.emit("bang"),this},$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),_.status===STATUS_REC){var i,imax=cell.length,buffer=_.buffer,timeout=_.timeout,writeIndex=_.writeIndex,writeIndexIncr=_.writeIndexIncr,currentTime=_.currentTime,currentTimeIncr=_.currentTimeIncr;for(i=0;imax>i;++i)buffer[0|writeIndex]=cell[i],writeIndex+=writeIndexIncr,currentTime+=currentTimeIncr,currentTime>=timeout&&fn.nextTick(_.onended);_.writeIndex=writeIndex,_.currentTime=currentTime}fn.outputSignalAR(this)}return this},fn.register("record",RecNode),fn.alias("rec","record")}(timbre),function(T){"use strict";function ReverbNode(_args){T.Object.call(this,2,_args),fn.fixAR(this),this._.reverb=new Reverb(this._.samplerate,this._.cellsize)}var fn=T.fn,Reverb=T.modules.Reverb;fn.extend(ReverbNode);var $=ReverbNode.prototype;Object.defineProperties($,{room:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.setRoomSize(value))},get:function(){return this._.reverb.roomsize}},damp:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.setDamp(value))},get:function(){return this._.reverb.damp}},mix:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.wet=value)},get:function(){return this._.reverb.wet}}}),$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,fn.inputSignalAR(this),_.bypassed||_.reverb.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)),this},fn.register("reverb",ReverbNode)}(timbre),function(T){"use strict";function ScheduleNode(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.queue=[],_.currentTime=0,_.maxRemain=1e3}var fn=T.fn,timevalue=T.timevalue;fn.extend(ScheduleNode);var $=ScheduleNode.prototype;Object.defineProperties($,{queue:{get:function(){return this._.queue}},remain:{get:function(){return this._.queue.length}},maxRemain:{set:function(value){"number"==typeof value&&value>0&&(this._.maxRemain=value)},get:function(){return this._.maxRemain}},isEmpty:{get:function(){return 0===this._.queue.length}},currentTime:{get:function(){return this._.currentTime}}}),$.sched=function(delta,item,args){return"string"==typeof delta&&(delta=timevalue(delta)),"number"==typeof delta&&this.schedAbs(this._.currentTime+delta,item,args),this},$.schedAbs=function(time,item,args){if("string"==typeof time&&(time=timevalue(time)),"number"==typeof time){var _=this._,queue=_.queue;if(queue.length>=_.maxRemain)return this;for(var i=queue.length;i--&&!(queue[i][0]<time););queue.splice(i+1,0,[time,T(item),args])}return this},$.advance=function(delta){return"string"==typeof delta&&(delta=timevalue(delta)),"number"==typeof delta&&(this._.currentTime+=delta),this},$.clear=function(){return this._.queue.splice(0),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var emit=null,queue=_.queue;if(queue.length)for(;queue[0][0]<_.currentTime;){var nextItem=_.queue.shift();if(nextItem[1].bang(nextItem[2]),emit="sched",0===queue.length){emit="empty";break}}_.currentTime+=fn.currentTimeIncr,emit&&_.emit(emit)}return this},fn.register("schedule",ScheduleNode),fn.alias("sched","schedule")}(timbre),function(T){"use strict";function ScopeNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.samples=0,_.writeIndex=0,_.plotFlush=!0,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue;fn.extend(ScopeNode);var oninit=function(){this._.buffer||(this.size=1024),this._.interval||(this.interval=1e3)},$=ScopeNode.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.buffer&&"number"==typeof value){var n=64>value?64:value>2048?2048:value;_.buffer=new fn.SignalArray(n),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},interval:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*_.samplerate/_.buffer.length,_.samplesIncr<1&&(_.samplesIncr=1)):_.reservedinterval=value)},get:function(){return this._.interval}}}),$.bang=function(){for(var _=this._,buffer=_.buffer,i=0,imax=buffer.length;imax>i;++i)buffer[i]=0;return _.samples=0,_.writeIndex=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var i,cell=this.cells[0],imax=_.cellsize,samples=_.samples,samplesIncr=_.samplesIncr,buffer=_.buffer,writeIndex=_.writeIndex,emit=!1,bufferlength=buffer.length;for(i=0;imax>i;++i)0>=samples&&(buffer[writeIndex++]=cell[i],writeIndex>=bufferlength&&(writeIndex=0),emit=_.plotFlush=!0,samples+=samplesIncr),--samples;_.samples=samples,_.writeIndex=writeIndex,emit&&this._.emit("data")}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var _=this._;if(_.plotFlush){for(var buffer=_.buffer,mask=buffer.length-1,data=new Float32Array(buffer.length),j=_.writeIndex,i=0,imax=buffer.length;imax>i;i++)data[i]=buffer[++j&mask];_.plotData=data,_.plotFlush=null}return super_plot.call(this,opts)},fn.register("scope",ScopeNode)}(timbre),function(T){"use strict";function ScriptProcessorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.numberOfInputs=0,_.numberOfOutputs=0,_.bufferSize=0,_.bufferMask=0,_.duration=0,_.inputBufferL=null,_.inputBufferR=null,_.outputBufferL=null,_.outputBufferR=null,_.onaudioprocess=null,_.index=0,this.once("init",oninit)}function AudioBuffer(self,buffers){this.samplerate=self._.samplerate,this.length=self._.bufferSize,this.duration=self._.duration,this.numberOfChannels=buffers.length,this.getChannelData=function(n){return buffers[n]}}function AudioProcessingEvent(self){var _=self._;this.node=self,this.playbackTime=T.currentTime,this.inputBuffer=2===_.numberOfInputs?new AudioBuffer(self,[_.inputBufferL,_.inputBufferR]):new AudioBuffer(self,[_.inputBufferL]),this.outputBuffer=2===_.numberOfOutputs?new AudioBuffer(self,[_.outputBufferL,_.outputBufferR]):new AudioBuffer(self,[_.outputBufferL])}var fn=T.fn;fn.extend(ScriptProcessorNode);var oninit=function(){var _=this._;0===_.numberOfInputs&&(this.numberOfInputs=1),0===_.numberOfOutputs&&(this.numberOfOutputs=1),0===_.bufferSize&&(this.bufferSize=1024)},$=ScriptProcessorNode.prototype;Object.defineProperties($,{numberOfInputs:{set:function(value){var _=this._;0===_.numberOfInputs&&(_.numberOfInputs=2===value?2:1)},get:function(){return this._.numberOfInputs}},numberOfOutputs:{set:function(value){var _=this._;0===_.numberOfOutputs&&(_.numberOfOutputs=2===value?2:1)},get:function(){return this._.numberOfOutputs}},bufferSize:{set:function(value){var _=this._;0===_.bufferSize&&-1!==[256,512,1024,2048,4096,8192,16384].indexOf(value)&&(_.bufferSize=value,_.bufferMask=value-1,_.duration=value/_.samplerate,_.inputBufferL=new fn.SignalArray(value),_.inputBufferR=new fn.SignalArray(value),_.outputBufferL=new fn.SignalArray(value),_.outputBufferR=new fn.SignalArray(value))},get:function(){return this._.bufferSize}},onaudioprocess:{set:function(value){"function"==typeof value&&(this._.onaudioprocess=value)},get:function(){return this._.onaudioprocess}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var buffer,cellsize=_.cellsize,bufferMask=_.bufferMask,begin=_.index,end=begin+cellsize,cellL=this.cells[1],cellR=this.cells[2];if(fn.inputSignalAR(this),2===_.numberOfInputs)_.inputBufferL.set(cellL,begin),_.inputBufferR.set(cellR,begin);else{buffer=_.inputBufferL;for(var i=0;cellsize>i;i++)buffer[begin+i]=.5*(cellL[i]+cellR[i])}cellL.set(_.outputBufferL.subarray(begin,end)),cellR.set(_.outputBufferR.subarray(begin,end)),_.index=end&bufferMask,0===_.index&&_.onaudioprocess&&(_.onaudioprocess(new AudioProcessingEvent(this)),1===_.numberOfOutputs&&_.outputBufferR.set(_.outputBufferL)),fn.outputSignalAR(this)}return this},fn.register("script",ScriptProcessorNode)}(timbre),function(T){"use strict";function SelectorNode(_args){T.Object.call(this,2,_args),this._.selected=0,this._.background=!1}var fn=T.fn;fn.extend(SelectorNode);var $=SelectorNode.prototype;Object.defineProperties($,{selected:{set:function(value){"number"==typeof value&&(this._.selected=value,this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell))},get:function(){return this._.selected}},background:{set:function(value){this._.background=!!value},get:function(){return this._.background}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,nodes=this.nodes,imax=nodes.length;if(_.background)for(i=0;imax>i;++i)nodes[i].process(tickID);var tmp=nodes[_.selected];tmp&&(_.background||tmp.process(tickID),this.cells[1].set(tmp.cells[1]),this.cells[2].set(tmp.cells[2])),fn.outputSignalAR(this)}return this},fn.register("selector",SelectorNode)}(timbre),function(T){"use strict";function SpectrumNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.status=WAIT_STATE,_.samples=0,_.samplesIncr=0,_.writeIndex=0,_.plotFlush=!0,_.plotRange=[0,32],_.plotBarStyle=!0,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue,FFT=T.modules.FFT,WAIT_STATE=0,EXEC_STATE=1;fn.extend(SpectrumNode);var oninit=function(){var _=this._;_.fft||(this.size=512),_.interval||(this.interval=500)},$=SpectrumNode.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.fft&&"number"==typeof value){var n=256>value?256:value>2048?2048:value;_.fft=new FFT(n),_.buffer=new fn.SignalArray(_.fft.length),_.freqs=new fn.SignalArray(_.fft.length>>1),_.reservedwindow&&(_.fft.setWindow(_.reservedwindow),_.reservedwindow=null),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},window:{set:function(value){this._.fft.setWindow(value)},get:function(){return this._.fft.windowName}},interval:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*_.samplerate,_.samplesIncr<_.buffer.length&&(_.samplesIncr=_.buffer.length,_.interval=1e3*_.samplesIncr/_.samplerate)):_.reservedinterval=value)},get:function(){return this._.interval}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}},real:{get:function(){return this._.fft.real}},imag:{get:function(){return this._.fft.imag}}}),$.bang=function(){return this._.samples=0,this._.writeIndex=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var i,emit,cell=this.cells[0],imax=cell.length,status=_.status,samples=_.samples,samplesIncr=_.samplesIncr,writeIndex=_.writeIndex,buffer=_.buffer,bufferLength=buffer.length;for(i=0;imax>i;++i)0>=samples&&status===WAIT_STATE&&(status=EXEC_STATE,writeIndex=0,samples+=samplesIncr),status===EXEC_STATE&&(buffer[writeIndex++]=cell[i],writeIndex>=bufferLength&&(_.fft.forward(buffer),emit=_.plotFlush=!0,status=WAIT_STATE)),--samples;_.samples=samples,_.status=status,_.writeIndex=writeIndex,emit&&this._.emit("data")}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),super_plot.call(this,opts)},fn.register("spectrum",SpectrumNode)}(timbre),function(T){"use strict";function SubtractNode(_args){T.Object.call(this,2,_args),this._.ar=!1}var fn=T.fn;fn.extend(SubtractNode);var $=SubtractNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)cellL[j]-=tmpL[j],cellR[j]-=tmpR[j];else for(j=0;jmax>j;++j)cellL[j]=cellR[i]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)tmp-=nodes[i].process(tickID).cells[0][0];else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("-",SubtractNode)}(timbre),function(T){"use strict";function SynthDefNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.poly=4,_.genList=[],_.genDict={},_.synthdef=null,_.remGen=make_remGen(this),_.onended=fn.make_onended(this)}var fn=T.fn;fn.extend(SynthDefNode);var $=SynthDefNode.prototype;Object.defineProperties($,{def:{set:function(value){"function"==typeof value&&(this._.synthdef=value)},get:function(){return this._.synthdef}},poly:{set:function(value){"number"==typeof value&&value>0&&64>=value&&(this._.poly=value)},get:function(){return this._.poly}}});var make_doneAction=function(self,opts){return function(){self._.remGen(opts.gen)}},make_remGen=function(self){return function(gen){var _=self._,i=_.genList.indexOf(gen);-1!==i&&_.genList.splice(i,1),"undefined"!=typeof gen.noteNum&&(_.genDict[gen.noteNum]=null)}},noteOn=function(noteNum,freq,velocity,_opts){velocity|=0,0>=velocity?this.noteOff(this,noteNum):velocity>127&&(velocity=127);var _=this._,list=_.genList,dict=_.genDict,gen=dict[noteNum];gen&&_.remGen(gen);var opts={freq:freq,noteNum:noteNum,velocity:velocity,mul:.0078125*velocity};if(_opts)for(var key in _opts)opts[key]=_opts[key];opts.doneAction=make_doneAction(this,opts),gen=_.synthdef.call(this,opts),gen instanceof T.Object&&(gen.noteNum=noteNum,list.push(gen),dict[noteNum]=opts.gen=gen,this.playbackState=fn.PLAYING_STATE,list.length>_.poly&&_.remGen(list[0]))},midicps=function(){for(var table=new Float32Array(128),i=0;128>i;++i)table[i]=440*Math.pow(2,1*(i-69)/12);return table}(),cpsmidi=function(cps){return cps>0?Math.log(1*cps/440)*Math.LOG2E*12+69:0};$.noteOn=function(noteNum,velocity,_opts){var freq=midicps[noteNum]||440*Math.pow(2,(noteNum-69)/12);return noteOn.call(this,noteNum+.5|0,freq,velocity,_opts),this},$.noteOff=function(noteNum){var gen=this._.genDict[noteNum];return gen&&gen.release&&gen.release(),this},$.noteOnWithFreq=function(freq,velocity,_opts){var noteNum=cpsmidi(freq);return noteOn.call(this,noteNum+.5|0,freq,velocity,_opts),this},$.noteOffWithFreq=function(freq){var noteNum=cpsmidi(freq);return this.noteOff(noteNum+.5|0)},$.allNoteOff=function(){for(var list=this._.genList,i=0,imax=list.length;imax>i;++i)list[i].release&&list[i].release()},$.allSoundOff=function(){for(var _=this._,list=_.genList,dict=_.genDict;list.length;)delete dict[list.shift().noteNum]},$.synth=function(_opts){var gen,_=this._,list=_.genList,opts={};if(_opts)for(var key in _opts)opts[key]=_opts[key];return opts.doneAction=make_doneAction(this,opts),gen=_.synthdef.call(this,opts),gen instanceof T.Object&&(list.push(gen),opts.gen=gen,this.playbackState=fn.PLAYING_STATE,list.length>_.poly&&_.remGen(list[0])),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){if(this.tickID=tickID,this.playbackState===fn.PLAYING_STATE){var gen,i,imax,j,tmpL,tmpR,list=_.genList,cellL=this.cells[1],cellR=this.cells[2],jmax=cell.length;if(list.length)for(gen=list[0],gen.process(tickID),cellL.set(gen.cells[1]),cellR.set(gen.cells[2]),i=1,imax=list.length;imax>i;++i)for(gen=list[i],gen.process(tickID),tmpL=gen.cells[1],tmpR=gen.cells[2],j=0;jmax>j;++j)cellL[j]+=tmpL[j],cellR[j]+=tmpR[j];else fn.nextTick(_.onended)}fn.outputSignalAR(this)}return this},fn.register("SynthDef",SynthDefNode);var env_desc={set:function(value){fn.isDictionary(value)?"string"==typeof value.type&&(this._.env=value):value instanceof T.Object&&(this._.env=value)},get:function(){return this._.env}};fn.register("OscGen",function(){var osc_desc={set:function(value){value instanceof T.Object&&(this._.osc=value)},get:function(){return this._.osc}},wave_desc={set:function(value){"string"==typeof value&&(this._.wave=value)},get:function(){return this._.wave}},synthdef=function(opts){var synth,osc,env,envtype,_=this._;return osc=_.osc||null,env=_.env||{},envtype=env.type||"perc",osc instanceof T.Object&&"function"==typeof osc.clone&&(osc=osc.clone()),osc||(osc=T("osc",{wave:_.wave})),osc.freq=opts.freq,osc.mul=osc.mul*opts.velocity/128,synth=osc,env instanceof T.Object?"function"==typeof env.clone&&(synth=env.clone().append(synth)):synth=T(envtype,env,synth),synth.on("ended",opts.doneAction).bang(),synth};return function(_args){var instance=new SynthDefNode(_args);return instance._.wave="sin",Object.defineProperties(instance,{env:env_desc,osc:osc_desc,wave:wave_desc}),instance.def=synthdef,instance}}()),fn.register("PluckGen",function(){var synthdef=function(opts){var synth,env,envtype,_=this._;return env=_.env||{},envtype=env.type||"perc",synth=T("pluck",{freq:opts.freq,mul:opts.velocity/128}).bang(),env instanceof T.Object?"function"==typeof env.clone&&(synth=env.clone().append(synth)):synth=T(envtype,env,synth),synth.on("ended",opts.doneAction).bang(),synth};return function(_args){var instance=new SynthDefNode(_args);return Object.defineProperties(instance,{env:env_desc}),instance.def=synthdef,instance}}())}(timbre),function(T){"use strict";function ScissorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.isLooped=!1,_.onended=fn.make_onended(this,0)}var fn=T.fn,Scissor=T.modules.Scissor,Tape=Scissor.Tape,TapeStream=Scissor.TapeStream,isSignalArray=fn.isSignalArray;fn.extend(ScissorNode);var $=ScissorNode.prototype;Object.defineProperties($,{tape:{set:function(tape){tape instanceof Tape?(this.playbackState=fn.PLAYING_STATE,this._.tape=tape,this._.tapeStream=new TapeStream(tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped):(tape instanceof T.Object&&tape.buffer&&(tape=tape.buffer),"object"==typeof tape&&Array.isArray(tape.buffer)&&isSignalArray(tape.buffer[0])&&(this.playbackState=fn.PLAYING_STATE,this._.tape=new Scissor(tape),this._.tapeStream=new TapeStream(this._.tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped))},get:function(){return this._.tape}},isLooped:{get:function(){return this._.isLooped}},buffer:{get:function(){return this._.tape?this._.tape.getBuffer():void 0}}}),$.loop=function(value){return this._.isLooped=!!value,this._.tapeStream&&(this._.tapeStream.isLooped=this._.isLooped),this},$.bang=function(){return this.playbackState=fn.PLAYING_STATE,this._.tapeStream&&this._.tapeStream.reset(),this._.emit("bang"),this},$.getBuffer=function(){return this._.tape?this._.tape.getBuffer():void 0},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var tapeStream=_.tapeStream;if(tapeStream){var cellL=this.cells[1],cellR=this.cells[2],tmp=tapeStream.fetch(cellL.length);cellL.set(tmp[0]),cellR.set(tmp[1]),this.playbackState===fn.PLAYING_STATE&&tapeStream.isEnded&&fn.nextTick(_.onended)}fn.outputSignalAR(this)}return this},fn.register("tape",ScissorNode)}(timbre),function(T){"use strict";function TaskNode(_args){T.Object.call(this,1,_args),fn.timer(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.task=[],_.i=0,_.j=0,_.imax=0,_.jmax=0,_.wait=0,_.count=0,_.args={},_.doNum=1,_.initFunc=fn.nop,_.onended=make_onended(this),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue,FunctionWrapper=T(function(){}).constructor;fn.extend(TaskNode);var onstart=function(){var args,_=this._;this.playbackState=fn.PLAYING_STATE,_.task=this.nodes.map(function(x){return x instanceof FunctionWrapper?x.func:!1}).filter(function(x){return!!x
}),_.i=_.j=0,_.imax=_.doNum,_.jmax=_.task.length,args=_.initFunc(),fn.isDictionary(args)||(args={param:args}),_.args=args},make_onended=function(self){return function(){self.playbackState=fn.FINISHED_STATE;var _=self._,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],lastValue=_.args;if("number"==typeof lastValue)for(var i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=lastValue;_.emit("ended",_.args)}},$=TaskNode.prototype;Object.defineProperties($,{"do":{set:function(value){"number"==typeof value&&value>0&&(this._.doNum=1/0===value?1/0:0|value)},get:function(){return this._.doNum}},init:{set:function(value){"function"==typeof value&&(this._.initFunc=value)},get:function(){return this._.initFunc}}}),$.bang=function(){var _=this._;return _.count=0,_.emit("bang"),this},$.wait=function(time){return"string"==typeof time&&(time=timevalue(time)),"number"==typeof time&&time>0&&(this._.count+=this._.samplerate*time*.001|0),this},$.process=function(tickID){var func,cell=this.cells[0],_=this._;if(this.tickID!==tickID&&(this.tickID=tickID,_.i<_.imax)){for(;_.count<=0;){if(_.j>=_.jmax){if(++_.i,_.i>=_.imax){fn.nextTick(_.onended);break}_.j=0}func=_.task[_.j++],func&&func.call(this,_.i,_.args)}_.count-=cell.length}return this},fn.register("task",TaskNode)}(timbre),function(T){"use strict";function TimeoutNode(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.currentTime=0,_.samplesMax=0,_.samples=0,_.onended=fn.make_onended(this),this.once("init",oninit),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue;fn.extend(TimeoutNode);var oninit=function(){this._.timeout||(this.timeout=1e3)},onstart=function(){this.playbackState=fn.PLAYING_STATE};Object.defineProperty(onstart,"unremovable",{value:!0,writable:!1});var $=TimeoutNode.prototype;Object.defineProperties($,{timeout:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this.playbackState=fn.PLAYING_STATE,_.timeout=value,_.samplesMax=.001*_.samplerate*value|0,_.samples=_.samplesMax)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),$.bang=function(){var _=this._;return this.playbackState=fn.PLAYING_STATE,_.samples=_.samplesMax,_.currentTime=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){if(this.tickID=tickID,_.samples>0&&(_.samples-=cell.length),_.samples<=0){for(var nodes=this.nodes,i=0,imax=nodes.length;imax>i;++i)nodes[i].bang();fn.nextTick(_.onended)}_.currentTime+=fn.currentTimeIncr}return this},fn.register("timeout",TimeoutNode)}(timbre),function(T){"use strict";function WaveShaperNode(_args){T.Object.call(this,1,_args),fn.fixAR(this),this._.curve=null}var fn=T.fn;fn.extend(WaveShaperNode);var $=WaveShaperNode.prototype;Object.defineProperties($,{curve:{set:function(value){fn.isSignalArray(value)&&(this._.curve=value)},get:function(){return this._.curve}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),_.curve){var x,i,cell=this.cells[0],curve=_.curve,len=curve.length,imax=_.cellsize;for(i=0;imax>i;++i)x=.5*(cell[i]+1)*len+.5|0,0>x?x=0:x>=len-1&&(x=len-1),cell[i]=curve[x]}fn.outputSignalAR(this)}return this},fn.register("waveshaper",WaveShaperNode)}(timbre),function(T){"use strict";function ZMapNode(_args){T.Object.call(this,1,_args);var _=this._;_.inMin=0,_.inMax=1,_.outMin=0,_.outMax=1,_.ar=!1,this.once("init",oninit)}var fn=T.fn;fn.extend(ZMapNode);var oninit=function(){this._.warp||(this.warp="linlin")},$=ZMapNode.prototype;Object.defineProperties($,{inMin:{set:function(value){"number"==typeof value&&(this._.inMin=value)},get:function(){return this._.inMin}},inMax:{set:function(value){"number"==typeof value&&(this._.inMax=value)},get:function(){return this._.inMax}},outMin:{set:function(value){"number"==typeof value&&(this._.outMin=value)},get:function(){return this._.outMin}},outMax:{set:function(value){"number"==typeof value&&(this._.outMax=value)},get:function(){return this._.outMax}},warp:{set:function(value){if("string"==typeof value){var f=WarpFunctions[value];f&&(this._.warp=f,this._.warpName=value)}},get:function(){return this._.warpName}}}),$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){this.tickID=tickID;var i,inMin=_.inMin,inMax=_.inMax,outMin=_.outMin,outMax=_.outMax,warp=_.warp,len=this.nodes.length,mul=_.mul,add=_.add,imax=cell.length;if(_.ar&&len){for(fn.inputSignalAR(this),i=0;imax>i;++i)cell[i]=warp(cell[i],inMin,inMax,outMin,outMax)*mul+add;fn.outputSignalAR(this)}else{var input=this.nodes.length?fn.inputSignalKR(this):0,value=warp(input,inMin,inMax,outMin,outMax)*mul+add;for(i=0;imax>i;++i)cell[i]=value}}return this};var WarpFunctions={linlin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:inMax===inMin?outMin:(x-inMin)/(inMax-inMin)*(outMax-outMin)+outMin},linexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===outMin?0:inMax===inMin?outMax:Math.pow(outMax/outMin,(x-inMin)/(inMax-inMin))*outMin},explin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin?outMax:Math.log(x/inMin)/Math.log(inMax/inMin)*(outMax-outMin)+outMin},expexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin||0===outMin?0:Math.pow(outMax/outMin,Math.log(x/inMin)/Math.log(inMax/inMin))*outMin}};fn.register("zmap",ZMapNode)}(timbre),!function(undefined){"use strict";function setupTypedArray(){function ArrayBuffer(_){for(var shift,a=new Array(_.byteLength),bytes=_.BYTES_PER_ELEMENT,i=0,imax=a.length;imax>i;++i)shift=i%bytes*8,a[i]=(_[i/bytes|0]&255<<shift)>>>shift;return a.__view=_,a}function TypedArray(klass,arg,offset,length){var a,b,bytes,i,imax;if(Array.isArray(arg))if(arg.__view)if("undefined"==typeof offset&&(offset=0),"undefined"==typeof length&&(length=arg.length-offset),bytes=klass.bytes,klass.type===floating)a=arg.__view.slice(offset/bytes|0,(offset+length)/bytes|0);else{for(b=arg.slice(offset,offset+length),a=new Array(b.length/bytes|0),i=0,imax=a.length;imax>i;++i)a[i]=0;for(i=0,imax=b.length;imax>i;++i)a[i/bytes|0]+=(255&b[i])<<i%bytes*8}else a=arg.slice();else a="number"==typeof arg&&arg>0?new Array(0|arg):[];if(klass.type!==floating)for(i=0,imax=a.length;imax>i;++i)a[i]=65535&(+a[i]||0);else for(i=0,imax=a.length;imax>i;++i)a[i]=a[i]||0;if(klass.type===signed)for(i=0,imax=a.length;imax>i;++i)a[i]&1<<8*bytes-1&&(a[i]-=1<<8*bytes);return a.__klass=klass,a.constructor=window[klass.name],a.set=set,a.subarray=subarray,a.BYTES_PER_ELEMENT=klass.bytes,a.byteLength=klass.bytes*a.length,a.byteOffset=offset||0,Object.defineProperty(a,"buffer",{get:function(){return new ArrayBuffer(this)}}),a}var unsigned=0,signed=1,floating=2,set=function(array,offset){"undefined"==typeof offset&&(offset=0);var i,imax=Math.min(this.length-offset,array.length);for(i=0;imax>i;++i)this[offset+i]=array[i]},subarray=function(begin,end){return"undefined"==typeof end&&(end=this.length),new this.constructor(this.slice(begin,end))};[["Int8Array",1,signed],["Uint8Array",1,unsigned],["Int16Array",2,signed],["Uint16Array",2,unsigned],["Int32Array",4,signed],["Uint32Array",4,unsigned],["Float32Array",4,floating],["Float64Array",8,floating]].forEach(function(_params){var name=_params[0],params={bytes:_params[1],type:_params[2],name:name};window[name]=function(arg,offset,length){return TypedArray.call(this,params,arg,offset,length)}})}"undefined"==typeof Float32Array&&setupTypedArray();var timbre=function(){return T.apply(null,arguments)},slice=Array.prototype.slice,FINISHED_STATE=0,PLAYING_STATE=1,UNSCHEDULED_STATE=2,SCHEDULED_STATE=3,ACCEPT_SAMPLERATES=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3],ACCEPT_CELLSIZES=[32,64,128,256],_ver="13.08.03",_sys=null,_constructors={},_factories={},_envtype="undefined"!=typeof module&&module.exports?"node":"undefined"!=typeof window?"browser":"unknown",_envmobile="browser"===_envtype&&/(iPhone|iPad|iPod|Android)/i.test(navigator.userAgent),_f64mode=!1,_bpm=120,T=function(){var t,m,args=slice.call(arguments),key=args[0];switch(typeof key){case"string":_constructors[key]?t=new _constructors[key](args.slice(1)):_factories[key]?t=_factories[key](args.slice(1)):(m=/^(.+?)(?:\.(ar|kr))?$/.exec(key),m&&(key=m[1],_constructors[key]?t=new _constructors[key](args.slice(1)):_factories[key]&&(t=_factories[key](args.slice(1))),t&&m[2]&&t[m[2]]()));break;case"number":t=new NumberWrapper(args);break;case"boolean":t=new BooleanWrapper(args);break;case"function":t=new FunctionWrapper(args);break;case"object":if(null!==key){if(key instanceof TimbreObject)return key;if(key.context instanceof TimbreObject)return key.context;isDictionary(key)?t=new ObjectWrapper(args):isArray(key)&&(t=new ArrayWrapper(args))}}t===undefined&&(t=new AddNode(args.slice(1)),console.warn('T("'+key+'") is not defined.'));var _=t._;return _.originkey=key,_.meta=__buildMetaData(t),_.emit("init"),t},__buildMetaData=function(instance){for(var names,desc,meta=instance._.meta,p=instance;null!==p&&p.constructor!==Object;){names=Object.getOwnPropertyNames(p);for(var i=0,imax=names.length;imax>i;++i)meta[names[i]]||(/^(constructor$|process$|_)/.test(names[i])?meta[names[i]]="ignore":(desc=Object.getOwnPropertyDescriptor(p,names[i]),"function"==typeof desc.value?meta[names[i]]="function":(desc.get||desc.set)&&(meta[names[i]]="property")));p=Object.getPrototypeOf(p)}return meta};Object.defineProperties(timbre,{version:{value:_ver},envtype:{value:_envtype},envmobile:{value:_envmobile},env:{get:function(){return _sys.impl.env}},samplerate:{get:function(){return _sys.samplerate}},channels:{get:function(){return _sys.channels}},cellsize:{get:function(){return _sys.cellsize}},currentTime:{get:function(){return _sys.currentTime}},isPlaying:{get:function(){return _sys.status===PLAYING_STATE}},isRecording:{get:function(){return _sys.status===SCHEDULED_STATE}},amp:{set:function(value){"number"==typeof value&&(_sys.amp=value)},get:function(){return _sys.amp}},bpm:{set:function(value){"number"==typeof value&&value>=5&&300>=value&&(_bpm=value)},get:function(){return _bpm}}}),timbre.bind=function(Klass,opts){return _sys.bind(Klass,opts),timbre},timbre.setup=function(opts){return _sys.setup(opts),timbre},timbre.play=function(){return _sys.play(),timbre},timbre.pause=function(){return _sys.pause(),timbre},timbre.reset=function(){return _sys.reset(),_sys.events.emit("reset"),timbre},timbre.on=timbre.addListener=function(type,listener){return _sys.on(type,listener),timbre},timbre.once=function(type,listener){return _sys.once(type,listener),timbre},timbre.off=timbre.removeListener=function(type,listener){return _sys.off(type,listener),timbre},timbre.removeAllListeners=function(type){return _sys.removeAllListeners(type),timbre},timbre.listeners=function(type){return _sys.listeners(type)},timbre.rec=function(){return _sys.rec.apply(_sys,arguments)},timbre.timevalue=function(){var getbpm=function(str){var m,bpm=_bpm;return(m=/^bpm(\d+(?:\.\d+)?)/i.exec(str))&&(bpm=Math.max(5,Math.min(300,+(m[1]||0)))),bpm};return function(str){var m,ms,x;if(m=/^(\d+(?:\.\d+)?)Hz$/i.exec(str))return 0===+m[1]?0:1e3/+m[1];if(m=/L(\d+)?(\.*)$/i.exec(str))return ms=60/getbpm(str)*(4/(m[1]||4))*1e3,ms*=[1,1.5,1.75,1.875][(m[2]||"").length]||1;if(m=/^(\d+(?:\.\d+)?|\.(?:\d+))(min|sec|m)s?$/i.exec(str))switch(m[2]){case"min":return 60*+(m[1]||0)*1e3;case"sec":return 1e3*+(m[1]||0);case"m":return+(m[1]||0)}return(m=/^(?:([0-5]?[0-9]):)?(?:([0-5]?[0-9]):)(?:([0-5]?[0-9]))(?:\.([0-9]{1,3}))?$/.exec(str))?(x=3600*(m[1]||0)+60*(m[2]||0)+(m[3]||0),x=1e3*x+(0|((m[4]||"")+"00").substr(0,3))):(m=/(\d+)\.(\d+)\.(\d+)$/i.exec(str))?(x=480*(4*m[1]+ +m[2])+ +m[3],60/getbpm(str)*(x/480)*1e3):(m=/(\d+)ticks$/i.exec(str))?60/getbpm(str)*(m[1]/480)*1e3:(m=/^(\d+)samples(?:\/(\d+)Hz)?$/i.exec(str))?1e3*m[1]/(m[2]||timbre.samplerate):0}}();var fn=timbre.fn={SignalArray:Float32Array,currentTimeIncr:0,emptycell:null,FINISHED_STATE:FINISHED_STATE,PLAYING_STATE:PLAYING_STATE,UNSCHEDULED_STATE:UNSCHEDULED_STATE,SCHEDULED_STATE:SCHEDULED_STATE},isArray=fn.isArray=Array.isArray,isDictionary=fn.isDictionary=function(object){return"object"==typeof object&&object.constructor===Object};fn.nop=function(){return this},fn.isSignalArray=function(obj){return obj instanceof fn.SignalArray?!0:Array.isArray(obj)&&obj.__klass&&2===obj.__klass.type?!0:!1},fn.extend=function(child,parent){function ctor(){this.constructor=child}parent=parent||TimbreObject;for(var key in parent)parent.hasOwnProperty(key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},fn.constructorof=function(ctor,Klass){for(var f=ctor&&ctor.prototype;f;){if(f===Klass.prototype)return!0;f=Object.getPrototypeOf(f)}return!1},fn.register=function(key,ctor){fn.constructorof(ctor,TimbreObject)?_constructors[key]=ctor:_factories[key]=ctor},fn.alias=function(key,alias){_constructors[alias]?_constructors[key]=_constructors[alias]:_factories[alias]&&(_factories[key]=_factories[alias])},fn.getClass=function(key){return _constructors[key]},fn.pointer=function(src,offset,length){return offset=src.byteOffset+offset*src.constructor.BYTES_PER_ELEMENT,"number"==typeof length?new src.constructor(src.buffer,offset,length):new src.constructor(src.buffer,offset)},fn.nextTick=function(func){return _sys.nextTick(func),timbre},fn.fixAR=function(self){self._.ar=!0,self._.aronly=!0},fn.fixKR=function(self){self._.ar=!1,self._.kronly=!0},fn.changeWithValue=function(){var _=this._,x=_.value*_.mul+_.add;isNaN(x)&&(x=0);for(var cell=this.cells[0],i=0,imax=cell.length;imax>i;++i)cell[i]=x},fn.changeWithValue.unremovable=!0,fn.clone=function(src){var new_instance=new src.constructor([]);return new_instance._.ar=src._.ar,new_instance._.mul=src._.mul,new_instance._.add=src._.add,new_instance._.bypassed=src._.bypassed,new_instance},fn.timer=function(){var make_onstart=function(self){return function(){-1===_sys.timers.indexOf(self)&&(_sys.timers.push(self),_sys.events.emit("addObject"),self._.emit("start"),fn.buddies_start(self))}},make_onstop=function(self){return function(){var i=_sys.timers.indexOf(self);-1!==i&&(_sys.timers.splice(i,1),self._.emit("stop"),_sys.events.emit("removeObject"),fn.buddies_stop(self))}};return function(self){var onstart=make_onstart(self),onstop=make_onstop(self);return self.nodeType=TimbreObject.TIMER,self.start=function(){return _sys.nextTick(onstart),self},self.stop=function(){return _sys.nextTick(onstop),self},self}}(),fn.listener=function(){var make_onlisten=function(self){return function(){-1===_sys.listeners.indexOf(self)&&(_sys.listeners.push(self),_sys.events.emit("addObject"),self._.emit("listen"),fn.buddies_start(self))}},make_onunlisten=function(self){return function(){var i=_sys.listeners.indexOf(self);-1!==i&&(_sys.listeners.splice(i,1),self._.emit("unlisten"),_sys.events.emit("removeObject"),fn.buddies_stop(self))}};return function(self){var onlisten=make_onlisten(self),onunlisten=make_onunlisten(self);return self.nodeType=TimbreObject.LISTENER,self.listen=function(){return arguments.length&&self.append.apply(self,arguments),self.nodes.length&&_sys.nextTick(onlisten),self},self.unlisten=function(){return arguments.length&&self.remove.apply(self,arguments),self.nodes.length||_sys.nextTick(onunlisten),self},self}}(),fn.make_onended=function(self,lastValue){return function(){if(self.playbackState=FINISHED_STATE,"number"==typeof lastValue)for(var cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=lastValue;self._.emit("ended")}},fn.inputSignalAR=function(self){var i,j,not_clear,tmp,tmpL,tmpR,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],nodes=self.nodes,imax=nodes.length,jmax=cell.length,tickID=self.tickID;if(2===self.numChannels){if(not_clear=!0,0!==imax){for(i=0;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE){nodes[i].process(tickID),cellL.set(nodes[i].cells[1]),cellR.set(nodes[i].cells[2]),not_clear=!1,++i;break}for(;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=jmax;j;)j-=8,cellL[j]+=tmpL[j],cellR[j]+=tmpR[j],cellL[j+1]+=tmpL[j+1],cellR[j+1]+=tmpR[j+1],cellL[j+2]+=tmpL[j+2],cellR[j+2]+=tmpR[j+2],cellL[j+3]+=tmpL[j+3],cellR[j+3]+=tmpR[j+3],cellL[j+4]+=tmpL[j+4],cellR[j+4]+=tmpR[j+4],cellL[j+5]+=tmpL[j+5],cellR[j+5]+=tmpR[j+5],cellL[j+6]+=tmpL[j+6],cellR[j+6]+=tmpR[j+6],cellL[j+7]+=tmpL[j+7],cellR[j+7]+=tmpR[j+7]}not_clear&&(cellL.set(fn.emptycell),cellR.set(fn.emptycell))}else{if(not_clear=!0,0!==imax){for(i=0;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE){nodes[i].process(tickID),cell.set(nodes[i].cells[0]),not_clear=!1,++i;break}for(;imax>i;++i)if(nodes[i].playbackState===PLAYING_STATE)for(tmp=nodes[i].process(tickID).cells[0],j=jmax;j;)j-=8,cell[j]+=tmp[j],cell[j+1]+=tmp[j+1],cell[j+2]+=tmp[j+2],cell[j+3]+=tmp[j+3],cell[j+4]+=tmp[j+4],cell[j+5]+=tmp[j+5],cell[j+6]+=tmp[j+6],cell[j+7]+=tmp[j+7]}not_clear&&cell.set(fn.emptycell)}},fn.inputSignalKR=function(self){var i,nodes=self.nodes,imax=nodes.length,tickID=self.tickID,tmp=0;for(i=0;imax>i;++i)nodes[i].playbackState===PLAYING_STATE&&(tmp+=nodes[i].process(tickID).cells[0][0]);return tmp},fn.outputSignalAR=function(self){var i,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],mul=self._.mul,add=self._.add;if(2===self.numChannels)for(i=cell.length;i;)i-=8,cellL[i]=cellL[i]*mul+add,cellR[i]=cellR[i]*mul+add,cellL[i+1]=cellL[i+1]*mul+add,cellR[i+1]=cellR[i+1]*mul+add,cellL[i+2]=cellL[i+2]*mul+add,cellR[i+2]=cellR[i+2]*mul+add,cellL[i+3]=cellL[i+3]*mul+add,cellR[i+3]=cellR[i+3]*mul+add,cellL[i+4]=cellL[i+4]*mul+add,cellR[i+4]=cellR[i+4]*mul+add,cellL[i+5]=cellL[i+5]*mul+add,cellR[i+5]=cellR[i+5]*mul+add,cellL[i+6]=cellL[i+6]*mul+add,cellR[i+6]=cellR[i+6]*mul+add,cellL[i+7]=cellL[i+7]*mul+add,cellR[i+7]=cellR[i+7]*mul+add,cell[i]=.5*(cellL[i]+cellR[i]),cell[i+1]=.5*(cellL[i+1]+cellR[i+1]),cell[i+2]=.5*(cellL[i+2]+cellR[i+2]),cell[i+3]=.5*(cellL[i+3]+cellR[i+3]),cell[i+4]=.5*(cellL[i+4]+cellR[i+4]),cell[i+5]=.5*(cellL[i+5]+cellR[i+5]),cell[i+6]=.5*(cellL[i+6]+cellR[i+6]),cell[i+7]=.5*(cellL[i+7]+cellR[i+7]);else if(1!==mul||0!==add)for(i=cell.length;i;)i-=8,cell[i]=cell[i]*mul+add,cell[i+1]=cell[i+1]*mul+add,cell[i+2]=cell[i+2]*mul+add,cell[i+3]=cell[i+3]*mul+add,cell[i+4]=cell[i+4]*mul+add,cell[i+5]=cell[i+5]*mul+add,cell[i+6]=cell[i+6]*mul+add,cell[i+7]=cell[i+7]*mul+add},fn.outputSignalKR=function(self){var i,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],mul=self._.mul,add=self._.add,value=cell[0]*mul+add;if(2===self.numChannels)for(i=cell.length;i;)i-=8,cell[i]=cell[i+1]=cell[i+2]=cell[i+3]=cell[i+4]=cell[i+5]=cell[i+6]=cell[i+7]=cellL[i]=cellL[i+1]=cellL[i+2]=cellL[i+3]=cellL[i+4]=cellL[i+5]=cellL[i+6]=cellL[i+7]=cellR[i]=cellR[i+1]=cellR[i+2]=cellR[i+3]=cellR[i+4]=cellR[i+5]=cellR[i+6]=cellR[i+7]=value;else for(i=cell.length;i;)i-=8,cell[i]=cell[i+1]=cell[i+2]=cell[i+3]=cell[i+4]=cell[i+5]=cell[i+6]=cell[i+7]=value},fn.buddies_start=function(self){var node,i,imax,buddies=self._.buddies;for(i=0,imax=buddies.length;imax>i;++i)switch(node=buddies[i],node.nodeType){case TimbreObject.DSP:node.play();break;case TimbreObject.TIMER:node.start();break;case TimbreObject.LISTENER:node.listen()}},fn.buddies_stop=function(self){var node,i,imax,buddies=self._.buddies;for(i=0,imax=buddies.length;imax>i;++i)switch(node=buddies[i],node.nodeType){case TimbreObject.DSP:node.pause();break;case TimbreObject.TIMER:node.stop();break;case TimbreObject.LISTENER:node.unlisten()}},fn.fix_iOS6_1_problem=function(flag){_sys.fix_iOS6_1_problem(flag)};var modules=timbre.modules={},EventEmitter=modules.EventEmitter=function(){function EventEmitter(context){this.context=context,this.events={}}var $=EventEmitter.prototype;return $.emit=function(type){var handler=this.events[type];if(!handler)return!1;var args;if("function"==typeof handler){switch(arguments.length){case 1:handler.call(this.context);break;case 2:handler.call(this.context,arguments[1]);break;case 3:handler.call(this.context,arguments[1],arguments[2]);break;default:args=slice.call(arguments,1),handler.apply(this.context,args)}return!0}if(isArray(handler)){args=slice.call(arguments,1);for(var listeners=handler.slice(),i=0,imax=listeners.length;imax>i;++i)listeners[i]instanceof TimbreObject?listeners[i].bang.apply(listeners[i],args):listeners[i].apply(this.context,args);return!0}return handler instanceof TimbreObject?(args=slice.call(arguments,1),void handler.bang.apply(handler,args)):!1},$.on=function(type,listener){if("function"!=typeof listener&&!(listener instanceof TimbreObject))throw new Error("addListener takes instances of Function or timbre.Object");var e=this.events;return e[type]?isArray(e[type])?e[type].push(listener):e[type]=[e[type],listener]:e[type]=listener,this},$.once=function(type,listener){var g,self=this;if("function"==typeof listener)g=function(){self.off(type,g),listener.apply(self.context,arguments)};else{if(!(listener instanceof TimbreObject))throw new Error("once takes instances of Function or timbre.Object");g=function(){self.off(type,g),listener.bang.apply(listener,arguments)}}return g.listener=listener,self.on(type,g),this},$.off=function(type,listener){if("function"!=typeof listener&&!(listener instanceof TimbreObject))throw new Error("removeListener takes instances of Function or timbre.Object");var e=this.events;if(!e[type])return this;var list=e[type];if(isArray(list)){for(var position=-1,i=0,imax=list.length;imax>i;++i)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;list.splice(position,1),0===list.length&&(e[type]=null)}else(list===listener||list.listener&&list.listener===listener)&&(e[type]=null);return this},$.removeAllListeners=function(type){var e=this.events,remain=!1,listeners=e[type];if(isArray(listeners))for(var i=listeners.length;i--;){var listener=listeners[i];listener.unremovable?remain=!0:this.off(type,listener)}else listeners&&(listeners.unremovable?remain=!0:this.off(type,listeners));return remain||(e[type]=null),this},$.listeners=function(type){var a,e=this.events;if(!e[type])return[];if(e=e[type],!isArray(e))return e.unremovable?[]:[e];e=e.slice(),a=[];for(var i=0,imax=e.length;imax>i;++i)e[i].unremovable||a.push(e[i]);return a},EventEmitter}(),Deferred=modules.Deferred=function(){function Deferred(context){this.context=context||this,this._state="pending",this._doneList=[],this._failList=[],this._promise=new Promise(this)}function Promise(object){this.context=object.context,this.then=object.then,this.done=function(){return object.done.apply(object,arguments),this},this.fail=function(){return object.fail.apply(object,arguments),this},this.pipe=function(){return object.pipe.apply(object,arguments)},this.always=function(){return object.always.apply(object,arguments),this},this.promise=function(){return this},this.isResolved=function(){return object.isResolved()},this.isRejected=function(){return object.isRejected()}}var $=Deferred.prototype,exec=function(statue,list,context,args){if("pending"===this._state){this._state=statue;for(var i=0,imax=list.length;imax>i;++i)list[i].apply(context,args);this._doneList=this._failList=null}},isDeferred=function(x){return x&&"function"==typeof x.promise};return $.resolve=function(){var args=slice.call(arguments,0);return exec.call(this,"resolved",this._doneList,this.context||this,args),this},$.resolveWith=function(context){var args=slice.call(arguments,1);return exec.call(this,"resolved",this._doneList,context,args),this},$.reject=function(){var args=slice.call(arguments,0);return exec.call(this,"rejected",this._failList,this.context||this,args),this},$.rejectWith=function(context){var args=slice.call(arguments,1);return exec.call(this,"rejected",this._failList,context,args),this},$.promise=function(){return this._promise},$.done=function(){for(var args=slice.call(arguments),isResolved="resolved"===this._state,isPending="pending"===this._state,list=this._doneList,i=0,imax=args.length;imax>i;++i)"function"==typeof args[i]&&(isResolved?args[i]():isPending&&list.push(args[i]));return this},$.fail=function(){for(var args=slice.call(arguments),isRejected="rejected"===this._state,isPending="pending"===this._state,list=this._failList,i=0,imax=args.length;imax>i;++i)"function"==typeof args[i]&&(isRejected?args[i]():isPending&&list.push(args[i]));return this},$.always=function(){return this.done.apply(this,arguments),this.fail.apply(this,arguments),this},$.then=function(done,fail){return this.done(done).fail(fail)},$.pipe=function(done,fail){var self=this,dfd=new Deferred(this.context);return this.done(function(){var res=done.apply(self.context,arguments);isDeferred(res)?res.then(function(){var args=slice.call(arguments);dfd.resolveWith.apply(dfd,[res].concat(args))}):dfd.resolveWith(self,res)}),this.fail(function(){if("function"==typeof fail){var res=fail.apply(self.context,arguments);isDeferred(res)&&res.fail(function(){var args=slice.call(arguments);dfd.rejectWith.apply(dfd,[res].concat(args))})}else dfd.reject.apply(dfd,arguments)}),dfd.promise()},$.isResolved=function(){return"resolved"===this._state},$.isRejected=function(){return"rejected"===this._state},$.state=function(){return this._state},Deferred.when=function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length;1!==length||isDeferred(subordinate)||(remaining=0);var deferred=1===remaining?subordinate:new Deferred,updateFunc=function(i,results){return function(value){results[i]=arguments.length>1?slice.call(arguments):value,--remaining||deferred.resolve.apply(deferred,results)}};if(length>1)for(var resolveResults=new Array(length),onfailed=function(){deferred.reject()};length>i;++i)resolveValues[i]&&isDeferred(resolveValues[i])?resolveValues[i].promise().done(updateFunc(i,resolveResults)).fail(onfailed):(resolveResults[i]=resolveValues[i],--remaining);return remaining||deferred.resolve.apply(deferred,resolveValues),deferred.promise()},Deferred}(),TimbreObject=timbre.Object=function(){function TimbreObject(numChannels,_args){this._={};var e=this._.events=new EventEmitter(this);if(this._.emit=function(){return e.emit.apply(e,arguments)},isDictionary(_args[0])){var params=_args.shift(),_in=params["in"];this.once("init",function(){this.set(params),_in&&(isArray(_in)?this.append.apply(this,_in):_in instanceof TimbreObject&&this.append(_in))})}switch(this.tickID=-1,this.nodes=_args.map(timbre),this.cells=[],this.numChannels=numChannels,numChannels){case 0:this.L=this.R=new ChannelObject(null),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 1:this.L=this.R=new ChannelObject(this),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 2:this.L=new ChannelObject(this),this.R=new ChannelObject(this),this.cells[0]=new fn.SignalArray(_sys.cellsize),this.cells[1]=this.L.cell,this.cells[2]=this.R.cell}this.playbackState=PLAYING_STATE,this.nodeType=TimbreObject.DSP,this._.ar=!0,this._.mul=1,this._.add=0,this._.dac=null,this._.bypassed=!1,this._.meta={},this._.samplerate=_sys.samplerate,this._.cellsize=_sys.cellsize,this._.buddies=[]}TimbreObject.DSP=1,TimbreObject.TIMER=2,TimbreObject.LISTENER=3;var $=TimbreObject.prototype;return Object.defineProperties($,{isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},isBypassed:{get:function(){return this._.bypassed}},isEnded:{get:function(){return!(1&this.playbackState)}},mul:{set:function(value){"number"==typeof value&&(this._.mul=value,this._.emit("setMul",value))},get:function(){return this._.mul}},add:{set:function(value){"number"==typeof value&&(this._.add=value,this._.emit("setAdd",value))},get:function(){return this._.add}},buddies:{set:function(value){isArray(value)||(value=[value]),this._.buddies=value.filter(function(node){return node instanceof TimbreObject})},get:function(){return this._.buddies}}}),$.toString=function(){return this.constructor.name},$.valueOf=function(){return _sys.tickID!==this.tickID&&this.process(_sys.tickID),this.cells[0][0]},$.append=function(){if(arguments.length>0){var list=slice.call(arguments).map(timbre);this.nodes=this.nodes.concat(list),this._.emit("append",list)}return this},$.appendTo=function(object){return object.append(this),this},$.remove=function(){if(arguments.length>0){for(var j,nodes=this.nodes,list=[],i=0,imax=arguments.length;imax>i;++i)-1!==(j=nodes.indexOf(arguments[i]))&&(list.push(nodes[j]),nodes.splice(j,1));list.length>0&&this._.emit("remove",list)}return this},$.removeFrom=function(object){return object.remove(this),this},$.removeAll=function(){var list=this.nodes.slice();return this.nodes=[],list.length>0&&this._.emit("remove",list),this},$.removeAtIndex=function(index){var item=this.nodes[index];return item&&(this.nodes.splice(index,1),this._.emit("remove",[item])),this},$.postMessage=function(message){return this._.emit("message",message),this},$.to=function(object){if(object instanceof TimbreObject)object.append(this);else{var args=slice.call(arguments);isDictionary(args[1])?args.splice(2,0,this):args.splice(1,0,this),object=T.apply(null,args)}return object},$.splice=function(ins,obj,rem){var i;return obj?obj instanceof TimbreObject&&(i=obj.nodes.indexOf(rem),-1!==i&&obj.nodes.splice(i,1),ins instanceof TimbreObject?(ins.nodes.push(this),obj.nodes.push(ins)):obj.nodes.push(this)):this._.dac&&(ins instanceof TimbreObject?rem instanceof TimbreObject?rem._.dac&&(rem._.dac._.node=ins,ins._.dac=rem._.dac,rem._.dac=null,ins.nodes.push(this)):this._.dac&&(this._.dac._.node=ins,ins._.dac=this._.dac,this._.dac=null,ins.nodes.push(this)):rem instanceof TimbreObject&&rem._.dac&&(rem._.dac._.node=this,this._.dac=rem._.dac,rem._.dac=null)),this},$.on=$.addListener=function(type,listener){return this._.events.on(type,listener),this},$.once=function(type,listener){return this._.events.once(type,listener),this},$.off=$.removeListener=function(type,listener){return this._.events.off(type,listener),this},$.removeAllListeners=function(type){return this._.events.removeAllListeners(type),this},$.listeners=function(type){return this._.events.listeners(type)},$.set=function(key,value){var x,desc,meta=this._.meta;switch(typeof key){case"string":switch(meta[key]){case"property":this[key]=value;break;case"function":this[key](value);break;default:for(x=this;null!==x;)desc=Object.getOwnPropertyDescriptor(x,key),desc&&("function"==typeof desc.value?(meta[key]="function",this[key](value)):(desc.get||desc.set)&&(meta[key]="property",this[key]=value)),x=Object.getPrototypeOf(x)}break;case"object":for(x in key)this.set(x,key[x])}return this},$.get=function(key){return"property"===this._.meta[key]?this[key]:void 0},$.bang=function(){return this._.emit.apply(this,["bang"].concat(slice.call(arguments))),this},$.process=fn.nop,$.bypass=function(){return this._.bypassed=0===arguments.length?!0:!!arguments[0],this},$.play=function(){var dac=this._.dac;return null===dac&&(dac=this._.dac=new SystemInlet(this)),dac.play()&&this._.emit.apply(this,["play"].concat(slice.call(arguments))),fn.buddies_start(this),this},$.pause=function(){var dac=this._.dac;return dac&&dac.playbackState===PLAYING_STATE&&(dac.pause(),this._.dac=null,this._.emit("pause")),fn.buddies_stop(this),this},$.start=$.stop=$.listen=$.unlisten=function(){return this},$.ar=function(){return(0===arguments.length?0:!arguments[0])?this.kr(!0):this._.kronly||(this._.ar=!0,this._.emit("ar",!0)),this},$.kr=function(){return(0===arguments.length?0:!arguments[0])?this.ar(!0):this._.aronly||(this._.ar=!1,this._.emit("ar",!1)),this},$.plot="browser"===_envtype?function(opts){var _=this._,canvas=opts.target;if(!canvas)return this;var foreground,width=opts.width||canvas.width||320,height=opts.height||canvas.height||240,offset_x=(opts.x||0)+.5,offset_y=opts.y||0,context=canvas.getContext("2d");
foreground=opts.foreground!==undefined?opts.foreground:_.plotForeground||"rgb(  0, 128, 255)";var background;background=opts.background!==undefined?opts.background:_.plotBackground||"rgb(255, 255, 255)";var x,y,dy,y0,i,lineWidth=opts.lineWidth||_.plotLineWidth||1,cyclic=!!_.plotCyclic,data=_.plotData||this.cells[0],range=opts.range||_.plotRange||[-1.2,1.2],rangeMin=range[0],rangeDelta=height/(range[1]-rangeMin),dx=width/data.length,imax=data.length;if(context.save(),context.rect(offset_x,offset_y,width,height),null!==background&&(context.fillStyle=background,context.fillRect(offset_x,offset_y,width,height)),_.plotBefore&&_.plotBefore.call(this,context,offset_x,offset_y,width,height),_.plotBarStyle)for(context.fillStyle=foreground,x=0,i=0;imax>i;++i)dy=(data[i]-rangeMin)*rangeDelta,y=height-dy,context.fillRect(x+offset_x,y+offset_y,dx,dy),x+=dx;else{for(context.strokeStyle=foreground,context.lineWidth=lineWidth,context.beginPath(),x=0,y0=height-(data[0]-rangeMin)*rangeDelta,context.moveTo(x+offset_x,y0+offset_y),i=1;imax>i;++i)x+=dx,y=height-(data[i]-rangeMin)*rangeDelta,context.lineTo(x+offset_x,y+offset_y);cyclic?context.lineTo(x+dx+offset_x,y0+offset_y):context.lineTo(x+dx+offset_x,y+offset_y),context.stroke()}_.plotAfter&&_.plotAfter.call(this,context,offset_x,offset_y,width,height);var border=opts.border||_.plotBorder;return border&&(context.strokeStyle="string"==typeof border?border:"#000",context.lineWidth=1,context.strokeRect(offset_x,offset_y,width,height)),context.restore(),this}:fn.nop,TimbreObject}(),ChannelObject=timbre.ChannelObject=function(){function ChannelObject(parent){timbre.Object.call(this,-1,[]),fn.fixAR(this),this._.parent=parent,this.cell=new fn.SignalArray(_sys.cellsize),this.L=this.R=this,this.cells[0]=this.cells[1]=this.cells[2]=this.cell,this.numChannels=1}return fn.extend(ChannelObject),ChannelObject.prototype.process=function(tickID){return this.tickID!==tickID&&(this.tickID=tickID,this._.parent&&this._.parent.process(tickID)),this},ChannelObject}(),AddNode=function(){function AddNode(_args){TimbreObject.call(this,2,_args)}return fn.extend(AddNode),AddNode.prototype.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},fn.register("+",AddNode),AddNode}(),NumberWrapper=function(){function NumberWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.value=_args[0],isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(NumberWrapper);var $=NumberWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.value=isNaN(value)?0:value,fn.changeWithValue.call(this))},get:function(){return this._.value}}}),NumberWrapper}(),BooleanWrapper=function(){function BooleanWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.value=_args[0],isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(BooleanWrapper);var $=BooleanWrapper.prototype;return Object.defineProperties($,{value:{set:function(value){this._.value=value?1:0,fn.changeWithValue.call(this)},get:function(){return!!this._.value}}}),BooleanWrapper}(),FunctionWrapper=function(){function FunctionWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),this.func=_args[0],this._.value=0,isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}this.on("setAdd",fn.changeWithValue),this.on("setMul",fn.changeWithValue)}fn.extend(FunctionWrapper);var $=FunctionWrapper.prototype;return Object.defineProperties($,{func:{set:function(value){"function"==typeof value&&(this._.func=value)},get:function(){return this._.func}},args:{set:function(value){this._.args=isArray(value)?value:[value]},get:function(){return this._.args}}}),$.bang=function(){var _=this._,args=slice.call(arguments).concat(_.args),x=_.func.apply(this,args);return"number"==typeof x&&(_.value=x,fn.changeWithValue.call(this)),this._.emit("bang"),this},FunctionWrapper}(),ArrayWrapper=function(){function ArrayWrapper(_args){TimbreObject.call(this,1,[]);var i,imax;for(i=0,imax=_args[0].length;imax>i;++i)this.append(_args[0][i]);if(isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}}fn.extend(ArrayWrapper);var $=ArrayWrapper.prototype;return Object.defineProperties($,{}),$.bang=function(){var i,imax,args=["bang"].concat(slice.call(arguments)),nodes=this.nodes;for(i=0,imax=nodes.length;imax>i;++i)nodes[i].bang.apply(nodes[i],args);return this},$.postMessage=function(message){var i,imax,nodes=this.nodes;for(i=0,imax=nodes.length;imax>i;++i)nodes[i].postMessage(message);return this},$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},ArrayWrapper}(),ObjectWrapper=function(){function ObjectWrapper(_args){if(TimbreObject.call(this,1,[]),fn.fixKR(this),isDictionary(_args[1])){var params=_args[1];this.once("init",function(){this.set(params)})}}fn.extend(ObjectWrapper);var $=ObjectWrapper.prototype;return Object.defineProperties($,{}),ObjectWrapper}(),SystemInlet=function(){function SystemInlet(object){TimbreObject.call(this,2,[]),this.playbackState=FINISHED_STATE;var _=this._;_.node=object,_.onplay=make_onplay(this),_.onpause=make_onpause(this)}fn.extend(SystemInlet);var make_onplay=function(self){return function(){-1===_sys.inlets.indexOf(self)&&(_sys.inlets.push(self),_sys.events.emit("addObject"),self.playbackState=PLAYING_STATE,self._.emit("play"))}},make_onpause=function(self){return function(){var i=_sys.inlets.indexOf(self);-1!==i&&(_sys.inlets.splice(i,1),self.playbackState=FINISHED_STATE,self._.emit("pause"),_sys.events.emit("removeObject"))}},$=SystemInlet.prototype;return $.play=function(){return _sys.nextTick(this._.onplay),-1===_sys.inlets.indexOf(this)},$.pause=function(){_sys.nextTick(this._.onpause)},$.process=function(tickID){var node=this._.node;1&node.playbackState?(node.process(tickID),this.cells[1].set(node.cells[1]),this.cells[2].set(node.cells[2])):(this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell))},SystemInlet}(),SoundSystem=function(){function SoundSystem(){this.context=this,this.tickID=0,this.impl=null,this.amp=.8,this.status=FINISHED_STATE,this.samplerate=44100,this.channels=2,this.cellsize=64,this.streammsec=20,this.streamsize=0,this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this.deferred=null,this.recStart=0,this.recBuffers=null,this.delayProcess=make_delayProcess(this),this.events=null,fn.currentTimeIncr=1e3*this.cellsize/this.samplerate,fn.emptycell=new fn.SignalArray(this.cellsize),this.reset(!0)}var make_delayProcess=function(self){return function(){self.recStart=Date.now(),self.process()}},$=SoundSystem.prototype;$.bind=function(Klass,opts){if("function"==typeof Klass){var player=new Klass(this,opts);this.impl=player,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate)}return this},$.setup=function(params){return"object"==typeof params&&(-1!==ACCEPT_SAMPLERATES.indexOf(params.samplerate)&&(this.samplerate=params.samplerate<=this.impl.maxSamplerate?params.samplerate:this.impl.maxSamplerate),-1!==ACCEPT_CELLSIZES.indexOf(params.cellsize)&&(this.cellsize=params.cellsize),"undefined"!=typeof Float64Array&&"undefined"!=typeof params.f64&&(_f64mode=!!params.f64,fn.SignalArray=_f64mode?Float64Array:Float32Array)),fn.currentTimeIncr=1e3*this.cellsize/this.samplerate,fn.emptycell=new fn.SignalArray(this.cellsize),this},$.getAdjustSamples=function(samplerate){var samples,bits;return samplerate=samplerate||this.samplerate,samples=this.streammsec/1e3*samplerate,bits=Math.ceil(Math.log(samples)*Math.LOG2E),bits=8>bits?8:bits>14?14:bits,1<<bits},$.play=function(){return this.status===FINISHED_STATE&&(this.status=PLAYING_STATE,this.streamsize=this.getAdjustSamples(),this.strmL=new fn.SignalArray(this.streamsize),this.strmR=new fn.SignalArray(this.streamsize),this.impl.play(),this.events.emit("play")),this},$.pause=function(){return this.status===PLAYING_STATE&&(this.status=FINISHED_STATE,this.impl.pause(),this.events.emit("pause")),this},$.reset=function(deep){return deep&&(this.events=new EventEmitter(this).on("addObject",function(){this.status===FINISHED_STATE&&this.play()}).on("removeObject",function(){this.status===PLAYING_STATE&&this.inlets.length+this.timers.length+this.listeners.length===0&&this.pause()})),this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this},$.process=function(){var x,tmpL,tmpR,i,j,jmax,k,nextTicks,tickID=this.tickID,strmL=this.strmL,strmR=this.strmR,amp=this.amp,imax=this.streamsize,saved_i=0,kmax=this.cellsize,n=this.streamsize/this.cellsize,timers=this.timers,inlets=this.inlets,listeners=this.listeners,currentTimeIncr=fn.currentTimeIncr;for(i=0;imax>i;++i)strmL[i]=strmR[i]=0;for(;n--;){for(++tickID,j=0,jmax=timers.length;jmax>j;++j)1&timers[j].playbackState&&timers[j].process(tickID);for(j=0,jmax=inlets.length;jmax>j;++j)if(x=inlets[j],x.process(tickID),1&x.playbackState)for(tmpL=x.cells[1],tmpR=x.cells[2],k=0,i=saved_i;kmax>k;++k,++i)strmL[i]+=tmpL[k],strmR[i]+=tmpR[k];for(saved_i+=kmax,j=0,jmax=listeners.length;jmax>j;++j)1&listeners[j].playbackState&&listeners[j].process(tickID);for(this.currentTime+=currentTimeIncr,nextTicks=this.nextTicks.splice(0),j=0,jmax=nextTicks.length;jmax>j;++j)nextTicks[j]()}for(i=0;imax>i;++i)x=strmL[i]*amp,-1>x?x=-1:x>1&&(x=1),strmL[i]=x,x=strmR[i]*amp,-1>x?x=-1:x>1&&(x=1),strmR[i]=x;this.tickID=tickID;var currentTime=this.currentTime;if(this.status===SCHEDULED_STATE){if(2===this.recCh)this.recBuffers.push(new fn.SignalArray(strmL)),this.recBuffers.push(new fn.SignalArray(strmR));else{var strm=new fn.SignalArray(strmL.length);for(i=0,imax=strm.length;imax>i;++i)strm[i]=.5*(strmL[i]+strmR[i]);this.recBuffers.push(strm)}if(currentTime>=this.maxDuration)this.deferred.sub.reject();else if(currentTime>=this.recDuration)this.deferred.sub.resolve();else{var now=Date.now();now-this.recStart>20?setTimeout(this.delayProcess,10):this.process()}}},$.nextTick=function(func){this.status===FINISHED_STATE?func():this.nextTicks.push(func)},$.rec=function(){fn.fix_iOS6_1_problem(!0);var dfd=new Deferred(this);if(this.deferred)return console.warn("rec deferred is exists??"),dfd.reject().promise();if(this.status!==FINISHED_STATE)return console.log("status is not none",this.status),dfd.reject().promise();var i=0,args=arguments,opts=isDictionary(args[i])?args[i++]:{},func=args[i];if("function"!=typeof func)return console.warn("no function"),dfd.reject().promise();this.deferred=dfd,this.status=SCHEDULED_STATE,this.reset();var rec_inlet=new T("+"),inlet_dfd=new Deferred(this),outlet={done:function(){inlet_dfd.resolve.apply(inlet_dfd,slice.call(arguments))},send:function(){rec_inlet.append.apply(rec_inlet,arguments)}},self=this;return inlet_dfd.then(recdone,function(){fn.fix_iOS6_1_problem(!1),recdone.call(self,!0)}),this.deferred.sub=inlet_dfd,this.savedSamplerate=this.samplerate,this.samplerate=opts.samplerate||this.samplerate,this.recDuration=opts.recDuration||1/0,this.maxDuration=opts.maxDuration||6e5,this.recCh=opts.ch||1,2!==this.recCh&&(this.recCh=1),this.recBuffers=[],this.streamsize=this.getAdjustSamples(),this.strmL=new fn.SignalArray(this.streamsize),this.strmR=new fn.SignalArray(this.streamsize),this.inlets.push(rec_inlet),func(outlet),setTimeout(this.delayProcess,10),dfd.promise()};var recdone=function(){this.status=FINISHED_STATE,this.reset();var bufferLength,recBuffers=this.recBuffers,samplerate=this.samplerate,streamsize=this.streamsize;this.samplerate=this.savedSamplerate,bufferLength=1/0!==this.recDuration?this.recDuration*samplerate*.001|0:(recBuffers.length>>this.recCh-1)*streamsize;var result,i,imax=bufferLength/streamsize|0,j=0,k=0,remaining=bufferLength;if(2===this.recCh){var L=new fn.SignalArray(bufferLength),R=new fn.SignalArray(bufferLength),mixed=new fn.SignalArray(bufferLength);for(i=0;imax>i;++i)if(L.set(recBuffers[j++],k),R.set(recBuffers[j++],k),k+=streamsize,remaining-=streamsize,remaining>0&&streamsize>remaining){L.set(recBuffers[j++].subarray(0,remaining),k),R.set(recBuffers[j++].subarray(0,remaining),k);break}for(i=0,imax=bufferLength;imax>i;++i)mixed[i]=.5*(L[i]+R[i]);result={samplerate:samplerate,channels:2,buffer:[mixed,L,R]}}else{var buffer=new fn.SignalArray(bufferLength);for(i=0;imax>i;++i)if(buffer.set(recBuffers[j++],k),k+=streamsize,remaining-=streamsize,remaining>0&&streamsize>remaining){buffer.set(recBuffers[j++].subarray(0,remaining),k);break}result={samplerate:samplerate,channels:1,buffer:[buffer]}}var args=[].concat.apply([result],arguments);this.deferred.resolve.apply(this.deferred,args),this.deferred=null};return $.on=function(type,listeners){this.events.on(type,listeners)},$.once=function(type,listeners){this.events.once(type,listeners)},$.off=function(type,listener){this.events.off(type,listener)},$.removeAllListeners=function(type){this.events.removeListeners(type)},$.listeners=function(type){return this.events.listeners(type)},$.fix_iOS6_1_problem=function(flag){this.impl.fix_iOS6_1_problem&&this.impl.fix_iOS6_1_problem(flag)},SoundSystem}(),ImplClass=null;ImplClass="undefined"!=typeof webkitAudioContext?function(sys){var bufSrc,jsNode,context=new webkitAudioContext;fn._audioContext=context,this.maxSamplerate=context.sampleRate,this.defaultSamplerate=context.sampleRate,this.env="webkit";var ua=navigator.userAgent;if(ua.match(/linux/i)?sys.streammsec*=8:ua.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(sys.streammsec*=4),this.play=function(){var onaudioprocess,x,dx,jsn_streamsize=sys.getAdjustSamples(context.sampleRate),sys_streamsize=sys.streamsize;sys.samplerate===context.sampleRate?onaudioprocess=function(e){var outs=e.outputBuffer;sys.process(),outs.getChannelData(0).set(sys.strmL),outs.getChannelData(1).set(sys.strmR)}:2*sys.samplerate===context.sampleRate?onaudioprocess=function(e){var i,j,inL=sys.strmL,inR=sys.strmR,outs=e.outputBuffer,outL=outs.getChannelData(0),outR=outs.getChannelData(1),imax=outs.length;for(sys.process(),i=j=0;imax>i;i+=2,++j)outL[i]=outL[i+1]=inL[j],outR[i]=outR[i+1]=inR[j]}:(x=sys_streamsize,dx=sys.samplerate/context.sampleRate,onaudioprocess=function(e){var i,inL=sys.strmL,inR=sys.strmR,outs=e.outputBuffer,outL=outs.getChannelData(0),outR=outs.getChannelData(1),imax=outs.length;for(i=0;imax>i;++i)x>=sys_streamsize&&(sys.process(),x-=sys_streamsize),outL[i]=inL[0|x],outR[i]=inR[0|x],x+=dx}),bufSrc=context.createBufferSource(),jsNode=context.createJavaScriptNode(jsn_streamsize,2,sys.channels),jsNode.onaudioprocess=onaudioprocess,bufSrc.noteOn(0),bufSrc.connect(jsNode),jsNode.connect(context.destination)},this.pause=function(){bufSrc.disconnect(),jsNode.disconnect()},_envmobile){var n=0,buf=context.createBufferSource();this.fix_iOS6_1_problem=function(flag){n+=flag?1:-1,1===n?(buf.noteOn(0),buf.connect(context.destination)):0===n&&buf.disconnect()}}}:"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(sys){var timer=function(){var source="var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};",blob=new Blob([source],{type:"text/javascript"}),path=URL.createObjectURL(blob);return new Worker(path)}();this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="moz",this.play=function(){var audio=new Audio,interleaved=new Float32Array(sys.streamsize*sys.channels),streammsec=sys.streammsec,written=0,writtenIncr=sys.streamsize/sys.samplerate*1e3,start=Date.now(),onaudioprocess=function(){if(!(written>Date.now()-start)){var inL=sys.strmL,inR=sys.strmR,i=interleaved.length,j=inL.length;for(sys.process();j--;)interleaved[--i]=inR[j],interleaved[--i]=inL[j];audio.mozWriteAudio(interleaved),written+=writtenIncr}};audio.mozSetup(sys.channels,sys.samplerate),timer.onmessage=onaudioprocess,timer.postMessage(streammsec)},this.pause=function(){timer.postMessage(0)}}:function(){this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="nop",this.play=function(){},this.pause=function(){}},_sys=(new SoundSystem).bind(ImplClass);var exports=timbre;"node"===_envtype?module.exports=global.timbre=exports:"browser"===_envtype&&(exports.noConflict=function(){var _t=window.timbre,_T=window.T;return function(deep){return window.T===exports&&(window.T=_T),deep&&window.timbre===exports&&(window.timbre=_t),exports}}(),window.timbre=window.T=exports),function(){function getFlashPlayerVersion(subs){try{return nav.plugins&&nav.mimeTypes&&nav.mimeTypes.length?nav.plugins["Shockwave Flash"].description.match(/([0-9]+)/)[subs]:new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").match(/([0-9]+)/)[subs]}catch(e){return-1}}if("nop"===_sys.impl.env&&"browser"===_envtype&&!_envmobile){var nav=navigator;if(!(getFlashPlayerVersion(0)<10)){var swf,PlayerDivID="TimbreFlashPlayerDiv",src=function(){var scripts=document.getElementsByTagName("script");if(scripts&&scripts.length)for(var m,i=0,imax=scripts.length;imax>i;++i)if(m=/^(.*\/)timbre(?:\.dev)?\.js$/i.exec(scripts[i].src))return m[1]+"timbre.swf"}();window.timbrejs_flashfallback_init=function(){function TimbreFlashPlayer(sys){var timerId=0;this.maxSamplerate=44100,this.defaultSamplerate=44100,this.env="flash",this.play=function(){var onaudioprocess,interleaved=new Array(sys.streamsize*sys.channels),streammsec=sys.streammsec,written=0,writtenIncr=sys.streamsize/sys.samplerate*1e3,start=Date.now();onaudioprocess=function(){if(!(written>Date.now()-start)){var inL=sys.strmL,inR=sys.strmR,i=interleaved.length,j=inL.length;for(sys.process();j--;)interleaved[--i]=32768*inR[j]|0,interleaved[--i]=32768*inL[j]|0;swf.writeAudio(interleaved.join(" ")),written+=writtenIncr}},swf.setup?(swf.setup(sys.channels,sys.samplerate),timerId=setInterval(onaudioprocess,streammsec)):console.warn("Cannot find "+src)},this.pause=function(){0!==timerId&&(swf.cancel(),clearInterval(timerId),timerId=0)}}_sys.bind(TimbreFlashPlayer),delete window.timbrejs_flashfallback_init};var o,p,swfSrc=src,swfName=swfSrc+"?"+ +new Date,swfId="TimbreFlashPlayer",div=document.createElement("div");div.id=PlayerDivID,div.style.display="inline",div.width=div.height=1,nav.plugins&&nav.mimeTypes&&nav.mimeTypes.length?(o=document.createElement("object"),o.id=swfId,o.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",o.width=o.height=1,o.setAttribute("data",swfName),o.setAttribute("type","application/x-shockwave-flash"),p=document.createElement("param"),p.setAttribute("name","allowScriptAccess"),p.setAttribute("value","always"),o.appendChild(p),div.appendChild(o)):div.innerHTML='<object id="'+swfId+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1"><param name="movie" value="'+swfName+'" /><param name="bgcolor" value="#FFFFFF" /><param name="quality" value="high" /><param name="allowScriptAccess" value="always" /></object>',window.addEventListener("load",function(){document.body.appendChild(div),swf=document[swfId]})}}}()}(),function(T){"use strict";function Biquad(samplerate){this.samplerate=samplerate,this.frequency=340,this.Q=1,this.gain=0,this.x1L=this.x2L=this.y1L=this.y2L=0,this.x1R=this.x2R=this.y1R=this.y2R=0,this.b0=this.b1=this.b2=this.a1=this.a2=0,this.setType("lpf")}var $=Biquad.prototype;$.process=function(cellL,cellR){var xL,xR,yL,yR,i,imax,x1L=this.x1L,x2L=this.x2L,y1L=this.y1L,y2L=this.y2L,x1R=this.x1R,x2R=this.x2R,y1R=this.y1R,y2R=this.y2R,b0=this.b0,b1=this.b1,b2=this.b2,a1=this.a1,a2=this.a2;for(i=0,imax=cellL.length;imax>i;++i)xL=cellL[i],yL=b0*xL+b1*x1L+b2*x2L-a1*y1L-a2*y2L,x2L=x1L,x1L=xL,y2L=y1L,y1L=yL,xR=cellR[i],yR=b0*xR+b1*x1R+b2*x2R-a1*y1R-a2*y2R,x2R=x1R,x1R=xR,y2R=y1R,y1R=yR,cellL[i]=yL,cellR[i]=yR;this.x1L=x1L,this.x2L=x2L,this.y1L=y1L,this.y2L=y2L,this.x1R=x1R,this.x2R=x2R,this.y1R=y1R,this.y2R=y2R},$.setType=function(type){var f;(f=setParams[type])&&(this.type=type,f.call(this,this.frequency,this.Q,this.gain))},$.setParams=function(frequency,Q,dbGain){this.frequency=frequency,this.Q=Q,this.gain=dbGain;var f=setParams[this.type];return f&&f.call(this,frequency,Q,dbGain),this};var setParams={lowpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt(.5*(4-Math.sqrt(16-16/(g*g)))),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta-gamma);this.b0=2*alpha,this.b1=4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},highpass:function(cutoff,resonance){if(cutoff/=.5*this.samplerate,cutoff>=1)this.b0=this.b1=this.b2=this.a1=this.a2=0;else if(0>=cutoff)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{resonance=0>resonance?0:resonance;var g=Math.pow(10,.05*resonance),d=Math.sqrt((4-Math.sqrt(16-16/(g*g)))/2),theta=Math.PI*cutoff,sn=.5*d*Math.sin(theta),beta=.5*(1-sn)/(1+sn),gamma=(.5+beta)*Math.cos(theta),alpha=.25*(.5+beta+gamma);this.b0=2*alpha,this.b1=-4*alpha,this.b2=this.b0,this.a1=2*-gamma,this.a2=2*beta}},bandpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=alpha*ia0,this.b1=0,this.b2=-alpha*ia0,this.a1=-2*k*ia0,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=this.b1=this.b2=this.a1=this.a2=0},lowshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne+aMinusOne*k+k2);this.b0=A*(aPlusOne-aMinusOne*k+k2)*ia0,this.b1=2*A*(aMinusOne-aPlusOne*k)*ia0,this.b2=A*(aPlusOne-aMinusOne*k-k2)*ia0,this.a1=-2*(aMinusOne+aPlusOne*k)*ia0,this.a2=(aPlusOne+aMinusOne*k-k2)*ia0}},highshelf:function(frequency,_dummy_,dbGain){frequency/=.5*this.samplerate;var A=Math.pow(10,dbGain/40);if(frequency>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(0>=frequency)this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0;else{var w0=Math.PI*frequency,S=1,alpha=.5*Math.sin(w0)*Math.sqrt((A+1/A)*(1/S-1)+2),k=Math.cos(w0),k2=2*Math.sqrt(A)*alpha,aPlusOne=A+1,aMinusOne=A-1,ia0=1/(aPlusOne-aMinusOne*k+k2);this.b0=A*(aPlusOne+aMinusOne*k+k2)*ia0,this.b1=-2*A*(aMinusOne+aPlusOne*k)*ia0,this.b2=A*(aPlusOne+aMinusOne*k-k2)*ia0,this.a1=2*(aMinusOne-aPlusOne*k)*ia0,this.a2=(aPlusOne-aMinusOne*k-k2)*ia0}},peaking:function(frequency,Q,dbGain){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency){var A=Math.pow(10,dbGain/40);if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha/A);this.b0=(1+alpha*A)*ia0,this.b1=-2*k*ia0,this.b2=(1-alpha*A)*ia0,this.a1=this.b1,this.a2=(1-alpha/A)*ia0}else this.b0=A*A,this.b1=this.b2=this.a1=this.a2=0}else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},notch:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=ia0,this.b1=-2*k*ia0,this.b2=ia0,this.a1=this.b1,this.a2=(1-alpha)*ia0}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},allpass:function(frequency,Q){if(frequency/=.5*this.samplerate,frequency>0&&1>frequency)if(Q>0){var w0=Math.PI*frequency,alpha=Math.sin(w0)/(2*Q),k=Math.cos(w0),ia0=1/(1+alpha);this.b0=(1-alpha)*ia0,this.b1=-2*k*ia0,this.b2=(1+alpha)*ia0,this.a1=this.b1,this.a2=this.b0}else this.b0=-1,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0}};setParams.lpf=setParams.lowpass,setParams.hpf=setParams.highpass,setParams.bpf=setParams.bandpass,setParams.bef=setParams.notch,setParams.brf=setParams.notch,setParams.apf=setParams.allpass,T.modules.Biquad=Biquad}(timbre),function(T){"use strict";function Chorus(samplerate){this.samplerate=samplerate;var bits=Math.round(Math.log(.1*samplerate)*Math.LOG2E);this.buffersize=1<<bits,this.bufferL=new T.fn.SignalArray(this.buffersize+1),this.bufferR=new T.fn.SignalArray(this.buffersize+1),this.wave=null,this._wave=null,this.writeIndex=this.buffersize>>1,this.readIndex=0,this.delayTime=20,this.rate=4,this.depth=20,this.feedback=.2,this.wet=.5,this.phase=0,this.phaseIncr=0,this.phaseStep=4,this.setWaveType("sin"),this.setDelayTime(this.delayTime),this.setRate(this.rate)}var $=Chorus.prototype,waves=[];waves[0]=function(){for(var wave=new Float32Array(512),i=0;512>i;++i)wave[i]=Math.sin(2*Math.PI*(i/512));return wave}(),waves[1]=function(){for(var x,wave=new Float32Array(512),i=0;512>i;++i)x=i/512-.25,wave[i]=1-4*Math.abs(Math.round(x)-x);return wave}(),$.setWaveType=function(waveType){"sin"===waveType?(this.wave=waveType,this._wave=waves[0]):"tri"===waveType&&(this.wave=waveType,this._wave=waves[1])},$.setDelayTime=function(delayTime){this.delayTime=delayTime;for(var readIndex=this.writeIndex-(delayTime*this.samplerate*.001|0);0>readIndex;)readIndex+=this.buffersize;this.readIndex=readIndex},$.setRate=function(rate){this.rate=rate,this.phaseIncr=512*this.rate/this.samplerate*this.phaseStep},$.process=function(cellL,cellR){var x,index,mod,i,j,bufferL=this.bufferL,bufferR=this.bufferR,size=this.buffersize,mask=size-1,wave=this._wave,phase=this.phase,phaseIncr=this.phaseIncr,writeIndex=this.writeIndex,readIndex=this.readIndex,depth=this.depth,feedback=this.feedback,wet=this.wet,dry=1-wet,imax=cellL.length,jmax=this.phaseStep;for(i=0;imax>i;){for(mod=wave[0|phase]*depth,phase+=phaseIncr;phase>512;)phase-=512;for(j=0;jmax>j;++j,++i)index=readIndex+size+mod&mask,x=.5*(bufferL[index]+bufferL[index+1]),bufferL[writeIndex]=cellL[i]-x*feedback,cellL[i]=cellL[i]*dry+x*wet,x=.5*(bufferR[index]+bufferR[index+1]),bufferR[writeIndex]=cellR[i]-x*feedback,cellR[i]=cellR[i]*dry+x*wet,writeIndex=writeIndex+1&mask,readIndex=readIndex+1&mask}this.phase=phase,this.writeIndex=writeIndex,this.readIndex=readIndex},T.modules.Chorus=Chorus}(timbre),function(T){"use strict";function Compressor(samplerate,channels){this.samplerate=samplerate,this.channels=channels,this.lastPreDelayFrames=0,this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.ratio=-1,this.slope=-1,this.linearThreshold=-1,this.dbThreshold=-1,this.dbKnee=-1,this.kneeThreshold=-1,this.kneeThresholdDb=-1,this.ykneeThresholdDb=-1,this.K=-1,this.attackTime=.003,this.releaseTime=.25,this.preDelayTime=.006,this.dbPostGain=0,this.effectBlend=1,this.releaseZone1=.09,this.releaseZone2=.16,this.releaseZone3=.42,this.releaseZone4=.98,this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1,this.delayBufferL=new T.fn.SignalArray(MaxPreDelayFrames),this.delayBufferR=2===channels?new T.fn.SignalArray(MaxPreDelayFrames):this.delayBufferL,this.preDelayTime=6,this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.maxAttackCompressionDiffDb=-1,this.meteringReleaseK=1-Math.exp(-1/(.325*this.samplerate)),this.setAttackTime(this.attackTime),this.setReleaseTime(this.releaseTime),this.setPreDelayTime(this.preDelayTime),this.setParams(-24,30,12)}var MaxPreDelayFrames=1024,MaxPreDelayFramesMask=MaxPreDelayFrames-1,DefaultPreDelayFrames=256,kSpacingDb=5,$=Compressor.prototype;$.clone=function(){var new_instance=new Compressor(this.samplerate,this.channels);return new_instance.setAttackTime(this.attackTime),new_instance.setReleaseTime(this.releaseTime),new_instance.setPreDelayTime(this.preDelayTime),new_instance.setParams(this.dbThreshold,this.dbKnee,this.ratio),new_instance},$.setAttackTime=function(value){this.attackTime=Math.max(.001,value),this._attackFrames=this.attackTime*this.samplerate},$.setReleaseTime=function(value){this.releaseTime=Math.max(.001,value);var releaseFrames=this.releaseTime*this.samplerate,satReleaseTime=.0025;this._satReleaseFrames=satReleaseTime*this.samplerate;var y1=releaseFrames*this.releaseZone1,y2=releaseFrames*this.releaseZone2,y3=releaseFrames*this.releaseZone3,y4=releaseFrames*this.releaseZone4;this._kA=.9999999999999998*y1+1.8432219684323923e-16*y2-1.9373394351676423e-16*y3+8.824516011816245e-18*y4,this._kB=-1.5788320352845888*y1+2.3305837032074286*y2-.9141194204840429*y3+.1623677525612032*y4,this._kC=.5334142869106424*y1-1.272736789213631*y2+.9258856042207512*y3-.18656310191776226*y4,this._kD=.08783463138207234*y1-.1694162967925622*y2+.08588057951595272*y3-.00429891410546283*y4,this._kE=-.042416883008123074*y1+.1115693827987602*y2-.09764676325265872*y3+.028494263462021576*y4},$.setPreDelayTime=function(preDelayTime){this.preDelayTime=preDelayTime;var preDelayFrames=preDelayTime*this.samplerate;if(preDelayFrames>MaxPreDelayFrames-1&&(preDelayFrames=MaxPreDelayFrames-1),this.lastPreDelayFrames!==preDelayFrames){this.lastPreDelayFrames=preDelayFrames;for(var i=0,imax=this.delayBufferL.length;imax>i;++i)this.delayBufferL[i]=this.delayBufferR[i]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=preDelayFrames}},$.setParams=function(dbThreshold,dbKnee,ratio){this._k=this.updateStaticCurveParameters(dbThreshold,dbKnee,ratio);var fullRangeGain=this.saturate(1,this._k),fullRangeMakeupGain=1/fullRangeGain;fullRangeMakeupGain=Math.pow(fullRangeMakeupGain,.6),this._masterLinearGain=Math.pow(10,.05*this.dbPostGain)*fullRangeMakeupGain},$.kneeCurve=function(x,k){return x<this.linearThreshold?x:this.linearThreshold+(1-Math.exp(-k*(x-this.linearThreshold)))/k},$.saturate=function(x,k){var y;if(x<this.kneeThreshold)y=this.kneeCurve(x,k);else{var xDb=x?20*Math.log(x)*Math.LOG10E:-1e3,yDb=this.ykneeThresholdDb+this.slope*(xDb-this.kneeThresholdDb);y=Math.pow(10,.05*yDb)}return y},$.slopeAt=function(x,k){if(x<this.linearThreshold)return 1;var x2=1.001*x,xDb=x?20*Math.log(x)*Math.LOG10E:-1e3,x2Db=x2?20*Math.log(x2)*Math.LOG10E:-1e3,y=this.kneeCurve(x,k),y2=this.kneeCurve(x2,k),yDb=y?20*Math.log(y)*Math.LOG10E:-1e3,y2Db=y2?20*Math.log(y2)*Math.LOG10E:-1e3;return(y2Db-yDb)/(x2Db-xDb)},$.kAtSlope=function(desiredSlope){for(var xDb=this.dbThreshold+this.dbKnee,x=Math.pow(10,.05*xDb),minK=.1,maxK=1e4,k=5,i=0;15>i;++i){var slope=this.slopeAt(x,k);desiredSlope>slope?maxK=k:minK=k,k=Math.sqrt(minK*maxK)}return k},$.updateStaticCurveParameters=function(dbThreshold,dbKnee,ratio){this.dbThreshold=dbThreshold,this.linearThreshold=Math.pow(10,.05*dbThreshold),this.dbKnee=dbKnee,this.ratio=ratio,this.slope=1/this.ratio,this.kneeThresholdDb=dbThreshold+dbKnee,this.kneeThreshold=Math.pow(10,.05*this.kneeThresholdDb);var k=this.kAtSlope(1/this.ratio),y=this.kneeCurve(this.kneeThreshold,k);return this.ykneeThresholdDb=y?20*Math.log(y)*Math.LOG10E:-1e3,this._k=k,this._k},$.process=function(cellL,cellR){for(var dryMix=1-this.effectBlend,wetMix=this.effectBlend,k=this._k,masterLinearGain=this._masterLinearGain,satReleaseFrames=this._satReleaseFrames,kA=this._kA,kB=this._kB,kC=this._kC,kD=this._kD,kE=this._kE,nDivisionFrames=64,nDivisions=cellL.length/nDivisionFrames,frameIndex=0,desiredGain=this.detectorAverage,compressorGain=this.compressorGain,maxAttackCompressionDiffDb=this.maxAttackCompressionDiffDb,i_attackFrames=1/this._attackFrames,preDelayReadIndex=this.preDelayReadIndex,preDelayWriteIndex=this.preDelayWriteIndex,detectorAverage=this.detectorAverage,delayBufferL=this.delayBufferL,delayBufferR=this.delayBufferR,meteringGain=this.meteringGain,meteringReleaseK=this.meteringReleaseK,i=0;nDivisions>i;++i){var envelopeRate,scaledDesiredGain=Math.asin(desiredGain)/(.5*Math.PI),isReleasing=scaledDesiredGain>compressorGain,x=compressorGain/scaledDesiredGain,compressionDiffDb=x?20*Math.log(x)*Math.LOG10E:-1e3;
if((1/0===compressionDiffDb||isNaN(compressionDiffDb))&&(compressionDiffDb=-1),isReleasing){maxAttackCompressionDiffDb=-1,x=compressionDiffDb,x=-12>x?0:x>0?3:.25*(x+12);var x2=x*x,x3=x2*x,x4=x2*x2,_releaseFrames=kA+kB*x+kC*x2+kD*x3+kE*x4,_dbPerFrame=kSpacingDb/_releaseFrames;envelopeRate=Math.pow(10,.05*_dbPerFrame)}else{(-1===maxAttackCompressionDiffDb||compressionDiffDb>maxAttackCompressionDiffDb)&&(maxAttackCompressionDiffDb=compressionDiffDb);var effAttenDiffDb=Math.max(.5,maxAttackCompressionDiffDb);x=.25/effAttenDiffDb,envelopeRate=1-Math.pow(x,i_attackFrames)}for(var loopFrames=nDivisionFrames;loopFrames--;){var compressorInput=0,absUndelayedSource=.5*(cellL[frameIndex]+cellR[frameIndex]);delayBufferL[preDelayWriteIndex]=cellL[frameIndex],delayBufferR[preDelayWriteIndex]=cellR[frameIndex],0>absUndelayedSource&&(absUndelayedSource*=-1),absUndelayedSource>compressorInput&&(compressorInput=absUndelayedSource);var absInput=compressorInput;0>absInput&&(absInput*=-1);var shapedInput=this.saturate(absInput,k),attenuation=1e-4>=absInput?1:shapedInput/absInput,attenuationDb=attenuation?-20*Math.log(attenuation)*Math.LOG10E:1e3;2>attenuationDb&&(attenuationDb=2);var dbPerFrame=attenuationDb/satReleaseFrames,satReleaseRate=Math.pow(10,.05*dbPerFrame)-1,isRelease=attenuation>detectorAverage,rate=isRelease?satReleaseRate:1;detectorAverage+=(attenuation-detectorAverage)*rate,detectorAverage>1&&(detectorAverage=1),1>envelopeRate?compressorGain+=(scaledDesiredGain-compressorGain)*envelopeRate:(compressorGain*=envelopeRate,compressorGain>1&&(compressorGain=1));var postWarpCompressorGain=Math.sin(.5*Math.PI*compressorGain),totalGain=dryMix+wetMix*masterLinearGain*postWarpCompressorGain,dbRealGain=20*Math.log(postWarpCompressorGain)*Math.LOG10E;meteringGain>dbRealGain?meteringGain=dbRealGain:meteringGain+=(dbRealGain-meteringGain)*meteringReleaseK,cellL[frameIndex]=delayBufferL[preDelayReadIndex]*totalGain,cellR[frameIndex]=delayBufferR[preDelayReadIndex]*totalGain,frameIndex++,preDelayReadIndex=preDelayReadIndex+1&MaxPreDelayFramesMask,preDelayWriteIndex=preDelayWriteIndex+1&MaxPreDelayFramesMask}1e-6>detectorAverage&&(detectorAverage=1e-6),1e-6>compressorGain&&(compressorGain=1e-6)}this.preDelayReadIndex=preDelayReadIndex,this.preDelayWriteIndex=preDelayWriteIndex,this.detectorAverage=detectorAverage,this.compressorGain=compressorGain,this.maxAttackCompressionDiffDb=maxAttackCompressionDiffDb,this.meteringGain=meteringGain},$.reset=function(){this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1;for(var i=0,imax=this.delayBufferL.length;imax>i;++i)this.delayBufferL[i]=this.delayBufferR[i]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=DefaultPreDelayFrames,this.maxAttackCompressionDiffDb=-1},T.modules.Compressor=Compressor}(timbre),function(T){"use strict";function Decoder(){}Decoder.prototype.decode=function(src,onloadedmetadata,onloadeddata){if("string"==typeof src){if(/\.wav$/.test(src))return Decoder.wav_decode(src,onloadedmetadata,onloadeddata);if(Decoder.ogg_decode&&/\.ogg$/.test(src))return Decoder.ogg_decode(src,onloadedmetadata,onloadeddata);if(Decoder.mp3_decode&&/\.mp3$/.test(src))return Decoder.mp3_decode(src,onloadedmetadata,onloadeddata)}else if("object"==typeof src){if("wav"===src.type)return Decoder.wav_decode(src.data,onloadedmetadata,onloadeddata);if(Decoder.ogg_decode&&"ogg"===src.type)return Decoder.ogg_decode(src.data,onloadedmetadata,onloadeddata);if(Decoder.mp3_decode&&"mp3"===src.type)return Decoder.mp3_decode(src.data,onloadedmetadata,onloadeddata)}return Decoder.webkit_decode?"object"==typeof src?Decoder.webkit_decode(src.data||src,onloadedmetadata,onloadeddata):Decoder.webkit_decode(src,onloadedmetadata,onloadeddata):Decoder.moz_decode?Decoder.moz_decode(src,onloadedmetadata,onloadeddata):void onloadedmetadata(!1)},T.modules.Decoder=Decoder,Decoder.getBinaryWithPath="browser"===T.envtype?function(path,callback){T.fn.fix_iOS6_1_problem(!0);var xhr=new XMLHttpRequest;xhr.open("GET",path),xhr.responseType="arraybuffer",xhr.onreadystatechange=function(){4===xhr.readyState&&(xhr.response?callback(new Uint8Array(xhr.response)):void 0!==xhr.responseBody&&callback(new Uint8Array(VBArray(xhr.responseBody).toArray())),T.fn.fix_iOS6_1_problem(!1))},xhr.send()}:function(path,callback){callback("no support")};var _24bit_to_32bit=function(uint8){for(var b0,b1,b2,bb,x,int32=new Int32Array(uint8.length/3),i=0,imax=uint8.length,j=0;imax>i;)b0=uint8[i++],b1=uint8[i++],b2=uint8[i++],bb=b0+(b1<<8)+(b2<<16),x=8388608&bb?bb-16777216:bb,int32[j++]=x;return int32};Decoder.wav_decode=function(){var _decode=function(data,onloadedmetadata,onloadeddata){if("RIFF"!==String.fromCharCode(data[0],data[1],data[2],data[3]))return onloadedmetadata(!1);var l1=data[4]+(data[5]<<8)+(data[6]<<16)+(data[7]<<24);if(l1+8!==data.length)return onloadedmetadata(!1);if("WAVE"!==String.fromCharCode(data[8],data[9],data[10],data[11]))return onloadedmetadata(!1);if("fmt "!==String.fromCharCode(data[12],data[13],data[14],data[15]))return onloadedmetadata(!1);for(var channels=data[22]+(data[23]<<8),samplerate=data[24]+(data[25]<<8)+(data[26]<<16)+(data[27]<<24),bitSize=data[34]+(data[35]<<8),i=36;i<data.length&&"data"!==String.fromCharCode(data[i],data[i+1],data[i+2],data[i+3]);)i+=1;if(i>=data.length)return onloadedmetadata(!1);i+=4;var l2=data[i]+(data[i+1]<<8)+(data[i+2]<<16)+(data[i+3]<<24),duration=(l2/channels>>1)/samplerate;if(i+=4,l2>data.length-i)return onloadedmetadata(!1);var mixdown,bufferL,bufferR;mixdown=new Float32Array(duration*samplerate|0),2===channels&&(bufferL=new Float32Array(mixdown.length),bufferR=new Float32Array(mixdown.length)),onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration}),8===bitSize?data=new Int8Array(data.buffer,i):16===bitSize?data=new Int16Array(data.buffer,i):32===bitSize?data=new Int32Array(data.buffer,i):24===bitSize&&(data=_24bit_to_32bit(new Uint8Array(data.buffer,i)));var imax,j,x,k=1/((1<<bitSize-1)-1);if(2===channels)for(i=j=0,imax=mixdown.length;imax>i;++i)x=bufferL[i]=data[j++]*k,x+=bufferR[i]=data[j++]*k,mixdown[i]=.5*x;else for(i=0,imax=mixdown.length;imax>i;++i)mixdown[i]=data[i]*k;onloadeddata()};return function(src,onloadedmetadata,onloadeddata){"string"==typeof src?Decoder.getBinaryWithPath(src,function(data){_decode(data,onloadedmetadata,onloadeddata)}):_decode(src,onloadedmetadata,onloadeddata)}}(),Decoder.webkit_decode=function(){if("undefined"!=typeof webkitAudioContext){var ctx=T.fn._audioContext,_decode=function(data,onloadedmetadata,onloadeddata){var samplerate,channels,bufferL,bufferR,duration;if("string"==typeof data)return onloadeddata(!1);var buffer;try{buffer=ctx.createBuffer(data.buffer,!1)}catch(e){return onloadedmetadata(!1)}samplerate=ctx.sampleRate,channels=buffer.numberOfChannels,2===channels?(bufferL=buffer.getChannelData(0),bufferR=buffer.getChannelData(1)):bufferL=bufferR=buffer.getChannelData(0),duration=bufferL.length/samplerate;for(var mixdown=new Float32Array(bufferL),i=0,imax=mixdown.length;imax>i;++i)mixdown[i]=.5*(mixdown[i]+bufferR[i]);onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration}),onloadeddata()};return function(src,onloadedmetadata,onloadeddata){if(src instanceof File){var reader=new FileReader;reader.onload=function(e){_decode(new Uint8Array(e.target.result),onloadedmetadata,onloadeddata)},reader.readAsArrayBuffer(src)}else"string"==typeof src?Decoder.getBinaryWithPath(src,function(data){_decode(data,onloadedmetadata,onloadeddata)}):_decode(src,onloadedmetadata,onloadeddata)}}}(),Decoder.moz_decode=function(){return"function"==typeof Audio&&"function"==typeof(new Audio).mozSetup?function(src,onloadedmetadata,onloadeddata){var samplerate,channels,mixdown,bufferL,bufferR,duration,writeIndex=0,audio=new Audio(src);audio.volume=0,audio.addEventListener("loadedmetadata",function(){samplerate=audio.mozSampleRate,channels=audio.mozChannels,duration=audio.duration,mixdown=new Float32Array(audio.duration*samplerate|0),2===channels&&(bufferL=new Float32Array(audio.duration*samplerate|0),bufferR=new Float32Array(audio.duration*samplerate|0)),2===channels?audio.addEventListener("MozAudioAvailable",function(e){for(var x,samples=e.frameBuffer,i=0,imax=samples.length;imax>i;i+=2)x=bufferL[writeIndex]=samples[i],x+=bufferR[writeIndex]=samples[i+1],mixdown[writeIndex]=.5*x,writeIndex+=1},!1):audio.addEventListener("MozAudioAvailable",function(e){for(var samples=e.frameBuffer,i=0,imax=samples.length;imax>i;++i)mixdown[i]=samples[i],writeIndex+=1},!1),audio.play(),setTimeout(function(){onloadedmetadata({samplerate:samplerate,channels:channels,buffer:[mixdown,bufferL,bufferR],duration:duration})},1e3)},!1),audio.addEventListener("ended",function(){onloadeddata()},!1),audio.load()}:void 0}()}(timbre),function(T){"use strict";function Envelope(samplerate){this.samplerate=samplerate||44100,this.value=ZERO,this.status=StatusWait,this.curve="linear",this.step=1,this.releaseNode=null,this.loopNode=null,this.emit=null,this._envValue=new EnvelopeValue(samplerate),this._table=[],this._initValue=ZERO,this._curveValue=0,this._defaultCurveType=CurveTypeLin,this._index=0,this._counter=0}function EnvelopeValue(samplerate){this.samplerate=samplerate,this.value=ZERO,this.step=1,this._curveType=CurveTypeLin,this._curveValue=0,this._grow=0,this._a2=0,this._b1=0,this._y1=0,this._y2=0}var ZERO=Envelope.ZERO=1e-6,CurveTypeSet=Envelope.CurveTypeSet=0,CurveTypeLin=Envelope.CurveTypeLin=1,CurveTypeExp=Envelope.CurveTypeExp=2,CurveTypeSin=Envelope.CurveTypeSin=3,CurveTypeWel=Envelope.CurveTypeWel=4,CurveTypeCurve=Envelope.CurveTypeCurve=5,CurveTypeSqr=Envelope.CurveTypeSqr=6,CurveTypeCub=Envelope.CurveTypeCub=7,StatusWait=Envelope.StatusWait=0,StatusGate=Envelope.StatusGate=1,StatusSustain=Envelope.StatusSustain=2,StatusRelease=Envelope.StatusRelease=3,StatusEnd=Envelope.StatusEnd=4,CurveTypeDict={set:CurveTypeSet,lin:CurveTypeLin,linear:CurveTypeLin,exp:CurveTypeExp,exponential:CurveTypeExp,sin:CurveTypeSin,sine:CurveTypeSin,wel:CurveTypeWel,welch:CurveTypeWel,sqr:CurveTypeSqr,squared:CurveTypeSqr,cub:CurveTypeCub,cubed:CurveTypeCub};Envelope.CurveTypeDict=CurveTypeDict;var $=Envelope.prototype;$.clone=function(){var new_instance=new Envelope(this.samplerate);return new_instance._table=this._table,new_instance._initValue=this._initValue,new_instance.setCurve(this.curve),null!==this.releaseNode&&new_instance.setReleaseNode(this.releaseNode+1),null!==this.loopNode&&new_instance.setLoopNode(this.loopNode+1),new_instance.setStep(this.step),new_instance.reset(),new_instance},$.setTable=function(value){this._initValue=value[0],this._table=value.slice(1),this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=StatusWait},$.setCurve=function(value){"number"==typeof value?(this._defaultCurveType=CurveTypeCurve,this._curveValue=value,this.curve=value):(this._defaultCurveType=CurveTypeDict[value]||null,this.curve=value)},$.setReleaseNode=function(value){"number"==typeof value&&value>0&&(this.releaseNode=value-1)},$.setLoopNode=function(value){"number"==typeof value&&value>0&&(this.loopNode=value-1)},$.setStep=function(step){this.step=this._envValue.step=step},$.reset=function(){this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=StatusWait},$.release=function(){null!==this.releaseNode&&(this._counter=0,this.status=StatusRelease)},$.getInfo=function(sustainTime){var i,imax,table=this._table,totalDuration=0,loopBeginTime=1/0,releaseBeginTime=1/0,isEndlessLoop=!1;for(i=0,imax=table.length;imax>i;++i){this.loopNode===i&&(loopBeginTime=totalDuration),this.releaseNode===i&&(sustainTime>totalDuration?totalDuration+=sustainTime:totalDuration=sustainTime,releaseBeginTime=totalDuration);var items=table[i];Array.isArray(items)&&(totalDuration+=items[1])}return 1/0!==loopBeginTime&&1/0===releaseBeginTime&&(totalDuration+=sustainTime,isEndlessLoop=!0),{totalDuration:totalDuration,loopBeginTime:loopBeginTime,releaseBeginTime:releaseBeginTime,isEndlessLoop:isEndlessLoop}},$.calcStatus=function(){var items,endValue,time,curveType,status=this.status,table=this._table,index=this._index,counter=this._counter,curveValue=this._curveValue,defaultCurveType=this._defaultCurveType,loopNode=this.loopNode,releaseNode=this.releaseNode,envValue=this._envValue,emit=null;switch(status){case StatusWait:case StatusEnd:break;case StatusGate:case StatusRelease:for(;0>=counter;)if(index>=table.length){if(status===StatusGate&&null!==loopNode){index=loopNode;continue}status=StatusEnd,counter=1/0,curveType=CurveTypeSet,emit="ended"}else if(status!==StatusGate||index!==releaseNode)items=table[index++],endValue=items[0],curveType=null===items[2]?defaultCurveType:items[2],curveType===CurveTypeCurve&&(curveValue=items[3],Math.abs(curveValue)<.001&&(curveType=CurveTypeLin)),time=items[1],counter=envValue.setNext(endValue,time,curveType,curveValue);else{if(null!==loopNode&&releaseNode>loopNode){index=loopNode;continue}status=StatusSustain,counter=1/0,curveType=CurveTypeSet,emit="sustained"}}return this.status=status,this.emit=emit,this._index=index,this._counter=counter,status},$.next=function(){return 1&this.calcStatus()&&(this.value=this._envValue.next()||ZERO),this._counter-=1,this.value},$.process=function(cell){var i,envValue=this._envValue,imax=cell.length;if(1&this.calcStatus())for(i=0;imax>i;++i)cell[i]=envValue.next()||ZERO;else{var value=this.value||ZERO;for(i=0;imax>i;++i)cell[i]=value}this.value=cell[imax-1],this._counter-=cell.length},EnvelopeValue.prototype.setNext=function(endValue,time,curveType,curveValue){var grow,w,a1,a2,b1,y1,y2,n=this.step,value=this.value,counter=.001*time*this.samplerate/n|0;switch(1>counter&&(counter=1,curveType=CurveTypeSet),curveType){case CurveTypeSet:this.value=endValue;break;case CurveTypeLin:grow=(endValue-value)/counter;break;case CurveTypeExp:grow=0!==value?Math.pow(endValue/value,1/counter):0;break;case CurveTypeSin:w=Math.PI/counter,a2=.5*(endValue+value),b1=2*Math.cos(w),y1=.5*(endValue-value),y2=y1*Math.sin(.5*Math.PI-w),value=a2-y1;break;case CurveTypeWel:w=.5*Math.PI/counter,b1=2*Math.cos(w),endValue>=value?(a2=value,y1=0,y2=-Math.sin(w)*(endValue-value)):(a2=endValue,y1=value-endValue,y2=Math.cos(w)*(value-endValue)),value=a2+y1;break;case CurveTypeCurve:a1=(endValue-value)/(1-Math.exp(curveValue)),a2=value+a1,b1=a1,grow=Math.exp(curveValue/counter);break;case CurveTypeSqr:y1=Math.sqrt(value),y2=Math.sqrt(endValue),grow=(y2-y1)/counter;break;case CurveTypeCub:y1=Math.pow(value,.33333333),y2=Math.pow(endValue,.33333333),grow=(y2-y1)/counter}return this.next=NextFunctions[curveType],this._grow=grow,this._a2=a2,this._b1=b1,this._y1=y1,this._y2=y2,counter};var NextFunctions=[];NextFunctions[CurveTypeSet]=function(){return this.value},NextFunctions[CurveTypeLin]=function(){return this.value+=this._grow,this.value},NextFunctions[CurveTypeExp]=function(){return this.value*=this._grow,this.value},NextFunctions[CurveTypeSin]=function(){var y0=this._b1*this._y1-this._y2;return this.value=this._a2-y0,this._y2=this._y1,this._y1=y0,this.value},NextFunctions[CurveTypeWel]=function(){var y0=this._b1*this._y1-this._y2;return this.value=this._a2+y0,this._y2=this._y1,this._y1=y0,this.value},NextFunctions[CurveTypeCurve]=function(){return this._b1*=this._grow,this.value=this._a2-this._b1,this.value},NextFunctions[CurveTypeSqr]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1,this.value},NextFunctions[CurveTypeCub]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1*this._y1,this.value},EnvelopeValue.prototype.next=NextFunctions[CurveTypeSet],T.modules.Envelope=Envelope,T.modules.EnvelopeValue=EnvelopeValue}(timbre),function(T){"use strict";function FFT(n){n="number"==typeof n?n:512,n=1<<Math.ceil(Math.log(n)*Math.LOG2E),this.length=n,this.buffer=new T.fn.SignalArray(n),this.real=new T.fn.SignalArray(n),this.imag=new T.fn.SignalArray(n),this._real=new T.fn.SignalArray(n),this._imag=new T.fn.SignalArray(n),this.mag=new T.fn.SignalArray(n>>1),this.minDecibels=-30,this.maxDecibels=-100;var params=FFTParams.get(n);this._bitrev=params.bitrev,this._sintable=params.sintable,this._costable=params.costable}var $=FFT.prototype;$.setWindow=function(key){if("string"==typeof key){var m=/([A-Za-z]+)(?:\(([01]\.?\d*)\))?/.exec(key);if(null!==m){var name=m[1].toLowerCase(),a=void 0!==m[2]?+m[2]:.25,f=WindowFunctions[name];if(f){this._window||(this._window=new T.fn.SignalArray(this.length));var w=this._window,n=0,N=this.length;for(a=0>a?0:a>1?1:a;N>n;++n)w[n]=f(n,N,a);this.windowName=key}}}},$.forward=function(_buffer){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this.real,imag=this.imag,window=this._window,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;if(window)for(i=0;n>i;++i)buffer[i]=_buffer[i]*window[i];else buffer.set(_buffer);for(i=0;n>i;++i)real[i]=buffer[bitrev[i]],imag[i]=0;for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}var rval,ival,mag=this.mag;for(i=0;n>i;++i)rval=real[i],ival=imag[i],mag[i]=Math.sqrt(rval*rval+ival*ival);return{real:real,imag:imag}},$.inverse=function(_real,_imag){var i,j,k,k2,h,d,c,s,ik,dx,dy,buffer=this.buffer,real=this._real,imag=this._imag,bitrev=this._bitrev,sintable=this._sintable,costable=this._costable,n=buffer.length;for(i=0;n>i;++i)j=bitrev[i],real[i]=+_real[j],imag[i]=-_imag[j];for(k=1;n>k;k=k2)for(h=0,k2=k+k,d=n/k2,j=0;k>j;j++){for(c=costable[h],s=sintable[h],i=j;n>i;i+=k2)ik=i+k,dx=s*imag[ik]+c*real[ik],dy=c*imag[ik]-s*real[ik],real[ik]=real[i]-dx,real[i]+=dx,imag[ik]=imag[i]-dy,imag[i]+=dy;h+=d}for(i=0;n>i;++i)buffer[i]=real[i]/n;return buffer},$.getFrequencyData=function(array){var i,minDecibels=this.minDecibels,imax=Math.min(this.mag.length,array.length);if(imax){var x,mag=this.mag,peak=0;for(i=0;imax>i;++i)x=mag[i],array[i]=x?20*Math.log(x)*Math.LOG10E:minDecibels,peak<array[i]&&(peak=array[i])}return array};var FFTParams={get:function(n){return FFTParams[n]||function(){var i,imax,bitrev=function(){var x,i,j,k,n2;for(x=new Int16Array(n),n2=n>>1,i=j=0;x[i]=j,!(++i>=n);){for(k=n2;j>=k;)j-=k,k>>=1;j+=k}return x}(),k=Math.floor(Math.log(n)/Math.LN2),sintable=new T.fn.SignalArray((1<<k)-1),costable=new T.fn.SignalArray((1<<k)-1),PI2=2*Math.PI;for(i=0,imax=sintable.length;imax>i;++i)sintable[i]=Math.sin(PI2*(i/n)),costable[i]=Math.cos(PI2*(i/n));return FFTParams[n]={bitrev:bitrev,sintable:sintable,costable:costable},FFTParams[n]}()}},WindowFunctions=function(){var PI=Math.PI,PI2=2*Math.PI,abs=Math.abs,pow=Math.pow,cos=Math.cos,sin=Math.sin,sinc=function(x){return sin(PI*x)/(PI*x)},E=Math.E;return{rectangular:function(){return 1},hann:function(n,N){return.5*(1-cos(PI2*n/(N-1)))},hamming:function(n,N){return.54-.46*cos(PI2*n/(N-1))},tukery:function(n,N,a){return a*(N-1)/2>n?.5*(1+cos(PI*(2*n/(a*(N-1))-1))):n>(N-1)*(1-a/2)?.5*(1+cos(PI*(2*n/(a*(N-1))-2/a+1))):1},cosine:function(n,N){return sin(PI*n/(N-1))},lanczos:function(n,N){return sinc(2*n/(N-1)-1)},triangular:function(n,N){return 2/(N+1)*((N+1)/2-abs(n-(N-1)/2))},bartlett:function(n,N){return 2/(N-1)*((N-1)/2-abs(n-(N-1)/2))},gaussian:function(n,N,a){return pow(E,-.5*pow((n-(N-1)/2)/(a*(N-1)/2),2))},bartlettHann:function(n,N){return.62-.48*abs(n/(N-1)-.5)-.38*cos(PI2*n/(N-1))},blackman:function(n,N,a){var a0=(1-a)/2,a1=.5,a2=a/2;return a0-a1*cos(PI2*n/(N-1))+a2*cos(4*PI*n/(N-1))}}}();T.modules.FFT=FFT}(timbre),function(T){"use strict";function Oscillator(samplerate){this.samplerate=samplerate||44100,this.wave=null,this.step=1,this.frequency=0,this.value=0,this.phase=0,this.feedback=!1,this._x=0,this._lastouts=0,this._coeff=TABLE_SIZE/this.samplerate,this._radtoinc=TABLE_SIZE/(2*Math.PI)}function waveshape(sign,name,shape,width){var _wave,i,imax,j,jmax,wave=Wavetables[name];if(void 0!==wave){switch("function"==typeof wave&&(wave=wave()),shape){case"@1":for(i=512;1024>i;++i)wave[i]=0;break;case"@2":for(i=512;1024>i;++i)wave[i]=Math.abs(wave[i]);break;case"@3":for(i=256;512>i;++i)wave[i]=0;for(i=512;768>i;++i)wave[i]=Math.abs(wave[i]);for(i=768;1024>i;++i)wave[i]=0;break;case"@4":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=wave[i<<1];wave=_wave;break;case"@5":for(_wave=new Float32Array(1024),i=0;512>i;++i)_wave[i]=Math.abs(wave[i<<1]);wave=_wave}if(void 0!==width&&50!==width){for(width*=.01,width=0>width?0:width>1?1:width,_wave=new Float32Array(1024),imax=1024*width|0,i=0;imax>i;++i)_wave[i]=wave[i/imax*512|0];for(jmax=1024-imax,j=0;1024>i;++i,++j)_wave[i]=wave[j/jmax*512+512|0];wave=_wave}if("+"===sign)for(i=0;1024>i;++i)wave[i]=.5*wave[i]+.5;else if("-"===sign)for(i=0;1024>i;++i)wave[i]*=-1;return wave}}function wavb(src){var wave=new Float32Array(1024),n=src.length>>1;if(-1!==[2,4,8,16,32,64,128,256,512,1024].indexOf(n))for(var i=0,k=0;n>i;++i){var x=parseInt(src.substr(2*i,2),16);x=128&x?(x-256)/128:x/127;for(var j=0,jmax=1024/n;jmax>j;++j)wave[k++]=x}return wave}function wavc(src){var wave=new Float32Array(1024);if(8===src.length){var i,j,color=parseInt(src,16),bar=new Float32Array(8);for(bar[0]=1,i=0;7>i;++i)bar[i+1]=.0625*(15&color),color>>=4;for(i=0;8>i;++i){var x=0,dx=(i+1)/1024;for(j=0;1024>j;++j)wave[j]+=Math.sin(2*Math.PI*x)*bar[i],x+=dx}var absx,maxx=0;for(i=0;1024>i;++i)maxx<(absx=Math.abs(wave[i]))&&(maxx=absx);if(maxx>0)for(i=0;1024>i;++i)wave[i]/=maxx}return wave}var TABLE_SIZE=1024,TABLE_MASK=TABLE_SIZE-1,$=Oscillator.prototype;$.setWave=function(value){var i,dx,wave=this.wave;if(this.wave||(this.wave=new Float32Array(TABLE_SIZE+1)),"function"==typeof value)for(i=0;TABLE_SIZE>i;++i)wave[i]=value(i/TABLE_SIZE);else if(T.fn.isSignalArray(value))if(value.length===wave.length)wave.set(value);else for(dx=value.length/TABLE_SIZE,i=0;TABLE_SIZE>i;++i)wave[i]=value[i*dx|0];else"string"==typeof value&&void 0!==(dx=getWavetable(value))&&this.wave.set(dx);this.wave[TABLE_SIZE]=this.wave[0]},$.clone=function(){var new_instance=new Oscillator(this.samplerate);return new_instance.wave=this.wave,new_instance.step=this.step,new_instance.frequency=this.frequency,new_instance.value=this.value,new_instance.phase=this.phase,new_instance.feedback=this.feedback,new_instance},$.reset=function(){this._x=0},$.next=function(){var x=this._x,index=x+this.phase*this._radtoinc|0;return this.value=this.wave[index&TABLE_MASK],x+=this.frequency*this._coeff*this.step,x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value},$.process=function(cell){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this.frequency*this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=dx;this._lastouts=lastouts}else{var phaseoffset=this.phase*radtoinc;for(i=0;imax>i;++i)phase=x+phaseoffset,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=dx}x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithFreqArray=function(cell,freqs){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=freqs[i]*dx;this._lastouts=lastouts}else{var phaseoffset=this.phase*this._radtoinc;for(i=0;imax>i;++i)phase=x+phaseoffset,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=freqs[i]*dx}x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithPhaseArray=function(cell,phases){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this.frequency*this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=dx;this._lastouts=lastouts}else for(i=0;imax>i;++i)phase=x+phases[i]*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=dx;x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]},$.processWithFreqAndPhaseArray=function(cell,freqs,phases){var phase,index,frac,x0,x1,i,wave=this.wave,radtoinc=this._radtoinc,x=this._x,dx=this._coeff,imax=this.step;if(this.feedback){var lastouts=this._lastouts;for(radtoinc*=this.phase,i=0;imax>i;++i)phase=x+lastouts*radtoinc,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=lastouts=x0+frac*(x1-x0),x+=freqs[i]*dx;this._lastouts=lastouts}else for(i=0;imax>i;++i)phase=x+phases[i]*TABLE_SIZE,index=0|phase,frac=phase-index,index&=TABLE_MASK,x0=wave[index],x1=wave[index+1],cell[i]=x0+frac*(x1-x0),x+=freqs[i]*dx;x>TABLE_SIZE&&(x-=TABLE_SIZE),this._x=x,this.value=cell[cell.length-1]};var getWavetable=function(key){var wave=Wavetables[key];if(void 0!==wave)return"function"==typeof wave&&(wave=wave()),wave;var m;if(m=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(key),null!==m){var sign=m[1],name=m[2],shape=m[3],width=m[4];if(wave=waveshape(sign,name,shape,width),void 0!==wave)return Wavetables[key]=wave,wave}return m=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(key),null!==m?wavb(m[1]):(m=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(key),null!==m?wavc(m[1]):void 0)};Oscillator.getWavetable=getWavetable;var setWavetable=function(name,value){var dx,i,wave=new Float32Array(1024);if("function"==typeof value)for(i=0;1024>i;++i)wave[i]=value(i/1024);else if(T.fn.isSignalArray(value))if(value.length===wave.length)wave.set(value);else for(dx=value.length/1024,i=0;1024>i;++i)wave[i]=value[i*dx|0];Wavetables[name]=wave};Oscillator.setWavetable=setWavetable;var Wavetables={sin:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=Math.sin(2*Math.PI*(i/1024));return wave},cos:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=Math.cos(2*Math.PI*(i/1024));return wave},pulse:function(){for(var wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=512>i?1:-1;return wave},tri:function(){for(var x,wave=new Float32Array(1024),i=0;1024>i;++i)x=i/1024-.25,wave[i]=1-4*Math.abs(Math.round(x)-x);return wave},saw:function(){for(var x,wave=new Float32Array(1024),i=0;1024>i;++i)x=i/1024,wave[i]=2*(x-Math.round(x));return wave},fami:function(){for(var d=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-.125,-.25,-.375,-.5,-.625,-.75,-.875,-1,-1,-.875,-.75,-.625,-.5,-.375,-.25,-.125],wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=d[i/1024*d.length|0];return wave},konami:function(){for(var d=[-.625,-.875,-.125,.75,.5,.125,.5,.75,.25,-.125,.5,.875,.625,0,.25,.375,-.125,-.75,0,.625,.125,-.5,-.375,-.125,-.75,-1,-.625,0,-.375,-.875,-.625,-.25],wave=new Float32Array(1024),i=0;1024>i;++i)wave[i]=d[i/1024*d.length|0];return wave}};T.modules.Oscillator=Oscillator}(timbre),function(T){"use strict";function Reverb(samplerate,buffersize){this.samplerate=samplerate;var i,imax,k=samplerate/44100;for(imax=2*CombParams.length,this.comb=new Array(imax),this.combout=new Array(imax),i=0;imax>i;++i)this.comb[i]=new CombFilter(CombParams[i%CombParams.length]*k),this.combout[i]=new T.fn.SignalArray(buffersize);for(imax=2*AllpassParams.length,this.allpass=new Array(imax),i=0;imax>i;++i)this.allpass[i]=new AllpassFilter(AllpassParams[i%AllpassParams.length]*k);this.outputs=[new T.fn.SignalArray(buffersize),new T.fn.SignalArray(buffersize)],this.damp=0,this.wet=.33,this.setRoomSize(.5),this.setDamp(.5)}function CombFilter(buffersize){this.buffer=new T.fn.SignalArray(0|buffersize),this.buffersize=this.buffer.length,this.bufidx=0,this.feedback=0,this.filterstore=0,this.damp=0}function AllpassFilter(buffersize){this.buffer=new T.fn.SignalArray(0|buffersize),this.buffersize=this.buffer.length,this.bufidx=0}var CombParams=[1116,1188,1277,1356,1422,1491,1557,1617],AllpassParams=[225,556,441,341],$=Reverb.prototype;$.setRoomSize=function(roomsize){var comb=this.comb,value=.28*roomsize+.7;this.roomsize=roomsize,comb[0].feedback=comb[1].feedback=comb[2].feedback=comb[3].feedback=comb[4].feedback=comb[5].feedback=comb[6].feedback=comb[7].feedback=comb[8].feedback=comb[9].feedback=comb[10].feedback=comb[11].feedback=comb[12].feedback=comb[13].feedback=comb[14].feedback=comb[15].feedback=value},$.setDamp=function(damp){var comb=this.comb,value=.4*damp;this.damp=damp,comb[0].damp=comb[1].damp=comb[2].damp=comb[3].damp=comb[4].damp=comb[5].damp=comb[6].damp=comb[7].damp=comb[8].damp=comb[9].damp=comb[10].damp=comb[11].damp=comb[12].damp=comb[13].damp=comb[14].damp=comb[15].damp=value},$.process=function(cellL,cellR){var i,comb=this.comb,combout=this.combout,allpass=this.allpass,output0=this.outputs[0],output1=this.outputs[1],wet=this.wet,dry=1-wet,imax=cellL.length;for(comb[0].process(cellL,combout[0]),comb[1].process(cellL,combout[1]),comb[2].process(cellL,combout[2]),comb[3].process(cellL,combout[3]),comb[4].process(cellL,combout[4]),comb[5].process(cellL,combout[5]),comb[6].process(cellL,combout[6]),comb[7].process(cellL,combout[7]),comb[8].process(cellR,combout[8]),comb[9].process(cellR,combout[9]),comb[10].process(cellR,combout[10]),comb[11].process(cellR,combout[11]),comb[12].process(cellR,combout[12]),comb[13].process(cellR,combout[13]),comb[14].process(cellR,combout[14]),comb[15].process(cellR,combout[15]),i=0;imax>i;++i)output0[i]=combout[0][i]+combout[1][i]+combout[2][i]+combout[3][i]+combout[4][i]+combout[5][i]+combout[6][i]+combout[7][i],output1[i]=combout[8][i]+combout[9][i]+combout[10][i]+combout[11][i]+combout[12][i]+combout[13][i]+combout[14][i]+combout[15][i];for(allpass[0].process(output0,output0),allpass[1].process(output0,output0),allpass[2].process(output0,output0),allpass[3].process(output0,output0),allpass[4].process(output1,output1),allpass[5].process(output1,output1),allpass[6].process(output1,output1),allpass[7].process(output1,output1),i=0;imax>i;++i)cellL[i]=output0[i]*wet+cellL[i]*dry,cellR[i]=output1[i]*wet+cellR[i]*dry},CombFilter.prototype.process=function(input,output){var ins,outs,i,buffer=this.buffer,buffersize=this.buffersize,bufidx=this.bufidx,filterstore=this.filterstore,feedback=this.feedback,damp1=this.damp,damp2=1-damp1,imax=input.length;for(i=0;imax>i;++i)ins=.015*input[i],outs=buffer[bufidx],filterstore=outs*damp2+filterstore*damp1,buffer[bufidx]=ins+filterstore*feedback,++bufidx>=buffersize&&(bufidx=0),output[i]=outs;this.bufidx=bufidx,this.filterstore=filterstore},AllpassFilter.prototype.process=function(input,output){var ins,outs,bufout,i,buffer=this.buffer,buffersize=this.buffersize,bufidx=this.bufidx,imax=input.length;for(i=0;imax>i;++i)ins=input[i],bufout=buffer[bufidx],outs=-ins+bufout,buffer[bufidx]=ins+.5*bufout,++bufidx>=buffersize&&(bufidx=0),output[i]=outs;this.bufidx=bufidx},T.modules.Reverb=Reverb}(timbre),function(T){"use strict";function Scissor(soundbuffer){return new Tape(soundbuffer)}function Tape(soundbuffer){if(this.fragments=[],soundbuffer){var samplerate=soundbuffer.samplerate||44100,duration=soundbuffer.buffer[0].length/samplerate;this.fragments.push(new Fragment(soundbuffer,0,duration))}}function Fragment(soundbuffer,start,duration,reverse,pitch,stretch,pan){soundbuffer||(soundbuffer=silencebuffer),this.buffer=soundbuffer.buffer[0],this.samplerate=soundbuffer.samplerate||44100,this.start=start,this._duration=duration,this.reverse=reverse||!1,this.pitch=pitch||100,this.stretch=stretch||!1,this.pan=pan||50}function TapeStream(tape,samplerate){this.tape=tape,this.fragments=tape.fragments,this.samplerate=samplerate||44100,this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5
}var DummyBuffer=new Float32Array(60),silencebuffer={buffer:DummyBuffer,samplerate:1};Scissor.silence=function(duration){return new Scissor(silencebuffer).slice(0,1).fill(duration)},Scissor.join=function(tapes){for(var new_instance=new Tape,i=0;i<tapes.length;i++)tapes[i]instanceof Tape&&new_instance.add_fragments(tapes[i].fragments);return new_instance},Scissor.Tape=Tape,Tape.prototype.add_fragment=function(fragment){return this.fragments.push(fragment),this},Tape.prototype.add_fragments=function(fragments){for(var i=0;i<fragments.length;i++)this.fragments.push(fragments[i]);return this},Tape.prototype.duration=function(){for(var result=0,i=0;i<this.fragments.length;i++)result+=this.fragments[i].duration();return result},Tape.prototype.slice=function(start,length){var duration=this.duration();start+length>duration&&(length=duration-start);for(var new_instance=new Tape,remainingstart=start,remaininglength=length,i=0;i<this.fragments.length;i++){var fragment=this.fragments[i],items=fragment.create(remainingstart,remaininglength),new_fragment=items[0];if(remainingstart=items[1],remaininglength=items[2],new_fragment&&new_instance.add_fragment(new_fragment),0===remaininglength)break}return new_instance},Tape.prototype.cut=Tape.prototype.slice,Tape.prototype.concat=function(other){var new_instance=new Tape;return new_instance.add_fragments(this.fragments),new_instance.add_fragments(other.fragments),new_instance},Tape.prototype.loop=function(count){var i,orig_fragments=[];for(i=0;i<this.fragments.length;i++)orig_fragments.push(this.fragments[i].clone());var new_instance=new Tape;for(i=0;count>i;i++)new_instance.add_fragments(orig_fragments);return new_instance},Tape.prototype.times=Tape.prototype.loop,Tape.prototype.split=function(count){for(var splitted_duration=this.duration()/count,results=[],i=0;count>i;i++)results.push(this.slice(i*splitted_duration,splitted_duration));return results},Tape.prototype.fill=function(filled_duration){var duration=this.duration();if(0===duration)throw"EmptyFragment";var loop_count=filled_duration/duration|0,remain=filled_duration%duration;return this.loop(loop_count).plus(this.slice(0,remain))},Tape.prototype.replace=function(start,length,replaced){var new_instance=new Tape,offset=start+length;new_instance=new_instance.plus(this.slice(0,start));var new_instance_duration=new_instance.duration();start>new_instance_duration&&(new_instance=new_instance.plus(Scissor.silence(start-new_instance_duration))),new_instance=new_instance.plus(replaced);var duration=this.duration();return duration>offset&&(new_instance=new_instance.plus(this.slice(offset,duration-offset))),new_instance},Tape.prototype.reverse=function(){for(var new_instance=new Tape,i=this.fragments.length;i--;){var fragment=this.fragments[i].clone();fragment.reverse=!fragment.isReversed(),new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.pitch=function(pitch,stretch){var new_instance=new Tape;stretch=stretch||!1;for(var i=0;i<this.fragments.length;i++){var fragment=this.fragments[i].clone();fragment.pitch*=.01*pitch,fragment.stretch=stretch,new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.stretch=function(factor){var factor_for_pitch=1/(.01*factor)*100;return this.pitch(factor_for_pitch,!0)},Tape.prototype.pan=function(right_percent){var new_instance=new Tape;right_percent>100?right_percent=100:0>right_percent&&(right_percent=0);for(var i=0;i<this.fragments.length;i++){var fragment=this.fragments[i].clone();fragment.pan=right_percent,new_instance.add_fragment(fragment)}return new_instance},Tape.prototype.silence=function(){return Scissor.silence(this.duration())},Tape.prototype.join=function(tapes){for(var new_instance=new Tape,i=0;i<tapes.length;i++)tapes[i]instanceof Tape&&new_instance.add_fragments(tapes[i].fragments);return new_instance},Tape.prototype.getBuffer=function(){var samplerate=44100;this.fragments.length>0&&(samplerate=this.fragments[0].samplerate);var stream=new TapeStream(this,samplerate),total_samples=this.duration()*samplerate|0;return{samplerate:samplerate,buffer:stream.fetch(total_samples)}},Fragment.prototype.duration=function(){return this._duration*(100/this.pitch)},Fragment.prototype.original_duration=function(){return this._duration},Fragment.prototype.isReversed=function(){return this.reverse},Fragment.prototype.isStretched=function(){return this.stretched},Fragment.prototype.create=function(remaining_start,remaining_length){var duration=this.duration();if(remaining_start>=duration)return[null,remaining_start-duration,remaining_length];var new_length,have_remain_to_retuen=remaining_start+remaining_length>=duration;have_remain_to_retuen?(new_length=duration-remaining_start,remaining_length-=new_length):(new_length=remaining_length,remaining_length=0);var new_fragment=this.clone();return new_fragment.start=this.start+remaining_start*this.pitch*.01,new_fragment._duration=new_length*this.pitch*.01,new_fragment.reverse=!1,[new_fragment,0,remaining_length]},Fragment.prototype.clone=function(){var new_instance=new Fragment;return new_instance.buffer=this.buffer,new_instance.samplerate=this.samplerate,new_instance.start=this.start,new_instance._duration=this._duration,new_instance.reverse=this.reverse,new_instance.pitch=this.pitch,new_instance.stretch=this.stretch,new_instance.pan=this.pan,new_instance},Scissor.Fragment=Fragment,Scissor.TapeStream=TapeStream,TapeStream.prototype.reset=function(){return this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5,this.isLooped=!1,this},TapeStream.prototype.fetch=function(n){var cellL=new T.fn.SignalArray(n),cellR=new T.fn.SignalArray(n),fragments=this.fragments;if(0===fragments.length)return[cellL,cellR];for(var pan,samplerate=100*this.samplerate,buffer=this.buffer,bufferIndex=this.bufferIndex,bufferIndexIncr=this.bufferIndexIncr,bufferBeginIndex=this.bufferBeginIndex,bufferEndIndex=this.bufferEndIndex,fragment=this.fragment,fragmentIndex=this.fragmentIndex,panL=this.panL,panR=this.panR,i=0;n>i;i++){for(;!buffer||bufferBeginIndex>bufferIndex||bufferIndex>=bufferEndIndex;)if(!fragment||fragmentIndex<fragments.length)fragment=fragments[fragmentIndex++],buffer=fragment.buffer,bufferIndexIncr=fragment.samplerate/samplerate*fragment.pitch,bufferBeginIndex=fragment.start*fragment.samplerate,bufferEndIndex=bufferBeginIndex+fragment.original_duration()*fragment.samplerate,pan=.01*fragment.pan,panL=1-pan,panR=pan,fragment.reverse?(bufferIndexIncr*=-1,bufferIndex=bufferEndIndex+bufferIndexIncr):bufferIndex=bufferBeginIndex;else{if(!this.isLooped){this.isEnded=!0,buffer=DummyBuffer,bufferIndexIncr=0,bufferIndex=0;break}buffer=null,bufferIndex=0,bufferIndexIncr=0,bufferBeginIndex=0,bufferEndIndex=0,fragment=null,fragmentIndex=0}cellL[i]=buffer[0|bufferIndex]*panL,cellR[i]=buffer[0|bufferIndex]*panR,bufferIndex+=bufferIndexIncr}return this.buffer=buffer,this.bufferIndex=bufferIndex,this.bufferIndexIncr=bufferIndexIncr,this.bufferBeginIndex=bufferBeginIndex,this.bufferEndIndex=bufferEndIndex,this.fragment=fragment,this.fragmentIndex=fragmentIndex,this.panL=panL,this.panR=panR,[cellL,cellR]},T.modules.Scissor=Scissor}(timbre),function(T){"use strict";function StereoDelay(samplerate){this.samplerate=samplerate;var bits=Math.ceil(Math.log(1.5*samplerate)*Math.LOG2E);this.buffersize=1<<bits,this.buffermask=this.buffersize-1,this.writeBufferL=new T.fn.SignalArray(this.buffersize),this.writeBufferR=new T.fn.SignalArray(this.buffersize),this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR,this.delaytime=null,this.feedback=null,this.cross=null,this.mix=null,this.prevL=0,this.prevR=0,this.readIndex=0,this.writeIndex=0,this.setParams(125,.25,!1,.45)}var $=StereoDelay.prototype;$.setParams=function(delaytime,feedback,cross,mix){if(this.delaytime!==delaytime){this.delaytime=delaytime;var offset=.001*delaytime*this.samplerate|0;offset>this.buffermask&&(offset=this.buffermask),this.writeIndex=this.readIndex+offset&this.buffermask}this.feedback!==feedback&&(this.feedback=feedback),this.cross!==cross&&(this.cross=cross,cross?(this.readBufferL=this.writeBufferR,this.readBufferR=this.writeBufferL):(this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR)),this.mix!==mix&&(this.mix=mix)},$.process=function(cellL,cellR){var x,i,readBufferL=this.readBufferL,readBufferR=this.readBufferR,writeBufferL=this.writeBufferL,writeBufferR=this.writeBufferR,readIndex=this.readIndex,writeIndex=this.writeIndex,mask=this.buffermask,fb=this.feedback,wet=this.mix,dry=1-wet,prevL=this.prevL,prevR=this.prevR,imax=cellL.length;for(i=0;imax>i;++i)x=readBufferL[readIndex],writeBufferL[writeIndex]=cellL[i]-x*fb,cellL[i]=prevL=.5*(cellL[i]*dry+x*wet+prevL),x=readBufferR[readIndex],writeBufferR[writeIndex]=cellR[i]-x*fb,cellR[i]=prevR=.5*(cellR[i]*dry+x*wet+prevR),readIndex+=1,writeIndex=writeIndex+1&mask;this.readIndex=readIndex&this.buffermask,this.writeIndex=writeIndex,this.prevL=prevL,this.prevR=prevR},T.modules.StereoDelay=StereoDelay}(timbre),function(T){"use strict";var fn=T.fn,modules=T.modules;fn.register("audio",function(_args){var BufferNode=fn.getClass("buffer"),instance=new BufferNode(_args);return instance.playbackState=fn.FINISHED_STATE,instance._.isLoaded=!1,Object.defineProperties(instance,{isLoaded:{get:function(){return this._.isLoaded}}}),instance.load=load,instance.loadthis=loadthis,instance});var load=function(src){var self=this,_=this._,dfd=new modules.Deferred(this),args=arguments,i=1;dfd.done(function(){self._.emit("done")}),"function"==typeof args[i]&&(dfd.done(args[i++]),"function"==typeof args[i]&&dfd.fail(args[i++])),_.loadedTime=0;var onloadedmetadata=function(result,msg){var _=self._;result?(self.playbackState=fn.PLAYING_STATE,_.samplerate=result.samplerate,_.channels=result.channels,_.bufferMix=null,_.buffer=result.buffer,_.phase=0,_.phaseIncr=result.samplerate/T.samplerate,_.duration=1e3*result.duration,_.currentTime=0,_.isReversed&&(_.phaseIncr*=-1,_.phase=result.buffer[0].length+_.phaseIncr),self._.emit("loadedmetadata")):dfd.reject(msg)},onloadeddata=function(){self._.isLoaded=!0,self._.plotFlush=!0,self._.emit("loadeddata"),dfd.resolveWith(self)};return(new modules.Decoder).decode(src,onloadedmetadata,onloadeddata),dfd.promise()},loadthis=function(){return load.apply(this,arguments),this}}(timbre),function(T){"use strict";function BiquadNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.biquad=new Biquad(_.samplerate),_.freq=T(340),_.band=T(1),_.gain=T(0),_.plotBefore=plotBefore,_.plotRange=[-18,18],_.plotFlush=!0}var fn=T.fn,FFT=T.modules.FFT,Biquad=T.modules.Biquad,PLOT_LOW_FREQ=20;fn.extend(BiquadNode);var plotBefore=function(context,x,y,width,height){context.lineWidth=1,context.strokeStyle="rgb(192, 192, 192)";for(var nyquist=.5*this._.samplerate,i=1;10>=i;++i)for(var j=1;4>=j;j++){var f=i*Math.pow(10,j);if(!(PLOT_LOW_FREQ>=f||f>=nyquist)){context.beginPath();var _x=Math.log(f/PLOT_LOW_FREQ)/Math.log(nyquist/PLOT_LOW_FREQ);_x=(_x*width+x|0)+.5,context.moveTo(_x,y),context.lineTo(_x,y+height),context.stroke()}}var h=height/6;for(i=1;6>i;i++){context.beginPath();var _y=(y+i*h|0)+.5;context.moveTo(x,_y),context.lineTo(x+width,_y),context.stroke()}},$=BiquadNode.prototype;Object.defineProperties($,{type:{set:function(value){var _=this._;value!==_.biquad.type&&(_.biquad.setType(value),_.plotFlush=!0)},get:function(){return this._.biquad.type}},freq:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}},cutoff:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}},res:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},Q:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},band:{set:function(value){this._.band=T(value)},get:function(){return this._.band}},gain:{set:function(value){this._.gain=T(value)},get:function(){return this._.gain}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var freq=_.freq.process(tickID).cells[0][0],band=_.band.process(tickID).cells[0][0],gain=_.gain.process(tickID).cells[0][0];(_.prevFreq!==freq||_.prevband!==band||_.prevGain!==gain)&&(_.prevFreq=freq,_.prevband=band,_.prevGain=gain,_.biquad.setParams(freq,band,gain),_.plotFlush=!0),_.bypassed||_.biquad.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)}return this};var fft=new FFT(2048),super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var biquad=new Biquad(this._.samplerate);biquad.setType(this.type),biquad.setParams(this.freq.valueOf(),this.band.valueOf(),this.gain.valueOf());var impluse=new Float32Array(fft.length);impluse[0]=1,biquad.process(impluse,impluse),fft.forward(impluse);var i,j,f,index,delta,x0,x1,xx,size=512,data=new Float32Array(size),nyquist=.5*this._.samplerate,spectrum=new Float32Array(size);for(fft.getFrequencyData(spectrum),i=0;size>i;++i)f=Math.pow(nyquist/PLOT_LOW_FREQ,i/size)*PLOT_LOW_FREQ,j=f/(nyquist/spectrum.length),index=0|j,delta=j-index,0===index?x1=x0=xx=spectrum[index]:(x0=spectrum[index-1],x1=spectrum[index],xx=(1-delta)*x0+delta*x1),data[i]=xx;this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("biquad",BiquadNode),fn.register("lowpass",function(_args){return new BiquadNode(_args).set("type","lowpass")}),fn.register("highpass",function(_args){return new BiquadNode(_args).set("type","highpass")}),fn.register("bandpass",function(_args){return new BiquadNode(_args).set("type","bandpass")}),fn.register("lowshelf",function(_args){return new BiquadNode(_args).set("type","lowshelf")}),fn.register("highshelf",function(_args){return new BiquadNode(_args).set("type","highshelf")}),fn.register("peaking",function(_args){return new BiquadNode(_args).set("type","peaking")}),fn.register("notch",function(_args){return new BiquadNode(_args).set("type","notch")}),fn.register("allpass",function(_args){return new BiquadNode(_args).set("type","allpass")}),fn.alias("lpf","lowpass"),fn.alias("hpf","highpass"),fn.alias("bpf","bandpass"),fn.alias("bef","notch"),fn.alias("brf","notch"),fn.alias("apf","allpass")}(timbre),function(T){"use strict";function BufferNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.pitch=T(1),_.samplerate=44100,_.channels=0,_.bufferMix=null,_.buffer=[],_.isLooped=!1,_.isReversed=!1,_.duration=0,_.currentTime=0,_.currentTimeObj=null,_.phase=0,_.phaseIncr=0,_.onended=fn.make_onended(this,0),_.onlooped=make_onlooped(this)}var fn=T.fn,Tape=T.modules.Scissor.Tape,isSignalArray=function(obj){return fn.isSignalArray(obj)||obj instanceof Float32Array};fn.extend(BufferNode);var make_onlooped=function(self){return function(){var _=self._;_.phase>=_.buffer[0].length?_.phase=0:_.phase<0&&(_.phase=_.buffer[0].length+_.phaseIncr),self._.emit("looped")}},$=BufferNode.prototype,setBuffer=function(value){var _=this._;if("object"==typeof value){var samplerate,channels,buffer=[];isSignalArray(value)?(buffer[0]=value,channels=1):"object"==typeof value&&(value instanceof T.Object?value=value.buffer:value instanceof Tape&&(value=value.getBuffer()),Array.isArray(value.buffer)?isSignalArray(value.buffer[0])&&(isSignalArray(value.buffer[1])&&isSignalArray(value.buffer[2])?(channels=2,buffer=value.buffer):(channels=1,buffer=[value.buffer[0]])):isSignalArray(value.buffer)&&(channels=1,buffer=[value.buffer]),"number"==typeof value.samplerate&&(samplerate=value.samplerate)),buffer.length&&(samplerate>0&&(_.samplerate=value.samplerate),_.bufferMix=null,_.buffer=buffer,_.phase=0,_.phaseIncr=_.samplerate/T.samplerate,_.duration=1e3*_.buffer[0].length/_.samplerate,_.currentTime=0,_.plotFlush=!0,this.reverse(_.isReversed))}};Object.defineProperties($,{buffer:{set:setBuffer,get:function(){var _=this._;return{samplerate:_.samplerate,channels:_.channels,buffer:_.buffer}}},pitch:{set:function(value){this._.pitch=T(value)},get:function(){return this._.pitch}},isLooped:{get:function(){return this._.isLooped}},isReversed:{get:function(){return this._.isReversed}},samplerate:{get:function(){return this._.samplerate}},duration:{get:function(){return this._.duration}},currentTime:{set:function(value){if("number"==typeof value){var _=this._;value>=0&&value<=_.duration&&(_.phase=value/1e3*_.samplerate,_.currentTime=value)}else value instanceof T.Object?this._.currentTimeObj=value:null===value&&(this._.currentTimeObj=null)},get:function(){return this._.currentTimeObj?this._.currentTimeObj:this._.currentTime}}}),$.clone=function(){var _=this._,instance=fn.clone(this);return _.buffer.length&&setBuffer.call(instance,{buffer:_.buffer,samplerate:_.samplerate,channels:_.channels}),instance.loop(_.isLooped),instance.reverse(_.isReversed),instance},$.slice=function(begin,end){var _=this._,instance=T(_.originkey),isReversed=_.isReversed;if(_.buffer.length){if(begin="number"==typeof begin?.001*begin*_.samplerate|0:0,end="number"==typeof end?.001*end*_.samplerate|0:_.buffer[0].length,begin>end){var tmp=begin;begin=end,end=tmp,isReversed=!isReversed}2===_.channels?setBuffer.call(instance,{buffer:[fn.pointer(_.buffer[0],begin,end-begin),fn.pointer(_.buffer[1],begin,end-begin),fn.pointer(_.buffer[2],begin,end-begin)],samplerate:_.samplerate}):setBuffer.call(instance,{buffer:fn.pointer(_.buffer[0],begin,end-begin),samplerate:_.samplerate}),instance.playbackState=fn.PLAYING_STATE}return instance.loop(_.isLooped),instance.reverse(_.isReversed),instance},$.reverse=function(value){var _=this._;return _.isReversed=!!value,_.isReversed?(_.phaseIncr>0&&(_.phaseIncr*=-1),0===_.phase&&_.buffer.length&&(_.phase=_.buffer[0].length+_.phaseIncr)):_.phaseIncr<0&&(_.phaseIncr*=-1),this},$.loop=function(value){return this._.isLooped=!!value,this},$.bang=function(value){return this.playbackState=value===!1?fn.FINISHED_STATE:fn.PLAYING_STATE,this._.phase=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(!_.buffer.length)return this;if(this.tickID!==tickID){this.tickID=tickID;var i,bufferL,bufferR,cellL=this.cells[1],cellR=this.cells[2],phase=_.phase,imax=_.cellsize;if(2===_.channels?(bufferL=_.buffer[1],bufferR=_.buffer[2]):bufferL=bufferR=_.buffer[0],_.currentTimeObj){var t,pos=_.currentTimeObj.process(tickID).cells[0],sr=.001*_.samplerate;for(i=0;imax>i;++i)t=pos[i],phase=t*sr,cellL[i]=bufferL[0|phase]||0,cellR[i]=bufferR[0|phase]||0;_.phase=phase,_.currentTime=t}else{var pitch=_.pitch.process(tickID).cells[0][0],phaseIncr=_.phaseIncr*pitch;for(i=0;imax>i;++i)cellL[i]=bufferL[0|phase]||0,cellR[i]=bufferR[0|phase]||0,phase+=phaseIncr;phase>=bufferL.length?fn.nextTick(_.isLooped?_.onlooped:_.onended):0>phase&&fn.nextTick(_.isLooped?_.onlooped:_.onended),_.phase=phase,_.currentTime+=fn.currentTimeIncr}fn.outputSignalAR(this)}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var bufferL,bufferR,_=this._;if(_.plotFlush){2===_.channels?(bufferL=_.buffer[1],bufferR=_.buffer[2]):bufferL=bufferR=_.buffer[0];for(var data=new Float32Array(2048),x=0,xIncr=bufferL.length/2048,i=0;2048>i;i++)data[i]=.5*(bufferL[0|x]+bufferR[0|x]),x+=xIncr;_.plotData=data,_.plotFlush=null}return super_plot.call(this,opts)},fn.register("buffer",BufferNode)}(timbre),function(T){"use strict";function ChorusNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var chorus=new Chorus(this._.samplerate);chorus.setDelayTime(20),chorus.setRate(4),chorus.depth=20,chorus.feedback=.2,chorus.mix=.33,this._.chorus=chorus}var fn=T.fn,Chorus=T.modules.Chorus;fn.extend(ChorusNode);var $=ChorusNode.prototype;Object.defineProperties($,{type:{set:function(value){this._.chorus.setDelayTime(value)},get:function(){return this._.chorus.wave}},delay:{set:function(value){value>=.5&&80>=value&&this._.chorus.setDelayTime(value)},get:function(){return this._.chorus.delayTime}},rate:{set:function(value){"number"==typeof value&&value>0&&this._.chorus.setRate(value)},get:function(){return this._.chorus.rate}},depth:{set:function(value){"number"==typeof value&&value>=0&&100>=value&&(value*=this._.samplerate/44100,this._.chorus.depth=value)},get:function(){return this._.chorus.depth}},fb:{set:function(value){"number"==typeof value&&value>=-1&&1>=value&&(this._.chorus.feedback=.99996*value)},get:function(){return this._.chorus.feedback}},mix:{set:function(value){this._.mix=T(value)},get:function(){return this._.mix}}}),$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,fn.inputSignalAR(this),_.bypassed||_.chorus.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)),this},fn.register("chorus",ChorusNode)}(timbre),function(T){"use strict";function ClipNode(_args){T.Object.call(this,2,_args);var _=this._;_.min=-.8,_.max=.8}var fn=T.fn;fn.extend(ClipNode);var $=ClipNode.prototype;Object.defineProperties($,{minmax:{set:function(value){var _=this._;"number"==typeof value&&(_.min=-Math.abs(value),_.max=-_.min)},get:function(){return this._.max}},min:{set:function(value){var _=this._;"number"==typeof value&&(_.max<value?_.max=value:_.min=value)},get:function(){return this._.min}},max:{set:function(value){var _=this._;"number"==typeof value&&(value<_.min?_.min=value:_.max=value)},get:function(){return this._.max}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,value,cellL=this.cells[1],cellR=this.cells[2],imax=cellL.length,min=_.min,max=_.max;if(_.ar){for(fn.inputSignalAR(this),i=0;imax>i;++i)value=cellL[i],min>value?value=min:value>max&&(value=max),cellL[i]=value,value=cellR[i],min>value?value=min:value>max&&(value=max),cellR[i]=value;fn.outputSignalAR(this)}else value=fn.inputSignalKR(this),min>value?value=min:value>max&&(value=max),this.cells[0][0]=value,fn.outputSignalKR(this)}return this},fn.register("clip",ClipNode)}(timbre),function(T){"use strict";function CompressorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.prevThresh=-24,_.prevKnee=30,_.prevRatio=12,_.thresh=T(_.prevThresh),_.knee=T(_.prevKnee),_.ratio=T(_.prevRatio),_.postGain=6,_.reduction=0,_.attack=3,_.release=25,_.comp=new Compressor(_.samplerate),_.comp.dbPostGain=_.postGain,_.comp.setAttackTime(.001*_.attack),_.comp.setReleaseTime(.001*_.release),_.comp.setPreDelayTime(6),_.comp.setParams(_.prevThresh,_.prevKnee,_.prevRatio)}var fn=T.fn,timevalue=T.timevalue,Compressor=T.modules.Compressor;fn.extend(CompressorNode);var $=CompressorNode.prototype;Object.defineProperties($,{thresh:{set:function(value){this._.thresh=T(value)},get:function(){return this._.thresh}},thre:{set:function(value){this._.thresh=T(value)},get:function(){return this._.thre}},knee:{set:function(value){this._.kne=T(value)},get:function(){return this._.knee}},ratio:{set:function(value){this._.ratio=T(value)},get:function(){return this._.ratio}},gain:{set:function(value){"number"==typeof value&&(this._.comp.dbPostGain=value)},get:function(){return this._.comp.dbPostGain}},attack:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&(value=0>value?0:value>1e3?1e3:value,this._.attack=value,this._.comp.setAttackTime(.001*value))},get:function(){return this._.attack}},release:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&(value=0>value?0:value>1e3?1e3:value,this._.release=value,this._.comp.setReleaseTime(.001*value))},get:function(){return this._.release}},reduction:{get:function(){return this._.reduction}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var thresh=_.thresh.process(tickID).cells[0][0],knee=_.knee.process(tickID).cells[0][0],ratio=_.ratio.process(tickID).cells[0][0];(_.prevThresh!==thresh||_.prevKnee!==knee||_.prevRatio!==ratio)&&(_.prevThresh=thresh,_.prevKnee=knee,_.prevRatio=ratio,_.comp.setParams(thresh,knee,ratio)),_.bypassed||(_.comp.process(this.cells[1],this.cells[2]),_.reduction=_.comp.meteringGain),fn.outputSignalAR(this)}return this},fn.register("comp",CompressorNode)}(timbre),function(T){"use strict";function DelayNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.time=T(100),_.fb=T(.2),_.cross=T(!1),_.mix=.33,_.delay=new StereoDelay(_.samplerate)}var fn=T.fn,timevalue=T.timevalue,StereoDelay=T.modules.StereoDelay;fn.extend(DelayNode);var $=DelayNode.prototype;Object.defineProperties($,{time:{set:function(value){"string"==typeof value&&(value=timevalue(value)),this._.time=T(value)},get:function(){return this._.time}},fb:{set:function(value){this._.fb=T(value)},get:function(){return this._.fb}},cross:{set:function(value){this._.cross=T(value)},get:function(){return this._.cross}},mix:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.mix=value)},get:function(){return this._.mix}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var time=_.time.process(tickID).cells[0][0],fb=_.fb.process(tickID).cells[0][0],cross=0!==_.cross.process(tickID).cells[0][0],mix=_.mix;(_.prevTime!==time||_.prevFb!==fb||_.prevCross!==cross||_.prevMix!==mix)&&(_.prevTime=time,_.prevFb=fb,_.prevCross=cross,_.prevMix=mix,_.delay.setParams(time,fb,cross,mix)),fn.inputSignalAR(this),_.bypassed||_.delay.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)}return this},fn.register("delay",DelayNode)}(timbre),function(T){"use strict";function DistNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.pre=T(60),_.post=T(-18),_.x1L=_.x2L=_.y1L=_.y2L=0,_.x1R=_.x2R=_.y1R=_.y2R=0,_.b0=_.b1=_.b2=_.a1=_.a2=0,_.cutoff=0,_.Q=1,_.preScale=0,_.postScale=0}var fn=T.fn;fn.extend(DistNode);var $=DistNode.prototype;Object.defineProperties($,{cutoff:{set:function(value){"number"==typeof value&&value>0&&(this._.cutoff=value)},get:function(){return this._.cutoff}},pre:{set:function(value){this._.pre=T(value)},get:function(){return this._.pre}},post:{set:function(value){this._.post=T(value)},get:function(){return this._.post}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var preGain=-_.pre.process(tickID).cells[0][0],postGain=-_.post.process(tickID).cells[0][0];if((_.prevPreGain!==preGain||_.prevPostGain!==postGain)&&(_.prevPreGain=preGain,_.prevPostGain=postGain,_.preScale=Math.pow(10,.05*-preGain),_.postScale=Math.pow(10,.05*-postGain)),!_.bypassed){var i,imax,value,x0,y0,cellL=this.cells[1],cellR=this.cells[2],preScale=_.preScale,postScale=_.postScale;if(_.cutoff){_.prevCutoff!==_.cutoff&&(_.prevCutoff=_.cutoff,lowpass_params(_));var x1L=_.x1L,x2L=_.x2L,y1L=_.y1L,y2L=_.y2L,x1R=_.x1R,x2R=_.x2R,y1R=_.y1R,y2R=_.y2R,b0=_.b0,b1=_.b1,b2=_.b2,a1=_.a1,a2=_.a2;for(i=0,imax=cellL.length;imax>i;++i)x0=cellL[i]*preScale,y0=b0*x0+b1*x1L+b2*x2L-a1*y1L-a2*y2L,value=y0*postScale,-1>value?value=-1:value>1&&(value=1),cellL[i]=value,x2L=x1L,x1L=x0,y2L=y1L,y1L=y0,x0=cellR[i]*preScale,y0=b0*x0+b1*x1R+b2*x2R-a1*y1R-a2*y2R,value=y0*postScale,-1>value?value=-1:value>1&&(value=1),cellR[i]=value,x2R=x1R,x1R=x0,y2R=y1R,y1R=y0;_.x1L=x1L,_.x2L=x2L,_.y1L=y1L,_.y2L=y2L,_.x1R=x1R,_.x2R=x2R,_.y1R=y1R,_.y2R=y2R}else for(i=0,imax=cellL.length;imax>i;++i)value=cellL[i]*preScale*postScale,-1>value?value=-1:value>1&&(value=1),cellL[i]=value,value=cellR[i]*preScale*postScale,-1>value?value=-1:value>1&&(value=1),cellR[i]=value}fn.outputSignalAR(this)}return this};var lowpass_params=function(_){var w0=2*Math.PI*_.cutoff/_.samplerate,cos=Math.cos(w0),sin=Math.sin(w0),alpha=sin/(2*_.Q),ia0=1/(1+alpha);_.b0=.5*(1-cos)*ia0,_.b1=1-cos*ia0,_.b2=.5*(1-cos)*ia0,_.a1=-2*cos*ia0,_.a2=1-alpha*ia0};fn.register("dist",DistNode)}(timbre),function(T){"use strict";function DivNode(_args){T.Object.call(this,2,_args),this._.ar=!1}var fn=T.fn;fn.extend(DivNode);var $=DivNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,div,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)div=tmpL[j],cellL[j]=0===div?0:cellL[j]/div,div=tmpR[j],cellR[j]=0===div?0:cellR[j]/div;else for(j=0;jmax>j;++j)cellL[j]=cellR[i]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)div=nodes[i].process(tickID).cells[0][0],tmp=0===div?0:tmp/div;else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("/",DivNode)}(timbre),function(T){"use strict";function EnvNode(_args){T.Object.call(this,2,_args);var _=this._;_.env=new Envelope(_.samplerate),_.env.setStep(_.cellsize),_.tmp=new fn.SignalArray(_.cellsize),_.ar=!1,_.plotFlush=!0,_.onended=make_onended(this),this.on("ar",onar)}function envValue(opts,min,def,name1,name2,func){var x=def;return"number"==typeof opts[name1]?x=opts[name1]:"number"==typeof opts[name2]?x=opts[name2]:func&&("string"==typeof opts[name1]?x=func(opts[name1]):"string"==typeof opts[name2]&&(x=func(opts[name2]))),min>x&&(x=min),x}var fn=T.fn,timevalue=T.timevalue,Envelope=T.modules.Envelope,isDictionary=fn.isDictionary;fn.extend(EnvNode);var onar=function(value){this._.env.setStep(value?1:this._.cellsize)},make_onended=function(self){return function(){self._.emit("ended")}},$=EnvNode.prototype;Object.defineProperties($,{table:{set:function(value){Array.isArray(value)&&(setTable.call(this,value),this._.plotFlush=!0)},get:function(){return this._.env.table}},curve:{set:function(value){this._.env.setCurve(value)},get:function(){return this._.env.curve}},releaseNode:{set:function(value){this._.env.setReleaseNode(value),this._.plotFlush=!0},get:function(){return this._.env.releaseNode+1}},loopNode:{set:function(value){this._.env.setLoopNode(value),this._.plotFlush=!0},get:function(){return this._.env.loopNode+1}}}),$.clone=function(){var instance=fn.clone(this);return instance._.env=this._.env.clone(),instance},$.reset=function(){return this._.env.reset(),this},$.release=function(){var _=this._;return _.env.release(),_.emit("released"),this},$.bang=function(){var _=this._;return _.env.reset(),_.env.status=Envelope.StatusGate,_.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;var value,emit=null;if(_.ar){var tmp=_.tmp;for(_.env.process(tmp),i=0;imax>i;++i)cellL[i]*=tmp[i],cellR[i]*=tmp[i];emit=_.env.emit}else{for(value=_.env.next(),i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value;emit=_.env.emit}fn.outputSignalAR(this),emit&&("ended"===emit?fn.nextTick(_.onended):this._.emit(emit,_.value))}return this};var setTable=function(list){for(var value,time,curveType,curveValue,env=this._.env,table=[list[0]||ZERO],i=1,imax=list.length;imax>i;++i)value=list[i][0]||ZERO,time=list[i][1],curveType=list[i][2],"number"!=typeof time&&(time="string"==typeof time?timevalue(time):10),10>time&&(time=10),"number"==typeof curveType?(curveValue=curveType,curveType=Envelope.CurveTypeCurve):(curveType=Envelope.CurveTypeDict[curveType]||null,curveValue=0),table.push([value,time,curveType,curveValue]);env.setTable(table)},super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var i,imax,env=this._.env.clone(),info=env.getInfo(1e3),totalDuration=info.totalDuration,loopBeginTime=info.loopBeginTime,releaseBeginTime=info.releaseBeginTime,data=new Float32Array(256),duration=0,durationIncr=totalDuration/data.length,isReleased=!1,samples=.001*totalDuration*this._.samplerate|0;for(samples/=data.length,env.setStep(samples),env.status=Envelope.StatusGate,i=0,imax=data.length;imax>i;++i)data[i]=env.next(),duration+=durationIncr,!isReleased&&duration>=releaseBeginTime&&(env.release(),isReleased=!0);
this._.plotData=data,this._.plotBefore=function(context,x,y,width,height){var x1,w;1/0!==loopBeginTime&&1/0!==releaseBeginTime&&(x1=x+width*(loopBeginTime/totalDuration),w=x+width*(releaseBeginTime/totalDuration),w-=x1,context.fillStyle="rgba(224, 224, 224, 0.8)",context.fillRect(x1,0,w,height)),1/0!==releaseBeginTime&&(x1=x+width*(releaseBeginTime/totalDuration),w=width-x1,context.fillStyle="rgba(212, 212, 212, 0.8)",context.fillRect(x1,0,w,height))};var minValue=1/0,maxValue=-1/0;for(i=0;imax>i;++i)data[i]<minValue?minValue=data[i]:data[i]>maxValue&&(maxValue=data[i]);1>maxValue&&(maxValue=1),this._.plotRange=[minValue,maxValue],this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("env",EnvNode);var ZERO=Envelope.ZERO;fn.register("perc",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),r=envValue(opts,10,1e3,"r","releaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[ZERO,r]],new EnvNode(_args)}),fn.register("adsr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","decayTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[s,d],[ZERO,r]],opts.releaseNode=3,new EnvNode(_args)}),fn.register("adshr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),h=envValue(opts,10,500,"h","holdTime",timevalue),r=envValue(opts,10,1e3,"r","decayTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[s,d],[s,h],[ZERO,r]],new EnvNode(_args)}),fn.register("asr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","releaseTime",timevalue);return opts.table=[ZERO,[s,a],[ZERO,r]],opts.releaseNode=2,new EnvNode(_args)}),fn.register("dadsr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],dl=envValue(opts,10,100,"dl","delayTime",timevalue),a=envValue(opts,10,10,"a","attackTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),r=envValue(opts,10,1e3,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[ZERO,dl],[lv,a],[s,d],[ZERO,r]],opts.releaseNode=4,new EnvNode(_args)}),fn.register("ahdsfr",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),h=envValue(opts,10,10,"h","holdTime",timevalue),d=envValue(opts,10,300,"d","decayTime",timevalue),s=envValue(opts,ZERO,.5,"s","sustainLevel"),f=envValue(opts,10,5e3,"f","fadeTime",timevalue),r=envValue(opts,10,1e3,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[lv,h],[s,d],[ZERO,f],[ZERO,r]],opts.releaseNode=5,new EnvNode(_args)}),fn.register("linen",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],a=envValue(opts,10,10,"a","attackTime",timevalue),s=envValue(opts,10,1e3,"s","sustainTime",timevalue),r=envValue(opts,10,1e3,"r","releaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[ZERO,[lv,a],[lv,s],[ZERO,r]],new EnvNode(_args)}),fn.register("env.tri",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],dur=envValue(opts,20,1e3,"dur","duration",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return dur*=.5,opts.table=[ZERO,[lv,dur],[ZERO,dur]],new EnvNode(_args)}),fn.register("env.cutoff",function(_args){isDictionary(_args[0])||_args.unshift({});var opts=_args[0],r=envValue(opts,10,100,"r","relaseTime",timevalue),lv=envValue(opts,ZERO,1,"lv","level");return opts.table=[lv,[ZERO,r]],new EnvNode(_args)})}(timbre),function(T){"use strict";function EQNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.biquads=new Array(7),_.plotBefore=plotBefore,_.plotRange=[-18,18],_.plotFlush=!0}var fn=T.fn,FFT=T.modules.FFT,Biquad=T.modules.Biquad,PLOT_LOW_FREQ=20,PARAM_NAMES={hpf:0,lf:1,lmf:2,mf:3,hmf:4,hf:5,lpf:6};fn.extend(EQNode);var plotBefore=function(context,x,y,width,height){context.lineWidth=1,context.strokeStyle="rgb(192, 192, 192)";for(var nyquist=.5*this._.samplerate,i=1;10>=i;++i)for(var j=1;4>=j;j++){var f=i*Math.pow(10,j);if(!(PLOT_LOW_FREQ>=f||f>=nyquist)){context.beginPath();var _x=Math.log(f/PLOT_LOW_FREQ)/Math.log(nyquist/PLOT_LOW_FREQ);_x=(_x*width+x|0)+.5,context.moveTo(_x,y),context.lineTo(_x,y+height),context.stroke()}}var h=height/6;for(i=1;6>i;i++){context.beginPath();var _y=(y+i*h|0)+.5;context.moveTo(x,_y),context.lineTo(x+width,_y),context.stroke()}},$=EQNode.prototype;Object.defineProperties($,{params:{set:function(value){if("object"==typeof value)for(var keys=Object.keys(value),i=0,imax=keys.length;imax>i;++i){var items=value[keys[i]];Array.isArray(items)?this.setParams(keys[i],items[0],items[1],items[2]):this.setParams(keys[i])}}}}),$.setParams=function(index,freq,Q,gain){var _=this._;if("string"==typeof index&&(index=PARAM_NAMES[index]),index>=0&&index<_.biquads.length){if(index|=0,"number"==typeof freq&&"number"==typeof Q){"number"!=typeof gain&&(gain=0);var biquad=_.biquads[index];if(!biquad)switch(biquad=_.biquads[index]=new Biquad(_.samplerate),index){case 0:biquad.setType("highpass");break;case _.biquads.length-1:biquad.setType("lowpass");break;default:biquad.setType("peaking")}biquad.setParams(freq,Q,gain)}else _.biquads[index]=void 0;_.plotFlush=!0}return this},$.getParams=function(index){var _=this._,biquad=_.biquads[0|index];return biquad?{freq:biquad.frequency,Q:biquad.Q,gain:biquad.gain}:void 0},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),!_.bypassed)for(var cellL=this.cells[1],cellR=this.cells[2],biquads=_.biquads,i=0,imax=biquads.length;imax>i;++i)biquads[i]&&biquads[i].process(cellL,cellR);fn.outputSignalAR(this)}return this};var fft=new FFT(2048),super_plot=T.Object.prototype.plot;$.plot=function(opts){if(this._.plotFlush){var _=this._,impluse=new Float32Array(fft.length);impluse[0]=1;for(var i=0,imax=_.biquads.length;imax>i;++i){var params=this.getParams(i);if(params){var biquad=new Biquad(_.samplerate);biquad.setType(0===i?"highpass":i===imax-1?"lowpass":"peaking"),biquad.setParams(params.freq,params.Q,params.gain),biquad.process(impluse,impluse)}}fft.forward(impluse);var j,f,index,delta,x0,x1,xx,size=512,data=new Float32Array(size),nyquist=.5*_.samplerate,spectrum=new Float32Array(size);for(fft.getFrequencyData(spectrum),i=0;size>i;++i)f=Math.pow(nyquist/PLOT_LOW_FREQ,i/size)*PLOT_LOW_FREQ,j=f/(nyquist/spectrum.length),index=0|j,delta=j-index,0===index?x1=x0=xx=spectrum[index]:(x0=spectrum[index-1],x1=spectrum[index],xx=(1-delta)*x0+delta*x1),data[i]=xx;this._.plotData=data,this._.plotFlush=null}return super_plot.call(this,opts)},fn.register("eq",EQNode)}(timbre),function(T){"use strict";function FFTNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this),this.real=new T.ChannelObject(this),this.imag=new T.ChannelObject(this),this.cells[3]=this.real.cell,this.cells[4]=this.imag.cell;var _=this._;_.fft=new FFT(2*_.cellsize),_.fftCell=new fn.SignalArray(_.fft.length),_.prevCell=new fn.SignalArray(_.cellsize),_.freqs=new fn.SignalArray(_.fft.length>>1),_.plotFlush=!0,_.plotRange=[0,32],_.plotBarStyle=!0}var fn=T.fn,FFT=T.modules.FFT;fn.extend(FFTNode);var $=FFTNode.prototype;Object.defineProperties($,{window:{set:function(value){this._.fft.setWindow(value)},get:function(){return this._.fft.windowName}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var cell=this.cells[0],cellsize=_.cellsize;_.fftCell.set(_.prevCell),_.fftCell.set(cell,cellsize),_.fft.forward(_.fftCell),_.prevCell.set(cell),_.plotFlush=!0,this.cells[3].set(_.fft.real.subarray(0,cellsize)),this.cells[4].set(_.fft.imag.subarray(0,cellsize))}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),super_plot.call(this,opts)},fn.register("fft",FFTNode)}(timbre),function(T){"use strict";function FNoiseNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.freq=T(440),_.reg=32768,_.shortFlag=!1,_.phase=0,_.lastValue=0}var fn=T.fn;fn.extend(FNoiseNode);var $=FNoiseNode.prototype;Object.defineProperties($,{shortFlag:{set:function(value){this._.shortFlag=!!value},get:function(){return this._.shortFlag}},freq:{set:function(value){this._.freq=T(value)},get:function(){return this._.freq}}}),$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){this.tickID=tickID;var i,imax,lastValue=_.lastValue,phase=_.phase,phaseStep=_.freq.process(tickID).cells[0][0]/_.samplerate,reg=_.reg,mul=_.mul,add=_.add;if(_.shortFlag)for(i=0,imax=cell.length;imax>i;++i)phase>=1&&(reg>>=1,reg|=(1&(reg^reg>>6))<<15,lastValue=(1&reg)-.5,phase-=1),cell[i]=lastValue*mul+add,phase+=phaseStep;else for(i=0,imax=cell.length;imax>i;++i)phase>=1&&(reg>>=1,reg|=(1&(reg^reg>>1))<<15,lastValue=(1&reg)-.5,phase-=1),cell[i]=lastValue*mul+add,phase+=phaseStep;_.reg=reg,_.phase=phase,_.lastValue=lastValue}return this},fn.register("fnoise",FNoiseNode)}(timbre),function(T){"use strict";function GateNode(_args){T.Object.call(this,2,_args),fn.fixAR(this),this._.selected=0,this._.outputs=[]}var fn=T.fn,GateChannelNode=function(){function GateChannelNode(parent){T.Object.call(this,2,[]),fn.fixAR(this),this._.parent=parent}return fn.extend(GateChannelNode),GateChannelNode.prototype.process=function(tickID){return this.tickID!==tickID&&(this.tickID=tickID,this._.parent.process(tickID)),this},GateChannelNode}();fn.extend(GateNode);var $=GateNode.prototype;Object.defineProperties($,{selected:{set:function(value){var _=this._;if("number"==typeof value){_.selected=value;for(var outputs=_.outputs,i=0,imax=outputs.length;imax>i;++i)outputs[i]&&(outputs[i].cells[0].set(fn.emptycell),outputs[i].cells[1].set(fn.emptycell),outputs[i].cells[2].set(fn.emptycell))}},get:function(){return this._.selected}}}),$.at=function(index){var _=this._,output=_.outputs[index];return output||(_.outputs[index]=output=new GateChannelNode(this)),output},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var output=_.outputs[_.selected];output&&(output.cells[0].set(this.cells[0]),output.cells[1].set(this.cells[1]),output.cells[2].set(this.cells[2]))}return this},fn.register("gate",GateNode)}(timbre),function(T){"use strict";function IFFTNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._;_.fft=new FFT(2*_.cellsize),_.fftCell=new fn.SignalArray(this._.fft.length),_.realBuffer=new fn.SignalArray(this._.fft.length),_.imagBuffer=new fn.SignalArray(this._.fft.length)}var fn=T.fn,FFT=T.modules.FFT;fn.extend(IFFTNode);var $=IFFTNode.prototype;Object.defineProperties($,{real:{set:function(value){this._.real=T(value)},get:function(){return this._.real}},imag:{set:function(value){this._.imag=T(value)},get:function(){return this._.imag}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID&&(this.tickID=tickID,_.real&&_.imag)){var cell=this.cells[0],real=_.realBuffer,imag=_.imagBuffer,_real=_.real.process(tickID).cells[0],_imag=_.imag.process(tickID).cells[0];real.set(_real),imag.set(_imag),cell.set(_.fft.inverse(real,imag).subarray(0,_.cellsize)),fn.outputSignalAR(this)}return this},fn.register("ifft",IFFTNode)}(timbre),function(T){"use strict";function IntervalNode(_args){T.Object.call(this,1,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.interval=T(1e3),_.count=0,_.delay=0,_.timeout=1/0,_.currentTime=0,_.delaySamples=0,_.countSamples=0,_.onended=fn.make_onended(this),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue;fn.extend(IntervalNode);var onstart=function(){var _=this._;this.playbackState=fn.PLAYING_STATE,_.delaySamples=.001*_.samplerate*_.delay|0,_.countSamples=_.count=_.currentTime=0};Object.defineProperty(onstart,"unremovable",{value:!0,writable:!1});var $=IntervalNode.prototype;Object.defineProperties($,{interval:{set:function(value){"string"==typeof value&&(value=timevalue(value),0>=value&&(value=0)),this._.interval=T(value)},get:function(){return this._.interval}},delay:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this._.delay=value,this._.delaySamples=.001*this._.samplerate*value|0)},get:function(){return this._.delay}},count:{set:function(value){"number"==typeof value&&(this._.count=value)},get:function(){return this._.count}},timeout:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this._.timeout=value)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),$.bang=function(){var _=this._;return this.playbackState=fn.PLAYING_STATE,_.delaySamples=.001*_.samplerate*_.delay|0,_.countSamples=_.count=_.currentTime=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID,_.delaySamples>0&&(_.delaySamples-=cell.length);var interval=_.interval.process(tickID).cells[0][0];if(_.delaySamples<=0&&(_.countSamples-=cell.length,_.countSamples<=0)){_.countSamples+=_.samplerate*interval*.001|0;for(var nodes=this.nodes,count=_.count,x=count*_.mul+_.add,j=0,jmax=cell.length;jmax>j;++j)cell[j]=x;for(var i=0,imax=nodes.length;imax>i;++i)nodes[i].bang(count);_.count+=1}_.currentTime+=fn.currentTimeIncr,_.currentTime>=_.timeout&&fn.nextTick(_.onended)}return this},fn.register("interval",IntervalNode)}(timbre),function(T){"use strict";function LagNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);var _=this._,bits=Math.ceil(Math.log(_.samplerate)*Math.LOG2E);_.buffersize=1<<bits,_.buffermask=_.buffersize-1,_.buffer=new fn.SignalArray(_.buffersize),_.time=0,_.readIndex=0,_.writeIndex=0}var fn=T.fn,timevalue=T.timevalue;fn.extend(LagNode);var $=LagNode.prototype;Object.defineProperties($,{time:{set:function(value){if("string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0){var _=this._;_.time=value;var offset=.001*value*_.samplerate|0;offset>_.buffermask&&(offset=_.buffermask),_.writeIndex=_.readIndex+offset&_.buffermask}},get:function(){return this._.time}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this);var i,cell=this.cells[0],buffer=_.buffer,mask=_.buffermask,readIndex=_.readIndex,writeIndex=_.writeIndex,imax=cell.length;for(i=0;imax>i;++i)buffer[writeIndex]=cell[i],cell[i]=buffer[readIndex],readIndex+=1,writeIndex=writeIndex+1&mask;_.readIndex=readIndex&mask,_.writeIndex=writeIndex,fn.outputSignalAR(this)}return this},fn.register("lag",LagNode)}(timbre),function(T){"use strict";function MapNode(_args){T.Object.call(this,1,_args);var _=this._;_.input=0,_.value=0,_.prev=null,_.ar=!1,_.map=defaultFunction}var fn=T.fn;fn.extend(MapNode);var defaultFunction=function(x){return x},$=MapNode.prototype;Object.defineProperties($,{input:{set:function(value){"number"==typeof value&&(this._.input=value)},get:function(){return this._.input}},map:{set:function(value){"function"==typeof value&&(this._.map=value)},get:function(){return this._.map}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(input){return this._.map?this._.map(input):0},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var map=_.map;if(map)for(i=0;imax>i;++i)cell[i]=map(cell[i]);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=len?fn.inputSignalKR(this):_.input;_.map&&_.prev!==input&&(_.prev=input,_.value=_.map(input));var value=_.value*_.mul+_.add;for(i=0;imax>i;++i)cell[i]=value}}return this},fn.register("map",MapNode)}(timbre),function(T){"use strict";function MaxNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MaxNode);var $=MaxNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,val,nodes=this.nodes,imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0],cell.set(tmp),i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)val=tmp[j],cell[j]<val&&(cell[j]=val);else for(j=0;jmax>j;++j)cell[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)val=nodes[i].process(tickID).cells[0][0],val>tmp&&(tmp=val);else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("max",MaxNode)}(timbre),function(T){"use strict";function MediaStreamNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.src=_.func=null,_.bufferL=new fn.SignalArray(BUFFER_SIZE),_.bufferR=new fn.SignalArray(BUFFER_SIZE),_.readIndex=0,_.writeIndex=0,_.totalRead=0,_.totalWrite=0}if("browser"===T.envtype){var fn=T.fn,BUFFER_SIZE=4096,BUFFER_MASK=BUFFER_SIZE-1;fn.extend(MediaStreamNode);var $=MediaStreamNode.prototype;$.listen=function(audio){var _impl=impl[T.env];_impl&&(_impl.set.call(this,audio),_impl.listen.call(this))},$.unlisten=function(){var _impl=impl[T.env];_impl&&_impl.unlisten.call(this),this.cells[0].set(fn.emptycell),this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell);for(var _=this._,bufferL=_.bufferL,bufferR=_.bufferR,i=0,imax=bufferL.length;imax>i;++i)bufferL[i]=bufferR[i]=0},$.process=function(tickID){var _=this._;if(null===_.src)return this;if(this.tickID!==tickID){this.tickID=tickID;var cellsize=_.cellsize;if(_.totalWrite>_.totalRead+cellsize){var begin=_.readIndex,end=begin+cellsize;this.cells[1].set(_.bufferL.subarray(begin,end)),this.cells[2].set(_.bufferR.subarray(begin,end)),_.readIndex=end&BUFFER_MASK,_.totalRead+=cellsize}fn.outputSignalAR(this)}return this};var impl={};impl.webkit={set:function(src){var _=this._;if(src instanceof HTMLMediaElement){var context=fn._audioContext;_.src=context.createMediaElementSource(src)}},listen:function(){var _=this._,context=fn._audioContext;_.gain=context.createGainNode(),_.gain.gain.value=0,_.node=context.createJavaScriptNode(1024,2,2),_.node.onaudioprocess=onaudioprocess(this),_.src.connect(_.node),_.node.connect(_.gain),_.gain.connect(context.destination)},unlisten:function(){var _=this._;_.src&&_.src.disconnect(),_.gain&&_.gain.disconnect(),_.node&&_.node.disconnect()}};var onaudioprocess=function(self){return function(e){var _=self._,ins=e.inputBuffer,length=ins.length,writeIndex=_.writeIndex;_.bufferL.set(ins.getChannelData(0),writeIndex),_.bufferR.set(ins.getChannelData(1),writeIndex),_.writeIndex=writeIndex+length&BUFFER_MASK,_.totalWrite+=length}};impl.moz={set:function(src){var _=this._;src instanceof HTMLAudioElement&&(_.src=src,_.istep=_.samplerate/src.mozSampleRate)},listen:function(){var _=this._,o0=_.bufferL,o1=_.bufferR,prev0=0,prev1=0;2===_.src.mozChannels?(_.x=0,_.func=function(e){var x,i,writeIndex=_.writeIndex,totalWrite=_.totalWrite,samples=e.frameBuffer,istep=_.istep,imax=samples.length;for(x=_.x,i=0;imax>i;i+=2){for(x+=istep;x>0;)o0[writeIndex]=.5*(samples[i]+prev0),o1[writeIndex]=.5*(samples[i+1]+prev1),writeIndex=writeIndex+1&BUFFER_MASK,++totalWrite,x-=1;prev0=samples[i],prev1=samples[i+1]}_.x=x,_.writeIndex=writeIndex,_.totalWrite=totalWrite}):(_.x=0,_.func=function(e){var x,i,writeIndex=_.writeIndex,totalWrite=_.totalWrite,samples=e.frameBuffer,istep=_.istep,imax=samples.length;for(x=_.x,i=0;imax>i;++i){for(x+=istep;x>=0;)o0[writeIndex]=o1[writeIndex]=.5*(samples[i]+prev0),writeIndex=writeIndex+1&BUFFER_MASK,++totalWrite,x-=1;prev0=samples[i]}_.x=x,_.writeIndex=writeIndex,_.totalWrite=totalWrite}),_.src.addEventListener("MozAudioAvailable",_.func)},unlisten:function(){var _=this._;_.func&&(_.src.removeEventListener("MozAudioAvailable",_.func),_.func=null)}},fn.register("mediastream",MediaStreamNode)}}(timbre),function(T){"use strict";function MidiCpsNode(_args){T.Object.call(this,1,_args);var _=this._;_.midi=0,_.value=0,_.prev=null,_.a4=440,_.ar=!1}var fn=T.fn;fn.extend(MidiCpsNode);var $=MidiCpsNode.prototype;Object.defineProperties($,{midi:{set:function(value){"number"==typeof value&&(this._.midi=value)},get:function(){return this._.midi}},a4:{set:function(value){"number"==typeof value&&(this._.a4=value,this._.prev=null)},get:function(){return this._.a4}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(midi){var _=this._;return _.a4*Math.pow(2,(midi-69)/12)},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cell=this.cells[0],len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var a4=_.a4;for(i=0;imax>i;++i)cell[i]=a4*Math.pow(2,(cell[i]-69)/12);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=len?fn.inputSignalKR(this):_.midi;_.prev!==input&&(_.prev=input,_.value=_.a4*Math.pow(2,(input-69)/12)),cell[0]=_.value,fn.outputSignalKR(this)}}return this},fn.register("midicps",MidiCpsNode)}(timbre),function(T){"use strict";function MidiRatioNode(_args){T.Object.call(this,1,_args);var _=this._;_.midi=0,_.value=0,_.prev=null,_.range=12,_.ar=!1}var fn=T.fn;fn.extend(MidiRatioNode);var $=MidiRatioNode.prototype;Object.defineProperties($,{midi:{set:function(value){"number"==typeof value&&(this._.midi=value)},get:function(){return this._.midi}},range:{set:function(value){"number"==typeof value&&value>0&&(this._.range=value)},get:function(){return this._.range}}}),$.bang=function(){return this._.prev=null,this._.emit("bang"),this},$.at=function(midi){var _=this._;return Math.pow(2,midi/_.range)},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,len=this.nodes.length,imax=cell.length;if(_.ar&&len){fn.inputSignalAR(this);var range=_.range;for(i=0;imax>i;++i)cell[i]=Math.pow(2,cell[i]/range);_.value=cell[imax-1],fn.outputSignalAR(this)}else{var input=this.nodes.length?fn.inputSignalKR(this):_.midi;_.prev!==input&&(_.prev=input,_.value=Math.pow(2,input/_.range));var value=_.value*_.mul+_.add;for(i=0;imax>i;++i)cell[i]=value}}return this},fn.register("midiratio",MidiRatioNode)}(timbre),function(T){"use strict";function MinNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MinNode);var $=MinNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,val,nodes=this.nodes,imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0],cell.set(tmp),i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)val=tmp[j],cell[j]>val&&(cell[j]=val);else for(j=0;jmax>j;++j)cell[j]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)val=nodes[i].process(tickID).cells[0][0],tmp>val&&(tmp=val);else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("min",MinNode)}(timbre),function(T){"use strict";function MML(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.tracks=[],_.onended=fn.make_onended(this),_.currentTime=0,this.on("start",onstart)}var fn=T.fn;fn.extend(MML);var onstart=function(){var self=this,_=this._,mml=_.mml;"string"==typeof mml&&(mml=[mml]),_.tracks=mml.map(function(mml,i){return new MMLTrack(self,i,mml)}),_.currentTime=0,this.playbackState=fn.PLAYING_STATE};Object.defineProperty(onstart,"unremoved",{value:!0,writable:!1});var $=MML.prototype;Object.defineProperties($,{mml:{set:function(value){var _=this._;("string"==typeof value||Array.isArray(value))&&(_.mml=value)},get:function(){return this._.mml}},currentTime:{get:function(){return this._.currentTime}}}),$.on=$.addListener=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.on(type,listener),this},$.once=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.once(type,listener),this},$.off=$.removeListener=function(type,listener){return"mml"===type&&(type="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.off(type,listener),this},$.removeAllListeners=function(type){return"mml"===type&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),type="data"),this._.events.removeAllListeners(type),this},$.listeners=function(type){return"mml"===type&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),type="data"),this._.events.listeners(type)},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,tracks=_.tracks;for(i=0,imax=tracks.length;imax>i;++i)tracks[i].process();for(;i--;)tracks[i].ended&&tracks.splice(i,1);0===tracks.length&&fn.nextTick(_.onended),_.currentTime+=fn.currentTimeIncr}return this},fn.register("mml",MML);var MMLTrack=function(){function MMLTrack(sequencer,trackNum,mml){var _=this._={};_.sequencer=sequencer,_.trackNum=trackNum,_.commands=compile(mml),_.status={t:120,l:4,o:4,v:12,q:6,dot:0,tie:!1},_.index=0,_.queue=[],_.currentTime=0,_.queueTime=0,_.segnoIndex=-1,_.loopStack=[],_.prevNote=0,_.remain=1/0,this.ended=!1,sched(this)}var EOF=0,NOTEON=1,NOTEOFF=2,COMMAND=3;MMLTrack.prototype.process=function(){var _=this._,sequencer=_.sequencer,trackNum=_.trackNum,queue=_.queue,eof=!1;if(queue.length)for(;queue[0][0]<=_.currentTime;){var nextItem=_.queue.shift();switch(nextItem[1]){case NOTEON:noteOn(sequencer,trackNum,nextItem[2],nextItem[3]),_.remain=nextItem[4],sched(this);break;case NOTEOFF:noteOff(sequencer,trackNum,nextItem[2],nextItem[3]);break;case COMMAND:command(sequencer,nextItem[2]);break;case EOF:eof=!0}if(0===queue.length)break}_.remain-=fn.currentTimeIncr,eof&&(this.ended=!0),_.currentTime+=fn.currentTimeIncr};var noteOn=function(sequencer,trackNum,noteNum,velocity){var gen,i,imax,nodes=sequencer.nodes;for(i=0,imax=nodes.length;imax>i;++i)gen=nodes[i],gen.noteOn?gen.noteOn(noteNum,velocity):gen.bang();sequencer._.emit("data","noteOn",{trackNum:trackNum,noteNum:noteNum,velocity:velocity})},noteOff=function(sequencer,trackNum,noteNum,velocity){var gen,i,imax,nodes=sequencer.nodes;for(i=0,imax=nodes.length;imax>i;++i)gen=nodes[i],gen.noteOff?gen.noteOff(noteNum,velocity):gen.release&&gen.release();sequencer._.emit("data","noteOff",{trackNum:trackNum,noteNum:noteNum,velocity:velocity})},command=function(sequencer,cmd){sequencer._.emit("data","command",{command:cmd})},sched=function(self){var cmd,tempo,val,len,dot,vel,duration,quantize,pending,_queueTime,peek,i,imax,_=self._,commands=(_.sequencer,_.commands),queue=_.queue,index=_.index,status=_.status,queueTime=_.queueTime,loopStack=_.loopStack;pending=[];outer:for(;;){if(commands.length<=index){if(!(_.segnoIndex>=0))break;index=_.segnoIndex}switch(cmd=commands[index++],cmd.name){case"@":queue.push([queueTime,COMMAND,cmd.val]);break;case"n":if(tempo=status.t||120,null!==cmd.len?(len=cmd.len,dot=cmd.dot||0):(len=status.l,dot=cmd.dot||status.dot),duration=60/tempo*(4/len)*1e3,duration*=[1,1.5,1.75,1.875][dot]||1,vel=status.v<<3,status.tie){for(i=queue.length;i--;)if(queue[i][2]){queue.splice(i,1);break}val=_.prevNote}else val=_.prevNote=cmd.val+12*(status.o+1),queue.push([queueTime,NOTEON,val,vel,duration]);if(len>0){if(quantize=status.q/8,1>quantize)for(_queueTime=queueTime+duration*quantize,queue.push([_queueTime,NOTEOFF,val,vel]),i=0,imax=pending.length;imax>i;++i)queue.push([_queueTime,NOTEOFF,pending[i],vel]);if(pending=[],queueTime+=duration,!status.tie)break outer}else pending.push(val);status.tie=!1;break;case"r":tempo=status.t||120,null!==cmd.len?(len=cmd.len,dot=cmd.dot||0):(len=status.l,dot=cmd.dot||status.dot),len>0&&(duration=60/tempo*(4/len)*1e3,duration*=[1,1.5,1.75,1.875][dot]||1,queueTime+=duration);break;case"l":status.l=cmd.val,status.dot=cmd.dot;break;case"o":status.o=cmd.val;break;case"<":status.o<9&&(status.o+=1);break;case">":status.o>0&&(status.o-=1);break;case"v":status.v=cmd.val;break;case"(":status.v<15&&(status.v+=1);break;case")":status.v>0&&(status.v-=1);break;case"q":status.q=cmd.val;break;case"&":status.tie=!0;break;case"$":_.segnoIndex=index;break;case"[":loopStack.push([index,null,null]);break;case"|":peek=loopStack[loopStack.length-1],peek&&1===peek[1]&&(loopStack.pop(),index=peek[2]);break;case"]":peek=loopStack[loopStack.length-1],peek&&(null===peek[1]&&(peek[1]=cmd.count,peek[2]=index),peek[1]-=1,0===peek[1]?loopStack.pop():index=peek[0]);break;case"t":status.t=null===cmd.val?120:cmd.val;break;case"EOF":queue.push([queueTime,EOF])}}_.index=index,_.queueTime=queueTime},compile=function(mml){var def,re,m,cmd,i,imax,j,jmax,checked=new Array(mml.length),commands=[];for(i=0,imax=MMLCommands.length;imax>i;++i)for(def=MMLCommands[i],re=def.re;m=re.exec(mml);){if(!checked[m.index]){for(j=0,jmax=m[0].length;jmax>j;++j)checked[m.index+j]=!0;cmd=def.func?def.func(m):{name:m[0]},cmd&&(cmd.index=m.index,cmd.origin=m[0],commands.push(cmd))}for(;re.lastIndex<mml.length&&checked[re.lastIndex];)++re.lastIndex}return commands.sort(function(a,b){return a.index-b.index}),commands.push({name:"EOF"}),commands},MMLCommands=[{re:/@(\d*)/g,func:function(m){return{name:"@",val:m[1]||null}}},{re:/([cdefgab])([\-+]?)(\d*)(\.*)/g,func:function(m){return{name:"n",val:{c:0,d:2,e:4,f:5,g:7,a:9,b:11}[m[1]]+({"-":-1,"+":1}[m[2]]||0),len:""===m[3]?null:Math.min(0|m[3],64),dot:m[4].length}}},{re:/r(\d*)(\.*)/g,func:function(m){return{name:"r",len:""===m[1]?null:Math.max(1,Math.min(0|m[1],64)),dot:m[2].length}}},{re:/&/g},{re:/l(\d*)(\.*)/g,func:function(m){return{name:"l",val:""===m[1]?4:Math.min(0|m[1],64),dot:m[2].length}}},{re:/o([0-9])/g,func:function(m){return{name:"o",val:""===m[1]?4:0|m[1]}}},{re:/[<>]/g},{re:/v(\d*)/g,func:function(m){return{name:"v",val:""===m[1]?12:Math.min(0|m[1],15)}}},{re:/[()]/g},{re:/q([0-8])/g,func:function(m){return{name:"q",val:""===m[1]?6:Math.min(0|m[1],8)}}},{re:/\[/g},{re:/\|/g},{re:/\](\d*)/g,func:function(m){return{name:"]",count:0|m[1]||2}}},{re:/t(\d*)/g,func:function(m){return{name:"t",val:""===m[1]?null:Math.max(5,Math.min(0|m[1],300))}}},{re:/\$/g}];return MMLTrack}()}(timbre),function(T){"use strict";function MonoNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(MonoNode),MonoNode.prototype.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,_.ar?(fn.inputSignalAR(this),fn.outputSignalAR(this)):(this.cells[0][0]=fn.inputSignalKR(this),fn.outputSignalKR(this))),this},fn.register("mono",MonoNode)}(timbre),function(T){"use strict";function MulNode(_args){T.Object.call(this,2,_args)}var fn=T.fn;fn.extend(MulNode);var $=MulNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)cellL[j]*=tmpL[j],cellR[j]*=tmpR[j];else for(j=0;jmax>j;++j)cellL[j]=cellR[j]=0;fn.outputSignalAR(this)
}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)tmp*=nodes[i].process(tickID).cells[0][0];else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("*",MulNode)}(timbre),function(T){"use strict";function NDictNode(_args){T.Object.call(this,1,_args);var _=this._;_.defaultValue=0,_.index=0,_.dict={},_.ar=!1}var fn=T.fn;fn.extend(NDictNode);var $=NDictNode.prototype;Object.defineProperties($,{dict:{set:function(value){if("object"==typeof value)this._.dict=value;else if("function"==typeof value){for(var dict={},i=0;128>i;++i)dict[i]=value(i);this._.dict=dict}},get:function(){return this._.dict}},defaultValue:{set:function(value){"number"==typeof value&&(this._.defaultValue=value)},get:function(){return this._.defaultValue}},index:{set:function(value){"number"==typeof value&&(this._.index=value)},get:function(){return this._.index}}}),$.at=function(index){var _=this._;return(_.dict[0|index]||_.defaultValue)*_.mul+_.add},$.clear=function(){return this._.dict={},this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var index,value,i,len=this.nodes.length,dict=_.dict,defaultValue=_.defaultValue,mul=_.mul,add=_.add,imax=cell.length;if(_.ar&&len){for(fn.inputSignalAR(this),i=0;imax>i;++i)index=cell[i],index=0>index?index-.5|0:index+.5|0,cell[i]=(dict[index]||defaultValue)*mul+add;fn.outputSignalAR(this)}else for(index=this.nodes.length?fn.inputSignalKR(this):_.index,index=0>index?index-.5|0:index+.5|0,value=(dict[index]||defaultValue)*mul+add,i=0;imax>i;++i)cell[i]=value}return this},fn.register("ndict",NDictNode)}(timbre),function(T){"use strict";function NoiseNode(_args){T.Object.call(this,1,_args)}var fn=T.fn;fn.extend(NoiseNode);var $=NoiseNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,x,mul=_.mul,add=_.add;if(_.ar)for(i=0,imax=cell.length;imax>i;++i)cell[i]=(2*Math.random()-1)*mul+add;else for(x=(2*Math.random()+1)*mul+add,i=0,imax=cell.length;imax>i;++i)cell[i]=x}return this},fn.register("noise",NoiseNode)}(timbre),function(T){"use strict";function OscNode(_args){T.Object.call(this,2,_args);var _=this._;_.freq=T(440),_.phase=T(0),_.osc=new Oscillator(_.samplerate),_.tmp=new fn.SignalArray(_.cellsize),_.osc.step=_.cellsize,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue,Oscillator=T.modules.Oscillator;fn.extend(OscNode);var oninit=function(){var _=this._;this.wave||(this.wave="sin"),_.plotData=_.osc.wave,_.plotLineWidth=2,_.plotCyclic=!0,_.plotBefore=plotBefore},$=OscNode.prototype;Object.defineProperties($,{wave:{set:function(value){this._.osc.setWave(value)},get:function(){return this._.osc.wave}},freq:{set:function(value){"string"==typeof value&&(value=timevalue(value),value=0>=value?0:1e3/value),this._.freq=T(value)},get:function(){return this._.freq}},phase:{set:function(value){this._.phase=T(value),this._.osc.feedback=!1},get:function(){return this._.phase}},fb:{set:function(value){this._.phase=T(value),this._.osc.feedback=!0},get:function(){return this._.phase}}}),$.clone=function(){var instance=fn.clone(this);return instance._.osc=this._.osc.clone(),instance._.freq=this._.freq,instance._.phase=this._.phase,instance},$.bang=function(){return this._.osc.reset(),this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;var osc=_.osc,freq=_.freq.process(tickID).cells[0],phase=_.phase.process(tickID).cells[0];if(osc.frequency=freq[0],osc.phase=phase[0],_.ar){var tmp=_.tmp;for(_.freq.isAr?_.phase.isAr?osc.processWithFreqAndPhaseArray(tmp,freq,phase):osc.processWithFreqArray(tmp,freq):_.phase.isAr?osc.processWithPhaseArray(tmp,phase):osc.process(tmp),i=0;imax>i;++i)cellL[i]*=tmp[i],cellR[i]*=tmp[i]}else{var value=osc.next();for(i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value}fn.outputSignalAR(this)}return this};var plotBefore;"browser"===T.envtype&&(plotBefore=function(context,offset_x,offset_y,width,height){var y=(height>>1)+.5;context.strokeStyle="#ccc",context.lineWidth=1,context.beginPath(),context.moveTo(offset_x,y+offset_y),context.lineTo(offset_x+width,y+offset_y),context.stroke()}),fn.register("osc",OscNode),fn.register("sin",function(_args){return new OscNode(_args).set("wave","sin")}),fn.register("cos",function(_args){return new OscNode(_args).set("wave","cos")}),fn.register("pulse",function(_args){return new OscNode(_args).set("wave","pulse")}),fn.register("tri",function(_args){return new OscNode(_args).set("wave","tri")}),fn.register("saw",function(_args){return new OscNode(_args).set("wave","saw")}),fn.register("fami",function(_args){return new OscNode(_args).set("wave","fami")}),fn.register("konami",function(_args){return new OscNode(_args).set("wave","konami")}),fn.register("+sin",function(_args){return new OscNode(_args).set("wave","+sin").kr()}),fn.register("+pulse",function(_args){return new OscNode(_args).set("wave","+pulse").kr()}),fn.register("+tri",function(_args){return new OscNode(_args).set("wave","+tri").kr()}),fn.register("+saw",function(_args){return new OscNode(_args).set("wave","+saw").kr()}),fn.alias("square","pulse")}(timbre),function(T){"use strict";function PanNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.pos=T(0),_.panL=.5,_.panR=.5}var fn=T.fn;fn.extend(PanNode);var $=PanNode.prototype;Object.defineProperties($,{pos:{set:function(value){this._.pos=T(value)},get:function(){return this._.pos}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var pos=_.pos.process(tickID).cells[0][0];_.prevPos!==pos&&(_.panL=1-pos,_.panR=_.prevPos=pos);var i,j,tmp,nodes=this.nodes,cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cellL.length;if(imax){for(tmp=nodes[0].process(tickID).cells[0],j=0;jmax>j;++j)cellL[j]=cellR[j]=tmp[j];for(i=1;imax>i;++i)for(tmp=nodes[i].process(tickID).cells[0],j=0;jmax>j;++j)cellL[j]=cellR[j]+=tmp[j];var panL=_.panL,panR=_.panR;for(j=0;jmax>j;++j)cellL[j]=cellL[j]*panL,cellR[j]=cellR[j]*panR}else cellL.set(fn.emptycell),cellR.set(fn.emptycell);fn.outputSignalAR(this)}return this},fn.register("pan",PanNode)}(timbre),function(T){"use strict";function ParamNode(_args){T.Object.call(this,2,_args);var _=this._;_.value=0,_.env=new EnvelopeValue(_.samplerate),_.env.step=_.cellsize,_.curve="lin",_.counter=0,_.ar=!1,_.onended=make_onended(this),this.on("ar",onar)}var fn=T.fn,timevalue=T.timevalue,Envelope=T.modules.Envelope,EnvelopeValue=T.modules.EnvelopeValue;fn.extend(ParamNode);var make_onended=function(self,lastValue){return function(){if("number"==typeof lastValue)for(var cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],value=self._.env.value,i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=value;self._.emit("ended")}},onar=function(value){this._.env.step=value?1:this._.cellsize},$=ParamNode.prototype;Object.defineProperties($,{value:{set:function(value){"number"==typeof value&&(this._.env.value=value)},get:function(){return this._.env.value}}}),$.to=function(nextValue,time,curve){var _=this._,env=_.env;if("string"==typeof time?time=timevalue(time):"undefined"==typeof time&&(time=0),"undefined"==typeof curve)_.counter=env.setNext(nextValue,time,Envelope.CurveTypeLin),_.curve="lin";else{var _curve=Envelope.CurveTypeDict[curve];_.counter="undefined"==typeof _curve?env.setNext(nextValue,time,Envelope.CurveTypeCurve,curve):env.setNext(nextValue,time,_curve),_.curve=curve}return _.plotFlush=!0,this},$.setAt=function(nextValue,time){var _=this._;return this.to(_.env.value,time,"set"),_.atValue=nextValue,this},$.linTo=function(nextValue,time){return this.to(nextValue,time,"lin")},$.expTo=function(nextValue,time){return this.to(nextValue,time,"exp")},$.sinTo=function(nextValue,time){return this.to(nextValue,time,"sin")},$.welTo=function(nextValue,time){return this.to(nextValue,time,"wel")},$.sqrTo=function(nextValue,time){return this.to(nextValue,time,"sqr")},$.cubTo=function(nextValue,time){return this.to(nextValue,time,"cub")},$.cancel=function(){var _=this._;return _.counter=_.env.setNext(_.env.value,0,Envelope.CurveTypeSet),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,value,cellL=this.cells[1],cellR=this.cells[2],imax=_.cellsize,env=_.env,counter=_.counter;if(this.nodes.length)fn.inputSignalAR(this);else for(i=0;imax>i;++i)cellL[i]=cellR[i]=1;if(0>=counter&&("set"===_.curve?env.setNext(_.atValue,0,Envelope.CurveTypeSet):env.setNext(env.value,0,Envelope.CurveTypeSet),fn.nextTick(_.onended),_.counter=1/0),_.ar){for(i=0;imax>i;++i)value=env.next(),cellL[i]*=value,cellR[i]*=value;_.counter-=_.cellsize}else{for(value=env.next(),i=0;imax>i;++i)cellL[i]*=value,cellR[i]*=value;_.counter-=1}fn.outputSignalAR(this),_.value=value}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var _=this._;if(_.plotFlush){var curve,i,imax,env=new EnvelopeValue(128),data=new Float32Array(128);if("set"===_.curve)for(i=100,imax=data.length;imax>i;++i)data[i]=1;else for(curve=Envelope.CurveTypeDict[_.curve],"undefined"==typeof curve?env.setNext(1,1e3,Envelope.CurveTypeCurve,_.curve):env.setNext(1,1e3,curve),i=0,imax=data.length;imax>i;++i)data[i]=env.next();_.plotData=data,_.plotRange=[0,1],_.plotFlush=null}return super_plot.call(this,opts)},fn.register("param",ParamNode)}(timbre),function(T){"use strict";function PhaserNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.freq=T("sin",{freq:1,add:1e3,mul:250}).kr(),_.Q=T(1),_.allpass=[],this.steps=2}var fn=T.fn,Biquad=T.modules.Biquad;fn.extend(PhaserNode);var $=PhaserNode.prototype;Object.defineProperties($,{freq:{set:function(value){this._.freq=value},get:function(){return this._.freq}},Q:{set:function(value){this._.Q=T(value)},get:function(){return this._.Q}},steps:{set:function(value){if("number"==typeof value){if(value|=0,2===value||4===value||8===value||12===value){var allpass=this._.allpass;if(allpass.length<value)for(var i=allpass.length;value>i;++i)allpass[i]=new Biquad(this._.samplerate),allpass[i].setType("allpass")}this._.steps=value}},get:function(){return this._.steps}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),!_.bypassed){var i,cellL=this.cells[1],cellR=this.cells[2],freq=_.freq.process(tickID).cells[0][0],Q=_.Q.process(tickID).cells[0][0],steps=_.steps;for(i=0;steps>i;i+=2)_.allpass[i].setParams(freq,Q,0),_.allpass[i].process(cellL,cellR),_.allpass[i+1].setParams(freq,Q,0),_.allpass[i+1].process(cellL,cellR)}fn.outputSignalAR(this)}return this},fn.register("phaser",PhaserNode)}(timbre),function(T){"use strict";function PinkNoiseNode(_args){T.Object.call(this,1,_args),fn.fixAR(this);for(var whites=new Uint8Array(5),i=0;5>i;++i)whites[i]=(Math.random()*(1<<30)|0)%25;this._.whites=whites,this._.key=0}var MAX_KEY=31,fn=T.fn;fn.extend(PinkNoiseNode);var $=PinkNoiseNode.prototype;$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,imax,j,last_key,sum,diff,key=_.key,whites=_.whites,mul=_.mul,add=_.add;for(i=0,imax=cell.length;imax>i;++i){for(last_key=key++,key>MAX_KEY&&(key=0),diff=last_key^key,j=sum=0;5>j;++j)diff&1<<j&&(whites[j]=(Math.random()*(1<<30)|0)%25),sum+=whites[j];cell[i]=(.01666666*sum-1)*mul+add}_.key=key}return this},fn.register("pink",PinkNoiseNode)}(timbre),function(T){"use strict";function PluckNode(_args){T.Object.call(this,1,_args),this._.freq=440,this._.buffer=null,this._.index=0}var fn=T.fn;fn.extend(PluckNode);var $=PluckNode.prototype;Object.defineProperties($,{freq:{set:function(value){"number"==typeof value&&(0>value&&(value=0),this._.freq=value)},get:function(){return this._.freq}}}),$.bang=function(){for(var _=this._,freq=_.freq,size=_.samplerate/freq+.5|0,buffer=_.buffer=new fn.SignalArray(size),i=0;size>i;++i)buffer[i]=2*Math.random()-1;return _.index=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){this.tickID=tickID;var buffer=_.buffer;if(buffer){var write,x,i,bufferLength=buffer.length,index=_.index,mul=_.mul,add=_.add,imax=cell.length;for(i=0;imax>i;++i)write=index,x=buffer[index++],index>=bufferLength&&(index=0),x=.5*(x+buffer[index]),buffer[write]=x,cell[i]=x*mul+add;_.index=index}}return this},fn.register("pluck",PluckNode)}(timbre),function(T){"use strict";function RecNode(_args){T.Object.call(this,1,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.timeout=5e3,_.status=STATUS_WAIT,_.writeIndex=0,_.writeIndexIncr=1,_.currentTime=0,_.currentTimeIncr=1e3/_.samplerate,_.onended=make_onended(this)}var fn=T.fn,timevalue=T.timevalue,STATUS_WAIT=0,STATUS_REC=1;fn.extend(RecNode);var make_onended=function(self){return function(){var _=self._,buffer=new fn.SignalArray(_.buffer.subarray(0,0|_.writeIndex));_.status=STATUS_WAIT,_.writeIndex=0,_.currentTime=0,_.emit("ended",{buffer:buffer,samplerate:_.samplerate})}},$=RecNode.prototype;Object.defineProperties($,{timeout:{set:function(value){"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(this._.timeout=value)},get:function(){return this._.timeout}},samplerate:{set:function(value){"number"==typeof value&&value>0&&value<=this._.samplerate&&(this._.samplerate=value)},get:function(){return this._.samplerate}},currentTime:{get:function(){return this._.currentTime}}}),$.start=function(){var len,_=this._;return _.status===STATUS_WAIT&&(len=.01*_.timeout*_.samplerate|0,(!_.buffer||_.buffer.length<len)&&(_.buffer=new fn.SignalArray(len)),_.writeIndex=0,_.writeIndexIncr=_.samplerate/T.samplerate,_.currentTime=0,_.status=STATUS_REC,_.emit("start"),this.listen()),this},$.stop=function(){var _=this._;return _.status===STATUS_REC&&(_.status=STATUS_WAIT,_.emit("stop"),fn.nextTick(_.onended),this.unlisten()),this},$.bang=function(){return this._.status===STATUS_WAIT?this.srart():this._.status===STATUS_REC&&this.stop(),this._.emit("bang"),this},$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),_.status===STATUS_REC){var i,imax=cell.length,buffer=_.buffer,timeout=_.timeout,writeIndex=_.writeIndex,writeIndexIncr=_.writeIndexIncr,currentTime=_.currentTime,currentTimeIncr=_.currentTimeIncr;for(i=0;imax>i;++i)buffer[0|writeIndex]=cell[i],writeIndex+=writeIndexIncr,currentTime+=currentTimeIncr,currentTime>=timeout&&fn.nextTick(_.onended);_.writeIndex=writeIndex,_.currentTime=currentTime}fn.outputSignalAR(this)}return this},fn.register("record",RecNode),fn.alias("rec","record")}(timbre),function(T){"use strict";function ReverbNode(_args){T.Object.call(this,2,_args),fn.fixAR(this),this._.reverb=new Reverb(this._.samplerate,this._.cellsize)}var fn=T.fn,Reverb=T.modules.Reverb;fn.extend(ReverbNode);var $=ReverbNode.prototype;Object.defineProperties($,{room:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.setRoomSize(value))},get:function(){return this._.reverb.roomsize}},damp:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.setDamp(value))},get:function(){return this._.reverb.damp}},mix:{set:function(value){"number"==typeof value&&(value=value>1?1:0>value?0:value,this._.reverb.wet=value)},get:function(){return this._.reverb.wet}}}),$.process=function(tickID){var _=this._;return this.tickID!==tickID&&(this.tickID=tickID,fn.inputSignalAR(this),_.bypassed||_.reverb.process(this.cells[1],this.cells[2]),fn.outputSignalAR(this)),this},fn.register("reverb",ReverbNode)}(timbre),function(T){"use strict";function ScheduleNode(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;_.queue=[],_.currentTime=0,_.maxRemain=1e3}var fn=T.fn,timevalue=T.timevalue;fn.extend(ScheduleNode);var $=ScheduleNode.prototype;Object.defineProperties($,{queue:{get:function(){return this._.queue}},remain:{get:function(){return this._.queue.length}},maxRemain:{set:function(value){"number"==typeof value&&value>0&&(this._.maxRemain=value)},get:function(){return this._.maxRemain}},isEmpty:{get:function(){return 0===this._.queue.length}},currentTime:{get:function(){return this._.currentTime}}}),$.sched=function(delta,item,args){return"string"==typeof delta&&(delta=timevalue(delta)),"number"==typeof delta&&this.schedAbs(this._.currentTime+delta,item,args),this},$.schedAbs=function(time,item,args){if("string"==typeof time&&(time=timevalue(time)),"number"==typeof time){var _=this._,queue=_.queue;if(queue.length>=_.maxRemain)return this;for(var i=queue.length;i--&&!(queue[i][0]<time););queue.splice(i+1,0,[time,T(item),args])}return this},$.advance=function(delta){return"string"==typeof delta&&(delta=timevalue(delta)),"number"==typeof delta&&(this._.currentTime+=delta),this},$.clear=function(){return this._.queue.splice(0),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var emit=null,queue=_.queue;if(queue.length)for(;queue[0][0]<_.currentTime;){var nextItem=_.queue.shift();if(nextItem[1].bang(nextItem[2]),emit="sched",0===queue.length){emit="empty";break}}_.currentTime+=fn.currentTimeIncr,emit&&_.emit(emit)}return this},fn.register("schedule",ScheduleNode),fn.alias("sched","schedule")}(timbre),function(T){"use strict";function ScopeNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.samples=0,_.writeIndex=0,_.plotFlush=!0,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue;fn.extend(ScopeNode);var oninit=function(){this._.buffer||(this.size=1024),this._.interval||(this.interval=1e3)},$=ScopeNode.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.buffer&&"number"==typeof value){var n=64>value?64:value>2048?2048:value;_.buffer=new fn.SignalArray(n),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},interval:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*_.samplerate/_.buffer.length,_.samplesIncr<1&&(_.samplesIncr=1)):_.reservedinterval=value)},get:function(){return this._.interval}}}),$.bang=function(){for(var _=this._,buffer=_.buffer,i=0,imax=buffer.length;imax>i;++i)buffer[i]=0;return _.samples=0,_.writeIndex=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var i,cell=this.cells[0],imax=_.cellsize,samples=_.samples,samplesIncr=_.samplesIncr,buffer=_.buffer,writeIndex=_.writeIndex,emit=!1,bufferlength=buffer.length;for(i=0;imax>i;++i)0>=samples&&(buffer[writeIndex++]=cell[i],writeIndex>=bufferlength&&(writeIndex=0),emit=_.plotFlush=!0,samples+=samplesIncr),--samples;_.samples=samples,_.writeIndex=writeIndex,emit&&this._.emit("data")}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){var _=this._;if(_.plotFlush){for(var buffer=_.buffer,mask=buffer.length-1,data=new Float32Array(buffer.length),j=_.writeIndex,i=0,imax=buffer.length;imax>i;i++)data[i]=buffer[++j&mask];_.plotData=data,_.plotFlush=null}return super_plot.call(this,opts)},fn.register("scope",ScopeNode)}(timbre),function(T){"use strict";function ScriptProcessorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.numberOfInputs=0,_.numberOfOutputs=0,_.bufferSize=0,_.bufferMask=0,_.duration=0,_.inputBufferL=null,_.inputBufferR=null,_.outputBufferL=null,_.outputBufferR=null,_.onaudioprocess=null,_.index=0,this.once("init",oninit)}function AudioBuffer(self,buffers){this.samplerate=self._.samplerate,this.length=self._.bufferSize,this.duration=self._.duration,this.numberOfChannels=buffers.length,this.getChannelData=function(n){return buffers[n]}}function AudioProcessingEvent(self){var _=self._;this.node=self,this.playbackTime=T.currentTime,this.inputBuffer=2===_.numberOfInputs?new AudioBuffer(self,[_.inputBufferL,_.inputBufferR]):new AudioBuffer(self,[_.inputBufferL]),this.outputBuffer=2===_.numberOfOutputs?new AudioBuffer(self,[_.outputBufferL,_.outputBufferR]):new AudioBuffer(self,[_.outputBufferL])}var fn=T.fn;fn.extend(ScriptProcessorNode);var oninit=function(){var _=this._;0===_.numberOfInputs&&(this.numberOfInputs=1),0===_.numberOfOutputs&&(this.numberOfOutputs=1),0===_.bufferSize&&(this.bufferSize=1024)},$=ScriptProcessorNode.prototype;Object.defineProperties($,{numberOfInputs:{set:function(value){var _=this._;0===_.numberOfInputs&&(_.numberOfInputs=2===value?2:1)},get:function(){return this._.numberOfInputs}},numberOfOutputs:{set:function(value){var _=this._;0===_.numberOfOutputs&&(_.numberOfOutputs=2===value?2:1)},get:function(){return this._.numberOfOutputs}},bufferSize:{set:function(value){var _=this._;0===_.bufferSize&&-1!==[256,512,1024,2048,4096,8192,16384].indexOf(value)&&(_.bufferSize=value,_.bufferMask=value-1,_.duration=value/_.samplerate,_.inputBufferL=new fn.SignalArray(value),_.inputBufferR=new fn.SignalArray(value),_.outputBufferL=new fn.SignalArray(value),_.outputBufferR=new fn.SignalArray(value))},get:function(){return this._.bufferSize}},onaudioprocess:{set:function(value){"function"==typeof value&&(this._.onaudioprocess=value)},get:function(){return this._.onaudioprocess}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var buffer,cellsize=_.cellsize,bufferMask=_.bufferMask,begin=_.index,end=begin+cellsize,cellL=this.cells[1],cellR=this.cells[2];if(fn.inputSignalAR(this),2===_.numberOfInputs)_.inputBufferL.set(cellL,begin),_.inputBufferR.set(cellR,begin);else{buffer=_.inputBufferL;for(var i=0;cellsize>i;i++)buffer[begin+i]=.5*(cellL[i]+cellR[i])}cellL.set(_.outputBufferL.subarray(begin,end)),cellR.set(_.outputBufferR.subarray(begin,end)),_.index=end&bufferMask,0===_.index&&_.onaudioprocess&&(_.onaudioprocess(new AudioProcessingEvent(this)),1===_.numberOfOutputs&&_.outputBufferR.set(_.outputBufferL)),fn.outputSignalAR(this)}return this},fn.register("script",ScriptProcessorNode)}(timbre),function(T){"use strict";function SelectorNode(_args){T.Object.call(this,2,_args),this._.selected=0,this._.background=!1}var fn=T.fn;fn.extend(SelectorNode);var $=SelectorNode.prototype;Object.defineProperties($,{selected:{set:function(value){"number"==typeof value&&(this._.selected=value,this.cells[1].set(fn.emptycell),this.cells[2].set(fn.emptycell))},get:function(){return this._.selected}},background:{set:function(value){this._.background=!!value},get:function(){return this._.background}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,nodes=this.nodes,imax=nodes.length;if(_.background)for(i=0;imax>i;++i)nodes[i].process(tickID);var tmp=nodes[_.selected];tmp&&(_.background||tmp.process(tickID),this.cells[1].set(tmp.cells[1]),this.cells[2].set(tmp.cells[2])),fn.outputSignalAR(this)}return this},fn.register("selector",SelectorNode)}(timbre),function(T){"use strict";function SpectrumNode(_args){T.Object.call(this,2,_args),fn.listener(this),fn.fixAR(this);var _=this._;_.status=WAIT_STATE,_.samples=0,_.samplesIncr=0,_.writeIndex=0,_.plotFlush=!0,_.plotRange=[0,32],_.plotBarStyle=!0,this.once("init",oninit)}var fn=T.fn,timevalue=T.timevalue,FFT=T.modules.FFT,WAIT_STATE=0,EXEC_STATE=1;fn.extend(SpectrumNode);var oninit=function(){var _=this._;_.fft||(this.size=512),_.interval||(this.interval=500)},$=SpectrumNode.prototype;Object.defineProperties($,{size:{set:function(value){var _=this._;if(!_.fft&&"number"==typeof value){var n=256>value?256:value>2048?2048:value;_.fft=new FFT(n),_.buffer=new fn.SignalArray(_.fft.length),_.freqs=new fn.SignalArray(_.fft.length>>1),_.reservedwindow&&(_.fft.setWindow(_.reservedwindow),_.reservedwindow=null),_.reservedinterval&&(this.interval=_.reservedinterval,_.reservedinterval=null)}},get:function(){return this._.buffer.length}},window:{set:function(value){this._.fft.setWindow(value)},get:function(){return this._.fft.windowName}},interval:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>0&&(_.buffer?(_.interval=value,_.samplesIncr=.001*value*_.samplerate,_.samplesIncr<_.buffer.length&&(_.samplesIncr=_.buffer.length,_.interval=1e3*_.samplesIncr/_.samplerate)):_.reservedinterval=value)},get:function(){return this._.interval}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}},real:{get:function(){return this._.fft.real}},imag:{get:function(){return this._.fft.imag}}}),$.bang=function(){return this._.samples=0,this._.writeIndex=0,this._.emit("bang"),this},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID,fn.inputSignalAR(this),fn.outputSignalAR(this);var i,emit,cell=this.cells[0],imax=cell.length,status=_.status,samples=_.samples,samplesIncr=_.samplesIncr,writeIndex=_.writeIndex,buffer=_.buffer,bufferLength=buffer.length;for(i=0;imax>i;++i)0>=samples&&status===WAIT_STATE&&(status=EXEC_STATE,writeIndex=0,samples+=samplesIncr),status===EXEC_STATE&&(buffer[writeIndex++]=cell[i],writeIndex>=bufferLength&&(_.fft.forward(buffer),emit=_.plotFlush=!0,status=WAIT_STATE)),--samples;_.samples=samples,_.status=status,_.writeIndex=writeIndex,emit&&this._.emit("data")}return this};var super_plot=T.Object.prototype.plot;$.plot=function(opts){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),super_plot.call(this,opts)},fn.register("spectrum",SpectrumNode)}(timbre),function(T){"use strict";function SubtractNode(_args){T.Object.call(this,2,_args),this._.ar=!1}var fn=T.fn;fn.extend(SubtractNode);var $=SubtractNode.prototype;$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var i,j,tmp,tmpL,tmpR,nodes=this.nodes,cell=this.cells[0],cellL=this.cells[1],cellR=this.cells[2],imax=nodes.length,jmax=cell.length;if(_.ar){if(nodes.length>0)for(nodes[0].process(tickID),tmpL=nodes[0].cells[1],tmpR=nodes[0].cells[2],cellL.set(tmpL),cellR.set(tmpR),i=1;imax>i;++i)for(nodes[i].process(tickID),tmpL=nodes[i].cells[1],tmpR=nodes[i].cells[2],j=0;jmax>j;++j)cellL[j]-=tmpL[j],cellR[j]-=tmpR[j];else for(j=0;jmax>j;++j)cellL[j]=cellR[i]=0;fn.outputSignalAR(this)}else{if(nodes.length>0)for(tmp=nodes[0].process(tickID).cells[0][0],i=1;imax>i;++i)tmp-=nodes[i].process(tickID).cells[0][0];else tmp=0;cell[0]=tmp,fn.outputSignalKR(this)}}return this},fn.register("-",SubtractNode)}(timbre),function(T){"use strict";function SynthDefNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.poly=4,_.genList=[],_.genDict={},_.synthdef=null,_.remGen=make_remGen(this),_.onended=fn.make_onended(this)}var fn=T.fn;fn.extend(SynthDefNode);var $=SynthDefNode.prototype;Object.defineProperties($,{def:{set:function(value){"function"==typeof value&&(this._.synthdef=value)},get:function(){return this._.synthdef}},poly:{set:function(value){"number"==typeof value&&value>0&&64>=value&&(this._.poly=value)},get:function(){return this._.poly}}});var make_doneAction=function(self,opts){return function(){self._.remGen(opts.gen)}},make_remGen=function(self){return function(gen){var _=self._,i=_.genList.indexOf(gen);-1!==i&&_.genList.splice(i,1),"undefined"!=typeof gen.noteNum&&(_.genDict[gen.noteNum]=null)}},noteOn=function(noteNum,freq,velocity,_opts){velocity|=0,0>=velocity?this.noteOff(this,noteNum):velocity>127&&(velocity=127);var _=this._,list=_.genList,dict=_.genDict,gen=dict[noteNum];gen&&_.remGen(gen);var opts={freq:freq,noteNum:noteNum,velocity:velocity,mul:.0078125*velocity};if(_opts)for(var key in _opts)opts[key]=_opts[key];opts.doneAction=make_doneAction(this,opts),gen=_.synthdef.call(this,opts),gen instanceof T.Object&&(gen.noteNum=noteNum,list.push(gen),dict[noteNum]=opts.gen=gen,this.playbackState=fn.PLAYING_STATE,list.length>_.poly&&_.remGen(list[0]))},midicps=function(){for(var table=new Float32Array(128),i=0;128>i;++i)table[i]=440*Math.pow(2,1*(i-69)/12);return table}(),cpsmidi=function(cps){return cps>0?Math.log(1*cps/440)*Math.LOG2E*12+69:0};$.noteOn=function(noteNum,velocity,_opts){var freq=midicps[noteNum]||440*Math.pow(2,(noteNum-69)/12);return noteOn.call(this,noteNum+.5|0,freq,velocity,_opts),this},$.noteOff=function(noteNum){var gen=this._.genDict[noteNum];return gen&&gen.release&&gen.release(),this},$.noteOnWithFreq=function(freq,velocity,_opts){var noteNum=cpsmidi(freq);return noteOn.call(this,noteNum+.5|0,freq,velocity,_opts),this},$.noteOffWithFreq=function(freq){var noteNum=cpsmidi(freq);return this.noteOff(noteNum+.5|0)},$.allNoteOff=function(){for(var list=this._.genList,i=0,imax=list.length;imax>i;++i)list[i].release&&list[i].release()},$.allSoundOff=function(){for(var _=this._,list=_.genList,dict=_.genDict;list.length;)delete dict[list.shift().noteNum]},$.synth=function(_opts){var gen,_=this._,list=_.genList,opts={};if(_opts)for(var key in _opts)opts[key]=_opts[key];return opts.doneAction=make_doneAction(this,opts),gen=_.synthdef.call(this,opts),gen instanceof T.Object&&(list.push(gen),opts.gen=gen,this.playbackState=fn.PLAYING_STATE,list.length>_.poly&&_.remGen(list[0])),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){if(this.tickID=tickID,this.playbackState===fn.PLAYING_STATE){var gen,i,imax,j,tmpL,tmpR,list=_.genList,cellL=this.cells[1],cellR=this.cells[2],jmax=cell.length;if(list.length)for(gen=list[0],gen.process(tickID),cellL.set(gen.cells[1]),cellR.set(gen.cells[2]),i=1,imax=list.length;imax>i;++i)for(gen=list[i],gen.process(tickID),tmpL=gen.cells[1],tmpR=gen.cells[2],j=0;jmax>j;++j)cellL[j]+=tmpL[j],cellR[j]+=tmpR[j];else fn.nextTick(_.onended)}fn.outputSignalAR(this)}return this},fn.register("SynthDef",SynthDefNode);var env_desc={set:function(value){fn.isDictionary(value)?"string"==typeof value.type&&(this._.env=value):value instanceof T.Object&&(this._.env=value)},get:function(){return this._.env}};fn.register("OscGen",function(){var osc_desc={set:function(value){value instanceof T.Object&&(this._.osc=value)},get:function(){return this._.osc}},wave_desc={set:function(value){"string"==typeof value&&(this._.wave=value)},get:function(){return this._.wave}},synthdef=function(opts){var synth,osc,env,envtype,_=this._;return osc=_.osc||null,env=_.env||{},envtype=env.type||"perc",osc instanceof T.Object&&"function"==typeof osc.clone&&(osc=osc.clone()),osc||(osc=T("osc",{wave:_.wave})),osc.freq=opts.freq,osc.mul=osc.mul*opts.velocity/128,synth=osc,env instanceof T.Object?"function"==typeof env.clone&&(synth=env.clone().append(synth)):synth=T(envtype,env,synth),synth.on("ended",opts.doneAction).bang(),synth};return function(_args){var instance=new SynthDefNode(_args);return instance._.wave="sin",Object.defineProperties(instance,{env:env_desc,osc:osc_desc,wave:wave_desc}),instance.def=synthdef,instance}}()),fn.register("PluckGen",function(){var synthdef=function(opts){var synth,env,envtype,_=this._;return env=_.env||{},envtype=env.type||"perc",synth=T("pluck",{freq:opts.freq,mul:opts.velocity/128}).bang(),env instanceof T.Object?"function"==typeof env.clone&&(synth=env.clone().append(synth)):synth=T(envtype,env,synth),synth.on("ended",opts.doneAction).bang(),synth};return function(_args){var instance=new SynthDefNode(_args);return Object.defineProperties(instance,{env:env_desc}),instance.def=synthdef,instance}}())}(timbre),function(T){"use strict";function ScissorNode(_args){T.Object.call(this,2,_args),fn.fixAR(this);var _=this._;_.isLooped=!1,_.onended=fn.make_onended(this,0)}var fn=T.fn,Scissor=T.modules.Scissor,Tape=Scissor.Tape,TapeStream=Scissor.TapeStream,isSignalArray=fn.isSignalArray;fn.extend(ScissorNode);var $=ScissorNode.prototype;Object.defineProperties($,{tape:{set:function(tape){tape instanceof Tape?(this.playbackState=fn.PLAYING_STATE,this._.tape=tape,this._.tapeStream=new TapeStream(tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped):(tape instanceof T.Object&&tape.buffer&&(tape=tape.buffer),"object"==typeof tape&&Array.isArray(tape.buffer)&&isSignalArray(tape.buffer[0])&&(this.playbackState=fn.PLAYING_STATE,this._.tape=new Scissor(tape),this._.tapeStream=new TapeStream(this._.tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped))
},get:function(){return this._.tape}},isLooped:{get:function(){return this._.isLooped}},buffer:{get:function(){return this._.tape?this._.tape.getBuffer():void 0}}}),$.loop=function(value){return this._.isLooped=!!value,this._.tapeStream&&(this._.tapeStream.isLooped=this._.isLooped),this},$.bang=function(){return this.playbackState=fn.PLAYING_STATE,this._.tapeStream&&this._.tapeStream.reset(),this._.emit("bang"),this},$.getBuffer=function(){return this._.tape?this._.tape.getBuffer():void 0},$.process=function(tickID){var _=this._;if(this.tickID!==tickID){this.tickID=tickID;var tapeStream=_.tapeStream;if(tapeStream){var cellL=this.cells[1],cellR=this.cells[2],tmp=tapeStream.fetch(cellL.length);cellL.set(tmp[0]),cellR.set(tmp[1]),this.playbackState===fn.PLAYING_STATE&&tapeStream.isEnded&&fn.nextTick(_.onended)}fn.outputSignalAR(this)}return this},fn.register("tape",ScissorNode)}(timbre),function(T){"use strict";function TaskNode(_args){T.Object.call(this,1,_args),fn.timer(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.task=[],_.i=0,_.j=0,_.imax=0,_.jmax=0,_.wait=0,_.count=0,_.args={},_.doNum=1,_.initFunc=fn.nop,_.onended=make_onended(this),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue,FunctionWrapper=T(function(){}).constructor;fn.extend(TaskNode);var onstart=function(){var args,_=this._;this.playbackState=fn.PLAYING_STATE,_.task=this.nodes.map(function(x){return x instanceof FunctionWrapper?x.func:!1}).filter(function(x){return!!x}),_.i=_.j=0,_.imax=_.doNum,_.jmax=_.task.length,args=_.initFunc(),fn.isDictionary(args)||(args={param:args}),_.args=args},make_onended=function(self){return function(){self.playbackState=fn.FINISHED_STATE;var _=self._,cell=self.cells[0],cellL=self.cells[1],cellR=self.cells[2],lastValue=_.args;if("number"==typeof lastValue)for(var i=0,imax=cellL.length;imax>i;++i)cell[0]=cellL[i]=cellR[i]=lastValue;_.emit("ended",_.args)}},$=TaskNode.prototype;Object.defineProperties($,{"do":{set:function(value){"number"==typeof value&&value>0&&(this._.doNum=1/0===value?1/0:0|value)},get:function(){return this._.doNum}},init:{set:function(value){"function"==typeof value&&(this._.initFunc=value)},get:function(){return this._.initFunc}}}),$.bang=function(){var _=this._;return _.count=0,_.emit("bang"),this},$.wait=function(time){return"string"==typeof time&&(time=timevalue(time)),"number"==typeof time&&time>0&&(this._.count+=this._.samplerate*time*.001|0),this},$.process=function(tickID){var func,cell=this.cells[0],_=this._;if(this.tickID!==tickID&&(this.tickID=tickID,_.i<_.imax)){for(;_.count<=0;){if(_.j>=_.jmax){if(++_.i,_.i>=_.imax){fn.nextTick(_.onended);break}_.j=0}func=_.task[_.j++],func&&func.call(this,_.i,_.args)}_.count-=cell.length}return this},fn.register("task",TaskNode)}(timbre),function(T){"use strict";function TimeoutNode(_args){T.Object.call(this,0,_args),fn.timer(this),fn.fixKR(this);var _=this._;this.playbackState=fn.FINISHED_STATE,_.currentTime=0,_.samplesMax=0,_.samples=0,_.onended=fn.make_onended(this),this.once("init",oninit),this.on("start",onstart)}var fn=T.fn,timevalue=T.timevalue;fn.extend(TimeoutNode);var oninit=function(){this._.timeout||(this.timeout=1e3)},onstart=function(){this.playbackState=fn.PLAYING_STATE};Object.defineProperty(onstart,"unremovable",{value:!0,writable:!1});var $=TimeoutNode.prototype;Object.defineProperties($,{timeout:{set:function(value){var _=this._;"string"==typeof value&&(value=timevalue(value)),"number"==typeof value&&value>=0&&(this.playbackState=fn.PLAYING_STATE,_.timeout=value,_.samplesMax=.001*_.samplerate*value|0,_.samples=_.samplesMax)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),$.bang=function(){var _=this._;return this.playbackState=fn.PLAYING_STATE,_.samples=_.samplesMax,_.currentTime=0,_.emit("bang"),this},$.process=function(tickID){var cell=this.cells[0],_=this._;if(this.tickID!==tickID){if(this.tickID=tickID,_.samples>0&&(_.samples-=cell.length),_.samples<=0){for(var nodes=this.nodes,i=0,imax=nodes.length;imax>i;++i)nodes[i].bang();fn.nextTick(_.onended)}_.currentTime+=fn.currentTimeIncr}return this},fn.register("timeout",TimeoutNode)}(timbre),function(T){"use strict";function WaveShaperNode(_args){T.Object.call(this,1,_args),fn.fixAR(this),this._.curve=null}var fn=T.fn;fn.extend(WaveShaperNode);var $=WaveShaperNode.prototype;Object.defineProperties($,{curve:{set:function(value){fn.isSignalArray(value)&&(this._.curve=value)},get:function(){return this._.curve}}}),$.process=function(tickID){var _=this._;if(this.tickID!==tickID){if(this.tickID=tickID,fn.inputSignalAR(this),_.curve){var x,i,cell=this.cells[0],curve=_.curve,len=curve.length,imax=_.cellsize;for(i=0;imax>i;++i)x=.5*(cell[i]+1)*len+.5|0,0>x?x=0:x>=len-1&&(x=len-1),cell[i]=curve[x]}fn.outputSignalAR(this)}return this},fn.register("waveshaper",WaveShaperNode)}(timbre),function(T){"use strict";function ZMapNode(_args){T.Object.call(this,1,_args);var _=this._;_.inMin=0,_.inMax=1,_.outMin=0,_.outMax=1,_.ar=!1,this.once("init",oninit)}var fn=T.fn;fn.extend(ZMapNode);var oninit=function(){this._.warp||(this.warp="linlin")},$=ZMapNode.prototype;Object.defineProperties($,{inMin:{set:function(value){"number"==typeof value&&(this._.inMin=value)},get:function(){return this._.inMin}},inMax:{set:function(value){"number"==typeof value&&(this._.inMax=value)},get:function(){return this._.inMax}},outMin:{set:function(value){"number"==typeof value&&(this._.outMin=value)},get:function(){return this._.outMin}},outMax:{set:function(value){"number"==typeof value&&(this._.outMax=value)},get:function(){return this._.outMax}},warp:{set:function(value){if("string"==typeof value){var f=WarpFunctions[value];f&&(this._.warp=f,this._.warpName=value)}},get:function(){return this._.warpName}}}),$.process=function(tickID){var _=this._,cell=this.cells[0];if(this.tickID!==tickID){this.tickID=tickID;var i,inMin=_.inMin,inMax=_.inMax,outMin=_.outMin,outMax=_.outMax,warp=_.warp,len=this.nodes.length,mul=_.mul,add=_.add,imax=cell.length;if(_.ar&&len){for(fn.inputSignalAR(this),i=0;imax>i;++i)cell[i]=warp(cell[i],inMin,inMax,outMin,outMax)*mul+add;fn.outputSignalAR(this)}else{var input=this.nodes.length?fn.inputSignalKR(this):0,value=warp(input,inMin,inMax,outMin,outMax)*mul+add;for(i=0;imax>i;++i)cell[i]=value}}return this};var WarpFunctions={linlin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:inMax===inMin?outMin:(x-inMin)/(inMax-inMin)*(outMax-outMin)+outMin},linexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===outMin?0:inMax===inMin?outMax:Math.pow(outMax/outMin,(x-inMin)/(inMax-inMin))*outMin},explin:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin?outMax:Math.log(x/inMin)/Math.log(inMax/inMin)*(outMax-outMin)+outMin},expexp:function(x,inMin,inMax,outMin,outMax){return inMin>x?outMin:x>inMax?outMax:0===inMin||0===outMin?0:Math.pow(outMax/outMin,Math.log(x/inMin)/Math.log(inMax/inMin))*outMin}};fn.register("zmap",ZMapNode)}(timbre);