// Generated by CoffeeScript 1.6.3
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['jquery', 'underscore', 'backbone', 'views/pad', 'collections/group', 'text!/js/templates/pads.ejs'], function($, _, Backbone, PadView, GroupCollection, PadsTemplate) {
    var PadsView, _ref;
    return PadsView = (function(_super) {
      __extends(PadsView, _super);

      function PadsView() {
        _ref = PadsView.__super__.constructor.apply(this, arguments);
        return _ref;
      }

      PadsView.prototype.el = '.pads';

      PadsView.prototype.template = _.template(PadsTemplate);

      PadsView.prototype.colorMap = {
        '1': '#ADD5FF',
        '2': '#FF8D8D',
        '3': '#BBBBD4',
        '4': '#EBECF2',
        '5': '#FFE97F'
      };

      PadsView.prototype.initialize = function(options) {
        var _this = this;
        this.app = options.parent;
        this.groups = new GroupCollection({
          position: 1
        }, {
          view: this
        });
        this.currentGroup = this.groups.at(0);
        this.createPads();
        this.bootstrapGroupPads(this.currentGroup);
        this.render();
        this.listenTo(this.groups, 'reset', function(collection) {
          collection.each(function(model) {
            return _this.bootstrapGroupPads(model);
          });
          return _this.render(1);
        });
        return this.listenTo(this.groups, 'add', function(model) {
          _this.bootstrapGroupPads(model);
          return _this.render(model.get('position'));
        });
      };

      PadsView.prototype.createPads = function() {
        var i, options, z, _results;
        this.pads = [];
        i = 1;
        z = 0;
        _results = [];
        while (i <= 128) {
          options = {
            name: 'c' + (i - z * 16),
            parent: this
          };
          this.pads.push(new PadView(options));
          if (i % 16 === 0) {
            z++;
          }
          _results.push(i++);
        }
        return _results;
      };

      PadsView.prototype.bootstrapGroupPads = function(group) {
        var pads, pos;
        pos = group.get('position') - 1 || 0;
        pads = this.pads.slice(pos * 16, pos * 16 + 16);
        return _.each(pads, function(pad, i) {
          if (group.sounds.at(i) != null) {
            return pad.bootstrapWithModel(group.sounds.at(i));
          }
        });
      };

      PadsView.prototype.record = function(pad) {
        var tick;
        if (this.app.transport._recording && pad.model) {
          tick = this.app.transport.getTick();
          console.log('recordHit at %s', tick);
          this.app.transport.pattern || (this.app.transport.pattern = {});
          this.app.transport.pattern[tick] || (this.app.transport.pattern[tick] = []);
          return this.app.transport.pattern[tick].push(pad.model.get('pad'));
        }
      };

      PadsView.prototype.toggleGroupSelectButtons = function(group) {
        return $('[data-behavior="selectGroup"]').removeClass('active').filter('[data-meta="' + group + '"]').addClass('active');
      };

      PadsView.prototype.render = function(group) {
        var active, zeroedIndex;
        if (group == null) {
          group = 1;
        }
        this.$('.pad-container').detach();
        this.toggleGroupSelectButtons(group);
        zeroedIndex = group - 1;
        active = this.groups.findWhere({
          position: group
        });
        if (active === 'undefined') {
          active = this.groups.create({
            position: group
          });
        }
        this.currentGroup = active;
        this.currentPads = this.pads.slice(zeroedIndex * 16, zeroedIndex * 16 + 16);
        this.app.display.model.set('right', 'Group ' + group);
        return this.$el.append(_.pluck(this.currentPads, 'el'));
      };

      return PadsView;

    })(Backbone.View);
  });

}).call(this);
