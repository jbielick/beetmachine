(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};define(["jquery","underscore","backbone","module","routes/app","views/pads","views/display","views/transport","views/sequence","views/pattern","models/recipe"],function($,_,Backbone,module,Router,Pads,Display,Transport,Sequence,Pattern,RecipeModel){var AppView;return new(AppView=function(_super){function AppView(){return AppView.__super__.constructor.apply(this,arguments)}return __extends(AppView,_super),AppView.prototype.el="body",AppView.prototype.initialize=function(){var defaultKeys;return this.router=new Router({app:this}),this.display=new Display({parent:this}),this.pads=new Pads({parent:this}),this.pattern=new Pattern({parent:this}),this.sequence=new Sequence({parent:this}),this.transport=new Transport({parent:this}),this.recipe=new RecipeModel,this.keyMap={},defaultKeys="6789yuiohjklnm,.",_.each(defaultKeys,function(_this){return function(key,i){return _this.keyMap[key.charCodeAt(0)]=i}}(this)),this.display.log("Ready"),_.isEmpty(module.config().recipe)?void 0:this.open(module.config().recipe,{parse:!0})},AppView.prototype.events={"click [data-behavior]":"delegateBehavior",keypress:"keyPressDelegate",keydown:"keyDownDelegate"},AppView.prototype.delegateBehavior=function(e){var behavior;return behavior=$(e.currentTarget).data("behavior"),null!=behavior&&_.isFunction(this[behavior])?this[behavior](e):void 0},AppView.prototype.selectGroup=function(e){var $target;return $target=$(e.currentTarget),this.pads.render($target.data("meta"))},AppView.prototype.open=function(recipe){return this.recipe=recipe,recipe.groups.length>0&&this.pads.groups.reset(recipe.groups),recipe.keyMap?this.keyMap=_.extend(this.keyMap,recipe.keyMap):void 0},AppView.prototype.save=function(){return this.recipe.set("groups",this.pads.groups.toJSON()),console.log(this.recipe.toJSON())},AppView.prototype.keyDownDelegate=function(e){var key,prevent;return key=String.fromCharCode(e.keyCode),"R"===key&&e.ctrlKey?(this.transport.record(),prevent=!0):" "===key?(this.transport.play(),prevent=!0):_.indexOf([1,"1","2","3","4","5","6","7","8"],key)>0&&e.ctrlKey&&(prevent=!0,this.pads.render(key),prevent)?e.preventDefault():void 0},AppView.prototype.keyPressDelegate=function(e){var sound;return null!=this.keyMap[e.charCode]&&(sound=this.pads.currentGroup.sounds.findWhere({pad:this.keyMap[e.charCode]+1}))?sound.trigger("press"):void 0},AppView}(Backbone.View))})}).call(this);