(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};define(["jquery","underscore","backbone","models/sound","views/editor","ligaments","text!/js/templates/pad.ejs"],function($,_,Backbone,SoundModel,SoundEditor,ligaments,PadTemplate){var PadView;return PadView=function(_super){function PadView(){return PadView.__super__.constructor.apply(this,arguments)}return __extends(PadView,_super),PadView.prototype.attributes={"class":"small-3 columns pad-container"},PadView.prototype.template=_.template(PadTemplate),PadView.prototype.initialize=function(options){return this.parent=options.parent,this.name=options.name,_.bindAll(this,"listenToModelChanges","press"),this.on("modelPresent",this.listenToModelChanges),this.render()},PadView.prototype.listenToModelChanges=function(){return this.stopListening(this.model,"press"),this.listenTo(this.model,"press",this.press),this.stopListening(this.model,"change:fx.*"),this.listenTo(this.model,"change:fx.*",function(_this){return function(){return _this.timbreContextAttached=!1,_this.rendered=!1}}(this))},PadView.prototype.bootstrapWithModel=function(sound){if(!sound&&!sound instanceof SoundModel)throw new Error("Must provide a SoundModel instance when mapping a pad.");return(this.model=sound).pad=this,this.model.get("keyCode")&&this.model.set("key",String.fromCharCode(this.model.get("keyCode"))),new Backbone.Ligaments({model:this.model,view:this}),this.loadSrc(this.model.get("src"),function(_this){return function(){return _this.trigger("modelPresent")}}(this))},PadView.prototype.render=function(){return this.el.innerHTML=this.template({name:this.name})},PadView.prototype.events={"contextmenu .pad":"edit","mousedown .pad":"press","mouseup .pad":"release",dragover:"prevent",dragenter:"prevent",drop:"uploadSample"},PadView.prototype.prevent=function(e){return e.preventDefault(),e.stopPropagation()},PadView.prototype.press=function(e){return e&&2===e.button?!0:(this.$(".pad").addClass("active"),setTimeout(function(_this){return function(){return _this.$(".pad").removeClass("active")}}(this),50),this.loaded?this.play().parent.record(this):void 0)},PadView.prototype.release=function(){},PadView.prototype.play=function(){var sound,_ref,_this;return _this=_this,this.rendered?(null!=(_ref=this.T.rendered)?_ref.playbackState:void 0)?this.T.rendered.currentTime=0:this.T.rendered.bang():(sound=this.renderEffects(),this.timbreContextAttached?sound.bang():(this.timbreContextAttached=!0,sound.play())),this},PadView.prototype.createModel=function(attrs){return null==attrs&&(attrs={}),this.model=new SoundModel(_.extend({pad:this.$el.index()+1},attrs)),this.parent.currentGroup.sounds.add(this.model),this.model},PadView.prototype.loadSrc=function(url,cb){var _this;return _this=this,url||this.model.get("src")?T("audio").load(url||this.model.get("src"),function(){return _this.T={raw:this},_this.loaded=!0,_this.$(".pad").addClass("mapped"),_this.parent.app.display.log(_this.name+" loaded"),cb?cb.call(_this,this):void 0}):void 0},PadView.prototype.renderEffects=function(){var sound;return sound=null,this.T&&delete this.T.rendered,this.T.rendered=this.T.raw.clone(),_.each(this.model.get("fx"),function(_this){return function(params,fx){return sound=T(fx,params,sound||_this.T.rendered)}}(this)),this.rendered=!0,sound||this.T.rendered},PadView.prototype.uploadSample=function(e){var objectUrl;return e=e.originalEvent,e.preventDefault(),e.stopPropagation(),this.model||this.createModel(),objectUrl=URL.createObjectURL(e.dataTransfer.files[0]),this.model.set("src",objectUrl,{silent:!0}),this.loadSrc(objectUrl,function(_this){return function(){return _this.trigger("modelPresent")}}(this)),this.parent.app.display.log("New Sample Uploaded on "+this.name+": "+e.dataTransfer.files[0].name)},PadView.prototype.edit=function(e){var editor;return e.preventDefault(),this.editor?this.editor.show():(editor=new SoundEditor({model:this.model||this.createModel(),pad:this}),this.editor=editor)},PadView}(Backbone.View)})}).call(this);